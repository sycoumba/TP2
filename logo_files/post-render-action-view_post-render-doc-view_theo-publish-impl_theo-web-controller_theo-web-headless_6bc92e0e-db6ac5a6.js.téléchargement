(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[40],{"14LO":function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComposite",(function(){return i}));var o=n("uTW7");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e){r(this,"dcxComposite",void 0),r(this,"current",void 0),r(this,"localStoragePath",void 0),this.dcxComposite=e.composite,this.current=new o.DCXDocumentBranch({branch:e.composite.current,componentURLfn:e.componentURLfn,overrideIDfn:e.overrideIDfn}),this.localStoragePath="local-storage://"}}},"1tmr":function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("UzQk");function r(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class i{constructor(e,t){r(this,"branch",void 0),r(this,"node",void 0),this.branch=e,this.node=t}reparent(e){if(e!==this.node){const t=this.node.childComponents.indexOf(this);t>=0?(e.childComponents.push(this),this.node.childComponents.splice(t,1),this.node=e,this.attachToNode()):o.CoreAssert.fail("internal error: component isn't attached to the node we think it is")}}update(e){const t=this.node.childComponents.indexOf(this);t<0?o.CoreAssert.fail("replaceWith: component isn't attached to the node we think it is"):e.node===this.node?(this.detachFromNode(),this.node.childComponents.splice(t,1,e),e.attachToNode()):o.CoreAssert.fail("replaceWith: only supports same-node replacement")}}},"2uFU":function(e,t,n){"use strict";function o(){let e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0;const n=e.filter(e=>-1===e.indexOf("_REMIX_"));return[...new Set([...n,...t.getRemixAncestorsCpMachineTags()])]}function r(e){const{width:t,height:n}=e.firstPage.pageSize;return{width:t,height:n}}n.r(t),n.d(t,"getRemixAncestorsIntoMachineTags",(function(){return o})),n.d(t,"getDocumentSize",(function(){return r}))},"3xdQ":function(e,t,n){var o,r;function i(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,o)}return n}function a(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}o=[n("YLtl"),n("UFvF"),n("MGCh"),n("rCSV"),n("a8ov"),n("r3b0"),n("U44B"),n("UzQk"),n("mwMu"),n("qnb0"),n("TdwW"),n("O0ct"),n("ZLL8"),n("WpJZ"),n("hEO4"),n("uiRp"),n("KpqY"),n("6lgp"),n("2uFU")],void 0===(r=function(e,t,n,o,r,c,s,l,u,d,p,h,m,g,f,v,y,C,S){const b=r.default,F=v.default,I=y.default,k=o.default,T=n.channel("core-wrapper");return function(n){n=n||{};var o={};o.events=new k,o.ActionError=C.default;var r,g=null,v=!1,y=null,w=!1,A=null,P=null,D=null,x=null,L=[],N=null,M=0,O=l.TheoPoint.ZERO,U=!1,R=[],E=function(){var t=!0;return g.content.root.visitAll((function(n){"image"===n.kind?n.url&&!e.startsWith(n.url,"data:")||(t=!1):"vector"===n.kind&&"uploading svg"===n.url&&(t=!1)})),t};o.monitorTransactions=function(){f.monitorTransactionsForDocument(g)},o.validateDoc=function(e){const t=l.TheoDocumentUtils.validateDoc(g,e);t&&T.error("validateDoc: ".concat(t.errorMsg),t)},o.getManifestData=function(){return g.encodeToJSON()},o.getDocumentCCID=function(){return g.uuid||" "};var B=function(e){var t=new c({makeComponentUrl:function(){return b.encodeDesignFilterComponentUrl()},trackAbsolutePath:!1,branch:e});return l.TheoDocument.newDocumentFromDataObject(t,null)};o.getTemporaryDocumentWithFontsLoaded=function(e){var n=B(e),o=n.missingFontList;return o.length?h.loadMissingFonts(o).then((function(){return B(e)})):t.resolve(n)};var W=e.throttle((function(){w&&E()&&o.events.publish("save-requested")}),500),G=[];function _(){G.forEach((function(e){e.unsubscribe()}));var t={};(G=[]).push(g.firstPage.subscribeWithCallback((function(n){0===--M&&(e.each(t,(function(e){(e.transform||e.geometry||e.style)&&o.events.publish("forma-dirty",e)})),o.events.publish("document-in-new-renderable-state"))}),l.FormaEndUpdateMessage.TYPE)),G.push(g.firstPage.subscribeWithCallback((function(e){if(0===M&&(t={}),e.event.forma){var n=e.event.forma.formaID,o=t[n];o||(t[n]=o={formaID:n}),e.event instanceof l.FormaTransformChangedEvent?o.transform=!0:e.event instanceof l.FormaGeometryChangedEvent?o.geometry=!0:e.event instanceof l.FormaStyleChangedEvent&&(o.style=!0)}M++}),l.FormaBeginUpdateMessage.TYPE)),G.push(g.controller.subscribeWithCallback((function(e){o.inCharStyleMode&&o.handleTapped({x:e.state.clickLocation.x,y:e.state.clickLocation.y,forma:e.state.forma})}),l.ClickMessage.TYPE)),G.push(g.controller.subscribeWithCallback((function(e){o.events.publish("layer-double-tapped")}),l.DoubleClickMessage.TYPE)),G.push(g.controller.model.subscribeWithCallback((function(e){e.changes.indexOf("snaplines")>=0&&o.events.publish("update-snap-lines",{lines:g.controller.model.snapLines.getAll()}),e.changes.indexOf("handles")>=0&&o.events.publish("update-handles"),e.changes.indexOf("swapState")>=0&&o.events.publish("update-swap-state"),e.changes.indexOf("action-feedback")>=0&&function(e){if(!e)return;switch(e.showWaiting){case l.ActionFeedbackWaitingType.Loading:o.events.publish("show-app-loading-indicator");break;case l.ActionFeedbackWaitingType.None:o.events.publish("hide-app-loading-indicator");break;default:l.CoreAssert.fail("Unknown value for showWaiting.")}null!=e.message&&o.events.publish("show-actionfeedback-message-modal",{messageType:e.messageType,messageObj:e.message})}(g.controller.model.actionFeedback.getActionFeedback())}),l.EditorModelChangedMessage.TYPE)),G.push(g.subscribeWithCallback((function(e){}),l.TheoDocumentRequestsSaveMessage.TYPE))}function j(e){return e?e.contentNode&&e.contentNode.url?b.decodeUrl(e.contentNode.url):(T.error("image forma has no contentNode or url"),null):(T.error("image forma is not defined"),null)}function H(e){if(e){var t=e.bounds;return e.controller&&(t=e.controller.size||e.bounds),{width:t.width,height:t.height}}}function z(){for(var e=g.controller.model.handles.getAll(),t=!1,n=null,r=[],i=null,a=null,c=null,s=null,u=null,d=!1,p=null,h=0;h<e.length;h++){var m=e[h];if(m instanceof l.BoxTransformHandles){if(m instanceof l.BoxTransformMultipleFormae){n=[];for(var f=0;f<m.formaIDs.length;f++){var v=m.formaIDs[f],y=o.getFormaById(v);null!=y&&n.push({formaID:v,bounds:y.bounds,placement:y.totalPlacement,isGroup:!(!y.controller||!y.controller.userGroup)})}if(0===n.length&&(n=[{formaID:"group",placement:m.reference.placement,bounds:m.reference.bounds,isGroup:!0}]),d=m.displayHints.includes(l.BoxHandleDisplayHint.GroupOutlineColor),u=m.displayHints.includes(l.BoxHandleDisplayHint.WideOutline),null!=i)continue}m.activeTransform===l.TransformType.Translate&&(t=!0),t||m.allowedTransforms.forEach((function(e){var t=Z(e);t&&r.push(t)})),c=m.allowedTransforms.includes(l.TransformType.RotateAboutCenter)&&!m.displayHints.includes(l.BoxHandleDisplayHint.SuppressRotationHandle)&&(m.activeTransform===l.TransformType.None||m.activeTransform===l.TransformType.RotateAboutCenter),i=m.reference.placement,a=m.reference.bounds,s=m.displayHints.includes(l.BoxHandleDisplayHint.ThinOutline),d=m.displayHints.includes(l.BoxHandleDisplayHint.GroupOutlineColor),p=m.displayHints.includes(l.BoxHandleDisplayHint.TextFrame)}}if(null===i)return null;var C=o.getDocumentSize();return{documentSize:new l.TheoSize(C.width,C.height),matrix2d:i,bounds:a,enablePips:r.length>0,rotateable:c,handlePoints:r,thinOutline:s,wideOutline:u,transparentOutline:t,textFrame:p,highlightRects:n,groupOutlineColor:d,inCropMode:o.inCropMode()}}function V(e){if(e){var t=o.getDocumentSize(),n=e.totalPlacement,r=H(e);return{forma:e,matrix2d:[n.a,n.b,n.c,n.d,n.tx,n.ty],documentWidth:t.width,documentHeight:t.height,width:r.width,height:r.height,showLeftLine:e.isRangeStart(),showRightLine:e.isRangeEnd()}}}function K(){var t=g.firstPage.colorLibraryController.getColorThemeAsArrayOfSolidColors();return e.map(t,(function(e){return e.red+":"+e.green+":"+e.blue})).join(":")}function X(t){return e.map(t,(function(e){var t=e.sprkElemId||e.id||null,n=e.sprkRoles||e.roles||null,o=p.rgb2SolidColor(e);return p.solidColor2TheoColor(o,t,n)}))}function Y(t){return e.map(t,(function(e){var t;return"string"==typeof e?(t=p.hex2SolidColor(e),p.solidColor2TheoColor(t,null,null)):(t=p.hex2SolidColor(e.color),p.solidColor2TheoColor(t,e.id,e.roles))}))}function J(){return t.Promise((function(e){r.invalidatePatches(e)}))}var Q=[{type:l.TransformType.TopLeftCornerTranslate,spot:new l.TheoPoint(0,0)},{type:l.TransformType.TopRightCornerTranslate,spot:new l.TheoPoint(1,0)},{type:l.TransformType.BottomLeftCornerTranslate,spot:new l.TheoPoint(0,1)},{type:l.TransformType.BottomRightCornerTranslate,spot:new l.TheoPoint(1,1)},{type:l.TransformType.TopSideTranslate,spot:new l.TheoPoint(.5,0)},{type:l.TransformType.BottomSideTranslate,spot:new l.TheoPoint(.5,1)},{type:l.TransformType.LeftSideTranslate,spot:new l.TheoPoint(0,.5)},{type:l.TransformType.RightSideTranslate,spot:new l.TheoPoint(1,.5)}];function q(e){const t=Q.find(t=>t.spot.x===e.x&&t.spot.y===e.y);return t?t.type:null}function Z(e){const t=Q.find(t=>t.type===e);return t?t.spot:null}function $(e){var t=e.getProperty("components"),n=t&&t.arrayValue&&t.arrayValue[0];return n&&n.dictionaryValue&&n.dictionaryValue.url&&n.dictionaryValue.url.stringValue}function ee(e){return e.catch((function(e){let t=e;t.isAllowedError||(e.errorMsg&&(t=e.errorMsg),T.error("doAction",t||"Unknown error!"),o.forceReloadEditor())}))}function te(e,t){let n=I.doAction(g,e);return!t&&o.shouldReloadOnActionFailure()&&(n=ee(n)),n}function ne(e,t,n){let r=I.doActionWithCompletion(g,e,t);return!n&&o.shouldReloadOnActionFailure()&&(r=ee(r)),r}function oe(){var e=o.getAllSelectedFormas();!1===g.controller.selection.inCharStyleMode&&!0===o.inCharStyleMode&&o.exitCharStyleMode(),0!==e.length&&e[0].isTypeLockup()||o.events.publish("text-forma-selected",{id:null,forma:null,selectionBoxes:[]}),e.length>0?o.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:z()}):o.events.publish("forma-selected",{id:null,forma:null})}function re(e,t){e&&o.events.publish("forma-updated",{id:e.formaID,selected:o.getSelectedForma()&&e.formaID===o.getSelectedFormaId(),snapLines:t,selectionBox:z(),data:{forma:e}})}function ie(e){null==e&&(e=!0),o.events.publish("design-updated",{formaAdded:e})}function ae(e){for(var t=e.controller,n=[],r=1;r<t.owner.selection.selectedCount;r++){var i=t.owner.selection.formaAt(r);n.push(V(i))}o.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:n})}function ce(e,t){e&&t&&(e.selectCharStyleForma(),e.updateGroup(),ie(!1),e.selectCharStyleForma(),ae(t))}function se(t){return t&&"image"===t.kind&&(!t.url||e.startsWith(t.url,"data:"))}return o.inCharStyleMode=!1,o.generateKeyFrames=function(){var e=o.beginTransaction("revertAnimationPlay"),t=l.MotionUtils.getCurrentAnimationStyle(g);l.AnimationFacade.applyAnimationStyle(t,g.firstPage),o.endTransactionAndMergeWithPrevious(e),ie(!1)},o.getGraph=function(e,t){void 0===t&&(t=o.getWatermarkEnabledForDoc());const n=g.firstPage.pgm.getGraph(e?l.PGMExportSettings.DYNAMIC:l.PGMExportSettings.STATIC);return t?F.addWatermark(n):n},o.postDocumentHasHighResImageSaveableState=function(){var e=t.defer();return function t(){if(E()&&!g.database.mutableState){var n=g.stateID;e.resolve(n)}else setTimeout(t,1e3)}(),e.promise},o.validateDBSaveState=function(t){const n=g.database.getState(t);for(var o=0;o<R.length;o++){var r=n.getObjectStateByID(R[o]);if(r){var i=r.object;if("image"===i.kind){const t=$(r);if(!t||e.startsWith(t,"data:"))return!1}else if("vector"===i.kind){if("uploading svg"===$(r))return!1}}}return!0},o.saveWithRenditions=function(e,t,n){return x.saveWithRenditions(g,e,t,n)},o.saveCopyWithRenditions=function(e,t,n){return e.saveWithRenditions(g,t,n)},o.saveImageComponent=function(e,t,n,o,r){return x.saveImageComponent(e,t,n,o,r)},o.initializeNewPost=function(n){var r,i=l.TypeLockupUtils.fixUpQuotes(n.text,""),a=n.palette,c=o.imageFormas(),s=t.defer(),u=o.hostImages(),d=e.map(u,(function(e){return e.imgLoadedPromise}));if(c.length>=1)Promise.all(d).then((function(){const e=o.beginTransaction("create_initial_theme_from_image");g.firstPage.colorLibraryController.createInitialThemeFromImage(),s.resolve(),o.endTransaction(e)}));else{if(n.defaultBackgroundColor){var p=g.firstPage.root.filterByKind(l.ShapeForma.KIND),h=p&&p[0];h&&(r={shape:h,color:n.defaultBackgroundColor})}o.setColorPalette({colors:a,id:"0"},{shuffle:!r}).then(s.resolve)}return s.promise.then((function(){if(r){var e=o.beginTransaction("set_color_id");r.shape.style.colors.setColorId(l.ColorRole.FieldPrimary,r.color),o.endTransactionAndMergeWithPrevious(e,!0)}return 0===o.lockupFormas().length?i.length?(o.downloadNewLockupRandomFontsAsync(),o.addNewLockup(i,{silent:!0,select:!!n.selectText})):t.resolve():(T.error("initializeNewPost error. We shouldn't be adding multiple lockups. Probably git issue 2093."),t.resolve())})).then((function(){return c.length>1?te(new l.CreatePaddedCollageAction).then((function(){ie(!1)})):t.resolve()})).then((function(){return o.retrieveAndApplyASuggestedGridStyle()})).then((function(){W()}))},o.resetUserActions=function(){r.reset()},o.undoToInitialState=function(){return t.Promise((function(e,t){r.setCurrentTimelineIndex(0,e)}))},o.beginBranch=function(){r.beginBranch()},o.endBranch=function(e){r.endBranch(e)},o.beginGesture=function(){return r.beginGesture(),r.gestureScope},o.endGesture=function(e){r.endGesture(e)},o.undo=function(){return t.Promise((function(e,t){r.undo((function(){o.events.publish("undo-finished"),e()}))}))},o.redo=function(){return t.Promise((function(e,t){r.redo((function(){o.events.publish("redo-finished"),e()}))}))},o.canUndo=function(){return r.getCurrentTimelineIndex()>0&&0===r.getActionDepth()},o.canRedo=function(){return r.getCurrentTimelineIndex()<r.getTimelineLength()-1&&0===r.getActionDepth()},o.getUndoDescription=function(){return r.getUndoDescription()},o.getRedoDescription=function(){return r.getRedoDescription()},o.getCurrentTimelineIndex=function(){return r.getCurrentTimelineIndex()},o.getCurrentTimelineState=function(){return r.getCurrentTimelineState()},o.documentId=function(){return x.documentId()||D.documentId()},o.backgroundColor=function(){return g.firstPage.root.style.colors.color(l.ColorRole.FieldPrimary)},o.getFormaBackgroundColor=function(e){var t=e.style.colors.fieldPrimary;return t?g.firstPage.colorLibraryController.getTheoColorForSolidColor(t):null},o.triggerEnteredPalette=function(){g.firstPage.colorLibraryController.enteredPalettePicker()},o.triggerTextSidebarDisplayed=function(){g.firstPage.colorLibraryController.enteredPalettePicker()},o.isBackgroundVisible=function(){var e=o.getGridForma();return e?e.controller.isBackgroundVisible():0===o.imageFormas().length},o.getImageFormaForURL=function(e){for(var t=o.imageFormas(),n=0;n<t.length;n++){var r=t[n];if(null!=r.contentNode&&r.contentNode.url===e)return r}return null},o.getImagePreviewData=function(e){if(e&&e.isImage()){var t=l.ImageFacade.getImageFormaForForma(e);if(t&&t.contentNode)return T.info("image preview placement:",t.placement),{colorThemeKey:K(),formaID:t.formaID,forma:t,url:j(t),styleFilter:t.style,placement:t.placement,width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return{}},o.getFormaRenderList=function(){var e=[];let t=!1;const n=Y(["FF0000"])[0];var r=g.firstPage.root.visitAsArray(l.FormaTraversal.PreOrder);const c=(t,n)=>e.push(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?i(Object(n),!0).forEach((function(t){a(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):i(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},t,{type:n}));for(var s=0;s<r.length;s++){const i=r[s],{controller:a,formaID:u,kind:d}=i;if(a){const r={forma:i,formaID:u};if("Root"===d&&c(r,"background"),"Shape"===d&&c(r,"shape"),"Frame"===d)continue;if(i.isTypeLockup()&&c(r,"lockup"),d===l.ImageForma.KIND||d===l.VideoForma.KIND){const r=j(i);null==r?(T.error("no image url, cleaning up the document",{docId:g.uuid,imageFormaId:i.uuid}),t=!0,o.replaceImagesWithColors([i],[n]).done()):e.push({forma:i.parent,type:"image",formaID:i.parent.formaID,url:r,logo:i.isLogo(),colorThemeKey:K()})}}}return t&&(o.events.publish("show-image-forma-corrupted-modal",{backgroundColor:n.rgbColor.rgbHex}),o.validateDoc("missingContentCleanup")),e},o.imageFormas=function(){return g.firstPage.root.filterByKind(l.ImageForma.KIND)},o.canAddMoreImages=function(e){return o.imageFormas().length+e<=l.GridController.MAX_IMAGE_COUNT},o.hostImages=function(){var e=[];return o.imageFormas().forEach((function(t){void 0!==t.contentNode.image&&e.push(t.contentNode.image)})),e},o.iconFormas=function(){return g.firstPage.root.filterWithCallback((function(e){return e.hasIntent(l.Forma.INTENT_ICON)}))},o.lockupFormas=function(){return g.firstPage.root.filterByControllerKind(l.TypeLockupController.KIND)},o.logoFormas=function(){return o.imageFormas().filter((function(e){return e.isLogo()}))},o.backgroundImageFormas=function(){return g.firstPage.root.filterWithCallback((function(e){return e.kind===l.FrameForma.KIND&&e.isBackgroundImage()}))},o.getLockupWordCount=function(){for(var e=[],t=o.lockupFormas(),n=0;n<t.length;n++)e.push(t[n].controller.text.trim().split(/ |\n/).length);return e},o.getIconCount=function(){return o.iconFormas().length},o.getImageCount=function(){return o.imageFormas().length},o.getPotentialBackgroundImageCount=function(){return g.firstPage.root.filterWithCallback(e=>l.ImageFacade.isPotentialBackgroundImage(e)).length},o.documentSize=function(){return{width:g.firstPage.pageSize.width,height:g.firstPage.pageSize.height}},o.getDocumentSize=function(){return S.getDocumentSize(g)},o.getImageSizeIfFullBleed=function(){var e=o.imageFormas();if(1===e.length){var t=e[0],n=o.getDocumentSize(),r=t.parent;if(r.finalFrame.width===n.width&&r.finalFrame.height===n.height&&t.contentNode)return{width:t.contentNode.pixelWidth,height:t.contentNode.pixelHeight}}return null},o.forceReloadEditor=function(e){o.events.publish("force-reload-editor",e)},o.shouldReloadOnActionFailure=function(){return s.isFeatureEnabled("post-reload-on-action-failure")},o.doAction=te,o.flipForma=function(e,t){te(new l.FlipAction(e,[t])).then((function(){o.events.publish("forma-flipped",{id:t.formaID,isImage:t.isImage()})}))},o.canDuplicateFormae=function(e){return l.DuplicateAction.canAddImages(e)},o.duplicateFormae=function(e){return r.currentlyExecutingAction()?t.reject():te(new l.DuplicateAction(e,!0,!0)).then((function(t){for(var n=!1,r=0;r<e.length;r++)if(e[r].isImage()){n=!0;break}return o.events.publish("formae-duplicated",{duplicatedImage:n}),t}))},o.inCropMode=function(){return g.controller.selection.inCropMode},o.enterCropMode=function(){return U&&T.error("probable error. cropModeBranchStarted shouldn't be true"),U||r.currentlyExecutingAction()||o.inCropMode()?t():(U=!0,o.beginBranch(),te(new l.EnterCropModeAction(o.getSelectedForma())))},o.exitCropMode=function(){return o.events.publish("exit-crop-mode"),r.currentlyExecutingAction()?t():te(new l.ExitCropModeAction).then(()=>{U&&(o.endBranch(!0),U=!1)})},o.inSpecialSelectionMode=function(){return!0===o.inCropMode()||!0===o.inCharStyleMode},o.exitSpecialSelectionMode=function(){!0===o.inCropMode()&&o.exitCropMode().done(),!0===o.inCharStyleMode&&o.exitCharStyleMode()},o.setImageAsBackground=function(){return r.currentlyExecutingAction()?t():te(new l.SetImageAsBackgroundAction).then(e=>(o.events.publish("image-set-background",{}),e))},o.setImageAsForeground=function(){return r.currentlyExecutingAction()?t():te(new l.SetImageAsFloatingAction).then(e=>(o.events.publish("image-set-foreground",{}),e))},o.deleteFormae=function(e){for(var t=[],n=o.getSelectedForma(),r=0;r<e.length;r++)t.push(o.getFormaById(e[r].formaID));return e=t,o.inCharStyleMode&&null!=n&&n.isTypeLockup()&&o.exitCharStyleMode(),o.deselect(),te(new l.DeleteAction(e)).then((function(){for(var t=[],n=!1,r=0;r<e.length;r++)t.push(e[r].formaID),n||(n=e[r].isImage());o.events.publish("formae-deleted",{ids:t,deletedImage:n})}))},o.groupItems=function(e,t,n){return te(new l.GroupAction(e,t,n))},o.ungroupItems=function(e,t,n){return te(new l.UngroupAction(e,t,n))},o.cleanupInvalidImageSync=function(e,t){if(e){const n=l.ImageFacade.getFrameFormaForForma(o.getFormaById(e)),r=o.beginTransaction("CleanUpCorruptImage");n&&l.CreationFacade.deleteFormae([n]),o.removeContentForCorruptImageFrame(t),o.endTransactionAndMergeWithPrevious(r),o.events.publish("formae-deleted",{ids:[e],deletedImage:n.isImage()})}},o.cleanupInvalidImageWithColorSync=function(e,t,n){if(e){const r=e&&o.getFormaById(e),i=o.beginTransaction("CleanUpCorruptImageWithColor");r&&l.ImageFacade.replaceImageWithColors(r,n),o.removeContentForCorruptImageFrame(t),o.endTransactionAndMergeWithPrevious(i)}},o.replaceImagesWithColors=function(e,t){return te(new l.ReplaceImagesWithColorsAction(e,t))},o.setImageCutout=function(e,t){return te(new l.SetImageCutoutAction(e,t))},o.getDeleteInfo=function(e){for(var t=o.getGridForma(),n=t&&1===t.style.numBackgroundCells,r=!1,i=!0,a=0;a<e.length;a++)if(e[a]&&e[a].isImage()&&e[a].isBackgroundImage()){r=!0,i=t.controller.canDeleteCellForForma(e[a])&&!n;break}return{isDeleteable:i,isBackgroundImage:r}},o.getSelectedBoundingBox=function(){return z()},o.getSwapState=function(){return g.controller.model.activeSwap.getActive()},o.isMultiSelect=function(){return l.SelectionFacade.isMultiSelect(g.controller.selection)},o.isGroupSelect=function(){const e=g.controller.selection.asFormaArray(),t=1===e.length&&e[0];return t&&t.kind===l.GroupForma.KIND&&t.intent===l.Forma.INTENT_USER_GROUP},o.getSelectedForma=function(){const e=g.controller.selection.asFormaArray();return e.length?e[0]:null},o.getAllSelectedFormas=function(){return g.controller.selection.asFormaArray()},o.getSelectedFormaId=function(){var e=o.getSelectedForma();return e?e.formaID:null},o.getSelectableFormaeIntersectingRect=function(e){return g.firstPage.selectableFormaeIntersectingRect(e)},o.removeStaleSelections=function(){g.controller.selection.removeStaleSelections()},o.getRootForma=function(){return g.firstPage.root},o.getDocument=function(){return g},o.getFormaById=function(e){return g.firstPage.formaByID(e)},o.selectFormaById=function(e){if(e.forma=o.getFormaById(e.formaId),e.forma)return o.selectForma(e),e.forma},o.marqueeSelectFormae=function(e,t){l.SelectionFacade.marqueeSelectFormae(e,t)},o.selectAll=function(){l.SelectionFacade.selectAllOnPage(g.firstPage)},o.deselectAll=function(){l.SelectionFacade.deselectAllOnPage(g.firstPage)},o.canSelectSibling=function(){return!o.inSpecialSelectionMode()&&l.SelectionFacade.canSelectSibling(g.firstPage)},o.selectSibling=function(e){l.SelectionFacade.selectSibling(g.firstPage,e)},o.canSelectParent=function(){return!o.inSpecialSelectionMode()&&l.SelectionFacade.canSelectParent(g.firstPage)},o.selectParent=function(){l.SelectionFacade.selectParent(g.firstPage)},o.canSelectChild=function(){return!o.inSpecialSelectionMode()&&l.SelectionFacade.canSelectChild(g.firstPage)},o.selectChild=function(){l.SelectionFacade.selectChild(g.firstPage)},o.deselect=function(e){e=e||{};var t=o.getSelectedForma();o.inCharStyleMode&&null!=t&&t.isTypeLockup()&&o.exitCharStyleMode(),o.inCropMode()&&o.exitCropMode().done(),g.controller.selection.clearSelection(!e.silent)},o.deselectForma=function(e){g.controller.selection.deselectForma(e)},o.formaIsSelected=function(e){return g.controller.selection.isSelected(e)},o.formaIsGroupSelected=function(e){return g.controller.selection.isGroupSelected(e)},o.selectForma=function(e){var t=o.getSelectedForma(),n=e.forma,r=e.silent,i=!e.multiselect;if(n&&(e.multiselect||o.getSelectedFormaId()!==n.formaID))if(e.multiselect&&o.formaIsSelected(e.forma))o.deselectForma(e.forma);else{if(o.inCharStyleMode&&null!=t&&t.isTypeLockup()&&o.exitCharStyleMode(),"Root"===n.kind&&!o.isBackgroundVisible())return T.error("error in selection. background is not visible, so don't allow selection"),void o.deselect();i&&o.deselect({silent:!0}),g.controller.selection.selectForma(n,!r)}},o.ensureBackgroundFormaSelected=function(){var e=o.getSelectedForma(),t=e&&!e.isTypeLockup()&&!e.isLogo()&&e.controller.moveable;if(!e||!(e.isBackgroundImage()||e.isShape()||"Root"===e.kind||e.isGridCell()||t)){var n=o.backgroundImageFormas();if(n.length>0)o.selectForma({forma:n[0]});else{var r=g.firstPage.root.filterByControllerKind("shape");r.length>0?o.selectForma({forma:r[0]}):o.selectForma({forma:g.firstPage.root})}}},o.ensureLockupSelected=function(){var e=o.getSelectedForma();if(!e||!e.isTypeLockup()){var t=o.lockupFormas();t.length>0&&o.selectForma({forma:t[0]})}},o.handleNudge=function(e){var t=e.translate;return te(new l.NudgeAction(new l.TheoPoint(t.x,t.y)))},o.handleHandleFeedback=function(e){for(var t=g.controller.model.handles.getAll(),n=null,r=0;r<t.length;r++)!(t[r]instanceof l.BoxTransformHandles)||n&&t[r]instanceof l.BoxTransformMultipleFormae||(n=t[r]);if(n){var i;switch(e.action){case"begin":i=l.HandleTransformStage.Begin;break;case"update":i=l.HandleTransformStage.Update;break;case"end":i=l.HandleTransformStage.End;break;default:return void T.error("handleHandleFeedback: params.action wasn't an expected value; it was "+e.action)}var a,c=null;switch(e.part){case"rotate":c=new l.RotateAboutCenterTransformEvent(n,i,e.totalDeltaRadians||0);break;case"corner":a=q(e.spot),c=new l.CornerTranslateTransformEvent(n,i,a,new l.TheoPoint(e.location.x,e.location.y));break;case"side":a=q(e.spot),c=new l.SideTranslateTransformEvent(n,i,a,new l.TheoPoint(e.location.x,e.location.y));break;default:return void T.error("handleHandleFeedback: params.part wasn't an expected value; it was "+e.part)}c.viewportScale=o.getViewScale(),g.controller.designController.handles.handleTransformEvent(c)}},o.getSelectedFormaRotation=function(){var e=o.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),180*Math.atan2(t.placement.transformValues.rotSine,t.placement.transformValues.rotCosine)/Math.PI},o.getSelectedFormaHasShapeMask=function(){return l.ImageFacade.formaHasShapeMask(o.getSelectedForma())},o.getSelectedFormaScale=function(){var e=o.getSelectedForma();if(!e)return null;var t=e;return"Frame"===e.kind&&(t=t.childAt(0)),t.placement.extractedScale.scale.x},o.getSelectedFormaPlacement=function(){var e=o.getSelectedForma();if(!e)return null;var t=e,n="";return"Frame"===e.kind&&(n=(t=t.childAt(0)).contentNode.pixelWidth+"_"+t.contentNode.pixelHeight),{placement:t.placement,id:n}},o.getSelectedFormaScaleRange=function(){var e={},t=o.getSelectedForma();if(t&&"Frame"===t.kind&&!t.controller.moveable){var n=t.childAt(0),r=.1;if(n.contentNode){var i=t.finalFrame.size,a=n.contentNode.pixelWidth,c=n.contentNode.pixelHeight,s=a/c,l=i.width/i.height,u=i.width/a,d=i.height/c;r=s>l?d:u}n.hasAlpha()?(e.min=.1,e.max=2):(e.min=r,e.max=10*r)}return e},o.scaleSelectedForma=function(e,t){var n=o.getSelectedForma();"Frame"!==n.kind||n.controller.moveable&&!o.inCropMode()||(n=n.childAt(0));var r=e/n.placement.extractedScale.scale.x;return te(new l.ScaleAction(r,[n]))},o.changeImageAdjustments=function(e){var t=o.getSelectedForma(),n=t;return t&&"Frame"===t.kind&&(n=t.childAt(0)),te(l.ChangeImageAdjustmentsAction.ActionWithDictionary(e,[n]))},o.resetImageAdjustments=function(e){return o.changeImageAdjustments(e)},o.getImageAdjustments=function(e){var t=e||o.getSelectedForma();return t&&"Frame"===t.kind&&(t=t.childAt(0)),t.style.adjustments},o.rotateSelectedForma=function(e,t){var n=e/180*Math.PI,r=o.getSelectedForma();return"Frame"!==r.kind||r.controller.moveable&&!o.inCropMode()||(r=r.childAt(0)),te(new l.RotateAction(n,t,[r],!0))},o.handleTextFormaBeginResize=function(e){if(e=e||o.getSelectedForma()){o.beginGesture();null!=e&&e.isTypeLockup()&&(e.controller.beginTouches(null),P=null)}},o.handleTextFormaEndResize=function(e){(e=e||o.getSelectedForma())&&o.endGesture(!0)},o.handleTextFormaResize=function(e,n){if(e&&e.isTypeLockup()&&null!=n.startForma){var o=new l.TheoPoint(n.touchPoint.x,n.touchPoint.y),r=0===n.spot.x&&.5===n.spot.y;return te(new l.CharRangeHandleAction(e,o,n.startForma,r,P)).then((function(){P=o,ae(e)}))}return t.resolve(!1)},o.formaAtPoint=function(e,t){return g.firstPage.formaAtPoint(e,0,null,t)},o.handleTapped=function(e){var t=e.forma||o.getFormaById(e.id);if(o.inCharStyleMode){null!=t&&t.isTypeLockup()&&t.controller.owner.selection.isSelected(t)&&t.controller.selectCharStyleForma();var n=new l.TheoPoint(e.x,e.y),r=g.firstPage.formaAtPointInSelection(n,g.controller.selection);if(null!=r&&null!=r.lockupForma)!function(e){if(!e||!e.lockupForma)return;te(new l.ApplyCharStyleAction(e,l.TypeLockupController.HIGHLIGHT_STYLE,l.CharStyleApplyMode.Toggle,e.rangeInLockup)).done()}(r);else{var i=o.getSelectedForma();i.formaID&&e.forma.formaID!==i.formaID&&(o.exitCharStyleMode(),o.selectForma({forma:t}))}}else void 0!==t&&o.selectForma({forma:t});return!o.inCharStyleMode},o.getOriginalImageSize=function(){if(!o.inVisibleGridLayout()){var e=o.backgroundImageFormas();if(1===e.length){var t=e[0];return{width:t.childAt(0).contentNode.pixelWidth,height:t.childAt(0).contentNode.pixelHeight}}return null}},o.recordOriginalSize=function(){return te(new l.RecordOriginalPageSizeAction(g.firstPage))},o.setPageSizeFromDesignSize=function(e,t){return t=t||{},ne(new l.ChangePageSizeAction(g.firstPage,e),(function(){var e=o.getDocumentSize(),n={width:e.width,height:e.height};return o.events.publish("document-size-changed",n),m.delay(t.delay||100)}))},o.getPageAspectRatio=function(){var e=o.getDocumentSize();return e.width/e.height},o.getDocumentSizeId=function(){return g.firstPage.sizeID},o.getDocumentOriginalSizeId=function(){return g.firstPage.originalSizeID},o.getPageCustomSizeFormat=function(){return g.firstPage.customSizeFormat},o.getPageCustomSizePPI=function(){return g.firstPage.customSizePPI},o.getPageExportData=function(){return g.firstPage.getPageExportData()},o.getExportData=function(){return g.firstPage.getExportData()},o.lockupFormaIDs=function(){var t=o.lockupFormas();return e.map(t,(function(e){return e.formaID}))},o.downloadNewLockupRandomFontsAsync=function(){if(!N){N=t.defer();h.loadMissingFonts(["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"]).then((function(){N.resolve()}))}},o.addNewLockup=function(e,n){T.assert(!!N,"Invalid random fonts loading promise."),n=n||{};var r=o.imageFormas();return(r.length>0?r[0].contentNode.image.getImageLoadedPromise():t.resolve()).then((function(){return te(new l.AddTextContentAction(e))}))},o.addBadge=function(e,t){return o.getTemporaryDocumentWithFontsLoaded(e).then((function(e){return te(new l.AddBadgeAction(e,t))}))},o.applyDesignTheme=function(e,n){var r=t.defer();return o.getTemporaryDocumentWithFontsLoaded(e).done((function(e){n=n||0;var t=g.firstPage.root;te(l.ApplyTemplateAction.init_e1db(e,t,n,t)).then((function(){m.delay(40).done(r.resolve)}))})),r.promise},o.applyRetargetSuggestion=function(e,t){return te(new l.ApplyTemplateAction.init_e1db(e,g.firstPage.root,t,g.firstPage.root)).then((function(){return m.delay(10)}))},o.getThemeId=function(){return g.content.root.getTag("theme:id")},o.getColorPalette=function(){var t=g.firstPage.colorLibraryController.getColorThemeAsArrayOfTheoColors();return e.map(t,(function(e){return{color:p.rgb2hex({r:255*e.rgbColor.red,g:255*e.rgbColor.green,b:255*e.rgbColor.blue}),roles:e.sparkRoles,id:e.sparkElementID}}))},o.getColorAnimationVariant=function(e){const t=g.firstPage.colorLibraryController.getThemeColorKeys();let n=0;for(let o=0;o<t.length;++o){const r=g.firstPage.colorLibraryController.getTheoColorForKey(t[o]);if(r){if(p.rgb2hex({r:255*r.rgbColor.red,g:255*r.rgbColor.green,b:255*r.rgbColor.blue})===e){n=o;break}}}return n},o.setColorPalette=function(e,t){if(!e||!e.colors)return;t=t||{};const n=Y(e.colors);return te(new l.ApplyColorThemeAction(n,e.id,g.firstPage,!!t.shuffle))},o.applyAspectRatioCropToImage=function(e){var t=l.ImageFacade.getImageFormaForForma(o.getSelectedForma());if(e.id===l.CropRatioPresetLibrary.FREEFORM_ID)return te(new l.SetImageCropToFreeformAction(t));var n=e.id===l.CropRatioPresetLibrary.ORIGINAL_ID?0:e.aspectRatio;return te(new l.CropImageToRatioAction(t,n,e.cropToRatioUsingFrameBounds))},o.applyShapeMaskToImage=function(e){return te(new l.ApplyShapeMaskToImageAction(o.getSelectedForma(),e.shapeId,e.cropToRatioUsingFrameBounds))},o.shuffleColorPalette=function(){return te(new l.ShuffleColorThemeAction(g.firstPage))},o.getImageFilters=function(){for(var e=g.firstPage.imageFilterLibrary.getImageStyles(),t=e.length-1;t>=0;t--)e[t].colors.library=g.firstPage.colorLibrary;return e},o.setImageFilterForSelection=function(e,n,r){var i=o.getSelectedForma();return i&&i.isImage()?te(0===n?new l.SetImageFilterAction(e,r):new l.ShuffleImageFilterAction(e,g.firstPage,r)):t.resolve(!1)},o.getTextForSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.contentNode;return t?t.text:null}},o.shouldSuggestTransparentBackground=function(){return g.firstPage.root.controller.suggestTransparentBackground()},o.setBackgroundTransparency=function(e){return te(new l.SetBackgroundOpacityAction(e,g.firstPage))},o.getFullCanvasColor=function(){var e=l.TypeLockupUtils.getFullCanvasLockups(g.firstPage.root);return e.length>0&&1===e[0].lockupStyle.backingOpacity?e[0].lockupStyle.colors.fieldSecondary:null},o.setTextForSelectedLockup=function(e){var n=o.getSelectedForma();if(!n)return t.resolve();var r=n&&n.formaID;return ne(new l.SetTextAction(e,n),(function(){return n=o.getFormaById(r),o.events.publish("forma-text-updated",{forma:n}),m.delay(10)}))},o.getDominantColorRoleOfLockup=function(e){if(!e||!e.isTypeLockup())return l.ColorRole.FieldPrimary;var t=e.controller.styleController.targetedLockupStyle;return t.textLook===l.LockupTextLook.KnockoutOnly||t.textLook===l.LockupTextLook.OutlineOnly?l.ColorRole.FieldSecondary:l.ColorRole.FieldPrimary},o.setColorsForSelectedLockup=function(e,n){var r=o.getSelectedForma();if(r&&r.isTypeLockup()&&r.formaID){var i=X(e);return te(new l.ApplyColorAction(null,i,o.inCharStyleMode,n))}return t.resolve(!1)},o.getShapeFormaTheoColor=function(e){if((e=e||o.getSelectedForma())&&e.isShape()){var t=e.style.colors.color(l.ColorRole.FieldPrimary);return g.firstPage.colorLibraryController.getTheoColorForSolidColor(t)}},o.getLockupFormaColors=function(e,t){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller,r=t?n.styleController.targetedLockupStyle.colors:n.lockupStyle.colors,i=r.fieldPrimary||new l.SolidColor(1,1,1,1),a=r.fieldSecondary||new l.SolidColor(1,1,1,1),c=g.firstPage.colorLibraryController.getTheoColorForSolidColor(i),s=g.firstPage.colorLibraryController.getTheoColorForSolidColor(a),u=[{red:Math.round(255*c.rgbColor.red),green:Math.round(255*c.rgbColor.green),blue:Math.round(255*c.rgbColor.blue),alpha:1,id:c.sparkElementID,roles:c.sparkRoles},{red:Math.round(255*s.rgbColor.red),green:Math.round(255*s.rgbColor.green),blue:Math.round(255*s.rgbColor.blue),alpha:1,id:s.sparkElementID,roles:s.sparkRoles}];return o.selectedLockupHasOnlyOneColor(e)&&(o.getDominantColorRoleOfLockup(e)===l.ColorRole.FieldSecondary?u.splice(0,1):u.splice(1)),u}},o.selectedLockupHasOnlyOneColor=function(e){if(!(e=e||o.getSelectedForma())||!e.isTypeLockup())return!0;var t="none"!==o.getShapeOfSelectedLockup(e),n=e.controller.styleController.targetedLockupStyle.textLook;return t?n===l.LockupTextLook.KnockoutOnly||n===l.LockupTextLook.OutlineOnly:n===l.LockupTextLook.OutlineOnly||n===l.LockupTextLook.Fill||l.LockupTextLook.UNSET},o.setFontForSelectedLockup=function(e){var n=s.fontProvider.descriptorForPostScriptName(e.postScriptName);if(n.postScriptName===e.postScriptName){var r=h.getFontData(e.postScriptName),i=l.TheoFont.init_9e5c(n,r.sparkElementId,r.acRoles);return ne(new l.SetFontAction(i,o.inCharStyleMode),(function(){var e=o.getSelectedForma();e&&re(e)}))}return t.reject("cannot find font with PostScriptName: "+e.postScriptName)},o.updataDocForTypekitFontDeactivated=function(e){g&&e&&(l.TypeLockupUtils.replaceFontsInDocument(g,[e]),ie(!1),W())},o.getLockupFontOfSelectedLockup=function(e,t){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){t="boolean"!=typeof t||t;var n=e.controller;return t?n.styleController.targetedLockupStyle.font:n.lockupStyle.font}},o.setShapeForSelectedLockup=function(e){return o.getSelectedForma()?isNaN(e)?o.applyBackingToLockup(7,e,o.getSelectedFormaId()):o.applyBackingToLockup(e,null,o.getSelectedFormaId()):t.resolve()},o.getEffectForSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.getTextLookForUI()},o.setEffectForSelectedLockup=function(e){return o.getSelectedForma()?te(new l.SetTextLookAction(e)):t.resolve()},o.toggleFillOfSelectedLockup=function(e){if(o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()){var t,n=o.getSelectedForma().controller.styleController;return t=e?l.LockupTextLook.OutlineOnly:n.targetedStrokeWeight>.12?l.LockupTextLook.FillAndOutline2:l.LockupTextLook.FillAndOutline,te(new l.SetTextLookAction(t))}},o.isLockupOutlineOnly=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.textLook===l.LockupTextLook.OutlineOnly},o.getStrokeWeightOfSelectedLockupForUI=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getStrokeWeightPercentForUI())},o.setStrokeWeightSelectedLockup=function(e,t){t=t||o.getSelectedForma();var n=function(e){return(e-1)/99}(e);return te(new l.SetTextEffectsAttributesAction(n,NaN,NaN))},o.getShadowOffsetOfSelectedLockupForUI=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup())return Math.round(e.controller.styleController.getShadowOffsetPercentForUI())},o.setShadowOffsetOfSelectedLockup=function(e,t){t=t||o.getSelectedForma();var n=function(e){return(e-1)/99}(e);return te(new l.SetTextEffectsAttributesAction(NaN,n,NaN))},o.getShadowAngleOfSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var t=e.controller.styleController.targetedShadowAngle;return t>180?t-360:t}},o.setShadowAngleOfSelectedLockup=function(e,t){return t=t||o.getSelectedForma(),e=e<0?e+360:e,te(new l.SetTextEffectsAttributesAction(NaN,NaN,e))},o.applyBackingToLockup=function(e,t,n){var r=o.getFormaById(n),i=e;if(9===e){var a=r.controller.size;i=a.width>a.height?9:8}return te(new l.ChangeBackgroundShapeAction([r],i,t,o.inCharStyleMode))},o.getShapeOfSelectedLockup=function(e){if((e=e||o.getSelectedForma())&&e.isTypeLockup()){var t,n=e.controller.styleController.targetedLockupStyle.backing;if(7===n)t=e.controller.styleController.targetedLockupStyle.backingArtworkID;else{t={0:"none",2:"row",4:"shadow",8:"banner",9:"banner",11:"knockout"}[n]}return t}},o.setLetterSpacingForSelectedLockup=function(e){var n=o.getSelectedForma();return n&&n.isTypeLockup()?te(new l.SetTrackingAction(e,O)):t.resolve(!1)},o.setCurrentPin=function(){if(O=l.TheoPoint.ZERO,o.getSelectedForma()&&o.getSelectedForma().isTypeLockup()){var e=o.getSelectedForma().controller.getPin(!0,!0);null!=e&&(O=e.pinPoint)}},o.setSpacingForSelectedLockup=function(e){var n=o.getSelectedForma();return n&&n.isTypeLockup()?te(new l.SetLeadingAction(e,O)):t.resolve(!1)},o.setPaddingForSelectedLockup=function(e){var n=o.getSelectedForma();return n&&n.isTypeLockup()?te(new l.SetPaddingAction(e,O)):t.resolve(!1)},o.getSpacingAndPaddingOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller.styleController,n=t.targetedLockupStyle.spacing,r=t.targetedLockupStyle.padding;return{spacing:"number"==typeof n?n:parseFloat(n),padding:"number"==typeof r?r:parseFloat(r)}}},o.getLetterSpacingSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return e.controller.styleController.targetedLockupStyle.tracking},o.areSpacingAndPaddingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.areSpacingAndPaddingOptionsAvailable()},o.isSpacingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasSpacingOptions()},o.isPaddingAvailableForSelectedLockup=function(){var e=o.getSelectedForma();return!(!e||!e.isTypeLockup())&&e.controller.styleController.hasPaddingOptions()},o.setLayoutAndAlignmentForSelectedLockup=function(e,n){var r=o.getSelectedForma();return r&&r.isTypeLockup()&&r.formaID?(M++,te(new l.ChangeTextLayoutAndAlignmentAction(e,n)).then((function(){M--}))):t.resolve(!1)},o.getSuggestedColorsForLockup=function(t){if((t=t||o.getSelectedForma())&&t.isTypeLockup()){var n=t.controller.styleController.getSuggestableColors();return e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}))}},o.getBrandKitColorsPalettesForSelectedLockup=function(t){if(!o.getSelectedForma()||!o.getSelectedForma().isTypeLockup()||!t)return{colors:[]};var n=l.TheoBrandkitUtils.getBrandkitColorsForUI(t,o.getSelectedForma()),r=e.map(n,(function(t){return e.map(t,(function(e){return{red:255*e.rgbColor.red,green:255*e.rgbColor.green,blue:255*e.rgbColor.blue,id:e.sparkElementID,roles:e.sparkRoles}}))}));return{name:t.name,id:t.id,colors:r}},o.createFormaFromSVG=function(e,t,n){var r=e.original.link,i=new XMLHttpRequest;i.open("GET",r,!0),i.onload=function(a){var c=i.responseText,u=l.SVGParserUtils.theoArtworkFromSVGData(c,!0);s.pathUtils.cacheArtworkForURL(r,u),ne(new l.AddIconContentAction(r,t,n),(function(t){var n="";if(!(t.formae&&t.formae.length&&t.formae[0]instanceof l.ShapeForma))throw new Error("AddIconContentAction did not return a shapeForma");{const e=t.formae[0];n=e.contentID,R.push(n);var r=o.beginTransaction("temp_svg_content_node_url");e.contentNode.url="uploading svg",o.endTransactionAndMergeWithPrevious(r)}var i=new Blob([c],{type:e.mimeType});o.saveImageComponent(i,e.mimeType).then((function(e){var t={contentNodeID:n,url:e.encodedUrl,componentID:e.component.id};o.updateVectorContentNodeWithComponent(t)})).catch((function(e){T.error("failed to upload SVG file",e)})).done()})).done()},i.onerror=function(){T.error("failed to download SVG icon file")},i.send()},o.getLayoutOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return l.TextFacade.getLayoutForForma(e)},o.getAlignmentOfSelectedLockup=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return l.TextFacade.getAlignmentForForma(e)},o.getAllowedAlignmentStates=function(){var e=o.getSelectedForma();return e?e.controller.styleController.layoutSelector.values:[]},o.getUserFontSizesInDocument=function(){return l.TypeLockupUtils.sizesInDocument(g,void 0,!0).map(e=>l.TextFacade.toUserFontSize(e,g.firstPage))},o.getUserFontSizeOfSelectedForma=function(){var e,t=o.getSelectedForma();if(t&&t.isTypeLockup()){const n=t.controller.getCurrentFontSize();e=l.TextFacade.toUserFontSize(n,t.page)}return e},o.setFontSize=function(e){return te(new l.SetFontSizeAction(e))},o.getOpacitySliderValueOfSelectedForma=function(){var e=o.getSelectedForma();return e&&e.controller?l.OpacityFacade.getOpacityForForma(e):1},o.setLayerForSelectedForma=function(e){var t=o.getSelectedForma(),n=t.controller.getMinLayerIndex()+e;return te(new l.ChangeZOrderAction(n)).then((function(){o.updateLayers(t)}))},o.getLayerSliderValueOfSelectedForma=function(){var e=o.getSelectedForma();if(e)return e.controller.getZOrder()-e.controller.getMinLayerIndex()},o.getNumLayers=function(){var e=o.getSelectedForma();if(e)return e.controller.getReorderableLayerCount()},o.updateLayers=function(){o.events.publish("forma-layer-changed")},o.canSave=function(){return w&&E()},o.setColorForSelection=function(e){const t=function(e){if(!e)return!0;if(1===e.length&&e[0]&&"#NONE_COLOR"===e[0].id)return!0;return!1}(e)?null:X(e);return te(new l.ApplyColorAction(null,t))},o.addLogo=function(e){var t=g.content.root.visit(t=>t instanceof l.URLBasedContentNode&&t.sparkElementID===e.id);return te(t?new l.AddContentAction(t):new l.AddLogoContentAction(g.firstPage,e,null,null,e.componentId))},o.addOrReplaceImage=function(n){T.info("adding image. is low res? "+String(n.isLowResImage));var r=n.replacementForma;if(null!=n.replacementFrame&&null==r.parent)for(var i=g.firstPage.root.filterByKind(l.FrameForma.KIND),a=0;a<i.length;a++)i[a].finalFrame.equalWithAccuracy(n.replacementFrame,.001)&&(r=i[a],T.info("matched by frame"));r&&r.isShape()&&r.controller.moveable&&(T.error("Assertion fail. We shouldn't be asking to replace a moveable shape (at this point)."),r=null),s.imageAnalysis.updateHostImageCacheKey(n.metadata.sourceURL,n.url);var c=t.defer(),u=n.floatingImageStrategy||l.FloatingImageStrategy.IfHasAlphaOrIsLogo,d=new l.AddFormaParams(l.ControllerSettingsBehaviorEnum.IgnoreControllerSettings,!0,r,u);return ne(new l.AddImageContentAction(g.firstPage,n.url,n.mimeType,n.width,n.height,n.hasAlpha,n.metadata,null,null,d,l.ActionUndoability.useDefault,n.id,n.allowSelection),(function(t,r){if(r)c.reject(new o.ActionError(r));else{var i=o.getImageFormaForURL(n.url),a=i.parent.isBackgroundImage()?i.parent:i;n.formaId=a.formaID,n.contentNodeId=a.contentID,R.push(a.contentID),o.events.publish("forma-added",{id:a.contentID,isLowResImage:n.isLowResImage}),e.delay((function(){c.resolve(n)}),10)}})),c.promise},o.replaceImageWithHighRes=function(t){T.assert("string"==typeof t.contentNodeId,"can not patch content node with contentNodeId"),T.assert("string"==typeof t.lowResImageUrl,"can not patch content node without lowResImageUrl");return L.push((function(){var n=g.content.nodeByID(t.contentNodeId);if(n&&n.url===t.lowResImageUrl){var i=l.Matrix2D.uniformScaling(t.width>t.height?n.pixelWidth/t.width:n.pixelHeight/t.height),a=!1;if(e.each(o.imageFormas(),(function(e){e.contentNode.id===t.contentNodeId&&(r.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,s.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),e.placement=i.concat(e.placement),e.invalidateCachedBounds(),a=!0,r.endPatch())})),!a)g.firstPage.formaByID(t.id)||(r.beginPatch(),n.mediaMetadata=t.metadata,n.url=t.url,n.pixelWidth=t.width,n.pixelHeight=t.height,n.mimeType=t.mimeType,n.hasAlpha=t.hasAlpha,s.imageAnalysis.updateHostImageCacheKey(t.lowResImageUrl,t.url),a=!0,r.endPatch())}})),J()},o.updateVectorContentNodeWithComponent=function(e){return L.push((function(){var t=g.content.nodeByID(e.contentNodeID);t&&"uploading svg"===t.url&&"vector"===t.kind&&(r.beginPatch(),t.url=e.url,t.componentID=e.componentID,r.endPatch())})),J()},o.textLockupHighlight=function(){const e=o.beginTransaction("apply_lockup_highlight_box");var t=o.getSelectedForma();(new l.FormaCalloutUtils).applyLockupHighlightBox(t),o.endTransaction(e)},o.getStyleServiceMetaDataString=function(e){var t=null;if(null!=e){const{controller:n}=e,{text:o,size:{width:r,height:i}}=n,{tracking:a,spacing:c}=n.lockupStyle,{width:s,height:l}=e.page.pageSize,u=o.replace(/^\W+|\W+$/g,"").split(/\W+/g).length,d=n.numLines();t="trng:".concat(a,",spng:").concat(c,",w:").concat(Math.round(r),",h:").concat(Math.round(i))+",page_w:".concat(Math.round(s),",page_h:").concat(Math.round(l))+",words:".concat(u,",lines:").concat(d)}return t},o.getCurrentDocumentSynthesizedName=function(){return g.getSynthesizedTitle()},o.getCurrentDocumentDescription=function(){return g.getSynthesizedDescription()},o.getGridForma=function(e){var t=g.firstPage.root.filterByControllerKind(l.GridController.KIND);return t.length>0?t[0]:e?g.firstPage.root.controller.createGridControllerIfNone().forma:null},o.getAllGridStyles=function(){var e=t.defer();return setTimeout((function(){try{var t=g.firstPage.layoutLibrary.getLayoutsForRoot(g.firstPage.root);e.resolve(t)}catch(t){e.reject(t)}}),0),e.promise},o.retrieveAndApplyASuggestedGridStyle=function(){var e=l.LayoutSuggester.createContentAwareSuggestions(g.firstPage.root);return e.length?o.applyGridStyle({name:e[0].name,gridStyle:e[0].gridStyle,silent:!1},0):t.resolve()},o.applyGridStyle=function(e,t){return te(new l.SetGridStyleAction(e.gridStyle,t))},o.inAutomaticLayoutMode=function(){return g.controller.inAutomaticLayoutInteractionMode},o.enableAutomaticLayoutMode=function(){g.controller.setAutomaticLayoutInteractionMode();var e=o.getGridForma();if(e){var t=o.beginTransaction("inferGridCellAssignment");e.controller.inferGridCellAssignment(),o.endTransactionAndMergeWithPrevious(t),e.style.moveableShift=!0}},o.disableAutomaticLayoutMode=function(){g.controller.setDefaultInteractionMode()},o.enterCharStyleMode=function(){var e=o.getSelectedForma();e&&e.isTypeLockup()&&(o.inCharStyleMode=!0,ne(new l.EnterCharStyleModeAction(e),(function(){ae(e),o.events.publish("enter-char-style-mode")})).done())},o.exitCharStyleMode=function(){if(o.inCharStyleMode){var e=o.getSelectedForma();e&&e.isTypeLockup()&&(o.inCharStyleMode=!1,ne(new l.ExitCharStyleModeAction(e),(function(){o.events.publish("text-forma-selected",{id:e.formaID,forma:e,selectionBoxes:[]}),o.events.publish("exit-char-style-mode")})).done())}},o.exitCharStyleModeAndSelect=function(){if(o.inCharStyleMode){var e=o.getAllSelectedFormas();0!==e.length&&e[0].isTypeLockup()&&(o.exitCharStyleMode(),o.deselect({silent:!0}),o.selectForma({forma:e[0]}),o.events.publish("forma-selected",{id:e[0].formaID,forma:e[0],selectionBox:z()}))}},o.toggleCharStyleLinesMethods=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;switch(t.highlightMethod){case l.HighlightMethod.EvenRows:t.highlightMethod=l.HighlightMethod.OddRows;break;case l.HighlightMethod.OddRows:t.highlightMethod=l.HighlightMethod.Bracket;break;case l.HighlightMethod.Bracket:t.highlightMethod=l.HighlightMethod.InsideBracket;break;default:t.highlightMethod=l.HighlightMethod.EvenRows}ce(t,e)}},o.toggleCharStyleWordsMethods=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup()){var t=e.controller;t.highlightMethod===l.HighlightMethod.EvenWords?t.highlightMethod=l.HighlightMethod.OddWords:t.highlightMethod=l.HighlightMethod.EvenWords,ce(t,e)}},o.clearStyleRanges=function(){var e=o.getSelectedForma();if(e&&e.isTypeLockup())return te(new l.SetHighlightMethodAction(l.HighlightMethod.Manual))},o.getLayoutMargin=function(){var e=o.getGridForma();return null!=e?e.controller.margin:0},o.getLayoutSpacing=function(){var e=o.getGridForma();return null!=e?e.controller.spacing:0},o.setLayoutSpacing=function(e){return te(new l.SetGridParametersAction(e,NaN))},o.setLayoutMargin=function(e){return te(new l.SetGridParametersAction(NaN,e))},o.setLayoutSpacingAndMargin=function(e,t){var n=NaN,o=NaN;return e>=0&&(n=e),t>=0&&(o=t),te(new l.SetGridParametersAction(n,o))},o.prepareForGridLayouts=function(){te(new l.EnterGridLayoutModeAction)},o.inVisibleGridLayout=function(){var e=o.getGridForma();return null!=e&&e.style.gridCells.length>1},o.spacingChangesVisible=function(){var e=o.getGridForma();return null!=e&&e.controller.spacingChangesVisible},o.allowFlip=function(e){return e.controller.flippable},o.allowDuplication=function(e){return e.controller.duplicatable},o.allowCrop=function(e){return l.ImageFacade.canCropImage(e)},o.allowSetForeground=function(e){return l.ImageFacade.canSetFloatingImage(e)},o.allowSetBackground=function(e){return l.ImageFacade.canSetBackgroundImage(e)},o.allowDeletion=function(e){for(var t=!0,n=0;n<e.length;n++)if(!e[n].controller.deleteable){t=!1;break}return t},o.hasImageAttribution=function(t){if((t=t||o.getSelectedForma()).hasIntent(l.Forma.INTENT_ICON)||t.isImage()&&!t.isLogo()){var n=o.getImageFormaAttributionInfo(t);if(e.isEmpty(n))return!1;var r=n.sourceName;if(r&&-1!==["unsplash","pixabay","flickr","adobe stock","the noun project","giphy"].indexOf(r.toLowerCase()))return!0}return!1},o.isIcon=function(e){return!!(e=e||o.getSelectedForma()).hasIntent(l.Forma.INTENT_ICON)},o.isGiphy=function(e){return o.getImageFormaAttributionInfo(e).sourceName===l.MediaMetadata.kMediaGiphySourceName},o.formaOpacityChangeable=function(){var e=o.getSelectedForma();return!!e&&e.controller.opacityChangeable},o.getFormaOpacity=function(){return o.getSelectedForma().style.opacity},o.setFormaOpacity=function(e){return te(new l.SetOpacityAction(e))},o.isFormaSwappable=function(e){return!!o.getGridForma()&&(e.controller&&!e.controller.moveable&&"Root"!==e.kind)},o.getSwappableForma=function(){for(var e=[],t=g.firstPage.root.visitAsArray(l.FormaTraversal.PreOrder),n=0;n<t.length;n++){var r=t[n];if(o.isFormaSwappable(r)){var i={forma:r,formaID:r.formaID};"Shape"===r.kind&&(i.type="shape",e.push(i)),"Frame"===r.kind&&(i.type="frame",e.push(i))}}return e},o.setSwapMode=function(e,t){v=e;var n=o.getSelectedForma();if(n&&"Frame"===n.kind){var r=n.childAt(0);!v&&t&&y&&(T.info("disable swap mode ",y),r.placement=y,y=null)}},o.getPointInDocumentSpace=function(e,t){var n=o.getDocumentSize(),r=n.width*e,i=n.height*t;return new l.TheoPoint(r,i)},o.getDesignHeight=function(){return o.getSelectedForma().root.finalFrame.height},o.getFormaSize=function(e){return H(e)},o.getDocumentMetadataEvents=function(){return l.TheoDocumentUtils.getMetadataEvents(g,!1)},o.getMaxGridCells=function(){return l.GridController.MAX_CELL_COUNT},o.setPersistSave=function(e){return(x=e).initialize()},o.whenInitialized=function(){return A},o.updateColorInTheme=function(e,t){var n=p.solidColor2TheoColor(p.hex2SolidColor(e.color),e.id,e.roles),o=p.solidColor2TheoColor(p.hex2SolidColor(t.color),t.id,t.roles),r=g.firstPage.colorLibraryController.getKeyOfColorInTheme(n);return te(new l.ModifyColorThemeAction(o,r))},o.isSparkColorInUse=function(e){return g.firstPage.colorLibraryController.isSparkColorInUse(e)},o.updateSparkColor=function(e){if(g.firstPage.colorLibraryController.isSparkColorInUse(e.sparkElementID)){const t=o.beginTransaction("update_spark_color");g.firstPage.colorLibraryController.updateSparkColor(e),o.endTransaction(t)}return t.resolve()},o.areSparkFontsInUse=function(e){return l.TheoBrandkitUtils.areSparkFontsInUse(g,e)},o.updateSparkFont=function(e){if(l.TheoBrandkitUtils.areSparkFontsInUse(g,[e.id])){const t=o.beginTransaction("update_spark_font");l.TheoBrandkitUtils.updateSparkFont(g,e),o.endTransaction(t)}return t.resolve()},o.relinkSparkFont=function(e,n){if(l.TheoBrandkitUtils.areSparkFontsInUse(g,[e])){const t=o.beginTransaction("relink_spark_font");l.TheoBrandkitUtils.relinkSparkFont(g,e,n),o.endTransaction(t)}return t.resolve()},o.areSparkLogosInUse=function(e){return l.TheoBrandkitUtils.areSparkLogosInUse(g,e)},o.updateSparkLogo=function(e){if(l.TheoBrandkitUtils.areSparkLogosInUse(g,[e.id])){const t=o.beginTransaction("update_spark_logo");l.TheoBrandkitUtils.updateSparkLogo(g,e),o.endTransaction(t)}return t.resolve()},o.relinkSparkLogo=function(e,n){if(l.TheoBrandkitUtils.areSparkLogosInUse(g,e)){const t=o.beginTransaction("relink_spark_logo");l.TheoBrandkitUtils.relinkSparkLogo(g,e,n),o.endTransaction(t)}return t.resolve()},o.brandDocument=function(e){var t=e.fonts&&e.fonts.length,n=e.logos&&e.logos.length,o=e.colors&&e.colors.length;return te(new l.BrandifyAction(e,t,n,o))},o.changeBranding=function(e){const t=g.authoringContextID,n=l.MultiBrandFacade.activeBrandkitID;return te(new l.ChangeBrandingAction(e,t,n))},o.handleCurrentBrandChanged=function(e){o.events.publish("current-brand-changed",e)},o.addBranding=function(e){return s.setCoreWrapper(this),te(new l.AddBrandingAction(e))},o.stripBranding=function(){return te(new l.RemoveBrandingAction)},o.getBrandedElementsUsage=function(){return l.TheoBrandkitUtils.getDocumentBrandedElementsUsage(g,!0,!1)},o.includesUploadedFonts=function(){return o.getBrandedElementsUsage().indexOf(l.TheoBrandkitUtils.kBrandUsageCustomFont)>-1},o.getFontsUsed=function(){return l.TheoDocumentUtils.getFontsUsed(g)},o.getDocFontSourceUsage=function(){return l.TheoDocumentUtils.getFontSourceUsage(g)},o.getWatermarkEnabledForDoc=function(){return g?!("watermarkEnabled"in g)||g.watermarkEnabled:(T.error("Attempting to set watermarkEnabled with no document loaded."),!1)},o.setWatermarkEnabledForDoc=function(e){g?te(new l.SetWatermarkAction(e)).done():T.error("Attempting to set watermarkEnabled with no document loaded.")},o.getImageFormaAttributionInfo=function(e){return e&&(t=e.kind===l.ImageForma.KIND||e.hasIntent(l.Forma.INTENT_ICON)?e.contentNode:e.childAt(0).contentNode)&&t.mediaMetadata||{};var t},o.setAuthoringContextThemeId=function(e){const t=o.beginTransaction("set branded template ID");g.authoringContextThemeID=e,o.endTransactionAndMergeWithPrevious(t)},o.getAuthoringContextThemeId=function(){return g.authoringContextThemeID},o.updateConstrainedImages=function(){l.TheoDocumentUtils.updateConstrainedImageInfo(g)},o.getConstrainedImages=function(){return g.constrainedImages},o.getHighlightMethodEnum=function(){return l.HighlightMethod},o.synthesizeEmptyImages=function(){g.content.root.visitAll((function(e){if("image"===e.kind&&null==e.url){var t=document.createElement("canvas"),n=t.getContext("2d");t.width=e.pixelWidth,t.height=e.pixelHeight;var o=n.createLinearGradient(0,0,t.width,t.height),r=e.imageColorData;r.sort((function(e,t){return e.coverage<t.coverage?1:e.coverage>t.coverage?-1:0})),r.length>1?(o.addColorStop(0,"#"+r[0].rgbColor.hex.substring(0,6)),o.addColorStop(1,"#"+r[1].rgbColor.hex.substring(0,6))):(o.addColorStop(0,"#000"),o.addColorStop(1,"#fff")),n.fillStyle=o,n.fillRect(0,0,t.width,t.height),e.componentID=l.GUIDUtils.makeGUID(),e.url=t.toDataURL()}}))},o.setRemixParentCpId=function(e){g.setRemixParentCpId(e)},o.getRemixParentsCpIds=function(){return g.remixAncestorsCpAssetIDs},o.getRemixAncestorsIntoMachineTags=function(e){return S.getRemixAncestorsIntoMachineTags(e,g)},o.getEditorModelColorSelection=function(){var e=g.controller.model.attributes.find(l.ColorAttribute.KEY);return e?e.colors:[]},o.handlePointerChanged=function(e){var t=new l.TheoPoint(e.x,e.y),n="touch"===e.pointerType?1:0,o=s.async.getSystemUptimeInSeconds(),r=new l.PointerUpdate(""+e.pointerId,n,g.firstPage,t,o);r.tapCount=e.tapCount,r.modifierKeys=e.modifierKeys,"pointerDown"===e.updateType?g.controller.pointers.onPointersDown([r]):"pointerMove"===e.updateType?g.controller.pointers.onPointersMoved([r]):"pointerUp"===e.updateType&&g.controller.pointers.onPointersUp([r])},o.setViewScale=function(e){g.controller.viewScale=e},o.getViewScale=function(){return g.controller.viewScale},o.getGroupFeatures=function(){var e=g.controller.model.featureSets.find(l.FormaEditFeature.KEY);return{canGroup:e&&e.canGroup,canUngroup:e&&e.canUngroup}},o.getSettableFeatures=function(){var e={},t=g.controller.model.featureSets.find(l.AlignSpacingAttributesFeature.KEY);e.canAlign=t&&t.canAlign,e.canDistribute=t&&t.canDistribute;var n=g.controller.model.featureSets.find(l.OpacityAttributesFeature.KEY);e.opacity=!!n;var o=g.controller.model.featureSets.find(l.ImageFeature.KEY);return e.imageFilter=!!o&&o.canApplyFilter,e},o.getAlignmentTypes=function(){return l.AlignmentType},o.getDistributeTypes=function(){return l.DistributeType},o.setOpacityForSelectedFormae=function(e){return te(new l.SetOpacityAction(e))},o.getOpacityValuesForSelectedFormae=function(){return g.controller.model.attributes.find(l.OpacityAttribute.KEY).opacities},o.setAlignmentForSelectedFormae=function(e){return te(new l.AlignFormaeAction(e))},o.distributeSelectedFormae=function(e){return te(new l.DistributeFormaeAction(e))},o.animate=function(){o.events.publish("animate")},o.downloadAnimation=function(){o.events.publish("download-animation")},o.beginTransaction=function(e){if(e)return I.beginTransaction(g,e);T.error("no name provided for transaction.")},o.endTransactionAndMergeWithPrevious=function(e){I.endTransaction(e,!0)},o.endTransaction=function(e){I.endTransaction(e,!1)},o.containsBrandedContent=function(){return l.BrandingFacade.doesDocumentContainBrandedElements(g,!1)},o.updateCharStyleRanges=function(e,t){return te(new l.UpdateCharStyleRangeAction(o.getSelectedForma(),e,t))},o.missingFontListInDoc=function(){return g.missingFontList},o.setCPProjectID=function(e){if(g){const t=o.beginTransaction("setCPProjectID");g.publishedResourcePath=e,o.endTransactionAndMergeWithPrevious(t)}},o.setCommunityPlatformAlias=function(e){if(g){const t=o.beginTransaction("setCommunityPlatformAlias");g.communityPlatformAlias=e,o.endTransactionAndMergeWithPrevious(t)}},o.setCommunityPlatformAssetID=function(e){if(g){const t=o.beginTransaction("setCommunityPlatformAssetID");g.communityPlatformAssetID=e,o.endTransactionAndMergeWithPrevious(t)}},o.setPublishedEtag=function(e){if(g){const t=o.beginTransaction("setPublishedEtag");g.publishedEtag=e,o.endTransactionAndMergeWithPrevious(t)}},o.getIsExported=function(){return g?g.isExported:null},o.setIsExported=function(e){if(g){const t=o.beginTransaction("setIsExported");g.isExported=e,o.endTransactionAndMergeWithPrevious(t)}},o.getDisplayableAnimationStyles=function(){return l.AnimationLibrary.getDisplayableAnimationStyles(g.firstPage.root)},o.hasAnimationStyle=function(){const e=g.firstPage.animationController.animationStyle;return null!==e&&e.name!==l.AnimationStyle.NAME_NO_STYLE},o.getCurrentAnimationStyle=function(){return g.firstPage.animationController.animationStyle},o.getCoreAnimationStyle=function(){return l.AnimationStyle},o.setAnimationStyle=function(e,n){const r=g.firstPage.animationLibrary.getAnimationStyle(e);if(r){if(n>0){var i=r.clone();return i.variant=n,o.applyAnimationStyleAction(i)}return o.applyAnimationStyleAction(r)}return t.reject()},o.applyAnimationStyleAction=function(e){return te(new l.ApplyAnimationStyleAction(e,g.firstPage))},o.removeContentForCorruptImageFrame=function(e){const t=g.content.root.nodeByID(e);if(se(t)){const e=o.beginTransaction("removeCorruptContentNode");t.parent&&t.parent.removeChild(t),t.releaseResources(),o.endTransactionAndMergeWithPrevious(e)}},o.replaceCorruptImageFrames=function(){const e=[];let t;g.content.root.visitAll(n=>{se(n)&&(t||(t=o.beginTransaction("removeCorruptContentNodes")),e.push(n.id),n.parent&&n.parent.removeChild(n),n.releaseResources())});const n=e.length>0;if(0===e.length)return n;const r=o.imageFormas().filter(t=>e.indexOf(t.contentID)>=0);if(r.length){const e=p.solidColor2TheoColor(p.hex2SolidColor("FF0000"),null,null);l.ImageFacade.replaceImagesWithColors(r,[e])}return t&&(t=o.endTransactionAndMergeWithPrevious(t)),n},o.willCloseDocument=function(){g.willCloseDocument()},function(){D=n.persistSource||u.fromDocument(n.dcxDoc),x=n.persistSave||d.toDocument(n.dcxDoc);var t=!1;A=D.open().then((function(e){return(t=e.hadMissingFontsWhenOpened)?h.loadMissingFonts(e.missingFontList):e})).then((function(e){return t?D.open():e})).then((function(e){return t=e.hadMissingFontsWhenOpened,(g=e).controller.selection.subscribeWithCallback(oe,l.SelectionStateChangedMessage.TYPE),x.initialize()})).then((function(){const n=o.beginTransaction("create-grid-controller");if(g.firstPage.root.controller.createGridControllerIfNone(),o.endTransactionAndMergeWithPrevious(n),t){var i=o.beginTransaction("update missing fonts");o.lockupFormas().forEach((function(e){e.controller.updateGroup(),e.controller.updateScoring()})),o.endTransactionAndMergeWithPrevious(i)}return(r=g.controller.undoRedoMgr).reset(),g.controller.designControllerHandlesPointers=!0,g.controller.enableMoveableChildren=!0,r.subscribeWithCallback((function(e){if("state-changed"===e.changeType||"state-clean"===e.changeType){if(!r.gestureScope){ie();var t=o.getSelectedForma(),n=o.getSelectedFormaId();n&&(o.inCharStyleMode&&t.isTypeLockup()?(t.controller.selectCharStyleForma(),ae(t)):(o.exitCharStyleMode(),o.events.publish("forma-selected",{id:n,forma:t,selectionBox:z()}))),l.MultiBrandFacade.handleUndoRedoMessage(e),o.events.publish("undo-redo-state-changed",{changeType:e.changeType}),_(),W()}}else"state-updated"===e.changeType?(ie(!1),W()):"timeline-changed"===e.changeType&&o.events.publish("undo-redo-state-changed",{changeType:e.changeType})}),l.UndoRedoMessage.TYPE),r.registerPatch((function(t){e.each(L,(function(e){e()})),t()})),o.events.publish("undo-redo-state-changed"),w=!0,_(),!0}))}(),o}}.apply(t,o))||(e.exports=r)},"6lgp":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return o}));class o extends Error{constructor(){var e,t,n;super(...arguments),n=!1,(t="isAllowedError")in(e=this)?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n}}},"7the":function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i=r.default,a={},c=window.location.protocol+"//"+window.location.host;return a.loadFile=function(e,t){var r=n.defer();return o.dcxService.invoke("GET",c+i.decodeUrl(e),{},null,t,(function(e,t){e?r.reject(e):r.resolve(t.response)})),r.promise},a}.apply(t,o))||(e.exports=r)},"8VGm":function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return h}));var o=n("MGCh"),r=n.n(o),i=n("b3Wv"),a=n.n(i),c=n("a8ov"),s=n("UzQk"),l=n("14LO");function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}const d=n("UFvF"),p=r.a.channel("SourceCPAsset");class h{constructor(e){u(this,"assetId",void 0),u(this,"cpServiceDomain",void 0),this.assetId=e.assetId,this.cpServiceDomain=e.cpServiceDomain}documentId(){return this.assetId}open(){return d(this.openAsync())}async openAsync(){const e=await a.a.loadComposite(this.assetId,this.cpServiceDomain);e.name="";const t=new l.DCXDocumentComposite({composite:e,componentURLfn:e=>c.default.encodeCPUrl(this.assetId,e.absolutePath),overrideIDfn:e=>s.GUIDUtils.makeGUID()});var n,o=t.current;if(s.DocumentPersistenceFactory.usesJsonDocumentEncoding(o)){const e=s.JSONDocumentDecoder.getRequiredSynchronousComponents(o);await Promise.all(e.map(async e=>{const t=c.default.encodeCPUrl(this.assetId,e),n=await a.a.loadFile(t,{});var r=JSON.parse(n);o.registerContentForComponent(e,r)}))}try{n=s.TheoDocument.decodeDocument(t,(function(e){throw o.releaseRegisteredContent(),new Error(e.join(";"))})),o.releaseRegisteredContent()}catch(e){throw p.error("decoding from CP",e),n=s.TheoDocument.createDefault(),e}return n.history.postEntry("open,src=CP,was-vers="+n.versionDecoded.rawValue),n}}},FGv1:function(e,t,n){"use strict";n.r(t),n.d(t,"DCXDocumentComponentDeferred",(function(){return a}));var o=n("1tmr"),r=n("UzQk"),i=n("nNj6");class a extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="params")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.params=n}attachToNode(){}detachFromNode(){}get absolutePath(){return""}get componentId(){return this.params.componentId||""}get name(){return this.params.name}get path(){return this.params.path}get type(){return this.params.type}get etag(){return""}get relationship(){return this.params.relationship}get sourceHref(){return this.params.sourceHref}get mutableCopy(){return new a(this.branch,this.node,this.params)}replaceWithReal(e){if(!e||!e.etag)return r.CoreAssert.fail("replaceWithReal: you need to pass an AdobeDCXComponent"),null;const t=new i.a(this.branch,this.node,e);return this.update(t),t}}},KpqY:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var o=n("UzQk"),r=n("6lgp"),i=n("UFvF"),a=n.n(i);class c{static doAction(e,t){return c.doActionWithCompletion(e,t)}static doActionWithCompletion(e,t,n){if(!e||!e.controller)return a.a.reject("No document or controller");var i=a.a.defer();return e.controller.doActionWithCompletion(t,(function(e,t){if(n)try{n(e,t)}catch(e){t||(t=e)}if(t){if(!(t instanceof r.default)){const e=t instanceof o.CoreErrorObject&&t.isAllowedError;(t=new r.default(t)).isAllowedError=e}i.reject(t)}else i.resolve(e)})),i.promise}static beginTransaction(e,t){return e.beginTransaction(t)}static endTransaction(e,t){t?e.mergeWithPrevious():e.end()}}},LI3u:function(e,t,n){var o,r=n("MOGj"),i=n("YLtl"),a=n("MGCh").channel("ManifestEncoder");function c(e,t){for(var n=0;n<e.length;n++){var o=e[n];if(o.id===t)return o}}(o=function(e,t){if(this.config=i.extend({},e),this.branch=e.branch,this.rootNode=e.rootNode||this.branch.rootNode,this.node=t||this.rootNode,this.componentBranch=e.componentBranch||this.branch,this.componentRootNode=e.componentRootNode||this.componentBranch.rootNode,this.componentNode=e.componentNode||this.node,this.isRoot=this.node==this.rootNode,this._nodes=[],this._components=[],this._stashedComponents=[],this.isRoot){var n=this.componentBranch.getComponentsOf(this.componentRootNode),o=function e(t,n,o){if(!n)return t.allComponents();o=o||[];var r=t.getComponentsOf(n);return r&&r.length>0&&(o=o.concat(r)),t.getChildrenOf(n).forEach((function(n){o=e(t,n,o)})),o}(this.componentBranch,this.componentRootNode);a.info("stashing: begin (".concat(o.length," components, ").concat(o.length-n.length," not at root)"));for(var r=0;r<o.length;r++){var s=o[r];if(!c(n,s.id)){this._stashedComponents.push(s),a.info("stashing: moving component ".concat(s.id," to node ").concat(this.componentRootNode.absolutePath));try{this.componentBranch.moveComponent(s,this.componentRootNode)}catch(e){e&&e.message.indexOf("Component not found in this branch.")>=0?this._stashedComponents.pop():a.warn(e)}}}a.info("stashing: complete"),this.config.stashedComponents=this._stashedComponents;var l=this.branch.getChildrenOf(this.node);for(a.info("removing all ".concat(l.length," root nodes")),r=0;r<l.length;r++){var u=l[r];this.branch.removeChild(u)}}else this._stashedComponents=this.config.stashedComponents})._implements=function(e){return"IExportDataObject"==e},o.prototype=Object.create(Object.prototype,{_implements:{value:function(e){return"IExportDataObject"===e}},setName:{value:function(e){this.node?this.node.name=e:this.branch.name=e}},setType:{value:function(e){this.node.setValue("type",e)}},setPath:{value:function(e){this.node.setValue("path",e)}},setProperty:{value:function(e,t){e.indexOf("#")<0&&(e="theo#"+e),this.node.setValue(e,t)}},setOptionalStringProperty:{value:function(e,t){t&&this.setProperty(e,t)}},setStringProperty:{value:function(e,t){this.setProperty(e,t)}},setNumberProperty:{value:function(e,t){this.setProperty(e,t)}},setIntProperty:{value:function(e,t){this.setProperty(e,t)}},setBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},setOptionalBooleanProperty:{value:function(e,t){this.setProperty(e,t)}},appendChild:{value:function(e){var t=(new r.AdobeDCXBranch).addChild(null,e),n=new o(this.config,t);return this._nodes.push(n),n}},appendComponent:{value:function(e,t,n){var o={id:e,url:t,mimeType:n,confirmed:!0};this._components.push(o)}},setManifestProperty:{value:function(e,t){this.setProperty(e,t)}},setDocumentSize:{value:function(e,t){}},setCompositeID:{value:function(e){}},prepareForAttachment:{value:function(){}},finalizeAfterAttachment:{value:function(e){this.isRoot&&a.info("unstashing: begin");for(var t=0;t<this._components.length;t++){var n=this._components[t];a.assert(n.id,"finalizeAfterAttachment: A recorded component has no ID.");var o=c(this._stashedComponents,n.id),r=!1;if(this.config.finalizingComponent&&(r=this.config.finalizingComponent(e,n)),o)if(this.componentNode==this.componentRootNode);else try{var i=this.node==this.componentNode?e:this.componentNode;a.info("unstashing: moving stashed component ".concat(o.id," to node ").concat(i.absolutePath)),this.componentBranch.moveComponent(o,i)}catch(e){a.warn("moveComponent to node failed: "+e)}else a.assert(r,"finalizeAfterAttachment: no existing component, and finalizingComponent not provided or did not indicate that's OK.")}for(t=0;t<this._nodes.length;t++){var s=this._nodes[t];s.prepareForAttachment();try{var l=s.node,u=this.branch.copyChild(l,e||this.node,t,l.path,l.id);s.finalizeAfterAttachment(u)}catch(e){a.warn("addChild to node failed: "+e)}}if(this.isRoot){a.info("unstashing: complete");var d=this.componentBranch.getComponentsOf(this.componentRootNode);for(t=0;t<this._stashedComponents.length;t++){var p=c(d,(n=this._stashedComponents[t]).id);p&&(a.info("dumping unused component "+p.path),this.config.removeUnusedComponent?this.config.removeUnusedComponent(n,p):this.componentBranch.removeComponent(p))}}}}}),o.prototype.constructor=o,e.exports=o},WpJZ:function(e,t,n){"use strict";n.r(t),n.d(t,"getLockupStyleStringWithRole",(function(){return i})),n.d(t,"getAllStringForFormaUsedWheelSuggestions",(function(){return a})),n.d(t,"getUnreportedNounProjectIds",(function(){return c})),n.d(t,"setNounProjectIdsReported",(function(){return s}));var o=n("KpqY"),r=n("UzQk");function i(e,t){let n="";const o=e&&e.style;if(!o||!o.wheelUsed)return n;n=o.getCompressedStringOfFeatures();const i=(new r.RoleSuggester).getRole(e);return n="".concat(n,"{role:").concat(i.role,"|id:").concat(e.formaID,"|docId:").concat(t.uuid,"}"),n}function a(e){return e.firstPage.root.filterByControllerKind(r.TypeLockupController.KIND).map(t=>i(t,e)).filter(e=>e.length>0)}function c(e){return r.TheoDocumentUtils.getUnreportedUsedIcons(e)||[]}function s(e,t){if(!t)return;const n=o.default.beginTransaction(t,"setNounProjectIdsReported");r.TheoDocumentUtils.reportedIconUsage(t,e),o.default.endTransaction(n,!0)}},b2xK:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF")],void 0===(r=function(e,t){var n=function(e){e=e||{};var n={initialize:function(){return t.resolve(!0)},saveWithRenditions:function(e,n,o,r){return t.resolve(!0)},saveImageComponent:function(e){const t=(window.URL||window.webkitURL).createObjectURL(e);return Promise.resolve({component:{id:"d34f9c8e-7789-4909-a810-7c9937cdce9e"},encodedUrl:t})},documentId:function(){return null}};return n};return n.toBlackHole=function(){return new n({})},n}.apply(t,o))||(e.exports=r)},b3Wv:function(e,t,n){var o,r;o=[n("xeH2"),n("YLtl"),n("UFvF"),n("MOGj"),n("a8ov")],void 0===(r=function(e,t,n,o,r){var i,a,c=r.default,s={},l=window.location.protocol+"//"+window.location.host,u=l+"/api/post/v1/cp/";function d(){!i&&o.dcx&&(i=o.dcx.createHTTPService()),!a&&o.dcx&&(a=o.dcx.createCommunitySession(i,u))}return d(),s.loadComposite=function(e,t){var r=n.defer(),i=t?"host/".concat(t,"/"):"",c="".concat(u).concat(i,"dcx/").concat(e,"/"),s=o.dcx.newCompositeWithAssetId(c);return d(),o.dcx.compositeXfer.pullCompositeManifestOnly(s,a,(function(e,t){!e&&t?(s.resolvePullWithBranch(t),r.resolve(s)):r.reject(e)})),r.promise},s.loadFile=function(e,t){var o=n.defer(),r=c.decodeUrl(e);return i.invoke("GET",l+r,{},null,t,(function(e,t){e?o.reject(e):o.resolve(t.response)})),o.promise},s}.apply(t,o))||(e.exports=r)},btxu:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return s}));var o=n("UzQk"),r=n("wHG3"),i=n("lulf"),a=n("yBTN");function c(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class s{constructor(e){c(this,"coreWrapper",void 0),c(this,"assetLoader",void 0),this.coreWrapper=e,this.assetLoader=new a.default(this.coreWrapper)}static getImageQueue(){return this.pixiRenderer||(this.pixiRenderer=new r.PixiJSRenderer),this.imageQueue||(this.imageQueue=this.pixiRenderer.imageService.createQueue()),Promise.resolve(this.imageQueue)}static initialize(e){const t=!!(e=e||{}).skipLoadingAuthenticatedFeatures;if(!s.initializePromise){var n=new i.default;s.initializePromise=n.loadFeatures({skipLoadingAuthenticatedFeatures:t}).then(()=>{o.Host.setFeatureController(n)})}return s.initializePromise}static calculateTarget(e,t){let n,o;if("number"==typeof t.width&&"number"==typeof t.height)n=t.width,o=t.height;else{if("number"!=typeof t.longestSide)throw new Error("renderToCanvas missing one or more key parameters");{const r=e.bounds.width,i=e.bounds.height;n=r>i?t.longestSide:Math.round(t.longestSide*r/i),o=r>i?Math.round(t.longestSide*i/r):t.longestSide}}return{width:n,height:o}}async commonRender(e,t){const n=e.honorDocWatermarkProp&&this.coreWrapper.getWatermarkEnabledForDoc();let o=!1,i=0;"number"==typeof e.animTime&&(i=e.animTime,o=!0);const a=this.coreWrapper.getGraph(o,n);let c;if("number"==typeof e.longestSide)c=r.PixiJSApp.TargetRenderParameters.forGraphAtSize(a,e.longestSide,t);else{if("number"!=typeof e.width||"number"!=typeof e.height)throw new Error("render params missing one or more parameters");c=r.PixiJSApp.TargetRenderParameters.fit(e.width,e.height,t)}const l=await s.getImageQueue();return await l.render(a,c,i,this.assetLoader)}async renderToCanvas(e,t){const n=await this.commonRender(t,r.PixiJSApp.RawEncoding.AsUint8Array());e.canvas.width=n.width,e.canvas.height=n.height;const o=e.createImageData(n.width,n.height);o.data.set(n.data),e.putImageData(o,0,0)}async renderToBlob(e){const t=await this.commonRender(e,"image/png"===e.outputFormat?r.PixiJSApp.PNGEncoding.AsUint8Array():r.PixiJSApp.JPGEncoding.AsUint8Array(e.imageQuality||.75));return new Blob([t.data])}async render(e){return(await this.commonRender(e,"image/png"===e.outputFormat?r.PixiJSApp.PNGEncoding.AsDataURL():r.PixiJSApp.JPGEncoding.AsDataURL(e.imageQuality||.75))).data}async renderStack(e){return null}}c(s,"pixiRenderer",void 0),c(s,"imageQueue",void 0),c(s,"initializePromise",void 0)},hEO4:function(e,t,n){var o,r;o=[n("MGCh"),n("UzQk")],void 0===(r=function(e,t){const n=e.channel("Diagnostics"),o={truncateEncodedDOM:function(e){const t=["theo#placement","theo#bounds","theo#style","theo#color-library","theo#saliency-data","theo#artwork","theo#image-color-data","theo#edge-data"],n=["type-lockup"];return function e(o){const r={},i=o["theo#controller-kind"];try{Object.keys(o).forEach(a=>{let c=o[a];t.indexOf(a)>=0?c="…".concat(JSON.stringify(c).length,"…"):"children"===a?c=i&&n.indexOf(i)>=0?"…".concat(JSON.stringify(c).length,"…"):c.map(t=>e(t)):"string"==typeof c&&(c=c.replace(/(.{8})-.{4}-.{4}-.{4}-.{12}/g,"$1…")),r[a]=c})}catch(e){r.error="threw "+e}return r}(e)},validateDOM:function(e){try{if(!e.children)return"no root children";4!==e.children.length&&n.warn("expected 4 root children");const t=e.children.find(e=>"forma-document"===e.path);if(!t)return"no forma document";if("application/vnd.adobe.theo.forma+dcx"!==t.type&&n.warn("forma doc did not have correct type",t.type),!t.children||1!==t.children.length)return"expected exactly one forma root";const o=t.children[0];if("Root"!==o["theo#kind"])return"root forma did not have kind Root";if("root"!==o["theo#controller-kind"])return"root forma did not have controller kind root";if(!o.children||0===o.children.length)return"root forma did not have children";if(window.simulate_bad_dom){delete o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"])["theo#controller-kind"]}const r=o.children.find(e=>"group"===e["theo#kind"]&&"grid"===e["theo#controller-kind"]);if(!r)return"root forma did not have a grid child";if(!r.path)return"grid is missing path property"}catch(e){return"validation threw: "+e}return null},findGrid:function(e){if(!e)return n.error("findGrid: document is null"),null;const t=e.firstPage.root;if(!t||0===t.childCount)return n.error("findGrid: root has no children"),null;const o=t.children_.find(e=>"group"===e.kind&&e.controller&&"grid"===e.controller.kind);return o||(1===t.children_.length?(n.error("findGrid: assuming the sole child of the root is the grid; it's not the correct kind"),t.children_[0]):(n.error("findGrid: root unexpectedly had more than one child and none looked like a grid"),null))},dumpPostDOM:function(e){return function e(n){try{const o={id:n.formaID,kind:n.kind},r=n.controller;if(r&&(o.ckind=r.kind),n instanceof t.GroupForma){const r=n.visitAsArray(t.FormaTraversal.JustChildren);o.children=r.map(t=>e(t))}return o}catch(e){return{error:"threw"+e}}}(e.firstPage.root)},dumpStateDelta:function(e,t,n){t=t||10,n=n||1e4;const o=[];try{const r=e.database;let i=0,a=r.currentState.state;for(;a&&i<t;){const e={guid:a.guid,gen:a.generation_};try{e.deltas=Object.keys(a.objectStates).map(e=>{const t=a.objectStates[e];return{id:e,cls:t.className,props:Object.keys(t.properties||{}).join(",")}})}catch(t){e.error="threw "+t}if(o.push(e),JSON.stringify(o).length>n&&(e.summary="".concat(e.deltas.length," objects mutated"),delete e.deltas,JSON.stringify(o).length>n)){o.pop();break}a=a.basedOn,i++}}catch(e){o.push({error:"state enumeration threw "+e})}return o},dumpUndoRedo:(e,t)=>{t=t||80;const n={states:[]};try{e.controller.undoRedoMgr.timeline.states.forEach(e=>{const o={};e.action&&(o.action=e.action.description),e.state&&e.state.state&&(o.guid=e.state.state.guid),e.beginSelectedFormaIDs&&(o.bfids=e.beginSelectedFormaIDs.concat()),e.endSelectedFormaIDs&&(o.efids=e.endSelectedFormaIDs.concat()),n.states.push(o),n.states.length>t&&n.states.shift()})}catch(e){n.error="throw: ".concat(e)}return n},snapshotFormaHistory:(e,t)=>{if(!t)return{error:"nil object"};const n=[];try{let o=t.state;for(;o;){const r={};Object.keys(o.properties).forEach(e=>{const t=o.properties[e];t.isArray?r[e]="array(".concat(t.value.length,")"):t.isDictionary?r[e]="object(".concat(Object.keys(t.value).join(","),")"):r[e]="".concat(t.schemaType,"(").concat(t.value,")")});const i=[];let a=e.database.currentState.state;for(;a;)a.objectStates[t.id]===o&&i.push(a),a=a.basedOn;n.push({props:r,dbStates:i.map(e=>e.guid)}),o=o.basedOn}}catch(e){n.push("throw ".concat(e))}return{kind:t.kind,id:t.formaID,ckind:t.controller?t.controller.kind:"no controller",states:n}},monitorTransactionsForDocument:function(e){const t=[];let r=!1;const i=(e,o)=>{try{r=!0;const i={msg:e,recent:t.concat()};void 0!==o&&(i.err=o);try{throw new Error}catch(e){i.stack=e.stack}n.error("grid validation failed",i)}catch(e){n.error("monitorTransactionsForDocument throw",e)}},a=n=>{try{if(r)return;if(t.push({event:n,history:o.snapshotFormaHistory(e,e.firstPage.root.childAt(0))}),t.length>10&&t.shift(),window.simulate_db_validation_failure)i("simulated failure"),r=!1;else if(1!==e.firstPage.root.childCount)i("root has ".concat(e.firstPage.root.childCount," children"));else{const t=e.firstPage.root.childAt(0);"group"!==t.kind?i("grid has kind ".concat(t.kind)):t.controller?"grid"!==t.controller.kind&&i("grid has controller kind ".concat(t.controller.kind)):i("grid has kind ".concat(t.kind))}}catch(n){i("throw validating",n)}};e.database.addListener({onBeginTransaction:(e,t)=>a("beginT ".concat(t.name)),onEndTransaction:(e,t)=>a("endT ".concat(t.name)),onStateChanged:(e,t)=>{},onObjectStateChanged:(e,t)=>{}})}};return o}.apply(t,o))||(e.exports=r)},mwMu:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("r3b0"),n("14LO")],void 0===(r=function(e,t,n,o,r,i,a,c){var s=r.default,l=c.DCXDocumentComposite,u=o.channel("SourceCCStorage"),d=["id","local","manifest-format-version","name","projectContext#npwMethod","state","type","authctx#ctxid"],p=function(e){var o={},r=(e=e||{}).dcxDoc||n.currentDoc,c=e.branch||r.getDCXComposite().current,p=e.rootNode||c.root,h=e.domComponentPath;return o.open=function(){return(h?r.getComponent(p.absolutePath+"/"+h).then((function(e){var t,n=JSON.parse(e),o=new a({makeComponentUrl:function(e){return s.encodeComponentUrl(r.id,e.id,e.type)},manufactureComponentsForNode:function(e){var t=e&&e["theo#external-url"];return t?[{id:i.GUIDUtils.makeGUID(),url:t,mimeType:e["theo#mimetype"]}]:null},trackAbsolutePath:!0,branch:n});try{(t=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){const t=e&&"function"==typeof e.join?e.join(";"):"No error array found for err: ".concat(e);throw new Error(t)}))).history.postEntry("open,src=AC,was-vers="+t.versionDecoded.rawValue),p.name&&(t.documentName=p.name)}catch(e){throw u.error("acOpen",e),t=i.TheoDocument.createDefault(r.id),e}return t})):c===r.getDCXComposite().current?function(){var e,n,o=r.getDCXRoot();if(o._data.children)e=new l({composite:r.getDCXComposite()});else{for(var a in o._data)o._data.hasOwnProperty(a)&&-1===d.indexOf(a)&&console.error("unexpecte property: "+a+" found when creating a new doc.");e=null}n=e&&e.current;let c=t.resolve();return n&&i.DocumentPersistenceFactory.usesJsonDocumentEncoding(n)&&(c=c.then(()=>{const e=i.JSONDocumentDecoder.getRequiredSynchronousComponents(n);return t.all(e.map(e=>r.getComponent(e).then((function(t){var o=JSON.parse(t);n.registerContentForComponent(e,o)}))))})),c.then(()=>{var t;try{t=e?i.TheoDocument.decodeDocument(e,(function(e){throw n.releaseRegisteredContent(),new Error(e.join(";"))})):i.TheoDocument.createDefault(r.id),n&&n.releaseRegisteredContent(),t.history.postEntry("open,src=CC,was-vers="+t.versionDecoded.rawValue)}catch(e){throw u.error("coreOpen",e),e}return t})}():function(){var e,n=c._data,o=new a({makeComponentUrl:function(e){return s.encodeComponentUrl(r.id,e.id,e.type)},trackAbsolutePath:!1,branch:n,rootNode:p});try{e=new i.TheoDocument.newDocumentFromDataObject(o,(function(e){throw new Error(e.join(";"))}))}catch(e){return u.error("decoding from nodes",e),t.reject(e)}return t.resolve(e)}()).then(e=>e)},o.documentId=function(){return r.id},o};return p.fromDocument=function(e){return new p({dcxDoc:e})},p.fromTemplate=function(e,t){return new p({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json"})},p}.apply(t,o))||(e.exports=r)},nNj6:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));var o=n("1tmr"),r=n("UzQk");class i extends o.a{constructor(e,t,n){var o,r,i;super(e,t),i=void 0,(r="dcxComponent")in(o=this)?Object.defineProperty(o,r,{value:i,enumerable:!0,configurable:!0,writable:!0}):o[r]=i,this.dcxComponent=n}attachToNode(){if(this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)<0)try{this.branch.dcxBranch.moveComponent(this.dcxComponent,this.node.dcxNode)}catch(e){r.CoreAssert.fail("attachToNode: moveComponent() failed",e)}}detachFromNode(){this.branch.dcxBranch.getComponentsOf(this.node.dcxNode).indexOf(this.dcxComponent)>=0&&this.branch.retireComponent(this.dcxComponent)}get absolutePath(){return this.dcxComponent.absolutePath||""}get componentId(){return this.dcxComponent.id||""}get name(){return this.dcxComponent.name}get path(){return this.dcxComponent.path}get type(){return this.dcxComponent.type}get etag(){return this.dcxComponent.etag}get relationship(){return this.dcxComponent.relationship}get sourceHref(){return null}get mutableCopy(){return new i(this.branch,this.node,this.dcxComponent)}}},qnb0:function(e,t,n){var o,r;o=[n("YLtl"),n("UFvF"),n("MOGj"),n("2ofD"),n("MGCh"),n("a8ov"),n("UzQk"),n("b3Wv"),n("7the"),n("LI3u"),n("bBG2"),n("uTW7"),n("FGv1"),n("hEO4")],void 0===(r=function(e,t,n,o,r,i,a,c,s,l,u,d,p,h){const m=i.default,g=u.default;var f=r.channel("SaveCCStorage"),v=function(e,t){var n=e&&e.absolutePath;return n&&"/"!==n?n+"/"+t:"/"+t},y=function r(i){var u={},y=(i=i||{}).dcxDoc||o.currentDoc,C=i.branch||y.getDCXComposite().current,S=i.rootNode||C.rootNode,b=i.domComponentPath,F=i.isAuthoringContext||!!b,I=i.copyExternalImages,k=i.commitChanges||r.CommitChanges.AUTO,T=C.addElement("retirement","foo","retirement"),w=C.getChildWithAbsolutePath("/retirement");C.removeChild(w);var A={};function P(e,t){return"".concat(e,":").concat(t)}var D=[];function x(e,n){var o=F?e:e+".jpg";f.info("saving rendition "+o);var r=v(S,o);return y.pushComponentWithRetry({name:e,path:o,absolutePath:r,isUpdate:D.indexOf(r)>=0,relationship:"rendition",file:n,type:n.type,parent:S}).then((function(e){return f.info("finished saving rendition "+o),e})).catch((function(e){return f.error("error while saving image rendition",e),g.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+o,contextualData2:"success:"+!1}),t.reject(e)}))}function L(){var e=C.getChildWithAbsolutePath(v(S,"assets"));return e||((e=C.addChild(void 0,void 0,0,S)).path="assets"),e}function N(e,o,i){f.info("legacyACSave: begin"),f.assert(i,"legacyACSave: expected a thumbnail rendition"),f.assert(b,"legacyACSave: expect to get here only with a domComponentPath"),f.assert(F,"legacyACSave: expect to get here only for legacy AC saving");var c,s=[],u=y.getDCXComposite().current,d={finalizingComponent:function(e,t){var n=A[P(t.id,t.url)]||t.url;return m.isEncodedCPUrl(n)||m.isEncodedAuthoringContextUrl(n)||(n.indexOf("theo-web/images")>=0?f.warn("legacyACSave: recording this url as external",n):f.error("legacyACSave: recording this url as external",n)),e.setValue("theo#external-url",n),!0},removeUnusedComponent:function(e,t){T.getComponentWithId(t.id)?f.info("not retiring component ".concat(t.id," because we already have a")):(f.info("retiring component ".concat(t.id)),T.copyComponent(t)),u.removeComponent(t)}};c=new n.AdobeDCXBranch,d.branch=c,d.componentBranch=u,d.componentRootNode=S,d.componentNode=L();try{f.info("encoding composite"),e.history.postEntry("save,dst=AC");var p=new l(d);e.encode(p),p.prepareForAttachment(),p.finalizeAfterAttachment()}catch(e){throw f.error("error during encoding",e),err}const h=[];return o&&s.push(x("preview",o).then((function(e){h.push(e)}))),i&&s.push(x("thumbnail",i).then((function(e){h.push(e)}))),c&&s.push(function(e,n,o){f.info("saving dom "+n);var r=v(S,n);return y.pushComponentWithRetry({name:e,path:n,absolutePath:r,isUpdate:D.indexOf(r)>=0,relationship:"dom",type:"application/vnd.adobe.adobesparkpost.dom+json",file:JSON.stringify(o),parent:S}).then((function(e){return f.info("finished saving dom "+n),e})).catch((function(e){return f.error("error while saving dom",e),g.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+n,contextualData2:"success:"+!1}),t.reject(e)}))}("dom",b,c._data)),t.all(s).then((function(){S.setValue("theo#last-modified",(new Date).toISOString());var n=e.documentName;return S.name=n===a.TheoDocument.DEFAULT_NAME?"":n,M(h),k===r.CommitChanges.NEVER?(f.info("legacyACSave: complete; not saving, per client"),t.resolve()):(f.info("legacyACSave: saving changes"),y.saveChanges((function(){})).then(()=>f.info("legacyACSave: complete")))}))}function M(t){e.each(e.filter(y.getDCXComposite().current.getComponentsOf(S),(function(e){return"rendition"===e.relationship&&t.indexOf(e)<0})),(function(e){f.info("removing stale rendition component",e.id),y.getDCXComposite().current.removeComponent(e)}))}function O(e,o,i,c){f.info("coreSave() begin");var s=new d.DCXDocumentBranch({branch:y.getDCXComposite().current,retiredElement:T}),l=a.DocumentPersistenceFactory.encoderFor(s);try{"string"==typeof c?e.encodeStateByID(c,l):e.encode(l),l.finish()}catch(e){throw f.error("coreSave() threw during encoding process",e),e}const u=[],m=[],C=s.getDeferredComponents(),S=C.find(e=>"dom"===e.relationship);if(S){const n=S.params.content,o=h.validateDOM(n);if(o){f.error("validation failure '".concat(o,"'; encoded="),h.truncateEncodedDOM(n)),f.error("validation failure '".concat(o,"'; document="),h.dumpPostDOM(e)),f.error("validation failure '".concat(o,"'; delta="),h.dumpStateDelta(e)),f.error("validation failure '".concat(o,"'; undoredo="),h.dumpUndoRedo(e));const r=h.findGrid(e);return f.error("validation failure '".concat(o,"'; gridhist="),h.snapshotFormaHistory(e,r)),t.reject(o)}}const b=s.root&&s.root.dcxNode;if(b)try{const e=JSON.stringify(b._data);(new n.AdobeDCXBranch).parse(e)}catch(n){return f.error("manifest validation failure '".concat(n,"'; encoded="),h.truncateEncodedDOM(dom)),f.error("manifest validation failure '".concat(n,"'; document="),h.dumpPostDOM(e)),f.error("manifest validation failure '".concat(n,"'; delta="),h.dumpStateDelta(e)),f.error("manifest validation failure '".concat(n,"'; undoredo="),h.dumpUndoRedo(e)),t.reject(n)}return C.forEach(e=>{u.push(function(e){f.assert(e instanceof p.DCXDocumentComponentDeferred);var n=e.params,o=v(n.node,n.path);return f.info("saving deferred component ".concat(n.name," at ").concat(o)),y.pushComponentWithRetry({name:n.name,path:n.path,absolutePath:o,isUpdate:D.indexOf(o)>=0,relationship:n.relationship,file:JSON.stringify(n.content),type:n.type,parent:n.node.dcxNode}).then((function(t){return f.info("finished saving component "+n.path),e.replaceWithReal(t),t})).catch((function(e){return f.error("error while saving component",e),g.publish("post:saveCCStorageAttempt",{contextualData1:"path:".concat(o),contextualData2:"success:false"}),t.reject(e)}))}(e))}),o&&u.push(x("preview",o).then((function(e){m.push(e)}))),i&&u.push(x("thumbnail",i).then((function(e){m.push(e)}))),f.info("coreSave waiting on ".concat(u.length," asynchronous operations")),t.all(u).then(()=>(M(m),k==r.CommitChanges.NEVER?t.resolve():(f.info("coreSave: requesting doc.saveChanges()"),y.saveChanges((function(){}))))).then(()=>{f.info("coreSave() finished")})}return u.initialize=function(){return t.resolve(!0)},u.documentId=function(){return y.id},u.saveImageComponent=function(e,n,o,r,i){n=n||"image/jpeg",o=o||L();var c="";"image/jpeg"===n?c=".jpg":"image/png"===n?c=".png":"image/svg"!==n&&"image/svg+xml"!==n||(c=".svg");var s=a.GUIDUtils.makeGUID()+c,l={name:i||"image",relationship:"image",type:n,path:s,absolutePath:v(o,s),parent:o};return r&&(l.id=r),e instanceof Blob?l.file=e:(l.copyFrom={source:e.source,assetId:e.assetId},e.source||f.error("save-ccstorage saveImageComponent imageFile.source is falsy, assetId:  "+e.assetId)),f.info("pushing component "+s),y.pushComponentWithRetry(l).then((function(e){return f.info("pushed component "+s),{component:e,encodedUrl:F?m.encodeAuthoringContextUrl(y.id,e.id,null,n):m.encodeComponentUrl(y.id,e.id,n)}})).catch((function(e){return f.error("save-ccstorage saveImageComponent failed with",e),g.publish("post:saveCCStorageAttempt",{contextualData1:"path:"+s,contextualData2:"success:"+!1}),t.reject(e)}))},u.saveWithRenditions=function(n,o,r,i){var l,d=n.beginTransaction("prune_orphaned_content");return a.TheoDocumentUtils.pruneOrphanedContent(n),d.end(),l=y.getDCXComposite().current.allComponents()||[],D=l.map(e=>e.absolutePath),(I?function(n){const o=[];return n.content.root.visitAll((function(e){e instanceof a.URLBasedContentNode&&o.push(e)})),t.all(e.map(o,(function(e){let t=e.url;if(!t||!e.componentID){const n=e instanceof a.VectorContentNode;return f.assert(n||t,"doCopyExternalImages: should have a valid url"),f.assert(n||e.componentID,"doCopyExternalImages: should have a valid componentID"),null}t=A[P(e.componentID,t)]||t,t!=e.url&&f.info("doCopyExternalImages: applying domain-map of ".concat(e.url," to ").concat(t));let n=null;if(m.isEncodedCPUrl(t))"all"===I?(f.info("pulling CP image ".concat(t," for componentID ").concat(e.componentID)),n=c.loadFile(t,{responseType:"blob"})):f.info("not pulling CP image ".concat(t," because caller didn't ask us to"));else if(m.isEncodedAuthoringContextUrl(t)){m.decodeAuthoringContextUrlParameters(t).assetId!==y.id?(f.info("pulling AC image",t),n=s.loadFile(t,{responseType:"blob"})):f.info("not pulling AC image ".concat(t," because it's already in this AC"))}else if(m.isEncodedComponentUrl(t)){const e=m.decodeComponentUrlParameters(t);e.docId!==y.id&&(t=m.encodeComponentUrl(e.docId,e.componentId,e.mimeType),f.info("pulling doc image ".concat(t)),n=s.loadFile(t,{responseType:"blob"}))}if(n)return n.then((function(n){return f.info("pushing pulled image",t),u.saveImageComponent(n,e.mimeType,L(),e.componentID,e.componentID)})).then((function(t){return f.assert(t.component.id===e.componentID),f.info("image pushed as component id ".concat(t.component.id,"; aliasing from ").concat(e.url," to ").concat(t.encodedUrl)),A[P(e.componentID,e.url)]=t.encodedUrl,null})).catch((function(e){f.error("error while saving dom",e)}))}))).catch((function(e){throw f.error("error while copying images",e),e}))}(n):t.resolve(null)).then((function(){if(!o){var e=v(S,"preview.jpg"),t=y.getComponentWithAbsolutePath(e);t&&y.removeComponent(t)}return F?N(n,o,r):O(n,o,r,i)}))},u};return y.CommitChanges={AUTO:"AUTO",NEVER:"NEVER"},y.toDocument=function(e){return new y({dcxDoc:e,copyExternalImages:"all",commitChanges:y.CommitChanges.AUTO})},y.toTemplateLocal=function(e,t,n){return new y({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",commitChanges:n})},y.toTemplateExternal=function(e,t,n){return new y({dcxDoc:e.composite,rootNode:t,domComponentPath:"dom.json",copyExternalImages:"template",commitChanges:n})},y}.apply(t,o))||(e.exports=r)},r3b0:function(e,t,n){var o,r;!function(){function e(){for(var e=[],t=0;t<36;t++)e[t]="0123456789abcdef".substr(Math.floor(16*Math.random()),1);return e[14]="4",e[19]="0123456789abcdef".substr(3&e[19]|8,1),e[8]=e[13]=e[18]=e[23]="-",e.join("")}function t(e,t){return e=e||"/",t?("/"!=e.substring(e.length-1)&&(e+="/"),e+t):e}(r=function(t,n){this.config=t,this.branch=t.branch,this.node=n,t.remix&&(this.node?this.node.id=e():this.branch.id=e())})._implements=function(e){return"IImportDataObject"==e},r.prototype=Object.create(Object.prototype,{id:{get:function(){return this.node?this.node.id:this.branch.id}},type:{get:function(){return this.node?this.node.type:this.branch.type}},name:{get:function(){return this.node?this.node.name:this.branch.name}},path:{get:function(){return this.node?this.node.path:this.branch.path}},property:{value:function(e){return e.indexOf("#")<0&&(e="theo#"+e),this.node?this.node[e]:this.branch[e]}},stringProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},numberProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},intProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},booleanProperty:{value:function(e,t){var n=this.property(e);return null==n?t:n}},optionalBooleanProperty:{value:function(e){return this.property(e)}},optionalStringProperty:{value:function(e){return this.property(e)}},forEachChild:{value:function(e){var n=this.node?this.node.children:this.branch.children;if(n)for(var o=0;o<n.length;o++){var i=n[o];this.config.trackAbsolutePath&&(i.absolutePath=t(this.node?this.node.absolutePath:null,i.path)),e(new r(this.config,i),o)}}},forEachComponent:{value:function(e){var n=this.node?this.node.components:this.branch.components;if(n)for(var o=0;o<n.length;o++){var r=n[o];this.config.trackAbsolutePath&&(r.absolutePath=t(this.node?this.node.absolutePath:null,r.path)),e({id:r.id,mimeType:r.type,url:this.config.makeComponentUrl(r)},o)}if(this.config.manufactureComponentsForNode){var i=this.config.manufactureComponentsForNode(this.node);if(i)for(o=0;o<i.length;o++)e(i[o],(n?n.length:0)+o)}}}}),r.prototype.constructor=r}(),void 0!==e.exports?e.exports=r:void 0===(o=function(){return r}.apply(t,[]))||(e.exports=o)},uTW7:function(e,t,n){"use strict";n.r(t);var o=n("UzQk"),r=n("nNj6");function i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}class a{constructor(e,t,n){i(this,"overrideID",void 0),i(this,"dcxNode",void 0),i(this,"parent",void 0),i(this,"branch",void 0),i(this,"childNodes",void 0),i(this,"childComponents",void 0),this.dcxNode=e,this.branch=t,this.parent=n,this.overrideID=t.getOverrideIDForNode(e),this.childNodes=t.dcxBranch.getChildrenOf(this.dcxNode).map(e=>new a(e,t,this)),this.childComponents=t.dcxBranch.getComponentsOf(this.dcxNode).map(e=>new r.a(t,this,e))}get absolutePath(){return this.dcxNode.absolutePath}get nodeId(){return this.overrideID||this.dcxNode.id}get name(){return this.dcxNode.name}set name(e){this.dcxNode.name=e}get path(){return this.dcxNode.path}set path(e){this.dcxNode.path=e}get type(){return this.dcxNode.type}set type(e){this.dcxNode.type=e}getValue(e){return this.dcxNode.getValue(e)}setValue(e,t){this.dcxNode.setValue(e,t)}removeValue(e){this.dcxNode.removeValue(e)}visit(e){let t=e(this);if(t)return t;for(var n=0;n<this.childNodes.length;n++)if(t=this.childNodes[n].visit(e),t)return t;return null}findComponent(e){return this.visit(t=>t.childComponents.find(t=>e(t))||null)}findNode(e){return this.visit(t=>e(t)?t:null)}setCompositeID(e){}setManifestProperty(e,t){}setDocumentSize(e,t){}}var c=n("1tmr"),s=n("A+mC"),l=n("a8ov"),u=n("FGv1"),d=n("MGCh"),p=n.n(d);function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}n.d(t,"DCXDocumentBranch",(function(){return g}));const m=p.a.channel("DCXDocumentBranch");class g{constructor(e){h(this,"dcxBranch",void 0),h(this,"_root",void 0),h(this,"_retiredElement",void 0),h(this,"_componentPaths",{}),h(this,"_componentURLfn",void 0),h(this,"_overrideIDfn",void 0),this.dcxBranch=e.branch,this._retiredElement=e.retiredElement||null,this._componentURLfn=e.componentURLfn||null,this._overrideIDfn=e.overrideIDfn||null,this._root=new a(e.branch.rootNode,this,null)}getOverrideIDForNode(e){return this._overrideIDfn&&this._overrideIDfn(e)}registerContentForComponent(e,t){this._componentPaths[e]=o.Host.persistUtils.writeJsonContentToTempFile(t)}releaseRegisteredContent(){if(o.Host.persistUtils instanceof s.HostPersistUtilsImpl)for(var e in this._componentPaths)o.Host.persistUtils.deleteTempFile(this._componentPaths[e]);else o.CoreAssert.warning("persist utils is not of a known type; releasing temp files won't happen");this._componentPaths={}}getDeferredComponents(){let e=[];return this._root.visit(t=>e.push.apply(e,t.childComponents.filter(e=>e instanceof u.DCXDocumentComponentDeferred))),e}get root(){return this._root}getValue(e){return this.dcxBranch.rootNode.getValue(e)}get allComponents(){let e=[];return this._root.visit(t=>{e.push.apply(e,t.childComponents)}),e}appendNode(e,t,n){if(e=e||o.GUIDUtils.makeGUID(),!n||n instanceof a){let o=n||this._root,r=this.dcxBranch.addChild("",e,void 0,o.dcxNode);t&&(r.path=t);let i=new a(r,this,o);return o.childNodes.push(i),i}return m.error("appendNode: foreign node"),null}removeNode(e){if(e instanceof a)if(e.branch!==this)m.error("trying to remove a node from a branch it doesn't belong to");else if(e.parent){let t=e.parent.childNodes.indexOf(e);t<0?m.error("trying to remove a node from a parent it doesn't belong to"):(e.visit(e=>e.childComponents.forEach(e=>{e instanceof r.a&&this.retireComponent(e.dcxComponent)})),e.parent.childNodes.splice(t,1),this.dcxBranch.removeChild(e.dcxNode))}else m.error("can't remove the root node");else m.error("trying to remove a node that isn't really a node")}getChildrenOfNode(e){return o.CoreAssert.isTrue(!e||e instanceof a),e instanceof a?e.childNodes.concat():this._root.childNodes.concat()}getComponentsOfNode(e){return o.CoreAssert.isTrue(!e||e instanceof a),e instanceof a?e.childComponents.concat():this._root.childComponents.concat()}getComponentWithId(e){return this._root.findComponent(t=>t.componentId===e)}getPathForComponent(e){if(e instanceof c.a){const t=this._componentPaths[e.absolutePath];if(t)return t;if(this._componentURLfn){const t=this._componentURLfn(e);if(null!==t)return t}return o.CoreAssert.isTrue(!!e.componentId&&!!e.type),l.default.encodeComponentUrl(this.root.nodeId,e.componentId,e.type)}return m.error("passed in component isn't our type of component"),null}getComponentWithAbsolutePath(e){return this._root.findComponent(t=>t.absolutePath===e)}getNodeWithAbsolutePath(e){return this._root.findNode(t=>t.absolutePath===e)}addComponent(e,t,n,i,c,s,l,d,p){let h=s instanceof a?s.dcxNode:this.dcxBranch.rootNode,g=s&&s instanceof a?s:this._root;if(this._retiredElement){let e=this._retiredElement.getComponentsOf(this._retiredElement.rootNode).find(e=>e.id===t);if(e){m.info("copying component ".concat(e.id," from retirement zone")),this.dcxBranch.copyComponent(e,h);let t=new r.a(this,g,e);return g.childComponents.push(t),t}}if(l&&o.Host.persistUtils&&o.Host.persistUtils.fileExists(l)){m.info("creating deferred content component for ID ".concat(t," from source ").concat(l));const r={name:e,componentId:t||"",type:n,relationship:i,path:c,sourceFile:l,copy:d,sourceHref:p,node:g,content:o.Host.persistUtils.readJsonContentFromFile(l)};let a=new u.DCXDocumentComponentDeferred(this,g,r);return g.childComponents.push(a),a}return m.error("addComponent: on web we can't add arbitrary components.."),null}moveComponent(e,t){return e instanceof c.a?(m.info("moveComponent ".concat(e.componentId," to node ").concat(t instanceof a?t.absolutePath:"root")),e.reparent(t||this._root),e):(m.error("updateComponent: requires a DCXDocumentComponent"),null)}retireComponent(e){"rendition"!==e.relationship&&"dom"!==e.relationship?this._retiredElement.allComponents().find(t=>t.id===e.id)?m.info("not retiring component ".concat(e.id," (already have a copy of it in retirement zone)")):(m.info("retiring ".concat(e.id)),this._retiredElement.copyComponent(e)):m.info("not retiring ".concat(e.id," because it's a rendition or dom component"))}updateComponent(e,t,n){if(!(e instanceof c.a))return m.error("updateComponent: requires a DCXDocumentComponent"),null;const r=this.getComponentWithId(e.componentId);if(!r)return m.error("updateComponent: passed component's ID isn't in the branch; can only update existing components"),null;let i=e;if(t){if(!o.Host.persistUtils||!o.Host.persistUtils.fileExists(t))return m.error("updateComponent: sourceFile can't be used because it's not a faux-temp-file"),null;m.info("updating component ".concat(e.componentId," with new source file ").concat(t)),i=new u.DCXDocumentComponentDeferred(this,i.node,{name:i.name,componentId:i.componentId||"",type:i.type||"",relationship:i.relationship,path:i.path||"",sourceHref:i.sourceHref,node:i.node,sourceFile:t,copy:n,content:o.Host.persistUtils.readJsonContentFromFile(t)})}else r!==i?m.info("updating component ".concat(e.componentId," with new metadata only")):m.warn("updating component ".concat(e.componentId," but nothing has changed!"));return r!==i&&r.update(i),i}}},uiRp:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return i}));var o=n("UzQk");const r={contentType:"image/png",resourceID:"watermark-spark.png",width:380,height:80};class i{static addWatermark(e){const t=new o.PGMImage("watermark",o.PGMNodeMetadata.EMPTY,o.PGMAnimationList.EMPTY,o.TheoRect.fromXYWH(0,0,r.width,r.height),"watermark-spark.png"),n=new o.PGMReference(t,new o.PGMCompositingParams(o.Matrix2D.translationXY(e.bounds.width-r.width,e.bounds.height-r.height).scaleXYfromPoint(e.bounds.evalXY(1,1),.5,.5)));let i;if(e.root instanceof o.PGMSimpleGroup){const t=e.root;i=t.withEntityAndChildren(t.entity,t.children.concat(n))}else i=new o.PGMSimpleGroup("add-watermark-group",o.PGMNodeMetadata.EMPTY,o.PGMAnimationList.EMPTY,[new o.PGMReference(e.root),n]);return new o.PGMGraph(i,e.bounds,e.duration,e.resources.adding(t.contentID,new o.PGMResourceProvider(r.contentType,new o.StorageSpecApplicationResource(r.resourceID))))}}},yBTN:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return c}));var o=n("a8ov"),r=n("UzQk"),i=n("MGCh");const a=n.n(i).a.channel("WebAssetLoader");class c{constructor(e){var t,n,o;o=void 0,(n="coreWrapper")in(t=this)?Object.defineProperty(t,n,{value:o,enumerable:!0,configurable:!0,writable:!0}):t[n]=o,this.coreWrapper=e}getURLforContentID(e,t){const n=e.resources.byContentID(t);let i="";if(n)if(n.storage instanceof r.StorageSpecLocalComposite)i=o.default.getImageUrl(this.coreWrapper.documentId(),n.storage.componentID,n.storage.contentType);else if(n.storage instanceof r.StorageSpecApplicationResource)i=r.Host.resourceUtils.urlForResource("images",n.storage.resourceID)||"";else if(n.storage instanceof r.StorageSpecContentLiteral){let e=n.storage.content;e instanceof r.CoreContentBase64?i=e.contentType?"data:".concat(e.contentType,";base64,").concat(e.data):"data:base64,".concat(e.data):a.error("unimplemented content literal storage type")}else if(n.storage instanceof r.StorageSpecExternalCC){const e=n.storage;i=o.default.getAuthoringContextUrl(e.documentID,e.componentID,e.etag,e.contentType||n.contentType)}else if(n.storage instanceof r.StorageSpecCommunityPlatform){const e=n.storage;i=o.default.getCPUrl(e.assetID,e.absPath.forceRelative.asString)}else n.storage instanceof r.StorageSpecHTTP?i=n.storage.url:n.storage instanceof r.StorageSpecLocalFile?a.error("unexpected local file storage spec"):a.error("unimplemented storage type ".concat(n.storage.kind));else a.error("resource provider for content ID ".concat(t," not found"));return i||o.default.decodeUrl(t)||""}}}}]);
//# sourceMappingURL=post-render-action-view_post-render-doc-view_theo-publish-impl_theo-web-controller_theo-web-headless_6bc92e0e-db6ac5a6.js.map
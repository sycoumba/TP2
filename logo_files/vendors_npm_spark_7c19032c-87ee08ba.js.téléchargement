(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[22],{"/9Bx":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("gXiO"),s=n("2bF5");i.MoaColorMap=(o=function(){a.CoreObject.call(this)},r.defineClass({name:"MoaColorMap",ctor:o,superName:"CoreObject",statics:{createIdentityColorMap:function(){for(var t=[],e=r.iter(r.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!e.done;e.next()){var n=e.value;t.push(r.toDouble(n))}return t},createBrightnessColorMap:function(t){var e=Math.max(-100,Math.min(100,t))/100*85,n=[42.5+.6*e,127.5+e,212.5+.5*e];return o.createColorMapFromListOfYValues(0,255,r.clone(n),3)},createContrastColorMap:function(t){var e=Math.max(-100,Math.min(100,t)),n=63.75*(t<0?e/200:e/100),i=[63.75-n,191.25+n];return o.createColorMapFromListOfYValues(0,255,r.clone(i),2)},createExposureColorMap:function(t){var e=Math.max(-100,Math.min(100,t));return e=e<0?-t*t/100:t*t/100,o.createColorMapFromListOfYValues(t,255+t,[],0)},createShadowsColorMap:function(t){if(0!=t){var e=Math.max(-100,Math.min(100,t))/100;e<0&&(e*=1.25);var n=25.5*e,i=[25.5+n,76.5+.75*n,127.5,178.5,229.5];return o.createColorMapFromListOfYValues(n,255,r.clone(i),5)}return o.createIdentityColorMap()},createHighlightsColorMap:function(t){if(0!=t){var e=Math.max(-100,Math.min(100,t))/100;e>0&&(e*=1.25);var n=25.5*e,i=[25.5,76.5,127.5,178.5+n,229.5+n];return o.createColorMapFromListOfYValues(0,255+.75*n,r.clone(i),5)}return o.createIdentityColorMap()},createFadeColorMap:function(t){var e,n=Math.max(-100,Math.min(100,t))/100,i=[63.75,191.25];return o.createColorMapFromListOfYValues(e=n<0?128*n:72*n,255-.5*e,r.clone(i),2)},createWarmthColorMaps:function(t){var e,n,i,a=r.repeat(r.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),3),u=Math.max(-100,Math.min(100,t))/100;if(u<-.6)e=-15*(1-(l=-(u+.6)/.4))+-90*l,n=5*(1-l)+-10*l,i=60*(1-l)+100*l;else if(u<0)e=-15*(l=-u/.6),n=5*l,i=60*l;else if(u>.6)e=30*(1-(l=(u-.6)/.4))+65*l,n=10*(1-l)+-5*l,i=-30*(1-l)+-127.5*l;else{var l;e=30*(l=u/.6),n=10*l,i=-30*l}var c=[127.5+e],h=[127.5+n],f=[127.5+i],_=.35*e,d=.35*n,p=.35*i,m=e<0?255+e:255+.5*e,g=n<0?255+n:255+.5*n,R=i<0?255+i:255+.5*i;return a[0]=r.clone(o.createColorMapFromListOfYValues(_,m,r.clone(c),1)),a[1]=r.clone(o.createColorMapFromListOfYValues(d,g,r.clone(h),1)),a[2]=r.clone(o.createColorMapFromListOfYValues(p,R,r.clone(f),1)),a},createTintColorMaps:function(t){var e,n,i,a=r.repeat(r.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),3),u=Math.max(-100,Math.min(100,t))/100;if(u<-.6)e=-10*(1-(l=-(u+.6)/.4))+-90*l,n=45*(1-l)+40*l,i=-20*(1-l)+-70*l;else if(u<0)e=-10*(l=-u/.6),n=45*l,i=-20*l;else if(u>.6)e=15*(1-(l=(u-.6)/.4))+45*l,n=-15*(1-l)+-75*l,i=25*(1-l)+45*l;else{var l;e=15*(l=u/.6),n=-15*l,i=25*l}var c=[127.5+e],h=[127.5+n],f=[127.5+i],_=.35*e,d=.35*n,p=.35*i,m=e<0?255+e:255+.5*e,g=n<0?255+n:255+.5*n,R=i<0?255+i:255+.5*i;return a[0]=r.clone(o.createColorMapFromListOfYValues(_,m,r.clone(c),1)),a[1]=r.clone(o.createColorMapFromListOfYValues(d,g,r.clone(h),1)),a[2]=r.clone(o.createColorMapFromListOfYValues(p,R,r.clone(f),1)),a},createColorMapFromListOfYValues:function(t,e,n,i){if(i<1)return o.createColorMapForTwoYVals(t,e);var a=r.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),u=(r.toDouble(s.MoaConstants.kMoaColorMapSizeRGB)-1)/r.toDouble(i),l=0;if(1==i){for(var c=t,h=n[0],f=e,_=r.iter(r.range(0,s.MoaConstants.kMoaColorMapSizeRGB-1,!1));!_.done;_.next()){var d=_.value,p=(C=1-(R=r.toDouble(d)/(r.toDouble(s.MoaConstants.kMoaColorMapSizeRGB)-1)))*C*c+2*C*R*h+R*R*f;a[d]=o.MoaColorClamp(p)}return a[0]=o.MoaColorClamp(t),a[s.MoaConstants.kMoaColorMapSizeRGB-1]=o.MoaColorClamp(e),a}var m=0,g=u;for(c=t,h=n[l],f=.5*(n[l]+n[l+1]),d=0;d<=r.toInt(u)&&d<s.MoaConstants.kMoaColorMapSizeRGB;)p=(C=1-(R=r.toDouble(d)/u))*C*c+2*C*R*h+R*R*f,a[d]=o.MoaColorClamp(p),d+=1;for(;l<i-2;)for(l+=1,m=r.toDouble(l)*u,g+=u,c=.5*(n[l-1]+n[l]),h=n[l],f=.5*(n[l]+n[l+1]);d<=r.toInt(g)&&d<s.MoaConstants.kMoaColorMapSizeRGB;)p=(C=1-(R=(r.toDouble(d)-m)/u))*C*c+2*C*R*h+R*R*f,a[d]=o.MoaColorClamp(p),d+=1;for(m=(r.toDouble(l)+1)*u,c=.5*(n[l]+n[l+1]),h=n[l+1],f=e;d<s.MoaConstants.kMoaColorMapSizeRGB-1;){var R,C;p=(C=1-(R=(r.toDouble(d)-m)/u))*C*c+2*C*R*h+R*R*f,a[d]=o.MoaColorClamp(p),d+=1}return a[0]=o.MoaColorClamp(t),a[s.MoaConstants.kMoaColorMapSizeRGB-1]=o.MoaColorClamp(e),a},createColorMapForTwoYVals:function(t,e){for(var n=r.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),o=r.iter(r.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!o.done;o.next()){var i=o.value,a=r.toDouble(i)/r.toDouble(s.MoaConstants.kMoaColorMapSizeRGB),u=1-a;n[i]=a*e+u*t}return n},combineColorMaps:function(t,e){for(var n=r.repeat(0,s.MoaConstants.kMoaColorMapSizeRGB),o=s.MoaConstants.kMoaColorMapSizeRGB-1,i=r.iter(r.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!i.done;i.next()){var a=i.value,u=t[a];if(u<=0)n[a]=e[0];else if(u>=r.toDouble(o))n[a]=e[o];else{var l=r.toInt(u),c=u-r.toDouble(l);n[a]=(1-c)*e[l]+c*e[l+1]}}return n},MoaColorClamp:function(t){return t>255?255:t<0?0:t},roundColorMap:function(t){for(var e=r.iter(r.range(0,s.MoaConstants.kMoaColorMapSizeRGB,!1));!e.done;e.next()){var n=e.value;t[n]=Math.round(t[n])}}}}),o)},"2bF5":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("gXiO");i.MoaConstants=(o=function(){a.CoreObject.call(this)},r.defineClass({name:"MoaConstants",ctor:o,superName:"CoreObject",statics:{kMoaColorMapSizeRGB:256,kSatVibranceSumMax:150}}),o)},"9a+Y":function(t,e,n){var o,i,r=e,a=n("oAGj"),s=n("SpAV"),u=n("HRWw"),l=n("A6KL"),c=n("q5zr"),h=n("Quhx"),f=n("AxS/"),_=n("lJxM"),d=n("9YN4"),p=n("LGJg"),m=n("sW6f");r.ContentDocument=(o=function(){this.factory_={}},i={},a.defineClass({name:"ContentDocument",ctor:o,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ContentDocument",factory:{get:function(){return void 0===i.factory&&(i.factory=function(t,e,n,i){var r=a.as(a.opt(a.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),d.TheoDocument);return s.CoreAssert.isTrue(null!=r,"ContentDocument needs a parent document","ContentDocument","ContentDocument.swift",15),o.init_3144(t,e,n,r)}),i.factory},set:function(t){i.factory=t}},PROPERTY_CHILDREN:"children",DCXTYPE:{get:function(){return"application/vnd.adobe.theo.content+dcx"}},PATH:{get:function(){return"content"}},_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{initFactories:function(){this.factory_[f.RootContentNode.KIND]=function(t,e,n){return f.RootContentNode.init_5972(t,n)},this.factory_[l.GroupContentNode.KIND]=function(t,e,n){return l.GroupContentNode.init_5972(t,n)},this.factory_[c.ImageContentNode.KIND]=function(t,e,n){return c.ImageContentNode.init_5972(t,n)},this.factory_[p.VectorContentNode.KIND]=function(t,e,n){return p.VectorContentNode.init_5972(t,n)},this.factory_[_.TextContentNode.KIND]=function(t,e,n){return _.TextContentNode.init_5972(t,n)},this.factory_[m.VideoContentNode.KIND]=function(t,e,n){return m.VideoContentNode.init_5972(t,n)}},init_3144:function(t,e,n,o){this.parent_=o,a.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_3181,e,n,t),this.initFactories()},init_26a9:function(t,e){this.parent_=t,a.super_init(this,h.PostDCXObject,h.PostDCXObject.prototype.init_11e0,t.database),this.set(h.PostDCXObject.PROPERTY_PATH,o.PATH),this.set(h.PostDCXObject.PROPERTY_TYPE,o.DCXTYPE),this.initFactories(),this.root_=f.RootContentNode.init_5972(this,e)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},root_:{get:function(){var t;return(t=a.as(this.get(o.PROPERTY_CHILDREN),["Array",u.ContentNode]))?a.as(a.first(t),f.RootContentNode):null},set:function(t){if(null!=t){var e=a.clone(a.as(this.get(o.PROPERTY_CHILDREN),["Array",u.ContentNode]));null!=e&&e.length>0?e[0]=t:e=[a.as(t,u.ContentNode)],this.set(o.PROPERTY_CHILDREN,a.clone(e))}}},root:{get:function(){return this.root_}},nodeByID:function(t){return this.root.nodeByID(t)},nodeWithTag:function(t,e){return this.root.nodeWithTag(t,e)},createNode:function(t,e){var n=this.factory_[t];return null==n?(s.CoreAssert.warning("Could not instantiate a contentnode of kind "+t+": no factory"),null):n(this,t,e)},publishForChild:function(t){this.publish(t)},postDecode:function(){this.root.postDecode()}}}),o)},A6KL:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("dNOY"),u=n("HRWw");i.GroupContentNode=(o=function(){},r.defineClass({name:"GroupContentNode",ctor:o,superName:"ContentNode",statics:{KIND:{get:function(){return"group"}},SCHEMA_CLASS_NAME:{get:function(){return"GroupContentNode"}},factory:{get:function(){return function(t,e,n,i){var s=r.as(r.opt(r.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),o);return a.CoreAssert.isTrue(null!=s,"Non-root group content nodes need a parent","GroupContentNode","GroupContentNode.swift",16),o.init_3144(t,e,n,s)}}},PROPERTY_CHILDREN:"children",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){r.super_init(this,u.ContentNode,u.ContentNode.prototype.init_3144,t,e,n,o)},init_5e75:function(t,e,n,o){r.super_init(this,u.ContentNode,u.ContentNode.prototype.init_5e75,t,e,n,o)},init_8b5c:function(t,e,n){r.super_init(this,u.ContentNode,u.ContentNode.prototype.init_8b5c,t,e,n)},init_5972:function(t,e){r.super_init(this,u.ContentNode,u.ContentNode.prototype.init_8b5c,t,"group",e)},init_26a9:function(t,e){r.super_init(this,u.ContentNode,u.ContentNode.prototype.init_c3fa,t,"group",e)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},children_:{get:function(){var t;return(t=r.as(this.get(o.PROPERTY_CHILDREN),["Array",u.ContentNode]))||null!=t?t:[]}},nodeByID:function(t){if(t==this.id)return this;for(var e=r.iter(this.children_);!e.done;e.next()){var n=e.value;if(null!=n.nodeByID(t))return n}return null},nodeWithTag:function(t,e){if(this.getTag(t)==e)return this;for(var n=r.iter(this.children_);!n.done;n.next()){var o=n.value;if(null!=o.nodeWithTag(t,e))return o}return null},insertChildrenAt:function(t,e){for(var n=t,i=r.iter(e);!i.done;i.next())null!=(c=i.value).parent&&(a.CoreAssert.isTrue(c.parent!=this,"attempting to insert a child that is already a child","GroupContentNode.insertChildrenAt","GroupContentNode.swift",81),c.parent.removeChild(c));for(var u=r.clone(this.children_),l=r.iter(e);!l.done;l.next()){var c;(c=l.value).parent=this,u.splice(n,0,c)}this.set(o.PROPERTY_CHILDREN,r.clone(u)),this.publish(new s.InsertedContentChildrenMessage(this,t,r.clone(e)))},removeChildrenAt:function(t,e){if(t<0||e<0||t+e>this.children_.length)a.CoreAssert.fail("removeChildrenAt: invalid index and/or count","GroupContentNode.removeChildrenAt","GroupContentNode.swift",98);else{var n=r.clone(this.children_),i=r.clone(n.splice(t,e));this.set(o.PROPERTY_CHILDREN,r.clone(n));for(var u=r.iter(i);!u.done;u.next())u.value.parent=null;this.publish(new s.RemovedContentChildrenMessage(this,t,r.clone(i)))}},appendChild:function(t){this.insertChildrenAt(this.children_.length,[t])},insertChild:function(t,e){this.insertChildrenAt(t,[e])},removeChild:function(t){var e;a.CoreAssert.isTrue(t.parent==this,void 0,"GroupContentNode.removeChild","GroupContentNode.swift",121),t.parent==this&&null!=(e=r.indexOf(this.children_,t))&&this.removeChildrenAt(e,1)},removeChildAt:function(t){a.CoreAssert.isTrue(t>=0&&t<this.children_.length,void 0,"GroupContentNode.removeChildAt","GroupContentNode.swift",130),this.removeChildrenAt(t,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},childAt:function(t){return a.CoreAssert.isTrue(t>=0&&t<this.children_.length,void 0,"GroupContentNode.childAt","GroupContentNode.swift",139),this.children_[t]},childCount:{get:function(){return this.children_.length}},forEachChild:function(t){for(var e=r.iter(this.children_);!e.done;e.next())t(e.value)},visit:function(t){if(t(this))return this;for(var e=r.iter(this.children_);!e.done;e.next()){var n=e.value;if(t(n))return n}return null},didChangeState:function(t){var e;if(null!=(e=t[o.PROPERTY_CHILDREN])){var n=this.getCodec(o.PROPERTY_CHILDREN);a.CoreAssert.isTrue(null!=n,"State changed before codecs registered.","GroupContentNode.didChangeState","GroupContentNode.swift",170);var i,l,c=r.clone(r.as(n.decode(e[0],this),["Array",u.ContentNode])),h=r.clone(r.as(n.decode(e[1],this),["Array",u.ContentNode]));if((i=c)&&this.publish(new s.RemovedContentChildrenMessage(this,0,r.clone(i))),l=h){for(var f=r.iter(l);!f.done;f.next()){var _=f.value;a.CoreAssert.isTrue(null==_.parent||_.parent===this,"Changing this group's state shouldn't rip a child from its old parent","GroupContentNode.didChangeState","GroupContentNode.swift",182),null==_.parent&&(_.parent=this)}this.publish(new s.InsertedContentChildrenMessage(this,0,r.clone(l)))}}u.ContentNode.prototype.didChangeState.call(this,r.clone(t))}}}),o)},"AxS/":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("9a+Y"),u=n("A6KL");i.RootContentNode=(o=function(){},r.defineClass({name:"RootContentNode",ctor:o,superName:"GroupContentNode",statics:{KIND:{get:function(){return"root"}},SCHEMA_CLASS_NAME:{get:function(){return"RootContentNode"}},factory:{get:function(){return function(t,e,n,i){var u=r.as(r.opt(r.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),s.ContentDocument);return a.CoreAssert.isTrue(null!=u,"Root content node needs a content document parent","RootContentNode","RootContentNode.swift",18),o.init_5e75(t,e,n,u)}}},DOCUMENT_SOURCE_ID_TAG:"document:source:id",DOCUMENT_SOURCE_TYPE_TAG:"document:source:type",THEME_ID_TAG:"theme:id",PALETTE_ID_TAG:"palette:id",SUMMIT_LOGO_TAG:"SummitLogo",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_5e75:function(t,e,n,o){r.super_init(this,u.GroupContentNode,u.GroupContentNode.prototype.init_5e75,t,e,n,o)},init_5972:function(t,e){r.super_init(this,u.GroupContentNode,u.GroupContentNode.prototype.init_8b5c,t,"root",e)},className:{get:function(){return o.SCHEMA_CLASS_NAME}}}}),o)},HRWw:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("dJuF"),s=n("ZhwN"),u=n("Quhx");i.ContentNode=(o=function(){},r.defineClass({name:"ContentNode",ctor:o,superName:"PostDCXObject",statics:{KIND:{get:function(){return""}},SCHEMA_CLASS_NAME:{get:function(){return"GroupContentNode"}},CONTENT_NODE_CHILD_TYPES_NAME:"NonRootContentNodeTypes",PROPERTY_KIND:"kind",PROPERTY_TAGS:"tags",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){var i=n.getProperty(u.PostDCXObject.PROPERTY_PATH).stringValue;this.parent_=o,this.doc_=o.document,r.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_3181,e,n,i)},init_5e75:function(t,e,n,o){var i=n.getProperty(u.PostDCXObject.PROPERTY_PATH).stringValue;this.doc_=o,r.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_3181,e,n,i)},init_8b5c:function(t,e,n){var i;void 0===n&&(n=null);var l=(i=n)||null!=i?i:s.GUIDUtils.makeGUID();this.doc_=t,r.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_5079,t.database,{path:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(u.PostDCXObject.PROPERTY_PATH),l),kind:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(o.PROPERTY_KIND),e)},{},l)},init_c3fa:function(t,e,n){var i;void 0===n&&(n=null);var l=(i=n)||null!=i?i:s.GUIDUtils.makeGUID();this.parent_=t,this.doc_=t.document,r.super_init(this,u.PostDCXObject,u.PostDCXObject.prototype.init_5079,t.database,{path:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(u.PostDCXObject.PROPERTY_PATH),l),kind:a.DBProperty.stringProperty(a.DBNamePath.init_b14a(o.PROPERTY_KIND),e)},{},l)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},document:{get:function(){return this.doc_}},parent:{get:function(){return this.parent_},set:function(t){this.parent_=t}},kind:{get:function(){return this.get(o.PROPERTY_KIND)}},contentID:{get:function(){return this.path}},tags_:{get:function(){var t,e={};if(t=r.opt(this.getProperty(o.PROPERTY_TAGS),(function(t){return t.dictionaryValue})))for(var n=r.iter(t);!n.done;n.next()){var i,a=n.key;null!=(i=n.value.stringValue)&&(e[a]=i)}return e},set:function(t){for(var e={},n=r.iter(t);!n.done;n.next()){var i=n.key,s=n.value;e[i]=a.DBProperty.stringProperty(a.DBNamePath.init_b14a(o.PROPERTY_TAGS).append(i),s)}this.setProperty(o.PROPERTY_TAGS,a.DBProperty.dictProperty(a.DBNamePath.init_b14a(o.PROPERTY_TAGS),r.clone(e)))}},tags:{get:function(){for(var t=[],e=r.iter(this.tags_);!e.done;e.next()){var n=e.key;t.push(n)}return t}},nodeByID:function(t){return t==this.contentID?this:null},nodeWithTag:function(t,e){return this.tags_[t]==e?this:null},clearTags:function(){this.tags_={}},getTag:function(t){return this.tags_[t]},setTag:function(t,e){var n=r.clone(this.tags_);n[t]=e,this.tags_=r.clone(n)},removeFromParent:function(){null!=this.parent_&&this.parent.removeChild(this)},match:function(t){var e=r.clone(t.state.allProperties);e[u.PostDCXObject.PROPERTY_PATH]=this.getProperty(u.PostDCXObject.PROPERTY_PATH),this.matchProperties(r.clone(e))},visit:function(t){return t(this)?this:null},visitAll:function(t){this.visit((function(e){return t(e),!1}))},releaseResources:function(){},publish:function(t){u.PostDCXObject.prototype.publish.call(this,t),r.opt(this.doc_,(function(e){return e.publishForChild(t)}))},postDecode:function(){}}}),o)},LGJg:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("A6KL"),u=n("1NAc"),l=n("qSCS");i.VectorContentNode=(o=function(){},r.defineClass({name:"VectorContentNode",ctor:o,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"vector"}},SCHEMA_CLASS_NAME:{get:function(){return"VectorContentNode"}},factory:{get:function(){return function(t,e,n,i){var u=r.as(r.opt(r.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),s.GroupContentNode);return a.CoreAssert.isTrue(null!=u,"Content nodes need a parent","VectorContentNode","VectorContentNode.swift",16),o.init_3144(t,e,n,u)}}},USAGE_TAG:"usage_reported",PROPERTY_SIZE:"size",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){r.super_init(this,l.URLBasedContentNode,l.URLBasedContentNode.prototype.init_3144,t,e,n,o)},init_26a9:function(t,e){r.super_init(this,l.URLBasedContentNode,l.URLBasedContentNode.prototype.init_c3fa,t,"vector",e),this.set(o.PROPERTY_SIZE,u.TheoSize.Zero)},init_5972:function(t,e){r.super_init(this,l.URLBasedContentNode,l.URLBasedContentNode.prototype.init_8b5c,t,"vector",e),this.set(o.PROPERTY_SIZE,u.TheoSize.Zero)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},size:{get:function(){return this.get(o.PROPERTY_SIZE)},set:function(t){this.set(o.PROPERTY_SIZE,t)}},isUsageReported:function(){var t=this.getTag(o.USAGE_TAG);return null!=t&&"true"==t},setUsageReported:function(t){this.setTag(o.USAGE_TAG,t?"true":"false")},getUsageID:function(){return r.opt(this.mediaMetadata,(function(t){return t.assetID}))}}}),o)},R19c:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("gXiO"),s=n("s/Zj");i.MoaColorMatrix=(o=function(){a.CoreObject.call(this)},r.defineClass({name:"MoaColorMatrix",ctor:o,superName:"CoreObject",statics:{applyVibranceToColorMatrix:function(t,e){var n=Math.max(-100,Math.min(100,e)),i=n/100;o.MoaColorMatrixAdjustVibrance(t,i=n<0?1-i*i:1+1.8*i*i)},MoaColorMatrixAdjustVibrance:function(t,e){var n=1+.7*(e-1),i=e,a=45*Math.PI/180,u=35.26*Math.PI/180,l=s.MoaTransform.init_d41d();l.preRotateX(a),l.preRotateY(-u),l.preScaleXY(n,i),l.preRotateY(u),l.preRotateX(-a);for(var c=r.repeat(0,12),h=r.iter(r.range(0,11,!0));!h.done;h.next()){var f=h.value;c[f]=l.transformMatrix[f]}o.MoaColorMatrixMultiply(t,r.clone(c))},applySaturationToColorMatrix:function(t,e){var n=Math.max(-100,Math.min(100,e)),i=n/100;o.MoaColorMatrixAdjSaturation(t,i=n<0?1-i*i:1+1.5*i*i)},MoaColorMatrixAdjSaturation:function(t,e){var n=.213*(1-e),i=.715*(1-e),a=.072*(1-e),s=[n+e,i,a,0,n,i+e,a,0,n,i,a+e,0];o.MoaColorMatrixMultiply(t,r.clone(s))},MoaColorMatrixMultiply:function(t,e){var n=r.repeat(0,12);n[0]=t[0]*e[0]+t[1]*e[4]+t[2]*e[8],n[1]=t[0]*e[1]+t[1]*e[5]+t[2]*e[9],n[2]=t[0]*e[2]+t[1]*e[6]+t[2]*e[10],n[4]=t[4]*e[0]+t[5]*e[4]+t[6]*e[8],n[5]=t[4]*e[1]+t[5]*e[5]+t[6]*e[9],n[6]=t[4]*e[2]+t[5]*e[6]+t[6]*e[10],n[8]=t[8]*e[0]+t[9]*e[4]+t[10]*e[8],n[9]=t[8]*e[1]+t[9]*e[5]+t[10]*e[9],n[10]=t[8]*e[2]+t[9]*e[6]+t[10]*e[10],n[3]=t[0]*e[3]+t[1]*e[7]+t[2]*e[11]+t[3],n[7]=t[4]*e[3]+t[5]*e[7]+t[6]*e[11]+t[7],n[11]=t[8]*e[3]+t[9]*e[7]+t[10]*e[11]+t[11];for(var o=r.iter(r.range(0,11,!0));!o.done;o.next()){var i=o.value;t[i]=n[i]}}}}),o)},TbN7:function(t,e,n){var o,i,r,a=e,s=n("oAGj"),u=n("90dd");a.InsertedSwatchesMessage=(o=function t(e,n,o){this.index=n,this.swatches=s.clone(o),u.TheoMessage.call(this,t.TYPE,e)},s.defineClass({name:"InsertedSwatchesMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"InsertedSwatchesMessage"}}}}),o),a.RemovedSwatchesMessage=(i=function t(e,n,o){this.index=n,this.swatches=s.clone(o),u.TheoMessage.call(this,t.TYPE,e)},s.defineClass({name:"RemovedSwatchesMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"RemovedSwatchesMessage"}}}}),i),a.ReplacedSwatchesMessage=(r=function t(e,n){this.oldSwatches=s.clone(n),u.TheoMessage.call(this,t.TYPE,e)},s.defineClass({name:"ReplacedSwatchesMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ReplacedSwatchesMessage"}}}}),r)},VkKB:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("gXiO");i.PROPERTY_SEARCH="search",i.PROPERTY_LICENSE_TYPE="type",i.PROPERTY_SOURCE_NAME="source_name",i.PROPERTY_SOURCE_URL="source_url",i.PROPERTY_OWNER="owner",i.PROPERTY_ASSETID="asset_id",i.PROPERTY_CREATOR_USERID="creator_user_id",i.PROPERTY_CREATOR_DISPLAYNAME="creator_display_name",i.PROPERTY_DESIGN_INTENT="design_intent",i.PROPERTY_SOURCE="source",i.PROPERTY_TITLE="photo_name",i.PROPERTY_TAGS="tags",i.PROPERTY_LIBRARY_ID="library_id",i.PROPERTY_LIBRARY_NAME="library_name",i.PROPERTY_CREATED_DATE="created_date",i.PROPERTY_MODIFIED_DATE="modified_date",i.MediaMetadata=(o=function(){},r.defineClass({name:"MediaMetadata",ctor:o,superName:"CoreObject",statics:{kMediaStockSourceName:"Adobe Stock",kMediaNounProjectSourceName:"The Noun Project",kMediaUnsplashSourceName:"Unsplash",kMediaPixabaySourceName:"pixabay",kMediaGiphySourceName:"GIPHY",kMediaCCLSourceName:"Creative Cloud Libraries",kMediaStockLicenseTypeNone:"royalty_free",kMediaStockLicenseTypeStandard:"royalty_free_standard",kMediaStockLicenseTypeExtended:"royalty_free_extended",DESIGNINTENT_LOGO:"logo",DESIGNINTENT_PATTERN:"pattern",DESIGNINTENT_ICON:"icon",DESIGNINTENT_STICKER:"sticker",DESIGNINTENT_FLOATING_IMAGE:"floating-image",DESIGNINTENT_VIDEO:"video",fromProperties:function(t){var e=r.as(t[i.PROPERTY_SOURCE],"String");return"market"==e?o.fromMarketProperties(t):"dooplo"==e?o.fromDooploProperties(t):"adobestock"==e?o.fromStockProperties(t):"giphy"==e?o.fromGiphyProperties(t):"ccl"==e?o.fromCCLProperties(t):o.init_36a2(void 0,void 0,void 0,void 0,void 0,void 0,e)},fromDooploProperties:function(t){var e=r.as(t.rootProperties,["Dictionary","String","Any"]),n=r.as(r.opt(e,(function(t){return t.license})),["Dictionary","String","Any"]);return o.init_36a2(r.as(t[i.PROPERTY_SOURCE],"String"),r.as(t[i.PROPERTY_SEARCH],"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_TITLE]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_TAGS]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_LICENSE_TYPE]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_SOURCE_URL]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_SOURCE_NAME]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_OWNER]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_ASSETID]})),"String"))},fromStockProperties:function(t){var e=r.as(t.rootProperties,["Dictionary","String","Any"]),n=r.as(r.opt(e,(function(t){return t.license})),["Dictionary","String","Any"]);return o.init_36a2(r.as(t[i.PROPERTY_SOURCE],"String"),r.as(t[i.PROPERTY_SEARCH],"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_TITLE]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_TAGS]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_LICENSE_TYPE]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_SOURCE_URL]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_SOURCE_NAME]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_OWNER]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_ASSETID]})),"String"))},fromGiphyProperties:function(t){var e=null!=t[i.PROPERTY_LICENSE_TYPE]?r.as(t[i.PROPERTY_LICENSE_TYPE],"String"):"GIPHY Terms and Service";return o.init_36a2(r.as(t[i.PROPERTY_SOURCE],"String"),r.as(t[i.PROPERTY_SEARCH],"String"),r.as(t[i.PROPERTY_TITLE],"String"),r.as(t[i.PROPERTY_TAGS],"String"),e,r.as(t[i.PROPERTY_SOURCE_URL],"String"),r.as(t[i.PROPERTY_SOURCE_NAME],"String"),r.as(t[i.PROPERTY_OWNER],"String"),r.as(t[i.PROPERTY_ASSETID],"String"),null,null,o.DESIGNINTENT_STICKER)},fromMarketProperties:function(t){var e=r.as(t.tags,["Array","Any"]),n=r.opt(e,(function(t){return t.join(",")}));return o.init_36a2(r.as(t[i.PROPERTY_SOURCE],"String"),null,r.as(t.name,"String"),n,null,null,null,null,r.as(t.assetID,"String"),r.as(t.creator_userID,"String"),r.as(t.creator_displayName,"String"),r.as(t.design_intent,"String"))},fromCCLProperties:function(t){var e=r.as(t.rootProperties,["Dictionary","String","Any"]),n=r.as(r.opt(e,(function(t){return t.license})),["Dictionary","String","Any"]),a=r.as(r.opt(e,(function(t){return t.ccl})),["Dictionary","String","Any"]);return o.init_36a2(r.as(t[i.PROPERTY_SOURCE],"String"),r.as(t[i.PROPERTY_SEARCH],"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_TITLE]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_TAGS]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_LICENSE_TYPE]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_SOURCE_URL]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_SOURCE_NAME]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_OWNER]})),"String"),r.as(r.opt(n,(function(t){return t[i.PROPERTY_ASSETID]})),"String"),void 0,void 0,void 0,r.as(r.opt(a,(function(t){return t[i.PROPERTY_LIBRARY_ID]})),"String"),r.as(r.opt(a,(function(t){return t[i.PROPERTY_LIBRARY_NAME]})),"String"),r.as(r.opt(a,(function(t){return t[i.PROPERTY_CREATED_DATE]})),"Int"),r.as(r.opt(a,(function(t){return t[i.PROPERTY_MODIFIED_DATE]})),"Int"))},decodeJson:function(t){var e;return null==t?null:(e=r.as(t,["Dictionary","String","Any"]))?o.init_36a2(r.as(e[i.PROPERTY_SOURCE],"String"),r.as(e[i.PROPERTY_SEARCH],"String"),r.as(e[i.PROPERTY_TITLE],"String"),r.as(e[i.PROPERTY_TAGS],"String"),r.as(e[i.PROPERTY_LICENSE_TYPE],"String"),r.as(e[i.PROPERTY_SOURCE_URL],"String"),r.as(e[i.PROPERTY_SOURCE_NAME],"String"),r.as(e[i.PROPERTY_OWNER],"String"),r.as(e[i.PROPERTY_ASSETID],"String"),r.as(e[i.PROPERTY_CREATOR_USERID],"String"),r.as(e[i.PROPERTY_CREATOR_DISPLAYNAME],"String"),r.as(e[i.PROPERTY_DESIGN_INTENT],"String"),r.as(e[i.PROPERTY_LIBRARY_ID],"String"),r.as(e[i.PROPERTY_LIBRARY_NAME],"String"),r.as(e[i.PROPERTY_CREATED_DATE],"Int"),r.as(e[i.PROPERTY_MODIFIED_DATE],"Int")):(a.CoreAssert.fail("Not a dictionary","MediaMetadata.decodeJson","MediaMetadata.swift",507),null)}},props:{init_36a2:function(t,e,n,o,i,r,a,u,l,c,h,f,_,d,p,m){void 0===t&&(t=null),void 0===e&&(e=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===h&&(h=null),void 0===f&&(f=null),void 0===_&&(_=null),void 0===d&&(d=null),void 0===p&&(p=null),void 0===m&&(m=null),this.searchSource_=t,this.searchTerm_=e,this.title_=n,this.tags_=o,this.licenseType_=i,this.sourceUrl_=r,this.sourceName_=a,this.ownerName_=u,this.assetID_=l,this.creatorUserID_=c,this.creatorDisplayName_=c,this.designIntent_=f,this.libraryID_=_,this.libraryName_=d,this.createdDate_=p,this.modifiedDate_=m,s.CoreObject.call(this)},init_e2fc:function(t,e,n,o,i,r,a,u,l,c,h,f,_,d,p,m,g){var R,C,T,P,E,S,N,M,v,A,O,D,I,y,Y,b;void 0===e&&(e=null),void 0===n&&(n=null),void 0===o&&(o=null),void 0===i&&(i=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===u&&(u=null),void 0===l&&(l=null),void 0===c&&(c=null),void 0===h&&(h=null),void 0===f&&(f=null),void 0===_&&(_=null),void 0===d&&(d=null),void 0===p&&(p=null),void 0===m&&(m=null),void 0===g&&(g=null),this.searchSource_=(R=e)||null!=R?R:t.searchSource_,this.searchTerm_=(C=n)||null!=C?C:t.searchTerm_,this.title_=(T=o)||null!=T?T:t.title_,this.tags_=(P=i)||null!=P?P:t.tags_,this.licenseType_=(E=r)||null!=E?E:t.licenseType_,this.sourceUrl_=(S=a)||null!=S?S:t.sourceUrl_,this.sourceName_=(N=u)||null!=N?N:t.sourceName_,this.ownerName_=(M=l)||null!=M?M:t.ownerName_,this.assetID_=(v=c)||null!=v?v:t.assetID_,this.creatorUserID_=(A=h)||null!=A?A:t.creatorUserID_,this.creatorDisplayName_=(O=h)||null!=O?O:t.creatorDisplayName_,this.designIntent_=(D=_)||null!=D?D:t.designIntent_,this.libraryID_=(I=d)||null!=I?I:t.libraryID_,this.libraryName_=(y=p)||null!=y?y:t.libraryName_,this.createdDate_=(Y=m)||null!=Y?Y:t.createdDate_,this.modifiedDate_=(b=g)||null!=b?b:t.modifiedDate_,s.CoreObject.call(this)},getDebugDesc:function(){var t,e,n,o,i,r,a,s,u,l,c,h,f,_,d,p,m;return"sourceName_: "+((t=this.sourceName_)||null!=t?t:"")+" searchSource_: "+((e=this.searchSource_)||null!=e?e:"")+" searchTerm_: "+((n=this.searchTerm_)||null!=n?n:"")+" designIntent_: "+((o=this.designIntent_)||null!=o?o:"")+" licenseType_: "+((i=this.licenseType_)||null!=i?i:"")+" assetID_: "+((r=this.assetID_)||null!=r?r:"")+" sourceUrl_: "+((a=this.sourceUrl_)||null!=a?a:"")+" sourceName_: "+((s=this.sourceName_)||null!=s?s:"")+" ownerName_: "+((u=this.ownerName_)||null!=u?u:"")+" assetID_: "+((l=this.assetID_)||null!=l?l:"")+" creatorUserID_: "+((c=this.creatorUserID_)||null!=c?c:"")+" creatorDisplayName_: "+((h=this.creatorDisplayName_)||null!=h?h:"")+" designIntent_: "+((f=this.designIntent_)||null!=f?f:"")+" libraryID_: "+((_=this.libraryID_)||null!=_?_:"")+" libraryName_: "+((d=this.libraryName_)||null!=d?d:"")+" createdDate_: "+((p=this.createdDate_)||null!=p?p:0)+" modifiedDate_: "+((m=this.modifiedDate_)||null!=m?m:0)},isEqualTo:function(t){var e;return!(!(e=r.as(t,o))||this.searchSource!=e.searchSource||this.searchTerm!=e.searchTerm||this.title!=e.title||this.tags!=e.tags||this.licenseType!=e.licenseType||this.sourceURL!=e.sourceURL||this.sourceName!=e.sourceName||this.ownerName!=e.ownerName||this.assetID!=e.assetID||this.creatorUserID!=e.creatorUserID||this.creatorDisplayName!=e.creatorUserID||this.designIntent!=e.designIntent||this.libraryID_!=e.libraryID_||this.libraryName_!=e.libraryName_||this.createdDate_!=e.createdDate_||this.modifiedDate_!=e.modifiedDate_)},copyWithIntent:function(t){return o.init_e2fc(this,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,void 0,t)},copyWithSource:function(t){return o.init_e2fc(this,void 0,void 0,void 0,void 0,void 0,void 0,t)},searchSource:{get:function(){return this.searchSource_}},searchTerm:{get:function(){return this.searchTerm_}},title:{get:function(){return this.title_}},tags:{get:function(){return this.tags_}},licenseType:{get:function(){return this.licenseType_}},sourceName:{get:function(){return this.sourceName_}},sourceURL:{get:function(){return this.sourceUrl_}},ownerName:{get:function(){return this.ownerName_}},assetID:{get:function(){return this.assetID_}},creatorUserID:{get:function(){return this.creatorUserID_}},creatorDisplayName:{get:function(){return this.creatorDisplayName_}},designIntent:{get:function(){return this.designIntent_}},libraryID:{get:function(){return this.libraryID_}},libraryName:{get:function(){return this.libraryName_}},createdDate:{get:function(){return this.createdDate_}},modifiedDate:{get:function(){return this.modifiedDate_}},encodeJson:function(){var t={};return null!=this.searchSource_&&(t[i.PROPERTY_SOURCE]=this.searchSource_),null!=this.searchTerm_&&(t[i.PROPERTY_SEARCH]=this.searchTerm_),null!=this.title_&&(t[i.PROPERTY_TITLE]=this.title_),null!=this.tags&&(t[i.PROPERTY_TAGS]=this.tags_),null!=this.licenseType_&&(t[i.PROPERTY_LICENSE_TYPE]=this.licenseType_),null!=this.sourceName_&&(t[i.PROPERTY_SOURCE_NAME]=this.sourceName_),null!=this.sourceUrl_&&(t[i.PROPERTY_SOURCE_URL]=this.sourceUrl_),null!=this.ownerName_&&(t[i.PROPERTY_OWNER]=this.ownerName_),null!=this.assetID_&&(t[i.PROPERTY_ASSETID]=this.assetID_),null!=this.creatorUserID_&&(t[i.PROPERTY_CREATOR_USERID]=this.creatorUserID_),null!=this.creatorDisplayName_&&(t[i.PROPERTY_CREATOR_DISPLAYNAME]=this.creatorDisplayName_),null!=this.designIntent_&&(t[i.PROPERTY_DESIGN_INTENT]=this.designIntent_),null!=this.libraryID_&&(t[i.PROPERTY_LIBRARY_ID]=this.libraryID_),null!=this.libraryName_&&(t[i.PROPERTY_LIBRARY_NAME]=this.libraryName_),null!=this.createdDate_&&(t[i.PROPERTY_CREATED_DATE]=this.createdDate_),null!=this.modifiedDate_&&(t[i.PROPERTY_MODIFIED_DATE]=this.modifiedDate_),t},sourceHasLicense:function(){return this.sourceName==o.kMediaStockSourceName||this.sourceName==o.kMediaPixabaySourceName||this.sourceName==o.kMediaUnsplashSourceName||this.sourceName==o.kMediaNounProjectSourceName||this.sourceName==o.kMediaGiphySourceName}}}),o)},Vvcj:function(t,e,n){var o,i,r=e,a=n("oAGj"),s=n("SpAV"),u=n("TbN7"),l=n("kVgh"),c=n("Quhx"),h=n("aN2p"),f=n("9YN4");r.ColorThemeDocument=(o=function(){this.swatchFactory_={}},i={},a.defineClass({name:"ColorThemeDocument",ctor:o,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ColorThemeDocument",factory:{get:function(){return void 0===i.factory&&(i.factory=function(t,e,n,i){var r=a.as(a.opt(a.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),f.TheoDocument);return s.CoreAssert.isTrue(null!=r,"ColorThemeDocument needs a parent document","ColorThemeDocument","ColorThemeDocument.swift",15),o.init_7e49(t,n,r)}),i.factory},set:function(t){i.factory=t}},PROPERTY_CHILDREN:"children",DCXTYPE:{get:function(){return"application/vnd.adobe.theo.color+dcx"}},PATH:{get:function(){return"colortheme"}},_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{swatches_:{get:function(){var t;return(t=a.as(this.get(o.PROPERTY_CHILDREN),["Array",l.ColorSwatch]))||null!=t?t:[]},set:function(t){this.set(o.PROPERTY_CHILDREN,a.clone(t))}},init_7e49:function(t,e,n){this.parent_=n,this.swatchFactory_[h.SimpleSwatch.KIND]=function(t,e){return h.SimpleSwatch.init_d0e4(t)},a.super_init(this,c.PostDCXObject,c.PostDCXObject.prototype.init_3181,n.database,e,t)},init_d0e4:function(t){this.parent_=t,this.swatchFactory_[h.SimpleSwatch.KIND]=function(t,e){return h.SimpleSwatch.init_d0e4(t)},a.super_init(this,c.PostDCXObject,c.PostDCXObject.prototype.init_11e0,t.database),this.set(c.PostDCXObject.PROPERTY_PATH,o.PATH),this.set(c.PostDCXObject.PROPERTY_TYPE,o.DCXTYPE)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},swatchByID:function(t){for(var e=a.iter(this.swatches_);!e.done;e.next()){var n=e.value;if(n.id==t)return n}return null},swatchByTag:function(t,e){for(var n=a.iter(this.swatches_);!n.done;n.next()){var o=n.value;if(o.tag(t)==e)return o}return null},swatchesByTag:function(t){for(var e=[],n=a.iter(this.swatches_);!n.done;n.next()){var o=n.value;null!=o.tag(t)&&e.push(o)}return e},createSwatch:function(t){var e=this.swatchFactory_[t];return null==e?(s.CoreAssert.fail("ColorThemeDocument: Did not find a constructor for "+t,"ColorThemeDocument.createSwatch","ColorThemeDocument.swift",84),null):e(this,t)},insertSwatchesAt:function(t,e){if(t<0||t>this.swatches_.length)return s.CoreAssert.fail("insertSwatchesAt: "+t+" is out of range 0, "+this.swatches_.length,"ColorThemeDocument.insertSwatchesAt","ColorThemeDocument.swift",92),null;for(var n=t,o=a.clone(this.swatches_),i=a.iter(e);!i.done;i.next()){var r=i.value;if(r.parent!=this)return s.CoreAssert.fail("inserting swatch from different color theme document","ColorThemeDocument.insertSwatchesAt","ColorThemeDocument.swift",100),null;o.splice(n,0,r),n+=1}return this.swatches_=a.clone(o),this.publish(new u.InsertedSwatchesMessage(this,t,a.clone(e))),e},removeSwatchesAt:function(t,e){if(t<0||t+e>this.swatches_.length)return s.CoreAssert.fail("removeSwatchesAt: "+t+","+e+" is out of range 0, "+this.swatches_.length,"ColorThemeDocument.removeSwatchesAt","ColorThemeDocument.swift",116),null;var n=a.clone(this.swatches_),o=a.clone(n.splice(t,e));return this.swatches_=a.clone(n),this.publish(new u.RemovedSwatchesMessage(this,t,a.clone(o))),o},appendSwatch:function(t){return a.opt(this.insertSwatchesAt(this.swatches_.length,[t]),(function(t){return t[0]}))},insertSwatch:function(t,e){return a.opt(this.insertSwatchesAt(t,[e]),(function(t){return t[0]}))},removeSwatch:function(t){var e;return null!=(e=a.indexOf(this.swatches_,t))?a.opt(this.removeSwatchesAt(e,1),(function(t){return t[0]})):null},removeSwatchAt:function(t){return a.opt(this.removeSwatchesAt(t,1),(function(t){return t[0]}))},removeAllSwatches:function(){return this.removeSwatchesAt(0,this.swatches_.length)},replaceAllSwatches:function(t){if(this.swatches_==t)return this.swatches_;var e=a.clone(this.swatches_);return this.swatches_=a.clone(t),this.publish(new u.ReplacedSwatchesMessage(this,a.clone(t))),e},replaceWithDocument:function(t){for(var e=[],n=a.iter(t.copySwatches());!n.done;n.next()){var o=n.value;this.createSwatch(o.kind).match(o),e.push(o)}this.replaceAllSwatches(a.clone(e))},copySwatches:function(){return this.swatches_.concat()},swatchAt:function(t){return t<0||t>=this.swatches_.length?null:this.swatches_[t]},swatchCount:{get:function(){return this.swatches_.length}},addColorWithTag:function(t,e,n){var o=this.createSwatch(h.SimpleSwatch.KIND);return o.setTag(e,n),o.color=t,this.appendSwatch(o)},publishForChild:function(t){this.publish(t)}}}),o)},aN2p:function(t,e,n){var o,i,r=e,a=n("oAGj"),s=n("SpAV"),u=n("kVgh"),l=n("Vvcj"),c=n("Zifs");r.SimpleSwatch=(o=function(){},i={},a.defineClass({name:"SimpleSwatch",ctor:o,superName:"ColorSwatch",statics:{SCHEMA_CLASS_NAME:"SimpleSwatch",factory:{get:function(){return void 0===i.factory&&(i.factory=function(t,e,n,i){var r=a.as(a.opt(a.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),l.ColorThemeDocument);return s.CoreAssert.isTrue(null!=r,"SimpleSwatch needs a parent ColorThemeDocument","SimpleSwatch","SimpleSwatch.swift",15),o.init_7e49(t,n,r)}),i.factory},set:function(t){i.factory=t}},KIND:"simple",PROPERTY_COLOR:"color",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{className:{get:function(){return o.SCHEMA_CLASS_NAME}},color:{get:function(){return a.as(this.get(o.PROPERTY_COLOR),c.SolidColor)},set:function(t){this.set(o.PROPERTY_COLOR,t)}},match:function(t){var e=a.as(t,o);null!=e&&(this.color=e.color),u.ColorSwatch.prototype.match.call(this,t)},solidRepresentation:{get:function(){return this.color}},kind:{get:function(){return o.KIND}},init_7e49:function(t,e,n){a.super_init(this,u.ColorSwatch,u.ColorSwatch.prototype.init_7e49,t,e,n)},init_d0e4:function(t){a.super_init(this,u.ColorSwatch,u.ColorSwatch.prototype.init_d0e4,t)}}}),o)},az6C:function(t,e,n){var o,i,r=e,a=n("oAGj"),s=n("gXiO");r.GaussianKernel=(o=function(){this.glKernel=[],this.windowWidth=0},a.defineClass({name:"GaussianKernel",ctor:o,superName:"CoreObject",props:{set:function(t,e){this.glKernel=a.clone(t),this.windowWidth=e}}}),o),r.Sharpen=(i=function(){s.CoreObject.call(this)},a.defineClass({name:"Sharpen",ctor:i,superName:"CoreObject",statics:{computeGaussianKernels:function(t,e,n){var o=new r.GaussianKernel,s=4*t/100*a.toDouble(e+n)/400,u=a.toInt(Math.floor(1.5*s)+1),l=0;u>4&&(l=a.toInt(Math.floor((a.toDouble(u)/a.toDouble(4)-1)/2)+1),u=a.toInt(Math.floor(a.toDouble(u)/a.toDouble(2*l+1))+1));for(var c=2*l+1,h=2*u+1,f=[],_=0,d=a.iter(a.range(0,h,!1));!d.done;d.next()){var p=d.value;_+=a.toDouble(c)*(i.MoaMathNormalCDF(a.toDouble(p)+.5-a.toDouble(u),s/a.toDouble(c))-i.MoaMathNormalCDF(a.toDouble(p)-.5-a.toDouble(u),s/a.toDouble(c)))}for(var m=0,g=a.iter(a.range(0,h,!1));!g.done;g.next())p=g.value,f.push(1/_*a.toDouble(4096)*(i.MoaMathNormalCDF(a.toDouble(p)+.5-a.toDouble(u),s/a.toDouble(c))-i.MoaMathNormalCDF(a.toDouble(p)-.5-a.toDouble(u),s/a.toDouble(c)))),m+=f[p];for(var R=4-a.toInt((h-1)/2),C=4+a.toInt((h-1)/2),T=[],P=a.iter(a.range(0,8,!0));!P.done;P.next())(p=P.value)<R||p>C?T.push(0):T.push(a.toDouble(f[p-R])/m);return o.set(a.clone(T),c),o},get357FactorsOfClosestFactorableNumber:function(t){for(var e=!1,n=0,o=t,i=[0,0,0];!e;)if(o=t+n,(n*=-1)<=0&&(n-=1),!(o<3)){e=!0;var r=o,a=[3,5,7];i[0]=0,i[1]=0,i[2]=0;for(var s=0;r>1;)if(r%a[s]==0?(i[s]=i[s]+1,r/=a[s]):s+=1,s>=3){e=!1;break}}return i},MoaMathNormalCDF:function(t,e){return(1+i.MoaMathErf(t/1.4142135623730951/e))/2},MoaMathErf:function(t){return t>=0?1-i.MoaMathErfccheb(t):i.MoaMathErfccheb(-t)-1},MoaMathErfccheb:function(t){var e,n=[-1.3026537197817094,.6419697923564902,.019476473204185836,-.00956151478680863,-.000946595344482036,.000366839497852761,42523324806907e-18,-20278578112534e-18,-1624290004647e-18,130365583558e-17,1.5626441722e-8,-8.5238095915e-8,6.529054439e-9,5.059343495e-9,-9.91364156e-10,-2.27365122e-10,96467911e-18,2394038e-18,-6886027e-18,894487e-18,313092e-18,-112708e-18,381e-18,7106e-18,-1523e-18,-94e-18,121e-18,-28e-18];if(t<0)return 0;for(var o=0,i=0,r=2/(2+t),s=4*r-2,u=a.iter(a.range(1,27,!0).reversed());!u.done;u.next())e=o,o=s*o-i+n[u.value],i=e;return r*Math.exp(-t*t+.5*(n[0]+s*o)-i)}}}),i)},dNOY:function(t,e,n){var o,i,r=e,a=n("oAGj"),s=n("90dd");r.InsertedContentChildrenMessage=(o=function t(e,n,o){this.index=n,this.children=a.clone(o),s.TheoMessage.call(this,t.TYPE,e)},a.defineClass({name:"InsertedContentChildrenMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"InsertedContentChildrenMessage"}}}}),o),r.RemovedContentChildrenMessage=(i=function t(e,n,o){this.index=n,this.removed=a.clone(o),s.TheoMessage.call(this,t.TYPE,e)},a.defineClass({name:"RemovedContentChildrenMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"RemovedContentChildrenMessage"}}}}),i)},kVgh:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("dJuF"),u=n("ZhwN"),l=n("Quhx");i.ColorSwatch=(o=function(){},r.defineClass({name:"ColorSwatch",ctor:o,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"ColorSwatch",PROPERTY_NUM_TAGS:"numTags",PROPERTY_TAG_KEY_PREFIX:"key-",PROPERTY_TAG_VALUE_PREFIX:"value-",PROPERTY_TAGS:"tags",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_7e49:function(t,e,n){this.parent_=n,r.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_3181,n.database,e,t)},init_d0e4:function(t){for(var e=t.database,n={path:function(){return u.GUIDUtils.makeGUID()}},o={},i=r.iter(n);!i.done;i.next()){var a=i.key,s=i.value;o[a]=s()}this.parent_=t,r.super_init(this,l.PostDCXObject,l.PostDCXObject.prototype.init_5079,e,{},r.clone(o),"")},className:{get:function(){return o.SCHEMA_CLASS_NAME}},parent:{get:function(){return this.parent_}},numTags:{get:function(){var t;return(t=r.as(this.get(o.PROPERTY_NUM_TAGS),"Int"))||null!=t?t:0},set:function(t){this.set(o.PROPERTY_NUM_TAGS,t)}},rawTags_:{get:function(){for(var t,e,n={},i=r.iter(r.range(0,this.numTags,!1));!i.done;i.next()){var a=i.value,s=(t=r.opt(this.getProperty(o.PROPERTY_TAG_KEY_PREFIX+r.toString(a)),(function(t){return t.stringValue})))||null!=t?t:"",u=(e=r.opt(this.getProperty(o.PROPERTY_TAG_VALUE_PREFIX+r.toString(a)),(function(t){return t.stringValue})))||null!=e?e:"";n[s]=u}return n},set:function(t){for(var e=0,n=this.numTags,i=r.iter(t);!i.done;i.next()){var a=i.key,u=i.value,l=o.PROPERTY_TAG_KEY_PREFIX+r.toString(e),c=o.PROPERTY_TAG_VALUE_PREFIX+r.toString(e);this.setProperty(l,s.DBProperty.stringProperty(s.DBNamePath.init_b14a(l),a)),this.setProperty(c,s.DBProperty.stringProperty(s.DBNamePath.init_b14a(c),u)),e+=1}if(this.numTags=e,e<n)for(var h=r.iter(r.range(e,n,!1));!h.done;h.next()){var f=h.value;this.removeProperty(o.PROPERTY_TAG_KEY_PREFIX+r.toString(f)),this.removeProperty(o.PROPERTY_TAG_VALUE_PREFIX+r.toString(f))}}},tags:{get:function(){return r.keys(this.rawTags_)}},tag:function(t){return this.rawTags_[t]},contains:function(t){return null!=this.rawTags_[t]},clearTags:function(){this.rawTags_={}},match:function(t){this.clearTags();for(var e=r.iter(t.tags);!e.done;e.next()){var n=e.value;this.setTag(n,t.tag(n))}},setTag:function(t,e){var n=r.clone(this.rawTags_);null==e?r.removeKey(n,t):n[t]=e,this.rawTags_=r.clone(n)},publish:function(t){r.opt(this.parent_,(function(e){return e.publishForChild(t)}))},solidRepresentation:{get:function(){return a.CoreAssert.fail("stub","ColorSwatch","ColorSwatch.swift",107),null}},kind:{get:function(){return a.CoreAssert.fail("stub","ColorSwatch","ColorSwatch.swift",112),""}}}}),o)},lJxM:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("HRWw"),u=n("A6KL"),l=n("x4Gy");i.TextContentNode=(o=function(){},r.defineClass({name:"TextContentNode",ctor:o,superName:"ContentNode",statics:{KIND:{get:function(){return"text"}},SCHEMA_CLASS_NAME:{get:function(){return"TextContentNode"}},factory:{get:function(){return function(t,e,n,i){var s=r.as(r.opt(r.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),u.GroupContentNode);return a.CoreAssert.isTrue(null!=s,"Content nodes need a parent","TextContentNode","TextContentNode.swift",16),o.init_3144(t,e,n,s)}}},PROPERTY_TEXT_MODEL:"text-model",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_3144,t,e,n,o)},init_26a9:function(t,e){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_c3fa,t,"text",e),this.set(o.PROPERTY_TEXT_MODEL,l.ContentTextModel.init_d41d())},init_5972:function(t,e){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,t,"text",e),this.set(o.PROPERTY_TEXT_MODEL,l.ContentTextModel.init_d41d())},className:{get:function(){return o.SCHEMA_CLASS_NAME}},textModel:{get:function(){return this.get(o.PROPERTY_TEXT_MODEL)},set:function(t){this.set(o.PROPERTY_TEXT_MODEL,t)}},text:{get:function(){return this.textModel.text},set:function(t){this.textModel.text=t}},insert:function(t,e){void 0===e&&(e=0),this.textModel.insert(t,e)},removeText:function(){this.textModel.remove(this.textModel.rangeAll)},subscribeWithCallbackToTextModel:function(t,e){return this.textModel.subscribeWithCallback(t,e)},match:function(t){var e;(e=r.as(t,o))&&this.textModel.match(e.textModel),s.ContentNode.prototype.match.call(this,t)}}}),o)},p15M:function(t,e,n){var o,i,r=e,a=n("oAGj"),s=n("gXiO"),u=n("2bF5"),l=n("/9Bx"),c=n("R19c");r.ImageAdjustmentMaps=(o=function(){this.colorMap=[],this.sMap=[],this.hMap=[],this.threeChannelColorMap=[],this.cm=[]},a.defineClass({name:"ImageAdjustmentMaps",ctor:o,superName:"CoreObject",props:{set:function(t,e,n,o,i){this.colorMap=a.clone(t),this.sMap=a.clone(e),this.hMap=a.clone(n),this.threeChannelColorMap=a.clone(o),this.cm=a.clone(i)}}}),o),r.MoaAdjustments=(i=function(){s.CoreObject.call(this)},a.defineClass({name:"MoaAdjustments",ctor:i,superName:"CoreObject",statics:{computeColorMaps:function(t){return i.computeColorMapsFromValues(t.shadows,t.highlights,t.saturation,t.brightness,t.exposure,t.contrast,t.warmth,t.tint,t.fade,t.vibrance)},computeColorMapsFromValues:function(t,e,n,o,i,s,h,f,_,d){var p=new r.ImageAdjustmentMaps,m=a.clone(l.MoaColorMap.createIdentityColorMap()),g=0!=o||0!=i||0!=s,R=0!=h||0!=f||0!=_;if(0!=o){var C=a.clone(l.MoaColorMap.createBrightnessColorMap(o));m=a.clone(l.MoaColorMap.combineColorMaps(a.clone(m),a.clone(C)))}if(0!=i){var T=a.clone(l.MoaColorMap.createExposureColorMap(i));m=a.clone(l.MoaColorMap.combineColorMaps(a.clone(m),a.clone(T)))}if(0!=s){var P=a.clone(l.MoaColorMap.createContrastColorMap(s));m=a.clone(l.MoaColorMap.combineColorMaps(a.clone(m),a.clone(P)))}var E=a.clone(l.MoaColorMap.createShadowsColorMap(t)),S=a.clone(l.MoaColorMap.createHighlightsColorMap(e)),N=a.clone(l.MoaColorMap.createIdentityColorMap()),M=a.clone(l.MoaColorMap.createIdentityColorMap()),v=a.clone(l.MoaColorMap.createIdentityColorMap());if(0!=_){var A=a.clone(l.MoaColorMap.createFadeColorMap(_));N=a.clone(l.MoaColorMap.combineColorMaps(a.clone(N),a.clone(A))),M=a.clone(l.MoaColorMap.combineColorMaps(a.clone(M),a.clone(A))),v=a.clone(l.MoaColorMap.combineColorMaps(a.clone(v),a.clone(A)))}if(0!=h){var O=a.clone(l.MoaColorMap.createWarmthColorMaps(h));N=a.clone(l.MoaColorMap.combineColorMaps(a.clone(N),a.clone(O[0]))),M=a.clone(l.MoaColorMap.combineColorMaps(a.clone(M),a.clone(O[1]))),v=a.clone(l.MoaColorMap.combineColorMaps(a.clone(v),a.clone(O[2])))}if(0!=f){var D=a.clone(l.MoaColorMap.createTintColorMaps(f));N=a.clone(l.MoaColorMap.combineColorMaps(a.clone(N),a.clone(D[0]))),M=a.clone(l.MoaColorMap.combineColorMaps(a.clone(M),a.clone(D[1]))),v=a.clone(l.MoaColorMap.combineColorMaps(a.clone(v),a.clone(D[2])))}if(g)for(var I=a.iter(a.range(0,u.MoaConstants.kMoaColorMapSizeRGB,!1));!I.done;I.next())m[Y=I.value]=l.MoaColorMap.MoaColorClamp(Math.round(m[Y]));if(R)for(var y=a.iter(a.range(0,u.MoaConstants.kMoaColorMapSizeRGB,!1));!y.done;y.next()){var Y;N[Y=y.value]=l.MoaColorMap.MoaColorClamp(Math.round(N[Y])),M[Y]=l.MoaColorMap.MoaColorClamp(Math.round(M[Y])),v[Y]=l.MoaColorMap.MoaColorClamp(Math.round(v[Y]))}var b=n,L=d;if(b+L>u.MoaConstants.kSatVibranceSumMax){var x=b+L;b=u.MoaConstants.kSatVibranceSumMax*b/x,L=u.MoaConstants.kSatVibranceSumMax*L/x}var G=[1,0,0,0,0,1,0,0,0,0,1,0];0!=L&&c.MoaColorMatrix.applyVibranceToColorMatrix(G,L),0!=b&&c.MoaColorMatrix.applySaturationToColorMatrix(G,b),l.MoaColorMap.roundColorMap(E),l.MoaColorMap.roundColorMap(S);var w=a.repeat([],3);return w[0]=a.clone(N),w[1]=a.clone(M),w[2]=a.clone(v),p.set(a.clone(m),a.clone(E),a.clone(S),a.clone(w),a.clone(G)),p}}}),i)},q5zr:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("yGNn"),u=n("A6KL"),l=n("iCxV"),c=n("REQJ"),h=n("sIWg"),f=n("qSCS");i.ImageContentNode=(o=function(){this.saliencyIntegral_=null,this.edgeIntegral_=null,this.MAX_SALIENCY_DIM=20,this.image_=null},r.defineClass({name:"ImageContentNode",ctor:o,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"image"}},SCHEMA_CLASS_NAME:{get:function(){return"ImageContentNode"}},factory:{get:function(){return function(t,e,n,i){var s=r.as(r.opt(r.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),u.GroupContentNode);return a.CoreAssert.isTrue(null!=s,"Content nodes need a parent","ImageContentNode","ImageContentNode.swift",16),o.init_3144(t,e,n,s)}}},PROPERTY_PIXEL_WIDTH:"pixel-width",PROPERTY_PIXEL_HEIGHT:"pixel-height",PROPERTY_IMAGE_COLOR_DATA:"image-color-data",PROPERTY_IMAGE_HAS_ALPHA:"image-has_alpha",PROPERTY_SALIENCY_WIDTH:"saliency-width",PROPERTY_SALIENCY_HEIGHT:"saliency-height",PROPERTY_SALIENCY_DATA:"saliency-data",PROPERTY_EDGE_DATA:"edge-data",PROPERTY_FOCUS_REGION:"focus-region",PROPERTY_TRIMMED_BOUNDS:"trimmed-bounds",IMAGE_MASK_ROLE_TAG:{get:function(){return"image-role"}},IMAGE_MASK_METADATA_TAG:{get:function(){return"image-mask-metadata"}},ROLE_MASK:{get:function(){return"mask"}},ASSET_ID_TAG:{get:function(){return"asset-id"}},_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){r.super_init(this,f.URLBasedContentNode,f.URLBasedContentNode.prototype.init_3144,t,e,n,o),this.createImageFeatures()},init_26a9:function(t,e){r.super_init(this,f.URLBasedContentNode,f.URLBasedContentNode.prototype.init_c3fa,t,"image",e)},init_5972:function(t,e){r.super_init(this,f.URLBasedContentNode,f.URLBasedContentNode.prototype.init_8b5c,t,"image",e)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},willCommitState:function(){var t,e,n,i,a,s,u;(t=this.saliencyData_)&&(this.set(o.PROPERTY_SALIENCY_DATA,r.clone(t)),this.saliencyData_=null),(e=this.edgeData_)&&(this.set(o.PROPERTY_EDGE_DATA,r.clone(e)),this.edgeData_=null),null!=(n=this.saliencyWidth_)&&(this.set(o.PROPERTY_SALIENCY_WIDTH,n),this.saliencyWidth_=null),null!=(i=this.saliencyHeight_)&&(this.set(o.PROPERTY_SALIENCY_HEIGHT,i),this.saliencyHeight_=null),(a=this.focusRegion_)&&(this.set(o.PROPERTY_FOCUS_REGION,a),this.focusRegion_=null),(s=this.trimmedBounds_)&&(this.set(o.PROPERTY_TRIMMED_BOUNDS,s),this.trimmedBounds_=null),null!=(u=this.hasAlpha_)&&(this.set(o.PROPERTY_IMAGE_HAS_ALPHA,u),this.hasAlpha_=null),f.URLBasedContentNode.prototype.willCommitState.call(this)},pixelWidth:{get:function(){var t;return(t=r.as(this.get(o.PROPERTY_PIXEL_WIDTH),"Int"))||null!=t?t:0},set:function(t){this.set(o.PROPERTY_PIXEL_WIDTH,t)}},pixelHeight:{get:function(){var t;return(t=r.as(this.get(o.PROPERTY_PIXEL_HEIGHT),"Int"))||null!=t?t:0},set:function(t){this.set(o.PROPERTY_PIXEL_HEIGHT,t)}},imageColorData:{get:function(){return r.as(this.get(o.PROPERTY_IMAGE_COLOR_DATA),["Array",c.ImageColorData])}},saliencyWidth:{get:function(){var t,e;return null==this.get(o.PROPERTY_SALIENCY_WIDTH)&&null==this.saliencyWidth_&&this.computeSaliencyData(),(t=r.as(this.get(o.PROPERTY_SALIENCY_WIDTH),"Int"))||null!=t?t:(e=this.saliencyWidth_)||null!=e?e:0}},saliencyHeight:{get:function(){var t,e;return null==this.get(o.PROPERTY_SALIENCY_HEIGHT)&&null==this.saliencyHeight_&&this.computeSaliencyData(),(t=r.as(this.get(o.PROPERTY_SALIENCY_HEIGHT),"Int"))||null!=t?t:(e=this.saliencyHeight_)||null!=e?e:0}},saliencyData:{get:function(){var t;return null==this.get(o.PROPERTY_SALIENCY_DATA)&&null==this.saliencyData_&&this.computeSaliencyData(),(t=r.as(this.get(o.PROPERTY_SALIENCY_DATA),["Array","Double"]))?t:this.saliencyData_}},edgeData:{get:function(){var t;return null==this.get(o.PROPERTY_EDGE_DATA)&&null==this.edgeData_&&this.computeEdgeData(),(t=r.as(this.get(o.PROPERTY_EDGE_DATA),["Array","Double"]))||null!=t?t:this.edgeData_}},getSaliencyDataDimensions:function(){if(0==this.pixelWidth||0==this.pixelHeight)return null;var t=this.MAX_SALIENCY_DIM,e=r.toDouble(this.pixelWidth)/r.toDouble(this.pixelHeight);return e>1?{width:r.toInt(t),height:r.toInt(t/e)}:{width:r.toInt(t*e),height:r.toInt(t)}},computeSaliencyData:function(){var t,e;if((t=this.image)&&null!=(e=this.getSaliencyDataDimensions())){var n=0==this.database.transactionDepth?this.database.beginTransaction("compute_saliency",null):null;this.makeMutable();var o=r.clone(t.getSaliencyData(e.width,e.height));o.length>0&&(this.saliencyWidth_=e.width,this.saliencyHeight_=e.height,this.saliencyData_=r.clone(o),this.computeSaliencyIntegral()),r.opt(n,(function(t){return t.mergeWithPrevious()}))}},computeSaliencyIntegral:function(){var t;(t=this.saliencyData)&&t.length>0&&(this.saliencyIntegral_=r.clone(this.createIntegralImage(r.clone(t),this.saliencyWidth,this.saliencyHeight)))},createIntegralImage:function(t,e,n){for(var o=r.repeat(0,e*n),i=r.repeat([],n),a=r.repeat([],n),s=r.iter(r.range(0,n,!1));!s.done;s.next())for(var u=s.value,l=r.iter(r.range(0,e,!1));!l.done;l.next()){var c=l.value,h=c>0&&u>0?o[(u-1)*e+(c-1)]:0,f=u>0?o[(u-1)*e+c]:0,_=c>0?o[u*e+(c-1)]:0,d=t[u*e+c];o[u*e+c]=d+f+_-h,i[u].push(d),a[u].push(d+f+_-h)}return o},computeEdgeData:function(){var t,e;if((t=this.image)&&null!=(e=this.getSaliencyDataDimensions())){var n=0==this.database.transactionDepth?this.database.beginTransaction("compute_edge_data",null):null;this.makeMutable(),this.saliencyWidth_=e.width,this.saliencyHeight_=e.height,this.edgeData_=r.clone(t.getEdgeData(this.saliencyWidth_,this.saliencyHeight_)),this.computeEdgeIntegral(),r.opt(n,(function(t){return t.mergeWithPrevious()}))}},computeEdgeIntegral:function(){var t;(t=this.edgeData)&&t.length>0&&(this.edgeIntegral_=r.clone(this.createIntegralImage(r.clone(t),this.saliencyWidth,this.saliencyHeight)))},getAverageEdge:function(t){var e;if(l.Host.platform.isWeb){if(null!=this.saliencyData&&null==this.saliencyIntegral_&&this.computeSaliencyIntegral(),(e=this.saliencyIntegral_)&&e.length>0)return this.getAverageSaliencyOrEdge(t,r.clone(e),this.saliencyWidth,this.saliencyHeight)}else if(null!=this.edgeData&&null==this.edgeIntegral_&&this.computeEdgeIntegral(),(e=this.edgeIntegral_)&&e.length>0)return this.getAverageSaliencyOrEdge(t,r.clone(e),this.saliencyWidth,this.saliencyHeight);return 0},getAverageSaliencyOrEdge:function(t,e,n,o){if(0==this.saliencyWidth||0==this.saliencyHeight)return 0;var i=r.toDouble(n)/r.toDouble(this.pixelWidth),a=r.toDouble(o)/r.toDouble(this.pixelHeight),s=t.multiplyXY(i,a),u=r.toInt(Math.max(r.toInt(s.minY),0)),l=r.toInt(Math.min(r.toInt(s.maxY),o-1)),c=r.toInt(Math.max(r.toInt(s.minX),0)),h=r.toInt(Math.min(r.toInt(s.maxX),n-1));if(u>=l||c>=h)return 0;var f=e[u*n+c],_=e[u*n+h],d=e[l*n+c],p=e[l*n+h]+f-_-d,m=(h-c)*(l-u);return r.toDouble(p)/r.toDouble(m)},computeFocusRegion:function(){var t;(t=this.image)&&t.loaded()&&(this.focusRegion_=t.getFocus())},focusRegion:{get:function(){var t,e;return null==r.as(this.get(o.PROPERTY_FOCUS_REGION),h.TheoRect)&&null==this.focusRegion_&&this.computeFocusRegion(),(e=(t=r.as(this.get(o.PROPERTY_FOCUS_REGION),h.TheoRect))||null!=t?t:this.focusRegion_)?0==e.width||0==e.height?h.TheoRect.fromXXYY(0,r.toDouble(this.pixelWidth),0,r.toDouble(this.pixelHeight)):h.TheoRect.fromXXYY(e.minX*r.toDouble(this.pixelWidth),e.maxX*r.toDouble(this.pixelWidth),e.minY*r.toDouble(this.pixelHeight),e.maxY*r.toDouble(this.pixelHeight)):null},set:function(t){var e;(e=t)&&a.CoreAssert.isTrue(e.maxX<=1&&e.maxY<=1,"focusRegion must be 0-1","ImageContentNode","ImageContentNode.swift",327),this.focusRegion_=null,this.set(o.PROPERTY_FOCUS_REGION,t)}},computeTrimmedBounds:function(){var t;if((t=this.image)&&t.loaded()){var e,n=0==this.database.transactionDepth?this.database.beginTransaction("compute_trimmed_bounds",null):null;this.makeMutable(),this.trimmedBounds_=null,(e=t.getTrimmedBounds())&&isFinite(e.minX)&&isFinite(e.maxX)&&isFinite(e.minY)&&isFinite(e.maxY)&&(this.trimmedBounds_=e),r.opt(n,(function(t){return t.mergeWithPrevious()}))}},trimmedBounds:{get:function(){var t;return null==r.as(this.get(o.PROPERTY_TRIMMED_BOUNDS),h.TheoRect)&&null==this.trimmedBounds_&&this.computeTrimmedBounds(),(t=r.as(this.get(o.PROPERTY_TRIMMED_BOUNDS),h.TheoRect))||null!=t?t:this.trimmedBounds_},set:function(t){this.trimmedBounds_=null,this.set(o.PROPERTY_TRIMMED_BOUNDS,t)}},whenLoaded:function(){var t=this;return new s.CorePromise((function(e,n){var o;(o=t.image)?o.whenLoaded((function(){return e(o)})):n("Content node's image is nil")}))},createImageFeatures:function(){var t=this;r.opt(this.image,(function(e){return e.whenLoaded((function(){t.persisted&&(t.focusRegion,r.clone(t.saliencyData),r.clone(t.edgeData),r.clone(t.imageColorData))}))}))},computeHasAlpha:function(){var t;(t=this.image)&&(this.hasAlpha_=t.hasAlpha())},hasAlpha:{get:function(){var t,e;return null==this.get(o.PROPERTY_IMAGE_HAS_ALPHA)&&null==this.hasAlpha_&&this.computeHasAlpha(),(t=r.as(this.get(o.PROPERTY_IMAGE_HAS_ALPHA),"Bool"))||null!=t?t:!(!(e=this.hasAlpha_)&&null==e)&&e},set:function(t){this.hasAlpha_=null,this.set(o.PROPERTY_IMAGE_HAS_ALPHA,t)}},hasAlphaSafe:{get:function(){return r.as(this.get(o.PROPERTY_IMAGE_HAS_ALPHA),"Bool")}},image:{get:function(){var t=this;return null==this.image_&&null!=this.url&&(this.image_=l.Host.imageAnalysis.createHostImage(this.url,this.hasAlphaSafe)),null!=this.image_&&null==this.get(o.PROPERTY_FOCUS_REGION)&&r.opt(this.image_,(function(e){return e.whenAsyncFeaturesLoaded((function(){r.opt(t.database.getAppliedState(),(function(e){return null!=e.getObjectStateByID(t.id)}))&&(t.focusRegion_=r.opt(t.image_,(function(t){return t.getFocus()})))}))})),this.image_},set:function(t){this.image_=t}},hostImageLoaded:{get:function(){var t;return!!(t=this.image_)&&t.loaded()}},releaseResources:function(){this.image_=null}}}),o)},qSCS:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("HRWw"),u=n("VkKB");i.URLBasedContentNode=(o=function(){},r.defineClass({name:"URLBasedContentNode",ctor:o,superName:"ContentNode",statics:{SCHEMA_CLASS_NAME:{get:function(){return"URLBasedContentNode"}},DATA_URL_PREFIX:"data:",PROPERTY_DATA_URL:"data-url",PROPERTY_MIMETYPE:"mimetype",PROPERTY_MEDIA_METADATA:"media-metadata",PROPERTY_SPARK_ELEMENTID:"element-id",PROPERTY_SPARK_ROLES:"roles",PROPERTY_LOCAL_IDENTIFIER:"local-identifier",PROPERTY_COMPONENTS:"components",PROPERTY_COMPONENT_URL:"url",PROPERTY_COMPONENT_MIMETYPE:"mimeType",PROPERTY_COMPONENT_ID:"id",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_3144,t,e,n,o)},init_5e75:function(t,e,n,o){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_5e75,t,e,n,o)},init_8b5c:function(t,e,n){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_8b5c,t,e,n)},init_c3fa:function(t,e,n){r.super_init(this,s.ContentNode,s.ContentNode.prototype.init_c3fa,t,e,n)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},saveComponentDescription:function(t,e,n){var i,s,u,l,c,h=(i=t)||null!=i?i:(s=this.componentID)||null!=s?s:this.id,f=(u=e)||null!=u?u:this.url,_=(l=n)||null!=l?l:this.mimeType,d={};(c=r.as(this.get(o.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&(a.CoreAssert.isTrue(1==c.length,void 0,"URLBasedContentNode.saveComponentDescription","URLBasedContentNode.swift",51),c.length>0&&(d=r.clone(c[0]))),d[o.PROPERTY_COMPONENT_ID]=h,null!=f&&(d[o.PROPERTY_COMPONENT_URL]=f),null!=_&&(d[o.PROPERTY_COMPONENT_MIMETYPE]=_),this.set(o.PROPERTY_COMPONENTS,[d])},url:{get:function(){var t,e=r.as(this.get(o.PROPERTY_DATA_URL),"String");return null==e&&(t=r.as(this.get(o.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&t.length>0&&(e=r.as(t[0][o.PROPERTY_COMPONENT_URL],"String")),e},set:function(t){null==t?(this.set(o.PROPERTY_DATA_URL,null),this.set(o.PROPERTY_COMPONENTS,null)):t.startsWith(o.DATA_URL_PREFIX)?(this.set(o.PROPERTY_DATA_URL,t),this.set(o.PROPERTY_COMPONENTS,null)):(this.saveComponentDescription(null,t,null),this.set(o.PROPERTY_DATA_URL,null))}},componentID:{get:function(){var t,e;return(e=r.as(this.get(o.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]]))&&(a.CoreAssert.isTrue(1==e.length,"componentID components count not equal 1. components.count "+e.length,"URLBasedContentNode","URLBasedContentNode.swift",113),e.length>0&&(t=r.as(e[0][o.PROPERTY_COMPONENT_ID],"String"))),t},set:function(t){this.saveComponentDescription(t,null,null)}},mimeType:{get:function(){return r.as(this.get(o.PROPERTY_MIMETYPE),"String")},set:function(t){this.set(o.PROPERTY_MIMETYPE,t),null!=r.as(this.get(o.PROPERTY_COMPONENTS),["Array",["Dictionary","String","Any"]])&&this.saveComponentDescription(null,null,t)}},sparkRoles:{get:function(){return r.as(this.get(o.PROPERTY_SPARK_ROLES),["Array","String"])}},setRoles:function(t){this.set(o.PROPERTY_SPARK_ROLES,r.clone(t))},clearRoles:function(){this.set(o.PROPERTY_SPARK_ROLES,null)},getSparkLogoRole:function(){var t;if(t=this.sparkRoles)for(var e=r.iter(t);!e.done;e.next()){var n=e.value;switch(n){case"primary-logo":case"secondary-logo":return n;default:continue}}return null},sparkElementID:{get:function(){return r.as(this.get(o.PROPERTY_SPARK_ELEMENTID),"String")},set:function(t){this.set(o.PROPERTY_SPARK_ELEMENTID,t)}},mediaMetadata:{get:function(){return r.as(this.get(o.PROPERTY_MEDIA_METADATA),u.MediaMetadata)},set:function(t){this.set(o.PROPERTY_MEDIA_METADATA,t)}},localIdentifier:{get:function(){return r.as(this.get(o.PROPERTY_LOCAL_IDENTIFIER),"String")},set:function(t){this.set(o.PROPERTY_LOCAL_IDENTIFIER,t)}}}}),o)},"s/Zj":function(t,e,n){var o,i=e,r=n("oAGj"),a=n("gXiO");i.MoaTransform=(o=function(){this.transformMatrix_=[],this.identityTransform=[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},r.defineClass({name:"MoaTransform",ctor:o,superName:"CoreObject",props:{init_d41d:function(){a.CoreObject.call(this),this.copy(r.clone(this.identityTransform))},init_8c4b:function(t){a.CoreObject.call(this),this.copy(r.clone(t))},transformMatrix:{get:function(){return this.transformMatrix_}},setIdentity:function(){this.transformMatrix_=r.clone(this.identityTransform)},copy:function(t){this.transformMatrix_=r.clone(t)},preRotateX:function(t){var e=o.init_8c4b([1,0,0,0,0,Math.cos(t),-Math.sin(t),0,0,Math.sin(t),Math.cos(t),0,0,0,0,1]);this.preTransform(e)},preTransform:function(t){var e=o.init_d41d();e.copy(r.clone(this.transformMatrix)),this.matrixMultiply(t,e)},matrixMultiply:function(t,e){var n=r.clone(t.transformMatrix),o=r.clone(e.transformMatrix);this.transformMatrix_[0]=n[0]*o[0]+n[1]*o[4]+n[2]*o[8]+n[3]*o[12],this.transformMatrix_[1]=n[0]*o[1]+n[1]*o[5]+n[2]*o[9]+n[3]*o[13],this.transformMatrix_[2]=n[0]*o[2]+n[1]*o[6]+n[2]*o[10]+n[3]*o[14],this.transformMatrix_[3]=n[0]*o[3]+n[1]*o[7]+n[2]*o[11]+n[3]*o[15],this.transformMatrix_[4]=n[4]*o[0]+n[5]*o[4]+n[6]*o[8]+n[7]*o[12],this.transformMatrix_[5]=n[4]*o[1]+n[5]*o[5]+n[6]*o[9]+n[7]*o[13],this.transformMatrix_[6]=n[4]*o[2]+n[5]*o[6]+n[6]*o[10]+n[7]*o[14],this.transformMatrix_[7]=n[4]*o[3]+n[5]*o[7]+n[6]*o[11]+n[7]*o[15],this.transformMatrix_[8]=n[8]*o[0]+n[9]*o[4]+n[10]*o[8]+n[11]*o[12],this.transformMatrix_[9]=n[8]*o[1]+n[9]*o[5]+n[10]*o[9]+n[11]*o[13],this.transformMatrix_[10]=n[8]*o[2]+n[9]*o[6]+n[10]*o[10]+n[11]*o[14],this.transformMatrix_[11]=n[8]*o[3]+n[9]*o[7]+n[10]*o[11]+n[11]*o[15],this.transformMatrix_[12]=n[12]*o[0]+n[13]*o[4]+n[14]*o[8]+n[15]*o[12],this.transformMatrix_[13]=n[12]*o[1]+n[13]*o[5]+n[14]*o[9]+n[15]*o[13],this.transformMatrix_[14]=n[12]*o[2]+n[13]*o[6]+n[14]*o[10]+n[15]*o[14],this.transformMatrix_[15]=n[12]*o[3]+n[13]*o[7]+n[14]*o[11]+n[15]*o[15]},preRotateY:function(t){var e=o.init_8c4b([Math.cos(t),0,Math.sin(t),0,0,1,0,0,-Math.sin(t),0,Math.cos(t),0,0,0,0,1]);this.preTransform(e)},preScaleXY:function(t,e){var n=o.init_8c4b([t,0,0,0,0,e,0,0,0,0,1,0,0,0,0,1]);this.preTransform(n)}}}),o)},sW6f:function(t,e,n){var o,i=e,r=n("oAGj"),a=n("SpAV"),s=n("A6KL"),u=n("RkYL"),l=n("qSCS");i.VideoContentNode=(o=function(){},r.defineClass({name:"VideoContentNode",ctor:o,superName:"URLBasedContentNode",statics:{KIND:{get:function(){return"video"}},SCHEMA_CLASS_NAME:{get:function(){return"VideoContentNode"}},factory:{get:function(){return function(t,e,n,i){var u=r.as(r.opt(r.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),s.GroupContentNode);return a.CoreAssert.isTrue(null!=u,"Content nodes need a parent","VideoContentNode","VideoContentNode.swift",18),o.init_3144(t,e,n,u)}}},LIVE_PHOTO_TAG:"LivePhoto",PROPERTY_WIDTH:"width",PROPERTY_HEIGHT:"height",PROPERTY_DURATION:"duration",PROPERTY_TIME_SAMPLES:"time-samples",PROPERTY_CHILDREN:"children",PROPERTY_ORIGINAL_DURATION:"original-duration",PROPERTY_OFFSET_IN_ORIGINAL:"offset-in-original",_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,o){r.super_init(this,l.URLBasedContentNode,l.URLBasedContentNode.prototype.init_3144,t,e,n,o)},init_26a9:function(t,e){r.super_init(this,l.URLBasedContentNode,l.URLBasedContentNode.prototype.init_c3fa,t,"video",e),this.set(o.PROPERTY_WIDTH,0),this.set(o.PROPERTY_HEIGHT,0),this.set(o.PROPERTY_DURATION,u.TheoTime.Zero),this.set(o.PROPERTY_TIME_SAMPLES,[])},init_5972:function(t,e){r.super_init(this,l.URLBasedContentNode,l.URLBasedContentNode.prototype.init_8b5c,t,"video",e),this.set(o.PROPERTY_WIDTH,0),this.set(o.PROPERTY_HEIGHT,0),this.set(o.PROPERTY_DURATION,u.TheoTime.Zero),this.set(o.PROPERTY_TIME_SAMPLES,[])},className:{get:function(){return o.SCHEMA_CLASS_NAME}},width:{get:function(){return this.get(o.PROPERTY_WIDTH)},set:function(t){this.set(o.PROPERTY_WIDTH,t)}},height:{get:function(){return this.get(o.PROPERTY_HEIGHT)},set:function(t){this.set(o.PROPERTY_HEIGHT,t)}},duration:{get:function(){return this.get(o.PROPERTY_DURATION)},set:function(t){this.set(o.PROPERTY_DURATION,t)}},originalDuration:{get:function(){var t;return(t=r.as(this.get(o.PROPERTY_ORIGINAL_DURATION),u.TheoTime))||null!=t?t:this.duration},set:function(t){this.set(o.PROPERTY_ORIGINAL_DURATION,t)}},offsetInOriginal:{get:function(){var t;return(t=this._transientOffsetInOriginal)?t:r.as(this.get(o.PROPERTY_OFFSET_IN_ORIGINAL),u.TheoTime)},set:function(t){a.CoreAssert.isTrue(null==this._transientOffsetInOriginal,"Can't set offsetInOriginal while have transient value","VideoContentNode","VideoContentNode.swift",88),this.set(o.PROPERTY_OFFSET_IN_ORIGINAL,t)}},setTransientOffset:function(t){this._transientOffsetInOriginal=t},resetTransientOffset:function(){this._transientOffsetInOriginal=null},wasTrimmed:{get:function(){var t;return!!(t=r.as(this.get(o.PROPERTY_ORIGINAL_DURATION),u.TheoTime))&&!t.secondsEqual(this.duration)}},times:{get:function(){var t;return(t=r.as(this.get(o.PROPERTY_TIME_SAMPLES),["Array",u.TheoTime]))||null!=t?t:[]}},isGIF:{get:function(){var t;return null!=(t=this.mimeType)&&t.includes("gif")}},setTimes:function(t){this.set(o.PROPERTY_TIME_SAMPLES,r.clone(t))},concatTimes:function(t){this.set(o.PROPERTY_TIME_SAMPLES,r.clone(this.times.concat(r.clone(t))))},addTime:function(t){this.set(o.PROPERTY_TIME_SAMPLES,r.clone(this.times.concat([t])))},timesAsNSArray:{get:function(){for(var t=[],e=r.iter(this.times);!e.done;e.next()){var n=e.value;t.push(n)}return t.concat()}}}}),o)},zjY7:function(t,e,n){var o,i,r,a,s,u=e,l=n("oAGj"),c=n("cZuM"),h=n("SpAV"),f=n("gXiO"),_=n("FNB+"),d=n("6ZWm"),p=n("pnSN"),m=n("ZhwN"),g=n("iCxV"),R=n("c+uM"),C=n("uj1m"),T=n("3DEm"),P=n("txj3"),E=n("7Ta2"),S=n("djAF"),N=n("8t9B"),M=n("ThKb"),v=n("oKlP"),A=n("sIWg"),O=n("qSCS");u.PairingFeatures=l.defineEnum("PairingFeatures",{BOUNDARY_DISTANCE:"boundary_distance",CENTER_DISTANCE:"center_distance",X_ALIGNED:"x_aligned",Y_ALIGNED:"y_aligned",LEFT_ALIGNED:"left_aligned",CENTER_X_ALIGNED:"center_x_aligned",RIGHT_ALIGNED:"right_aligned",TOP_ALIGNED:"top_aligned",CENTER_Y_ALIGNED:"center_y_aligned",BOTTOM_ALIGNED:"bottom_aligned",HEIGHT_DIFF:"height_diff",WIDTH_DIFF:"width_diff",AREA_DIFF:"area_diff",CONTAINMENT_MISMATCH:"containment_mismatch",INTERSECTION:"intersection",CONTAINMENT_CHILD_COUNT:"containment_child_count",CHILD_COUNT_MATCH:"child_count_match",UNION_POSITION_X:"union_position_x",UNION_POSITION_Y:"union_position_y",UNION_NUM_NON_INTERSECT:"union_num_non_intersect",UNION_AREA:"union_area",UNION_EMPTY_SPACE:"union_empty_space",OUT_OF_BOUNDS_MISMATCH:"out_of_bounds_mismatch",OPACITY_DIFFERENCE:"opacity_difference",COLOR_DISTANCE:"color_distance",FONT_SIZE_DISTANCE:"font_size_distance",POSITION_X_FIRST:"position_x_first",POSITION_Y_FIRST:"position_y_first",POSITION_X_SECOND:"position_x_second",POSITION_Y_SECOND:"position_y_second",AREA_FIRST:"area_first",AREA_SECOND:"area_second",IS_SHAPE_FIRST:"is_shape_first",IS_TEXT_FIRST:"is_text_first",IS_IMAGE_FIRST:"is_image_first",IS_SHAPE_SECOND:"is_shape_second",IS_TEXT_SECOND:"is_text_second",IS_IMAGE_SECOND:"is_image_second",TYPE_MISMATCH:"type_mismatch"}),u.GroupLayoutStrategy=l.defineEnum("GroupLayoutStrategy",{Default:0,VerticalFlow:1,HorizontalFlow:2}),u.VisualNode=(o=function(){this.origNode=null,this.constraintLeft=!1,this.constraintRight=!1,this.constraintWidth=!1,this.constraintTop=!1,this.constraintBottom=!1,this.constraintHeight=!1,this.bgConstraint=!1,this.id=m.GUIDUtils.makeGUID()},l.defineClass({name:"VisualNode",ctor:o,superName:"CoreObject",props:{frame:{get:function(){return this.frame_},set:function(t){null==this.frame_&&(this.initFrame=t),this.frame_=t}},root:{get:function(){for(var t=this.parent;null!=t&&null!=t.parent;)t=t.parent;return t}},shortID:{get:function(){return this.id.substr(0,4)}},maintainAspectRatio:{get:function(){return!1}},clone:function(){var t=new o;return t.frame=this.frame,t.initFrame=this.initFrame,t.origNode=this,t.bgConstraint=this.bgConstraint,t},description:{get:function(){return"???: "+this.shortID+" "+this.frameString}},frameString:{get:function(){var t=l.toString(Math.round(this.frame.minX)),e=l.toString(Math.round(this.frame.maxX)),n=l.toString(Math.round(this.frame.minY)),o=l.toString(Math.round(this.frame.maxY));return" x: "+t+" "+e+" ("+l.toString(Math.round(this.frame.width))+"), y:"+n+" "+o+" ("+l.toString(Math.round(this.frame.height))+")"}},resetConstraints:function(t){void 0===t&&(t=null),null!=t&&t||this.resetXConstraints(),(null==t||t)&&this.resetYConstraints()},resetXConstraints:function(){this.constraintLeft=!1,this.constraintRight=!1,this.constraintWidth=!1},resetYConstraints:function(){this.constraintTop=!1,this.constraintBottom=!1,this.constraintHeight=!1},print:function(){for(var t="",e=[this];e.length>0;){var n,o=e[0];e.splice(0,1),(n=l.as(o,u.VisualNodeGroup))&&(e=n.children.concat(e));for(var i=o.parent;null!=i;)i=l.opt(i,(function(t){return t.parent})),t+="\t";t+=o.description+"\n"}return t}}}),o),u.VisualNodeLeaf=(i=function(t,e){this.hasForegroundRole_=null,this.hasBackgroundRole_=null,void 0===e&&(e=null),this.forma=t,u.VisualNode.call(this),this.frame=null!=e?e:t.frame},l.defineClass({name:"VisualNodeLeaf",ctor:i,superName:"VisualNode",props:{maintainAspectRatio:{get:function(){return this.forma.controller.maintainAspectRatio}},clone:function(){var t=new i(this.forma,this.frame);return t.origNode=this,t},hasForegroundRole:{get:function(){if(null!=this.hasForegroundRole_)return this.hasForegroundRole_;if(this.forma.isTypeLockup())return this.hasForegroundRole_=!0,!0;var t=l.clone((new E.RoleSuggester).getRole(this.forma));return t.role!=E.InferredRoleType.Seperator&&t.role!=E.InferredRoleType.GraphicContent||!this.forma.isTypeLockup()?(this.hasForegroundRole_=!1,!1):(this.hasForegroundRole_=!0,!0)}},hasBackgroundRole:{get:function(){if(null!=this.hasBackgroundRole_)return this.hasBackgroundRole_;var t=l.clone((new E.RoleSuggester).getRole(this.forma));return t.role==E.InferredRoleType.Background&&t.confidence>.5||t.secondaryRole==E.InferredRoleType.Background&&t.secondaryConfidence>.5?(this.hasBackgroundRole_=!0,!0):(this.hasBackgroundRole_=!1,!1)}},description:{get:function(){var t,e,n="";if(t=l.as(this.forma.controller,N.TypeLockupController)){var o=l.replaceAll(t.text.substr(0,6),"\n","");n="T: "+this.shortID+" "+o}else if(e=l.as(this.forma,S.ShapeForma)){var i,r;n="S: "+this.shortID+" ",(i=l.opt(l.as(e.contentNode,O.URLBasedContentNode),(function(t){return t.mediaMetadata})))&&null!=(r=i.searchTerm)&&(n+=r)}else n=this.forma.controller instanceof d.FrameController?"I: "+this.shortID+" ":"???: "+this.shortID+" "+this.forma.controller.kind;return n+=this.frameString}}}}),i),u.VisualNodeGroup=(r=function(t,e){if(this.alignments=[],void 0===e&&(e=null),this.children=l.clone(t),this.maintainAspectRatio_=!1,u.VisualNode.call(this),null==e){if(this.frame=A.TheoRect.Zero,t.length>0){this.frame=t[0].frame;for(var n=l.iter(t);!n.done;n.next()){var o=n.value;this.frame=this.frame.unionWith(o.frame)}}}else this.frame=e;for(var i=l.iter(t);!i.done;i.next()){var r;(r=(o=i.value).parent)&&r.removeChildren([o]),o.parent=this}this.setMaintainAspectRatio()},l.defineClass({name:"VisualNodeGroup",ctor:r,superName:"VisualNode",statics:{extractNodeInfo:function(t){var e,n,o={};if(e=l.as(t,r)){o.type=l.as("Group","AnyObject"),o.frame=e.frame.encodeJson(),o.layoutStrategy=l.as(e.layoutStrategyString,"AnyObject");for(var i=[],a=l.iter(e.children);!a.done;a.next()){var s=a.value;i.push(l.clone(r.extractNodeInfo(s)))}o.children=l.as(i,"AnyObject")}return(n=l.as(t,u.VisualNodeLeaf))&&(o.type=l.as(n.forma.controller.kind,"AnyObject"),o.formaId=l.as(n.forma.formaID,"AnyObject"),o.frame=n.forma.finalFrame.encodeJson(),o.role=l.as((new E.RoleSuggester).getRole(n.forma).role,"AnyObject")),o}},props:{maintainAspectRatio:{get:function(){return this.maintainAspectRatio_},set:function(t){this.maintainAspectRatio_=t}},layoutStrategyString:{get:function(){var t;if(null!=(t=this.layoutStrategy)){if(t==u.GroupLayoutStrategy.Default)return"default";if(t==u.GroupLayoutStrategy.VerticalFlow)return"vertical";if(t==u.GroupLayoutStrategy.HorizontalFlow)return"horizontal"}return"None"}},setMaintainAspectRatio:function(){this.maintainAspectRatio_=!1;for(var t=l.iter(this.children);!t.done;t.next()){var e,n=t.value;if((e=this.frame.intersectionWith(n.frame))&&Math.abs(e.area-this.frame.area)/this.frame.area<.1)return void(this.maintainAspectRatio_=n.maintainAspectRatio)}for(var o=0,i=l.iter(this.children);!i.done;i.next()){var r;n=i.value,(r=l.as(n,u.VisualNodeLeaf))&&r.maintainAspectRatio&&(o+=1)}o==this.children.length&&this.children.length>0&&(this.maintainAspectRatio_=!0)},clone:function(){for(var t=[],e=l.iter(this.children);!e.done;e.next()){var n=e.value;t.push(n.clone())}var o=new r(l.clone(t),this.frame);o.origNode=this,o.layoutStrategy=this.layoutStrategy,o.alignments=l.clone(this.alignments),o.bgConstraint=this.bgConstraint;for(var i=l.iter(t);!i.done;i.next())(n=i.value).parent=o;return o},addChildren:function(t){for(var e={},n=[],o=l.iter(t);!o.done;o.next()){var i=o.value;n.push(i.id),e[i.id]=i}for(var r=l.iter(n);!r.done;r.next()){var a;(a=(i=e[r.value]).parent)&&a.removeChildren([i]),this.children.push(i),i.parent=this}},removeChildren:function(t){for(var e=l.iter(t);!e.done;e.next()){var n=e.value;this.children.includes(n)&&l.remove(this.children,n)}},descendents:{get:function(){for(var t=[],e=l.iter(this.children);!e.done;e.next()){var n,o=e.value;t.push(o),(n=l.as(o,r))&&(t=t.concat(n.descendents))}return t}},leafDescendents:{get:function(){for(var t=[],e=l.iter(this.children);!e.done;e.next()){var n,o,i=e.value;(n=l.as(i,u.VisualNodeLeaf))&&t.push(n),(o=l.as(i,r))&&(t=t.concat(o.leafDescendents))}return t}},filledGroup:{get:function(){for(var t=l.iter(this.leafDescendents);!t.done;t.next())if(t.value.frame.equalWithAccuracy(this.frame,1))return!0;return!1}},description:{get:function(){var t=this.bgConstraint?" bg":"";return"G: "+this.shortID+" "+this.layoutStrategyString+t+" "+this.frameString}},encodeToJson:function(){return l.clone(r.extractNodeInfo(this))}}}),r),u.VisualNodeData=(a=function(){this.formae=[],this.fontSize=[],this.opacities=[],this.colors=[],this.unionIntersections={},this.nodeDistances={},this.alignments={},this.intersections=[],this.parentContainment=[],this.childContainment=[]},l.defineClass({name:"VisualNodeData",ctor:a,props:{frame:{get:function(){return this.node.frame}},init_d79d:function(t){this.node=t},init_b16c:function(t,e,n){this.node=t,this.formae=e.formae.concat(n.formae),this.fontSize=e.fontSize.concat(n.fontSize),this.opacities=e.opacities.concat(n.opacities),this.colors=e.colors.concat(n.colors);for(var o=l.iter(e.alignments);!o.done;o.next())for(var i=o.key,r=o.value,a=l.iter(n.alignments);!a.done;a.next()){var s=a.key,u=a.value;i==s&&(this.alignments[i]=r.concat(u))}},init_ff0a:function(t,e){this.node=t;var n,o,i=t.forma;this.formae.push(i),(n=i.style.colors.fieldPrimary)&&this.colors.push(n),(n=i.style.colors.fieldSecondary)&&this.colors.push(n),this.opacities.push(i.style.opacity),(o=l.as(i.controller,N.TypeLockupController))&&this.fontSize.push(o.getCurrentFontSize());for(var r=c.AlignmentDetector.init_a05b(i),a=l.iter(r.detectFormaAlignments(c.AlignmentDetector.DISTANCE_THRESHOLD,void 0,!1));!a.done;a.next()){var s=a.value;if(l.containsEq(e,s.forma,_._equality_Forma_Forma)){var u=s.forma.formaID;null==this.alignments[u]&&(this.alignments[u]=[]),this.alignments[u].push(l.clone(s))}}},nodeIntersection:function(t,e){for(var n=[],o=l.iter(t);!o.done;o.next()){var i=o.value;e.includes(i)&&n.push(i)}return n},setPairwiseDistanceTerms:function(t){if(this.intersections=l.clone(this.nodeIntersection(l.clone(this.intersections),l.clone(t))),this.parentContainment=l.clone(this.nodeIntersection(l.clone(this.parentContainment),l.clone(t))),this.childContainment=l.clone(this.nodeIntersection(l.clone(this.childContainment),l.clone(t))),null==this.node||l.opt(this.node,(function(t){return null==t.frame})))l.info("ERROR: in setPairwiseDistanceTerms");else for(var e=l.iter(t);!e.done;e.next()){var n=e.value,o=n.id;if(n!=this.node&&null==this.nodeDistances[o]){if(null!=n.inferenceData)for(var i=l.iter(n.inferenceData.formae);!i.done;i.next()){var r=i.value,a=l.clone(this.alignments[r.formaID]);null!=a&&(this.alignments[o]=l.clone(a))}if(null==n.frame)return void l.info("ERROR: in setPairwiseDistanceTerms");var s,u=n.frame;(s=u.intersectionWith(this.node.frame))&&(s.area/this.frame.area>.95?this.parentContainment.push(n):s.area/u.area>.95&&this.childContainment.push(n),this.intersections.push(n)),this.nodeDistances[o]=this.frame.L1Distance(u),this.unionIntersections[o]=[];for(var c=this.frame.unionWith(u),h=l.iter(t);!h.done;h.next()){var f=h.value;f!=n&&this.node!=f&&f.frame.intersects(c)&&this.unionIntersections[o].push(f)}}}}}}),a),u.VisualStructureDetector=(s=function(t,e){this.SPACING_REL_MERGE_THRESHOLD=.25,this.SPACING_ABS_MERGE_THRESHOLD=20,this.nodes_=[],this.pairwiseGroupScores_={};var n,o,i=this;this.parentForma_=e;for(var r=l.iter(t);!r.done;r.next()){var a=r.value,s=new u.VisualNodeLeaf(a),c=u.VisualNodeData.init_ff0a(s,l.clone(t));s.inferenceData=c,s.frame=l.opt(s.frame,(function(t){return t.intersectionWith(i.parentForma_.bounds)})),null!=s.frame?this.nodes_.push(s):l.opt(g.Host.logging,(function(t){return t.error(" node.frame == nil in VisualStructureDetector")}))}for(var _=l.iter(this.nodes_);!_.done;_.next())(s=_.value).inferenceData.node=s,s.inferenceData.setPairwiseDistanceTerms(l.clone(this.nodes_));if(this.bgFrames_=[],(n=e.finalFrame)&&(o=l.opt(this.parentForma_.root,(function(t){return t.filterWithCallback((function(t){return null!=t.controller&&t.isGridCell()}))})))){for(var d=l.iter(o);!d.done;d.next()){var p;if((p=(a=d.value).finalFrame)&&n.contains(p)){var m=a.bounds.transform(a.totalPlacement.concat(e.totalPlacement.inverse));n.equal(p)&&h.CoreAssert.isTrue(e.bounds.equal(m),void 0,"VisualStructureDetector.init","VisualStructureDetector.swift",802),this.bgFrames_.push(m)}}if(this.bgFrames_.length>0)for(var R=l.iter(l.range(0,4,!1));!R.done;R.next()){for(var C=null,T=[new v.TheoPoint(.5,0),new v.TheoPoint(0,.5),new v.TheoPoint(.5,1),new v.TheoPoint(1,.5)],P=l.iter(T);!P.done;P.next()){for(var E=P.value,S=e.bounds.eval(E),N=null,M=1/0,O=l.iter(this.bgFrames_);!O.done;O.next()){var D=(m=O.value).eval(E),I=.5==E.x?Math.abs(S.y-D.y):Math.abs(S.x-D.x);M>I&&(M=I,N=m)}if(null!=N&&M>0){var y=.5==E.x?e.bounds.horizontalLine(E.y):e.bounds.verticalLine(E.x),Y=.5==E.x?N.horizontalLine(E.y):N.verticalLine(E.x),b=A.TheoRect.boundsOfPoints([y.p1,y.p2,Y.p1,Y.p2]);(null==C||C.area<b.area)&&(C=b)}}if(null==C)break;this.bgFrames_.push(C)}}f.CoreObject.call(this)},l.defineClass({name:"VisualStructureDetector",ctor:s,superName:"CoreObject",props:{inferVisualStructure:function(){if(0==this.nodes_.length)return null;for(var t=[],e=[],n=l.iter(this.nodes_);!n.done;n.next()){var o=n.value;this.isBackgroundElement(o)?t.push(o):e.push(o)}var i=this.groupNodes(l.clone(t)),r=this.groupNodes(l.clone(e));return null==i?r:null==r?i:(i.addChildren(l.clone(r.children)),i)},groupNodes:function(t){if(0==t.length)return null;for(var e=l.clone(this.mergeNodes(l.clone(t))),n=(new u.VisualNodeGroup(l.clone(e),this.parentForma_.bounds),l.clone(this.createBackgroundGroupNodes(l.clone(e)))),o=l.iter(e);!o.done;o.next())o.value.inferenceData.setPairwiseDistanceTerms(l.clone(n));return new u.VisualNodeGroup(l.clone(n),this.parentForma_.bounds)},scoreNodeGrouping:function(t,e){var n,o,i,r={};if((n=t.inferenceData)&&(o=e.inferenceData)&&(i=l.opt(o.formae[0].parent,(function(t){return t.bounds})))){var a,s=t.frame.unionWith(e.frame);if(a=n.unionIntersections[e.id]){for(var h=l.clone(n.intersections),f=l.clone(o.intersections),_=0,d=l.iter(a);!d.done;d.next()){var p=d.value;h.includes(p)||f.includes(p)||(_+=1)}r[u.PairingFeatures.UNION_NUM_NON_INTERSECT]=l.toDouble(_)}var m=l.clone(n.parentContainment),g=l.clone(o.parentContainment);n.childContainment.includes(e)?r[u.PairingFeatures.CONTAINMENT_CHILD_COUNT]=l.toDouble(n.childContainment.length-1):o.childContainment.includes(t)&&(r[u.PairingFeatures.CONTAINMENT_CHILD_COUNT]=l.toDouble(o.childContainment.length-1)),m.includes(e)&&l.remove(m,e),g.includes(t)&&l.remove(g,t);for(var R=0,T=l.iter(m.concat(g));!T.done;T.next()){var E=T.value;m.includes(E)&&g.includes(E)||(R+=1)}r[u.PairingFeatures.CONTAINMENT_MISMATCH]=R,r[u.PairingFeatures.BOUNDARY_DISTANCE]=n.nodeDistances[e.id],r[u.PairingFeatures.CENTER_DISTANCE]=n.frame.center.distanceTo(o.frame.center);var S,N=l.clone(n.alignments[e.id]),v=l.clone(o.alignments[t.id]);if(null!=N&&null!=v)for(var A=l.iter(N);!A.done;A.next())for(var O=A.value,D=l.iter(v);!D.done;D.next()){var I=D.value;O.line.type==I.line.type&&(O.line.type==c.AlignmentType.CenterX?r[u.PairingFeatures.CENTER_X_ALIGNED]=1:O.line.type==c.AlignmentType.Left?r[u.PairingFeatures.LEFT_ALIGNED]=1:O.line.type==c.AlignmentType.Right?r[u.PairingFeatures.RIGHT_ALIGNED]=1:O.line.type==c.AlignmentType.Top?r[u.PairingFeatures.TOP_ALIGNED]=1:O.line.type==c.AlignmentType.CenterY?r[u.PairingFeatures.CENTER_Y_ALIGNED]=1:O.line.type==c.AlignmentType.Bottom&&(r[u.PairingFeatures.BOTTOM_ALIGNED]=1),O.line.type==c.AlignmentType.CenterX||O.line.type==c.AlignmentType.Left||O.line.type==c.AlignmentType.Right?r[u.PairingFeatures.X_ALIGNED]=1:r[u.PairingFeatures.Y_ALIGNED]=1)}if(S=n.frame.intersectionWith(o.frame)){var y=S.area/Math.max(n.frame.area,o.frame.area);r[u.PairingFeatures.INTERSECTION]=y}for(var Y=0,b=l.iter(n.formae);!b.done;b.next()){for(var L=b.value,x=!1,G=l.iter(o.formae);!G.done;G.next())((H=G.value).isTypeLockup()&&L.isTypeLockup()||H.isGraphic()&&L.isGraphic())&&(x=!0);x||(Y=1)}for(var w=l.iter(o.formae);!w.done;w.next()){L=w.value,x=!1;for(var F=l.iter(n.formae);!F.done;F.next()){var H;((H=F.value).isTypeLockup()&&L.isTypeLockup()||H.isGraphic()&&L.isGraphic())&&(x=!0)}x||(Y=1)}r[u.PairingFeatures.TYPE_MISMATCH]=Y;for(var B=null,U=l.iter(n.colors);!U.done;U.next())for(var k=U.value,V=l.iter(o.colors);!V.done;V.next()){var j=V.value;B=null==B?k.distanceTo(j):Math.min(B,k.distanceTo(j))}r[u.PairingFeatures.COLOR_DISTANCE]=null!=B?B:0;for(var X=null,W=l.iter(n.opacities);!W.done;W.next())for(var K=W.value,z=l.iter(o.opacities);!z.done;z.next()){var Z=z.value;X=null==X?Math.abs(K-Z):Math.min(X,Math.abs(K-Z))}r[u.PairingFeatures.OPACITY_DIFFERENCE]=null!=X?X:0;for(var q=null,J=l.iter(n.fontSize);!J.done;J.next())for(var Q=J.value,$=l.iter(o.fontSize);!$.done;$.next()){var tt=$.value;q=null==q?Math.abs(Q-tt):Math.min(q,Math.abs(Q-tt))}r[u.PairingFeatures.FONT_SIZE_DISTANCE]=null!=q?q:0;var et=!i.contains(n.frame)&&i.contains(o.frame)||i.contains(n.frame)&&!i.contains(o.frame);r[u.PairingFeatures.OUT_OF_BOUNDS_MISMATCH]=et?1:0;var nt=n,ot=o;n.frame.center.y>o.frame.center.y&&(nt=o,ot=n),r[u.PairingFeatures.POSITION_X_FIRST]=nt.frame.center.x/i.width,r[u.PairingFeatures.POSITION_Y_FIRST]=nt.frame.center.y/i.height,r[u.PairingFeatures.AREA_FIRST]=nt.frame.area,r[u.PairingFeatures.POSITION_X_SECOND]=ot.frame.center.x/i.width,r[u.PairingFeatures.POSITION_Y_SECOND]=ot.frame.center.y/i.height,r[u.PairingFeatures.AREA_SECOND]=ot.frame.area;for(var it=l.iter(nt.formae);!it.done;it.next())(L=it.value).isTypeLockup()?r[u.PairingFeatures.IS_TEXT_FIRST]=1:L.isShape()?r[u.PairingFeatures.IS_SHAPE_FIRST]=1:L.isImage()&&(r[u.PairingFeatures.IS_IMAGE_FIRST]=1);for(var rt=l.iter(ot.formae);!rt.done;rt.next())(L=rt.value).isTypeLockup()?r[u.PairingFeatures.IS_TEXT_SECOND]=1:L.isShape()?r[u.PairingFeatures.IS_SHAPE_SECOND]=1:L.isImage()&&(r[u.PairingFeatures.IS_IMAGE_SECOND]=1);r[u.PairingFeatures.UNION_EMPTY_SPACE]=Math.max(0,s.area-n.frame.area-o.frame.area),r[u.PairingFeatures.UNION_AREA]=s.area,r[u.PairingFeatures.UNION_POSITION_X]=s.center.x/i.height,r[u.PairingFeatures.UNION_POSITION_Y]=s.center.y/i.width,r[u.PairingFeatures.HEIGHT_DIFF]=Math.abs(n.frame.height-o.frame.height),r[u.PairingFeatures.WIDTH_DIFF]=Math.abs(n.frame.width-o.frame.width),r[u.PairingFeatures.AREA_DIFF]=Math.abs(n.frame.area-o.frame.area);for(var at,st=[],ut=l.iter(["union_position_x","y_aligned","is_text_second","right_aligned","is_shape_first","containment_child_count","is_image_first","is_image_second","type_mismatch","position_x_second","containment_mismatch","height_diff","union_area","union_empty_space","area_first","top_aligned","area_second","bottom_aligned","center_y_aligned","center_distance","union_position_y","is_text_first","opacity_difference","intersection","out_of_bounds_mismatch","position_y_first","is_shape_second","position_x_first","width_diff","union_num_non_intersect","left_aligned","color_distance","center_x_aligned","boundary_distance","position_y_second","x_aligned","area_diff","font_size_distance"]);!ut.done;ut.next()){var lt;null!=(lt=r[ut.value])?st.push(lt):st.push(0)}if(at=C.MLPModel.loadNNModel("VisualGrouping")){var ct=l.clone(st),ht=new M.TheoMatrix([ct]).subtract(at.featureScalingMean).divide(at.featureScalingStd);return{score:1-new P.NNMLPClassifier(l.clone(at.coefficients),l.clone(at.intercepts),at.finalSoftmax).predict(ht.transpose()).transpose().asArray[0][0],features:r}}}return{score:1/0,features:{}}},mergeWithParentIfPossible:function(t,e){var n,o,i,r;if(void 0===e&&(e=!1),(n=l.as(t,u.VisualNodeGroup))&&null!=(o=n.spacing)&&(i=n.parent)&&null!=(r=i.spacing)){if(n.layoutStrategy!=i.layoutStrategy)return;if(n.layoutStrategy==u.GroupLayoutStrategy.Default)return l.remove(i.children,n),void i.addChildren(l.clone(n.children));for(var a=[],s=l.iter(i.alignments);!s.done;s.next())for(var c=s.value,h=l.iter(n.alignments);!h.done;h.next())c==h.value&&(a.includes(c)||a.push(c));(a.length>0||!e)&&(i.alignments=l.clone(a),i.spacing=(o+r)/2,l.remove(i.children,n),i.addChildren(l.clone(n.children)))}},getNodeForForma:function(t){for(var e=l.iter(this.nodes_);!e.done;e.next()){var n=e.value;if(l.containsEq(n.inferenceData.formae,t,_._equality_Forma_Forma))return n}return null},getScoreNodeFeatures:function(t,e){return this.scoreNodeGrouping(this.getNodeForForma(t),this.getNodeForForma(e))},isBackgroundElement:function(t){var e,n;if((e=l.as(t,u.VisualNodeLeaf))&&(n=e.forma.finalFrame)){if(e.forma.isBackgroundImage())return!0;if(e.forma.isGridCell())return!0;if(n.contains(this.parentForma_.finalFrame)||e.forma.isGraphic()&&!this.parentForma_.finalFrame.contains(n.insetRel(.1,.1,.1,.1)))return!0;var o;if(o=l.as(e.forma.controller,N.TypeLockupController)){var i=o.getAverageFontSize();return 1==o.text.length&&i>1e3}return e.hasBackgroundRole}return!1},nodesMergeable:function(t,e){return this.isBackgroundElement(t)!=this.isBackgroundElement(e)},getPairwiseScore:function(t,e){var n,o=t.id+e.id;if(null!=(n=this.pairwiseGroupScores_[o]))return n;var i=this.scoreNodeGrouping(t,e);return this.pairwiseGroupScores_[o]=i.score,i.score},scoreVisualGroupMerge:function(t,e,n){if(t==e)return h.CoreAssert.fail("probably an error if we're trying to merge something with outself","VisualStructureDetector.scoreVisualGroupMerge","VisualStructureDetector.swift",1342),1;var o,i;if((o=l.as(t,u.VisualNodeLeaf))&&(i=l.as(e,u.VisualNodeLeaf)))return this.getPairwiseScore(o,i);var r,a=[t];(r=l.as(t,u.VisualNodeGroup))&&(a=l.clone(r.children));var s,c=[e];(s=l.as(e,u.VisualNodeGroup))&&(c=l.clone(s.children));for(var f=0,_=l.iter(a);!_.done;_.next())for(var d=_.value,p=l.iter(c);!p.done;p.next()){var m=p.value;f=Math.max(f,this.scoreVisualGroupMerge(d,m,l.clone(n)))}for(var g=l.iter(n);!g.done;g.next()){var R=g.value;if(R!=t&&R!=e){var C=t.frame.unionWith(e.frame).intersectionWith(R.frame);if(!t.frame.intersects(R.frame)&&!e.frame.intersects(R.frame)&&null!=C&&C.area/R.frame.area>.25)return 0}}return f},scoreRegionMerge:function(t,e,n,o){void 0===o&&(o=0);var i=t.frame.yDistance(e.frame,!1),r=t.frame.xDistance(e.frame,!1);if(i>0&&r>0)return-1/0;for(var a=l.iter(n);!a.done;a.next()){var s,c=a.value;if(c!=t&&c!=e&&(s=t.frame.unionWith(e.frame).intersectionWith(c.frame))&&s.area/c.frame.area>.1)return-1/0}if(i<o&&r<o)return-1/0;var h=r<i,f=Math.max(i,r),_=Math.max(-1*Math.min(i,r),0);if(f>200)return-1/0;for(var d=_/(h?Math.max(t.frame.width,e.frame.width):Math.max(t.frame.height,e.frame.height)),p=f/Math.max(this.parentForma_.bounds.width,this.parentForma_.bounds.height),m=0,g=l.iter([t,e]);!g.done;g.next()){var R,C=g.value;(R=l.as(C,u.VisualNodeGroup))&&(R.layoutStrategy==u.GroupLayoutStrategy.VerticalFlow&&h&&(m+=1),R.layoutStrategy!=u.GroupLayoutStrategy.HorizontalFlow||h||(m+=1))}var T,P,E=h?A.TheoRect.ONE_BY_ONE.scaleXY(1e3,1):A.TheoRect.ONE_BY_ONE.scaleXY(1,1e3),S=.5*(1-E.similarity(t.frame))+.5*(1-E.similarity(e.frame));return(T=this.getBackgroundFrame(t))&&(P=this.getBackgroundFrame(e))&&(d=_/(h?Math.min(t.frame.width,e.frame.width):Math.min(t.frame.height,e.frame.height)),!T.equal(P)&&d<.9)?0:.5+(d+10*(1-p)+.1*m+.5*S)},getContainingGraphicNode:function(t,e){for(var n=l.iter(e);!n.done;n.next()){var o,i=n.value;if((o=l.as(i,u.VisualNodeLeaf))&&o.forma.isGraphic()&&o.frame.contains(t.frame))return o}return null},createBackgroundGroupNodes:function(t){for(var e=[],n=l.iter(t);!n.done;n.next()){var o=n.value,i=l.as(o,u.VisualNodeLeaf),r=l.as(o,u.VisualNodeGroup),a=this.getBackgroundFrame(o),s=null!=a&&a.equal(this.parentForma_.bounds);if(null!=i||null!=r&&r.filledGroup||!s){var c=o.parent,h=new u.VisualNodeGroup([o]);if(l.opt(c,(function(t){return t.addChildren([h])})),e.push(h),h.layoutStrategy=u.GroupLayoutStrategy.Default,null!=i){var f=u.VisualNodeData.init_ff0a(i,[i.forma]);h.inferenceData=f}else h.inferenceData=o.inferenceData;s||(h.frame=a,h.bgConstraint=!0)}else e.push(o)}return e=l.sort(e,(function(t,e){return t.frame.center.y<e.frame.center.y}))},mergeNodes:function(t){for(var e=this,n=l.clone(t),o=l.iter(n);!o.done;o.next()){var i=o.value;l.opt(i.inferenceData,(function(t){return t.setPairwiseDistanceTerms(l.clone(n))}))}for(var r=0,a=l.iter([!0,!1]);!a.done;a.next())for(var s=a.value,c=l.iter([!0,!1]);!c.done;c.next())for(var h=c.value;n.length>1||r>100;){r+=1;for(var f=0,_=null,d=l.iter(l.range(0,n.length,!1));!d.done;d.next())for(var p=d.value,m=l.sort(n,(function(t,e){return t.frame.L1Distance(n[p].frame)<e.frame.L1Distance(n[p].frame)})),g=l.iter(l.range(0,Math.min(5,m.length),!1));!g.done;g.next()){var R=g.value;if(n[p]!=m[R]){if(h){var C=this.getContainingGraphicNode(n[p],l.clone(t)),P=this.getContainingGraphicNode(m[R],l.clone(t));if(C==m[R]||P==n[p])continue;if(null!=C&&C!=P||null!=P&&C!=P)continue}var E=s?this.scoreVisualGroupMerge(n[p],m[R],l.clone(n)):this.scoreRegionMerge(n[p],m[R],l.clone(n));E>.5&&E>f&&(_={nodeA:n[p],nodeB:m[R]},f=E)}}if(null==_)break;var S=new u.VisualNodeGroup([_.nodeA,_.nodeB]);S.frame=l.opt(S.frame,(function(t){return t.intersectionWith(e.parentForma_.bounds)}));var N=-1*T.MathUtils.minDouble(_.nodeA.frame.maxX-_.nodeB.frame.minX,_.nodeB.frame.maxX-_.nodeA.frame.minX),M=-1*T.MathUtils.minDouble(_.nodeA.frame.maxY-_.nodeB.frame.minY,_.nodeB.frame.maxY-_.nodeA.frame.minY);S.layoutStrategy=N<0&&M>=0?u.GroupLayoutStrategy.VerticalFlow:M<0&&N>=0?u.GroupLayoutStrategy.HorizontalFlow:u.GroupLayoutStrategy.Default,S.bgConstraint=_.nodeA.bgConstraint&&_.nodeB.bgConstraint;var v,A,O=l.clone(l.opt(_.nodeA.inferenceData,(function(t){return t.alignments[_.nodeB.id]})));if(null!=O){var D=l.sort(O,(function(t,e){return t.offset.length()<e.offset.length()}));S.alignments.includes(D[0].line.type)||S.alignments.push(D[0].line.type)}if(S.spacing=_.nodeA.frame.L1Distance(_.nodeB.frame),(v=_.nodeA.inferenceData)&&(A=_.nodeB.inferenceData)){var I=u.VisualNodeData.init_b16c(S,v,A);S.inferenceData=I,s&&(S.spacing=l.opt(_.nodeA.inferenceData,(function(t){return t.nodeDistances[_.nodeB.id]})))}n.push(S),this.mergeWithParentIfPossible(_.nodeA,!1),this.mergeWithParentIfPossible(_.nodeB,!1),l.remove(n,_.nodeA),l.remove(n,_.nodeB);for(var y=l.iter(n);!y.done;y.next())i=y.value,l.opt(i.inferenceData,(function(t){return t.setPairwiseDistanceTerms(l.clone(n))}))}return n},getBackgroundFrame:function(t){if(!this.parentForma_.bounds.contains(t.frame))return null;var e,n=[];(e=l.as(t,u.VisualNodeGroup))?n=l.clone(e.leafDescendents):null!=(r=l.as(t,u.VisualNodeLeaf))&&(n=[r]);for(var o=null,i=l.iter(n);!i.done;i.next()){var r,a,s,c=(r=i.value).frame;(a=l.as(r.forma.controller,N.TypeLockupController))&&null!=(s=l.opt(a.lockupStyle,(function(t){return t.backing})))&&(s!=R.LockupBacking.BannerHorizontal&&s!=R.LockupBacking.BannerVertical&&s!=R.LockupBacking.Banner||(c=l.opt(l.as(r.forma,p.GroupForma),(function(t){return t.childrenFrame}))));var h,f=!1;if(h=c)for(var _=l.iter(this.bgFrames_);!_.done;_.next()){var d=_.value;d.contains(h)&&(f=!0,o=l.opt(o,(function(t){return t.unionWith(d)}))||d)}f||(o=this.parentForma_.bounds)}return o||this.parentForma_.bounds}}}),s)}}]);
//# sourceMappingURL=vendors_npm_spark_7c19032c-87ee08ba.js.map
(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[31],{"2Srg":function(e,t,n){var o,r=t,a=n("oAGj"),i=n("cmoc"),l=n("cYVN");r.ImageRoleData=(o=function(e,t,n){l.RoleData.call(this,e,a.clone(t),a.clone(n))},a.defineClass({name:"ImageRoleData",ctor:o,superName:"RoleData",statics:{getImageRoleData:function(e){return e instanceof i.FrameForma?new o(e,[],{}):null}}}),o)},"2wfq":function(e,t,n){n("oAGj")},"3v9D":function(e,t,n){var o,r,a,i,l=t,s=n("oAGj"),u=n("SpAV"),c=n("CaSj"),h=n("FNB+"),g=n("6ZWm"),p=n("tQF8"),d=n("TP4q"),f=n("v/sv"),y=n("bSZx"),m=n("4mVB"),T=n("iCxV"),S=n("Dq5S"),L=n("uxH+"),R=n("8t9B"),v=n("ThKb"),I=n("sIWg");l.LayoutSuggester=(o=function(){this.scoringWeights_=null,this.layoutTypeModel_=null,this.group_=null},s.defineClass({name:"LayoutSuggester",ctor:o,superName:"CoreObject",statics:{KIND:{get:function(){return"LayoutSuggester"}},createContentAwareSuggestions:function(e){var t;return(t=s.opt(s.as(e.controller,L.RootController),(function(e){return e.getGridController()})))?o.init_abc1(t.gridForma).createSuggestions(!0,!1,!1):[]}},props:{init_abc1:function(e,t){void 0===t&&(t=null);var n=s.clone(e.filterWithCallback((function(e){return e.isBackgroundImage()}),h.FormaTraversal.JustChildren)),o=s.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),h.FormaTraversal.JustChildren));this.layoutItems_=n.map((function(e){return[S.LayoutItem.init_b14a(e)]}),this),this.imageCount_=this.layoutItems_.length;var r=o.map((function(e){return S.LayoutItem.init_b14a(e)}),this);this.layoutItems_.push(s.clone(r)),this.floatingCount_=r.length,u.CoreAssert.isTrue(null!=e.parent,void 0,"LayoutSuggester.init","LayoutSuggester.swift",40),this.scoringWeights_=s.clone(t),this.gridFrame_=e.frame,this.group_=e},init_cb42:function(e,t){void 0===t&&(t=null),this.layoutItems_=[];for(var n=[],o=s.iter(e.layoutItems);!o.done;o.next()){var r=o.value;r.type==S.ItemContentType.Image&&this.layoutItems_.push([r]),r.type==S.ItemContentType.Floating&&n.push(r)}this.imageCount_=this.layoutItems_.length,this.floatingCount_=n.length,this.layoutItems_.push(s.clone(n)),this.scoringWeights_=s.clone(t),this.gridFrame_=e.gridFrame},layoutTypeModel:{get:function(){return this.layoutTypeModel_},set:function(e){this.layoutTypeModel_=e}},createSuggestions:function(e,t,n,o,r){if(void 0===e&&(e=!0),void 0===t&&(t=!1),void 0===n&&(n=!0),void 0===o&&(o=!1),void 0===r&&(r=1),this.imageCount_<1)return[];var a=[];return e&&s.append(a,this.createContentAwareSuggestions(n,r,o)),t&&s.append(a,this.createFixedGridSuggestions(n,r)),s.sortInPlace(a,(function(e,t){return e.score>t.score})),a},createEqualSizeSuggestions:function(e,t){return void 0===e&&(e=!0),void 0===t&&(t=1),this.imageCount_<1?[]:this.getEqualSizeGridSuggestions(e,t)},createFixedGridSuggestions:function(e,t){void 0===t&&(t=1);var n=this;if(this.imageCount_<1)return[];for(var o=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),r=o.length,a=s.clone(c.DesignSuggester.getPermutations(r,350)),i=null,l=-1e6,u=s.toArray(s.range(1,r,!0)).map((function(e){return n.getFixedGrids(r,e,!1)}),this),h=s.toArray(s.range(1,r,!0)).map((function(e){return n.getFixedGrids(r,e,!0)}),this),g=s.iter(a);!g.done;g.next()){var p=g.value.map((function(e){return o[e]}),this),d=this.fillFixedGrids(r,[u,h],s.clone(p));d.score>l&&(i=d.suggestion,l=d.score)}return[i]},getEqualSizeGridSuggestions:function(e,t){void 0===t&&(t=1);for(var n=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),o=n.length,r=[],a=s.iter(s.range(1,o,!0));!a.done;a.next()){var i=a.value,l=i;if(o%i==0){var u=s.toInt(o/i),h=s.clone(this.getGrids(l,u)),g=s.clone(c.DesignSuggester.getPermutations(o,1))[0].map((function(e){return n[e]}),this),p=g.map((function(e){return e[0]}),this),f=this.createGridStyle(s.clone(h),s.clone(g),"equal_size_layout_"+l+"_"+u),m=new d.GridScore(f,this.gridFrame_,s.clone(p),null,!1,s.clone(this.scoringWeights_)),T=new y.GridSuggestion(void 0,f,m);r.push(T)}}return s.sortInPlace(r,(function(e,t){return e.score>t.score})),r.slice(0,Math.min(r.length,t))},getGrids:function(e,t){for(var n=1/s.toDouble(e),o=1/s.toDouble(t),r=[],a=s.iter(s.range(0,e,!1));!a.done;a.next())for(var i=a.value,l=s.iter(s.range(0,t,!1));!l.done;l.next()){var u=l.value,c=s.toDouble(i)*n,h=s.toDouble(u)*o,g=s.toDouble(i+1)*n,d=s.toDouble(u+1)*o;r.push(new p.GridCell(new I.TheoRect(c,h,g,d)))}return r},createContentAwareSuggestions:function(e,t,n){if(void 0===t&&(t=1),void 0===n&&(n=!1),this.imageCount_<1)return[];for(var o=s.clone(e&&this.floatingCount_>=1?this.layoutItems_:this.layoutItems_.slice(0,this.imageCount_)),r=o.length,a=this.gridFrame_.aspectRatio,i=[],l=Math.max(200-25*r,25),u=s.clone(c.DesignSuggester.getPermutations(r,l)),h=[],g=[],p=[],d=[],f=[],y=[],m=s.iter(s.toSequence(u));!m.done;m.next()){var T=m.value,S=T.offset,L=T.element.map((function(e){return o[e]}),this),R=this.generateContentAwareGrids(r,s.clone(L),a,n);s.append(h,R.heights),s.append(g,R.widths),s.append(p,R.scores),s.append(d,R.orders),s.append(f,R.flipDimensions);for(var v=s.iter(s.range(0,R.scores.length,!1));!v.done;v.next())y.push(S)}for(var I=s.sort(p),A=0;i.length<t&&A<I.length;){for(var F=I[I.length-1-A],_=s.indexOf(p,F),C=s.clone(u[y[_]]).map((function(e){return o[e]}),this),x=s.clone(h[_]),b=s.clone(d[_]),D=s.clone(g[_]),M=f[_],E=x.map((function(e){return 1/e}),this),N=this.buildBestContentAwareGrid(s.clone(C),s.clone(D),a,s.clone(b),M,s.clone(E),n),k=1,w=s.iter(i);!w.done;w.next()){var G=w.value;if((k=Math.min(k,G.gridStyle.similarity(N.gridStyle)))<.05)break}k>.05&&i.push(N),A+=1}return i},createGridStyle:function(e,t,n){var o=m.GridStyle.init_bf40(n,void 0,s.clone(e)),r=s.clone(this.getGridCellFormaMapping(s.clone(e),s.clone(t)));return o.forma=this.group_,o.setFormaMapping(s.clone(r)),o},getGridCellFormaMapping:function(e,t){for(var n={},o=s.iter(s.toSequence(t));!o.done;o.next())for(var r=o.value,a=r.offset,i=r.element,l=s.iter(i);!l.done;l.next())n[l.value.id]=e[a];return n},fillFixedGrids:function(e,t,n){for(var o=null,r=-1e6,a=n.map((function(e){return e[0]}),this),i=s.iter(s.stride(0,e,1));!i.done;i.next())for(var l=i.value,u=s.iter(t);!u.done;u.next())for(var c=u.value,h=s.iter(c[l]);!h.done;h.next()){var g=h.value,p=this.createGridStyle(s.clone(g),s.clone(n),"Test Layout"),f=new d.GridScore(p,this.gridFrame_,s.clone(a),null,!1,s.clone(this.scoringWeights_)),m=f.score;m>r&&(o=new y.GridSuggestion(void 0,p,f),r=m)}return{score:r,suggestion:o}},generateContentAwareGrids:function(e,t,n,o){for(var r=[],a=[],i=[],l=[],u=[],c=s.iter([!1,!0]);!c.done;c.next())for(var h=c.value,g=s.iter(s.stride(1,Math.min(6,e+1),1));!g.done;g.next()){for(var p=g.value,f=s.toArray(s.range(1,p,!0)).map((function(e){return s.toDouble(e)/s.toDouble(p)}),this),y=this.buildCellArray(s.clone(f),s.clone(t),h?1/n:n,void 0,h,void 0,o),m=s.clone(y.heights),T=s.clone(y.order),S=[],L=s.repeat(0,p),R=0;R<10;){var v=s.toArray(s.range(0,p,!1)).map((function(e){return 1/(s.toDouble(p)*s.toDouble(m[e]))+L[e]}),this),I=1/v.reduce((function(e,t){return e+t}),0);S=v.map((function(e){return e*I}),this);for(var A=!1,F=s.iter(s.range(0,S.length,!1));!F.done;F.next()){var _=F.value;S[_]<.1&&(L[_]+=.1,A=!0)}for(var C=0,x=s.iter(s.range(0,S.length,!1));!x.done;x.next()){var b=x.value;S[b]+=C,C=S[b]}if(S[S.length-1]=1,!A)break;R+=1}for(var D=this.buildCellArray(s.clone(S),s.clone(t),h?1/n:n,s.clone(T),h,void 0,o),M=s.clone(D.heights),E=M.map((function(e){return 1/e}),this),N=this.buildCellArray(s.clone(S),s.clone(t),h?1/n:n,s.clone(T),h,s.clone(E),o),k=[],w=s.iter(t);!w.done;w.next()){var G=w.value;s.append(k,G)}var P=s.clone(this.getGridCellFormaMapping(s.clone(N.cells),s.clone(t))),O=new d.GridScore(void 0,this.gridFrame_,s.clone(k),null,!0,s.clone(this.scoringWeights_),s.clone(P),s.clone(N.cells));a.push(s.clone(S)),r.push(s.clone(M)),i.push(O.score),l.push(s.clone(T)),u.push(h)}var H=s.sort(i);return{widths:a,heights:r,orders:l,scores:i,flipDimensions:u,maxScore:H[H.length-1]}},buildBestContentAwareGrid:function(e,t,n,o,r,a,i){var l=this.buildCellArray(s.clone(t),s.clone(e),r?1/n:n,s.clone(o),r,s.clone(a),i),u=s.clone(l.cells),c=s.clone(this.snapBounds(s.clone(u),this.gridFrame_.size,r)),h=this.createGridStyle(s.clone(c),s.clone(e),m.GridStyle.BALANCED_LAYOUT_NAME);h.cropType=i?g.CropType.FillFocus:g.CropType.FitBorder;for(var p=[],f=s.iter(e);!f.done;f.next()){var T=f.value;s.append(p,T)}var S=new d.GridScore(h,this.gridFrame_,s.clone(p),null,!0,s.clone(this.scoringWeights_));return new y.GridSuggestion(this.group_,h,S)},buildCellArray:function(e,t,n,o,r,a,i){var l,u,c;void 0===o&&(o=null),void 0===r&&(r=!1),void 0===a&&(a=null),void 0===i&&(i=!1);var h=null;null==o&&(h=[]);for(var g,d=s.repeat(0,e.length),f=[],y=0,m=s.iter(s.toSequence(t));!m.done;m.next()){var T=m.value,L=T.offset,R=T.element;if(null==o){var v=s.sort(d);g=s.indexOf(d,v[0]),h.push(g)}else g=o[L];var A,F,_=e[g];if(y=0==g?0:e[g-1],1==R.length&&R[0].type==S.ItemContentType.Image){var C=i&&null!=R[0].focusRegion?R[0].focusRegion.width:(l=R[0].width)||null!=l?l:1,x=i&&null!=R[0].focusRegion?R[0].focusRegion.height:(u=R[0].height)||null!=u?u:1;A=1/(r?s.toDouble(x)/s.toDouble(C):s.toDouble(C)/s.toDouble(x))*(_-y)*n}else{var b,D;if(null!=(b=s.opt(s.opt(s.opt(R[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.width})))&&null!=(D=s.opt(s.opt(s.opt(R[0].forma,(function(e){return e.parent})),(function(e){return e.bounds})),(function(e){return e.height})))){for(var M=0,E=s.iter(R);!E.done;E.next()){var N=E.value;M+=(c=s.opt(N.textInfo,(function(e){return e.textLength})))||null!=c?c:0}(A=this.getTextCellHeight(R.length,s.toDouble(M),y*b,_*b,b,D)/D)<.15&&(A=.15)}else A=(_-y)*n}null!=(F=s.opt(a,(function(e){return e[g]})))&&1-(A*=F)<.001&&(A=1);var k=null;k=r?new p.GridCell(new I.TheoRect(d[g],y,A+d[g],_)):new p.GridCell(new I.TheoRect(y,d[g],_,A+d[g])),f.push(k),d[g]=A+d[g]}return{cells:f,heights:d,order:null==h?o:h}},snapBounds:function(e,t,n,o){void 0===o&&(o=60);var r=e.map((function(e){return e.clone()}),this),a=[];e.forEach((function(e){return a.push(e)}));var i=[];if(n)for(var l=s.iter(s.range(0,a.length,!1));!l.done;l.next()){g=l.value,p=a[g],i.push(p);var u=p.bounds.maxX;if(u<1)for(var c=s.iter(s.range(g+1,a.length,!1));!c.done;c.next())if(m=c.value,T=(y=e[g]).bounds,Math.abs(y.bounds.maxX-u)*t.width<o&&1!=y.bounds.maxX&&y.bounds.maxX!=u&&(y=y.copyTo(new I.TheoRect(T.minX,T.minY,u,T.maxY)),a[m]=y),Math.abs(y.bounds.minX-u)*t.width<o&&0!=y.bounds.minX&&y.bounds.minX!=u&&(y=y.copyTo(new I.TheoRect(u,T.minY,T.maxX,T.maxY)),a[m]=y),y.bounds.width<.05)return r}else for(var h=s.iter(s.range(0,a.length,!1));!h.done;h.next()){var g=h.value,p=a[g];i.push(p);var d=p.bounds.maxY;if(d<1)for(var f=s.iter(s.range(g+1,a.length,!1));!f.done;f.next()){var y,m=f.value,T=(y=a[m]).bounds;if(Math.abs(y.bounds.maxY-d)*t.height<o&&1!=y.bounds.maxY&&y.bounds.maxY!=d&&(y=y.copyTo(new I.TheoRect(T.minX,T.minY,T.maxX,d)),a[m]=y),Math.abs(y.bounds.minY-d)*t.height<o&&0!=y.bounds.minY&&y.bounds.minY!=d&&(y=y.copyTo(new I.TheoRect(T.minX,d,T.maxX,T.maxY)),a[m]=y),y.bounds.height<.05)return r}}return i},getTextCellHeight:function(e,t,n,o,r,a){var i=.13358679,l=-.0261477,u=-.11470111,c=.03862264,h=-.02888805,g=.00561106,p=.03671017,d=.13522773,f=-.0499348,y=.02618676,m=1043.48108,T=3.14978552,S=1.15001079,L=167.10292,R=.639915899,v=.0844010175,I=.0901829377,A=.517425544,F=.44141582,_=78.7709665,C=248.39949567,x=2.99889961,b=1.20115851,D=260.27180508,M=.48002452,E=.27798828,N=.28644367,k=.49969626,w=.49655603,G=117.5756354,P=s.toDouble(this.floatingCount_),O=n,H=o,Y=.6568033208493654;return Y+=(a-m)/C*i,Y+=(P-T)/x*l,Y+=(s.toDouble(this.imageCount_)-S)/b*u,Y+=(O-L)/D*c,Y+=((1==e?1:0)-R)/M*h,Y+=((3==e?1:0)-v)/E*g,Y+=((e>3?1:0)-I)/N*p,Y+=(s.toDouble(e)/P-A)/k*d,Y+=((H-O)/r-F)/w*f,Y+=(t-_)/G*y,Y*=1e3},getFixedGrids:function(e,t,n){if(t>e)return[];for(var o=s.toArray(s.range(0,t,!0)).map((function(e){return s.toDouble(e+1)/s.toDouble(t)}),this),r=[s.repeat(1,t)],a=s.iter(s.range(t,e,!1));!a.done;a.next()){for(var i=[],l=s.iter(r);!l.done;l.next())for(var u=l.value,c=s.iter(s.range(0,t,!1));!c.done;c.next()){var h=c.value,g=u.concat();g[h]+=1,i.push(s.clone(g))}r=s.clone(i)}s.shuffleInPlace(r),r=s.clone(r.slice(0,Math.min(350,r.length)));for(var d=[],f=s.iter(r);!f.done;f.next()){for(var y=f.value,m=[],T=s.iter(s.toSequence(y));!T.done;T.next())for(var S=T.value,L=S.offset,R=S.element,v=0==L?0:o[L-1],A=o[L],F=0,_=s.iter(s.stride(1,s.toDouble(R+1),1));!_.done;_.next()){var C=_.value;n?m.push(new p.GridCell(new I.TheoRect(F,v,C/s.toDouble(R),A))):m.push(new p.GridCell(new I.TheoRect(v,F,A,C/s.toDouble(R)))),F=C/s.toDouble(R)}d.push(s.clone(m))}return d},createLayoutIdFeatures:function(e,t,n,o,r){var a=1==o?1:0,i=2==o?1:0,l=3==o?1:0,u=o>3?1:0,c=1==n?1:0,h=2==n?1:0,g=3==n?1:0,p=n>3?1:0,d=Math.atan2(t,e),f=e*t,y=0,m=0,T=0;if(r.length>0){y=r.reduce((function(e,t){return e+t}),0)/s.toDouble(r.length);var S=s.sort(r);T=S[S.length-1],m=S[0]}var L=[e,t,s.toDouble(n),s.toDouble(o),a,i,l,u,c,h,g,p,y,m,T,f,d];return new v.TheoMatrix([L])},predictLayoutIds:function(e,t){var n=s.opt(this.group_,(function(e){return e.root}));if(this.layoutTypeModel_=s.opt(n,(function(e){return e.page.layoutLibrary.layoutSuggestionModel})),null==n||null==this.layoutTypeModel_)return[];for(var o=n.filterWithCallback((function(e){return e.isBackgroundImage()})).length,r=s.clone(n.filterWithCallback((function(e){return e.isTypeLockup()}))),a=[],i=s.iter(r);!i.done;i.next()){var l,u=i.value;(l=s.as(u.controller,R.TypeLockupController))&&a.push(s.toDouble(l.text.length))}for(var c=n.page.pageSize.width,h=n.page.pageSize.height,g=Math.atan2(h,c),p=this.createLayoutIdFeatures(c,h,r.length,o,s.clone(a)),d=this.layoutTypeModel_.featureScalingMean,y=this.layoutTypeModel_.featureScalingStd,m=s.clone(this.layoutTypeModel_.layoutIDs),S=p.subtract(d).divide(y),L=s.repeat(0,this.layoutTypeModel_.models[0].intercepts.asFlatArray.length),v=s.iter(this.layoutTypeModel_.models);!v.done;v.next()){var I=v.value;if(I.minAngle<g&&g<=I.maxAngle){var A=S.matrixMultiply(I.coefficients.transpose()).sumDim(0);L=s.clone(I.intercepts.add(A).asFlatArray)}}if(L.length!=m.length)return s.opt(T.Host.logging,(function(e){return e.error("model scores don't match class labels")})),[];for(var F=s.sort(L,(function(e,t){return e>t})),_=[],C=s.clone(n.page.layoutLibrary.getAllGrids()),x=!1,b=!1,D=s.iter(s.range(0,m.length,!1));!D.done;D.next()){var M=D.value;if(_.length>=e)break;for(var E=m[s.indexOf(L,F[M])],N=s.iter(C);!N.done;N.next()){var k=N.value;if(k.name==E){var w=k.nonOverlappingCells().length;if(w>=o){if(w==o){if(x)continue;x=!0}if(2==w){if(b)continue;b=!0}var G=k;if(k.gridCells.length<=3){var P=k.flipRegion(),O=s.clone(new f.GridSuggester(this.group_,k).createSuggestions()),H=s.clone(new f.GridSuggester(this.group_,P).createSuggestions());O.length>0&&H.length>0&&(G=O[0].score>H[0].score?k:P)}for(var Y=!1,B=s.iter(t);!B.done;B.next())if(B.value.similarity(G)<.02){Y=!0;break}Y||_.includes(G.name)||_.push(G.name)}}}}return _}}}),o),l.GridDocument=(r=function(){},s.defineClass({name:"GridDocument",ctor:r,props:{init_d4b4:function(e,t,n,o,r,a){this.docID=e,this.userID=t,this.database=n,this.gridFrame=o,this.gridStyle=r,this.layoutItems=s.clone(a)},init_implicit:function(e,t,n,o,r,a){this.gridFrame=e,this.gridStyle=t,this.layoutItems=s.clone(n),this.docID=o,this.userID=r,this.database=a},clone:function(){return r.init_implicit(this.gridFrame,this.gridStyle,this.layoutItems,this.docID,this.userID,this.database)}}}),r),l.RangedLayoutLinearModel=(a=function(e,t,n,o){this.minAngle=e,this.maxAngle=t,this.coefficients=n,this.intercepts=o},s.defineClass({name:"RangedLayoutLinearModel",ctor:a,props:{clone:function(){return new a(this.minAngle,this.maxAngle,this.coefficients,this.intercepts)}}}),a),l.LayoutSuggestionsLinearModel=(i=function(e,t,n,o){this.featureScalingMean=e,this.featureScalingStd=t,this.layoutIDs=s.clone(n),this.models=s.clone(o)},s.defineClass({name:"LayoutSuggestionsLinearModel",ctor:i,superName:"CoreObject"}),i)},"6vbT":function(e,t,n){n("oAGj")},"7Ta2":function(e,t,n){var o,r,a,i=t,l=n("oAGj"),s=n("SpAV"),u=n("gXiO"),c=n("6ZWm"),h=n("iCxV"),g=n("2Srg"),p=n("ws+m"),d=n("xRbc"),f=n("zbwF"),y=n("nrTo"),m=n("JO5d"),T=n("ERpL"),S=n("lYNH"),L=n("8t9B");i.RoleSuggesterProtocol=l.defineProtocol("RoleSuggesterProtocol",{getRole:"(RoleData) -> InferredRole"}),i.RoleSuggester=(o=function(){u.CoreObject.call(this)},r={},l.defineClass({name:"RoleSuggester",ctor:o,superName:"CoreObject",statics:{cache:{get:function(){var e;return void 0===r.cache&&(r.cache=((e=l.opt(h.Host.platform,(function(e){return e.isService})))||null!=e)&&e?l.opt(h.Host.learning,(function(e){return e.getHostPredictionCache()})):new y.PredictionCacheInferredRole),r.cache},set:function(e){r.cache=e}},ROLE_SHORT_LABELS:{Undefined:"udf",Title:"ttl",Subtitle:"stl",BodyText:"bdy",ContactInfo:"ctc",SocialMediaReference:"soc",Quote:"qot",CalltoAction:"act",GraphicContent:"gct",Seperator:"sep",Backing:"bkg",Background:"bgd",Decoration:"dec",Logo:"log"},getShortLabel:function(e){var t;return null!=(t=o.ROLE_SHORT_LABELS[e])?t:(s.CoreAssert.fail("didn't find role in short label dictionary!","RoleSuggester.getShortLabel","RoleSuggester.swift",120),"???")}},props:{getRole:function(e){var t,n,r,a,s,u,y=null,R=null;if(l.as(e.controller,L.TypeLockupController)&&(n=d.LockupRoleData.getLockupRoleData(e))&&(y=n,R=f.LockupRoleSuggesterFactory.Create("MLP"),l.clone(R.getRole(n)).role==i.InferredRoleType.Undefined&&(R=f.LockupRoleSuggesterFactory.Create())),e.controller instanceof m.ShapeController&&(r=T.ShapeRoleData.getShapeRoleData(e))&&(y=r,R=e.isGridCell()?S.ShapeRoleSuggesterFactory.Create("Simple"):S.ShapeRoleSuggesterFactory.Create("MLP")),l.as(e.controller,c.FrameController)&&(a=g.ImageRoleData.getImageRoleData(e))&&(y=a,R=p.ImageRoleSuggesterFactory.Create("Simple")),(s=y)&&(u=R)){var v=s.getUniqueKey();return((t=l.opt(h.Host.platform,(function(e){return e.isService})))||null!=t)&&t||o.cache.cleanup(e.page.document.uuid),null==o.cache.getCacheValue(v)&&o.cache.setCacheValue(v,l.clone(this.getRoleForData(s,u))),o.cache.getCacheValue(v)}return i.InferredRole.init_84d1()},getRoleForData:function(e,t){var n=l.clone(t.getRole(e));return s.CoreAssert.isTrue(null!=o.ROLE_SHORT_LABELS[n.role],void 0,"RoleSuggester.getRoleForData","RoleSuggester.swift",92),s.CoreAssert.isTrue(null!=o.ROLE_SHORT_LABELS[n.secondaryRole],void 0,"RoleSuggester.getRoleForData","RoleSuggester.swift",93),n}}}),o),i.InferredRoleType=l.defineEnum("InferredRoleType",{Undefined:"Undefined",Title:"Title",SubTitle:"Subtitle",Body:"BodyText",Contact:"ContactInfo",Social:"SocialMediaReference",Quote:"Quote",Action:"CalltoAction",GraphicContent:"GraphicContent",Seperator:"Seperator",Backing:"Backing",Background:"Background",Decoration:"Decoration",Logo:"Logo"}),i.InferredRole=(a=function(){},l.defineClass({name:"InferredRole",ctor:a,props:{init_84d1:function(e,t,n,o){void 0===e&&(e=i.InferredRoleType.Undefined),void 0===t&&(t=0),void 0===n&&(n=i.InferredRoleType.Undefined),void 0===o&&(o=0),this.role=e,this.confidence=t,this.secondaryRole=n,this.secondaryConfidence=o},init_implicit:function(e,t,n,o){this.role=e,this.confidence=t,this.secondaryRole=n,this.secondaryConfidence=o},clone:function(){return a.init_implicit(this.role,this.confidence,this.secondaryRole,this.secondaryConfidence)}}}),a)},"7l9C":function(e,t,n){var o,r,a,i,l,s,u=t,c=n("oAGj"),h=n("SpAV"),g=n("gXiO"),p=n("tGKA"),d=n("3DEm"),f=n("ol4x"),y=n("oKlP"),m=n("sIWg");u.AlignmentIdiom=c.defineEnum("AlignmentIdiom",{LRBB:0,LLtb:1,LLbt:2,RRtb:3,RRbt:4,CCtb:5,CCbt:6,LRtb:7,LRbt:8,RLtb:9,LRtt:10,RLtt:11,LRbb:12,RLbb:13,LRmm:14,cCCtb:15,LRctt:16,LRcbb:17,LLtbo:18,RRtbo:19,LLbto:20,LRott:21}),u.GlyphType=c.defineEnum("GlyphType",{GENERIC:0,DROPCAP:1,PUNCTUATION:2,SYMBOL:3}),u.NodeMeasurements=(o=function(e,t,n,o,r){this.node=e,this.minY=t,this.maxY=n,this.topBaseLine=o,this.bottomBaseLine=r},c.defineClass({name:"NodeMeasurements",ctor:o}),o),u.TypographyNode=(r=function(){this.parent=null,this.globalMat=p.Matrix2D.Identity,this.transMat=p.Matrix2D.Identity,this.scaleMat=p.Matrix2D.Identity,this.rotateMat=p.Matrix2D.Identity,this.rotateAlign=0,this.scaleAlign=1,g.CoreObject.call(this)},c.defineClass({name:"TypographyNode",ctor:r,superName:"CoreObject",props:{isSame:function(e){return this.getId()==e.getId()},getRoot:function(){for(var e=this;null!=e.parent;)e=e.parent;return e},getWeight:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getWeight","TypographyNode.swift",94),null},transformToLocalBounds:function(e){var t=this.local(),n=t.transformPoint(new y.TheoPoint(e.minX,e.minY)),o=t.transformPoint(new y.TheoPoint(e.maxX,e.minY)),r=t.transformPoint(new y.TheoPoint(e.maxX,e.maxY)),a=t.transformPoint(new y.TheoPoint(e.minX,e.maxY)),i=d.MathUtils.minDouble(d.MathUtils.minDouble(d.MathUtils.minDouble(n.x,o.x),r.x),a.x),l=d.MathUtils.maxDouble(d.MathUtils.maxDouble(d.MathUtils.maxDouble(n.x,o.x),r.x),a.x),s=d.MathUtils.minDouble(d.MathUtils.minDouble(d.MathUtils.minDouble(n.y,o.y),r.y),a.y),u=d.MathUtils.maxDouble(d.MathUtils.maxDouble(d.MathUtils.maxDouble(n.y,o.y),r.y),a.y);return new m.TheoRect(i,s,l,u)},transformTo:function(e,t){for(var n=t,o=this.parent;null!=o&&o.getId()!=e.getId();)n=o.transformToLocalBounds(n),o=o.parent;return e.getId()!=this.getId()&&(n=e.transformToLocalBounds(n)),n},translateXY:function(e,t){this.transMat=this.transMat.translate(new y.TheoPoint(e,t))},rotateTo:function(e){var t=e*Math.PI/180;this.rotateMat=p.Matrix2D.Identity.rotateTo(Math.cos(t),Math.sin(t))},scaleXY:function(e){this.scaleMat=p.Matrix2D.Identity.scaleXY(e,e)},local:function(){return this.scaleMat.concat(this.rotateMat).concat(this.transMat)},global:function(){return this.globalMat},isRotated:function(){return 0!=this.rotateAlign},getId:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getId","TypographyNode.swift",169),null},localbounds:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.localbounds","TypographyNode.swift",174),null},getHSpace:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getHSpace","TypographyNode.swift",179),null},getAscent:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getAscent","TypographyNode.swift",194),null},getDescent:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getDescent","TypographyNode.swift",199),null},getLeading:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getLeading","TypographyNode.swift",204),null},getBaseline:function(e){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getBaseline","TypographyNode.swift",209),null},getMidline:function(){return this.localbounds().height/2},getSemanticWidth:function(){return h.CoreAssert.fail("Calling an abstreact method.","TypographyNode.getSemanticWidth","TypographyNode.swift",218),null},getRightmostTextNode:function(){return null},getLeftmostTextNode:function(){return null},depthFirstSearch:function(e){},calcTransform:function(){0!=this.rotateAlign&&this.rotateTo(this.rotateAlign),1!=this.scaleAlign&&this.scaleXY(this.scaleAlign)},getConcatScale:function(){return this.scaleAlign},getTextNodes:function(){return[]},childrenAreVertAligned:function(){return!1},getText:function(){return""},description:{get:function(){var e="  ",t="";if(null==this.parent)t="ROOT:";else{for(var n=this.parent;null!=n;)n=n.parent,e+="  ";t+=e,this.isSame(this.parent.leftChild)?t+="LEFT:":t+="RIGHT:"}this instanceof u.SpacerNode?t+="SpacerNode ":this instanceof u.TextNode?t+="TextNode ":t+="GroupNode ",t+="id ="+this.getId()+" < "+this.getText()+" > ";var o=this.localbounds();return t+=c.toString(" bounds:[x:%.2f",o.minX)+c.toString(" y:%.2f",o.minY)+c.toString(" w:%.2f",o.width)+c.toString(" h:%.2f]",o.height)+c.toString(" | scale:%.2f",this.scaleAlign)+c.toString(" | rotate:%.2f",this.rotateAlign),t+=c.toString(" | leading:%.2f",this.getLeading())+c.toString(" | baseline:[t:%.2f",this.getBaseline(!1))+c.toString(" b:%.2f]",this.getBaseline(!0))+"\r\n"}}}}),r),u.TextToken=(a=function(e,t,n,o,r,a,i,l,s,c){this.text=e,this.bounds=n,this.midline=o,this.hspace=r,this.ascent=a,this.descent=i,this.leading=l,this.preVertOffset=s,this.postVertOffset=c,this.weight=t,this.range=null,this.range=null,this.subTokens=null,this.type=u.GlyphType.GENERIC},c.defineClass({name:"TextToken",ctor:a,statics:{symbols:["$","£","€","¥","¢","%"],punctuation:["!","?",'"',"'","“","”","‘","’"],getGlyphType:function(e){return a.symbols.includes(e)?u.GlyphType.SYMBOL:a.punctuation.includes(e)?u.GlyphType.PUNCTUATION:u.GlyphType.GENERIC}}}),a),u.SpacerNode=(i=function(e,t){this.id_=e,this.size_=t,u.TypographyNode.call(this)},c.defineClass({name:"SpacerNode",ctor:i,superName:"TypographyNode",props:{getId:function(){return".S"+c.toString(this.id_)},getWeight:function(){return 0},localbounds:function(){return this.transformToLocalBounds(new m.TheoRect(0,0,this.size_.width,this.size_.height))},getHSpace:function(){return 0},getAscent:function(){return 0},getDescent:function(){return 0},getLeading:function(){return 0},getBaseline:function(e){return this.localbounds().height},getSemanticWidth:function(){return this.localbounds().width/2},getVerticalOffset:function(){return 0}}}),i),u.TextNode=(l=function(e,t){this.token_=e,this.id_=t,u.TypographyNode.call(this)},c.defineClass({name:"TextNode",ctor:l,superName:"TypographyNode",props:{getId:function(){return"."+c.toString(this.id_)},setToken:function(e){this.token_=e},getWeight:function(){return this.token_.weight},localbounds:function(){return this.transformToLocalBounds(this.token_.bounds)},globalbounds:function(){var e=this.global(),t=this.token_.bounds,n=e.transformPoint(new y.TheoPoint(t.minX,t.minY)),o=e.transformPoint(new y.TheoPoint(t.maxX,t.minY)),r=e.transformPoint(new y.TheoPoint(t.maxX,t.maxY)),a=e.transformPoint(new y.TheoPoint(t.minX,t.maxY)),i=d.MathUtils.minDouble(d.MathUtils.minDouble(d.MathUtils.minDouble(n.x,o.x),r.x),a.x),l=d.MathUtils.maxDouble(d.MathUtils.maxDouble(d.MathUtils.maxDouble(n.x,o.x),r.x),a.x),s=d.MathUtils.minDouble(d.MathUtils.minDouble(d.MathUtils.minDouble(n.y,o.y),r.y),a.y),u=d.MathUtils.maxDouble(d.MathUtils.maxDouble(d.MathUtils.maxDouble(n.y,o.y),r.y),a.y);return new m.TheoRect(i,s,l,u)},getHSpace:function(){return this.token_.hspace*this.scaleMat.a},getAscent:function(){return this.token_.ascent*this.scaleMat.d},getDescent:function(){return this.token_.descent*this.scaleMat.d},getLeading:function(){return this.token_.leading*this.scaleMat.d},getBaseline:function(e){return this.isRotated()?this.localbounds().height:this.token_.ascent*this.scaleMat.d},getMidline:function(){return this.isRotated()?u.TypographyNode.prototype.getMidline.call(this):this.token_.midline*this.scaleMat.d},getSemanticWidth:function(){return this.localbounds().width/2},getVerticalOffset:function(){return this.token_.preVertOffset},getRightmostTextNode:function(){return this},getLeftmostTextNode:function(){return this},depthFirstSearch:function(e){e.push(this)},getTextNodes:function(){return[this]},getText:function(){return this.token_.text}}}),l),u.GroupNode=(s=function(e,t){this.leftChild=e,this.rightChild=t,this.transAlign=u.AlignmentIdiom.LRBB,this.leadingAdjustment=0,u.TypographyNode.call(this),e.parent=this,t.parent=this},c.defineClass({name:"GroupNode",ctor:s,superName:"TypographyNode",props:{getId:function(){return this.leftChild.getId()+this.rightChild.getId()},getWeight:function(){var e=this.leftChild.getWeight();return e==this.rightChild.getWeight()?e:-1},localbounds:function(){var e=this.leftChild.localbounds(),t=new m.TheoRect(e.minX,e.minY,e.maxX,e.maxY);e=this.rightChild.localbounds();var n=new m.TheoRect(e.minX,e.minY,e.maxX,e.maxY);return this.transformToLocalBounds(new m.TheoRect(d.MathUtils.minDouble(t.minX,n.minX),d.MathUtils.minDouble(t.minY,n.minY),d.MathUtils.maxDouble(t.maxX,n.maxX),d.MathUtils.maxDouble(t.maxY,n.maxY)))},getHSpace:function(){return this.scaleMat.a*d.MathUtils.maxDouble(this.leftChild.getHSpace(),this.rightChild.getHSpace())},getLeading:function(){var e;switch(this.transAlign){case 1:case 3:case 5:case 7:case 15:e=this.rightChild.getLeading();break;case 2:case 4:case 6:case 8:e=this.leftChild.getLeading();break;default:e=d.MathUtils.maxDouble(this.leftChild.getLeading(),this.rightChild.getLeading())}return this.scaleMat.d*e},getInternalHSpace:function(){return d.MathUtils.minDouble(this.leftChild.getHSpace(),this.rightChild.getHSpace())},getConcatScale:function(){for(var e=this.scaleAlign,t=c.clone(this.getTextNodes()),n=c.iter(t);!n.done;n.next()){for(var o=n.value,r=o.parent,a=o.scaleAlign;r.getId()!=this.getId();)a*=r.scaleAlign,r=r.parent;a>e&&(e=a)}return e},getInternalVSpace:function(){return this.leadingAdjustment},getBaseline:function(e){if(this.isRotated())return this.localbounds().height;var t=this.leftChild.localbounds(),n=this.transformToLocalBounds(new m.TheoRect(t.minX,t.minY,t.maxX,t.minY+this.leftChild.getBaseline(e)));t=this.rightChild.localbounds();var o=this.transformToLocalBounds(new m.TheoRect(t.minX,t.minY,t.maxX,t.minY+this.rightChild.getBaseline(e)));return t=this.localbounds(),(e?d.MathUtils.maxDouble(n.maxY,o.maxY):d.MathUtils.minDouble(n.maxY,o.maxY))-t.minY},getSemanticWidth:function(){if(this.getWeight()<0){for(var e=this.rightChild;e.getWeight()<0;)e=e.rightChild;for(var t=(e=e.parent.leftChild).localbounds();!e.isSame(this);)t=(e=e.parent).transformToLocalBounds(t);return t.width}return this.localbounds().width/2},getMidline:function(){return this.isRotated()||this.transAlign!=u.AlignmentIdiom.LRBB?u.TypographyNode.prototype.getMidline.call(this):this.rightChild.isRotated()&&this.leftChild.isRotated()?u.TypographyNode.prototype.getMidline.call(this):d.MathUtils.maxDouble(this.leftChild.getMidline(),this.rightChild.getMidline())*this.scaleMat.d},getRightmostTextNode:function(){return this.rightChild.getRightmostTextNode()},getLeftmostTextNode:function(){return this.leftChild.getLeftmostTextNode()},swapChildren:function(){var e=this.leftChild;this.leftChild=this.rightChild,this.rightChild=e},depthFirstSearch:function(e){this.leftChild.depthFirstSearch(e),this.rightChild.depthFirstSearch(e)},getTextNodes:function(){var e=[];return this.depthFirstSearch(e),e},getTextRuns:function(){for(var e=[],t=c.clone(this.getTextNodes()),n=c.iter(t);!n.done;n.next()){for(var o=n.value;null!=o.parent&&o.parent.getWeight()==o.getWeight();)o=o.parent;for(var r=!1,a=c.iter(e);!a.done;a.next())if(a.value.isSame(o)){r=!0;break}r||e.push(o)}return e},getAscent:function(){switch(this.transAlign){case 1:case 3:case 5:case 7:case 15:return this.rightChild.getAscent();case 2:case 4:case 6:case 8:return this.leftChild.getAscent();case 10:case 11:case 16:return d.MathUtils.minDouble(this.leftChild.getAscent(),this.rightChild.getAscent())}return d.MathUtils.maxDouble(this.leftChild.getAscent(),this.rightChild.getAscent())},getDescent:function(){switch(this.transAlign){case 1:case 3:case 5:case 7:case 15:return this.rightChild.getDescent();case 2:case 4:case 6:case 8:return this.leftChild.getDescent();case 12:case 13:case 17:return d.MathUtils.minDouble(this.leftChild.getDescent(),this.rightChild.getDescent())}return d.MathUtils.maxDouble(this.leftChild.getDescent(),this.rightChild.getDescent())},childrenAreVertAligned:function(){switch(this.transAlign){case 1:case 3:case 5:case 2:case 4:case 6:var e=this.leftChild,t=this.rightChild;return 0==e.rotateAlign&&1==e.scaleAlign&&0==t.rotateAlign&&1==t.scaleAlign}return!1},findEndChainLeadingNodes:function(e){if(this.childrenAreVertAligned()){var t=this.leftChild,n=this.rightChild;t.childrenAreVertAligned()?t.findEndChainLeadingNodes(e):0==t.rotateAlign&&1==t.scaleAlign&&e.push(t),n.childrenAreVertAligned()?n.findEndChainLeadingNodes(e):0==n.rotateAlign&&1==n.scaleAlign&&e.push(n)}else 0==this.rotateAlign&&1==this.scaleAlign&&e.push(this)},calculateLeadings:function(){var e=[];this.findEndChainLeadingNodes(e);for(var t=99999.9,n=[],o=c.iter(e);!o.done;o.next()){var r=o.value,a=r.localbounds(),i=r.transformTo(this,a),l=r.transformTo(this,new m.TheoRect(a.minX,a.minY,a.maxX,a.minY+r.getBaseline(!1)));if(this.childrenAreVertAligned()){var s=r.transformTo(this,new m.TheoRect(a.minX,a.minY,a.maxX,a.minY+r.getBaseline(!0)));n.push(new u.NodeMeasurements(r,i.minY,i.maxY,l.maxY,s.maxY))}else n.push(new u.NodeMeasurements(r,i.minY,i.maxY,l.maxY,l.maxY));r.getLeading()<t&&(t=r.getLeading())}for(var h=c.sort(n,(function(e,t){return e.minY<t.minY})),g=0,p=c.iter(c.range(1,h.length-1,!0));!p.done;p.next())h[y=p.value].topBaseLine-h[y-1].bottomBaseLine>g&&(g=h[y].topBaseLine-h[y-1].bottomBaseLine);0==h[0].node.parent.leadingAdjustment&&(h[0].node.parent.leadingAdjustment=h[0].node.parent.getLeading()*f.TypographyLayout.leadingFactor);for(var d=c.iter(c.range(1,h.length-1,!0));!d.done;d.next()){var y;h[y=d.value].node.parent.leadingAdjustment=g-(h[y].topBaseLine-h[y-1].bottomBaseLine)+t*f.TypographyLayout.leadingFactor}},resetLeadings:function(){this.leadingAdjustment=0,this.leftChild instanceof s&&this.leftChild.childrenAreVertAligned()&&(this.leftChild.leadingAdjustment=0,this.leftChild.resetLeadings()),this.rightChild instanceof s&&this.rightChild.childrenAreVertAligned()&&(this.rightChild.leadingAdjustment=0,this.rightChild.resetLeadings())},calcTransform:function(){var e=this.leftChild,t=this.rightChild;this.childrenAreVertAligned()?null!=this.parent&&this.parent.childrenAreVertAligned()||(this.resetLeadings(),e.calcTransform(),t.calcTransform(),this.internalCalcTransform(),this.calculateLeadings()):this.leadingAdjustment=d.MathUtils.minDouble(this.leftChild.getLeading(),this.rightChild.getLeading())*f.TypographyLayout.leadingFactor,e.calcTransform(),t.calcTransform(),u.TypographyNode.prototype.calcTransform.call(this),this.internalCalcTransform()},internalCalcTransform:function(){var e=this.leftChild,t=this.rightChild,n=e.localbounds(),o=t.localbounds();switch(this.transAlign){case 0:t.translateXY(n.maxX-o.minX+this.getInternalHSpace(),n.minY-o.minY+(e.getBaseline(!0)-t.getBaseline(!0)));break;case 1:t.translateXY(n.minX-o.minX,n.maxY-o.minY+this.getInternalVSpace());break;case 2:t.translateXY(n.minX-o.minX,n.minY-o.maxY-this.getInternalVSpace());break;case 3:t.translateXY(n.maxX-o.maxX,n.maxY-o.minY+this.getInternalVSpace());break;case 4:t.translateXY(n.maxX-o.maxX,n.minY-o.maxY-this.getInternalVSpace());break;case 5:t.translateXY(n.minX+(n.width-o.width)/2-o.minX,n.maxY-o.minY+this.getInternalVSpace());break;case 6:t.translateXY(n.minX+(n.width-o.width)/2-o.minX,n.minY-o.maxY-this.getInternalVSpace());break;case 7:t.translateXY(n.maxX-o.minX+this.getInternalHSpace(),n.maxY-o.minY+this.getInternalVSpace());break;case 8:t.translateXY(n.maxX-o.minX+this.getInternalHSpace(),n.minY-o.maxY-this.getInternalVSpace());break;case 9:t.translateXY(n.minX-o.maxX-this.getInternalHSpace(),n.maxY-o.minY+this.getInternalVSpace());break;case 10:t.translateXY(n.maxX-o.minX+this.getInternalHSpace(),n.minY-o.minY);break;case 11:t.translateXY(n.minX-o.maxX-this.getInternalHSpace(),n.minY-o.minY);break;case 12:t.translateXY(n.maxX-o.minX+this.getInternalHSpace(),n.minY+(n.height-o.height)-o.minY);break;case 13:t.translateXY(n.minX-o.maxX-this.getInternalHSpace(),n.minY+(n.height-o.height)-o.minY);break;case 14:t.translateXY(n.maxX-o.minX+this.getInternalHSpace(),n.minY+(e.getMidline()-t.getMidline())-o.minY);break;case 15:t.translateXY(n.minX+e.getSemanticWidth()-(o.minX+t.getSemanticWidth()),n.maxY-o.minY+this.getInternalVSpace());break;case 16:for(var r=(i=e.getRightmostTextNode()).localbounds(),a=i.parent;null!=a&&!a.isSame(e);)r=a.transformToLocalBounds(r),a=a.parent;r=e.transformToLocalBounds(r),t.translateXY(r.maxX-o.minX+this.getInternalHSpace(),r.minY-o.minY);break;case 17:var i;for(r=(i=e.getRightmostTextNode()).localbounds(),a=i.parent;null!=a&&!a.isSame(e);)r=a.transformToLocalBounds(r),a=a.parent;r=e.transformToLocalBounds(r),t.translateXY(r.maxX-o.minX+this.getInternalHSpace(),r.minY+(r.height-o.height)-o.minY);break;case 18:t.translateXY(n.minX-o.minX,n.maxY-o.minY-d.MathUtils.minDouble(n.height,o.height)/3);break;case 19:t.translateXY(n.maxX-o.maxX,n.maxY-o.minY-d.MathUtils.minDouble(n.height,o.height)/2);break;case 20:t.translateXY(n.minX-o.minX,n.minY-o.maxY+d.MathUtils.minDouble(n.height,o.height)/2);break;case 21:t.translateXY(n.maxX-o.minX-d.MathUtils.minDouble(n.width,o.width)/2,n.minY-o.minY)}},description:{get:function(){var e=u.TypographyNode._getters.description.call(this);return e+=this.leftChild.description,e+=this.rightChild.description}},getText:function(){for(var e=c.clone(this.getTextNodes()),t="",n=c.iter(e);!n.done;n.next())" "!=(t+=n.value.getText()).substr(t.length-1)&&(t+=" ");return t.trim()}}}),s)},Dq5S:function(e,t,n){var o,r,a=t,i=n("oAGj"),l=n("SpAV"),s=n("lmwz"),u=n("8t9B");a.ItemContentType=i.defineEnum("ItemContentType",{Image:0,Floating:1}),a.TextInfo=(o=function(){},i.defineClass({name:"TextInfo",ctor:o,props:{init_91e2:function(e,t,n){this.textLength=e,this.font=t,this.backingShape=n},init_implicit:function(e,t,n){this.textLength=e,this.font=t,this.backingShape=n},clone:function(){return o.init_implicit(this.textLength,this.font,this.backingShape)}}}),o),a.LayoutItem=(r=function(){this.aspectRatios_=null,this.importance_=null,this.focus_=null},i.defineClass({name:"LayoutItem",ctor:r,props:{init_b14a:function(e){this.id_=e.formaID,this.forma_=e;var t,n,o=this.forma_.controller.floating,r=s.ImageFacade.getImageFormaForForma(e);if(o||null==r){if(l.CoreAssert.isTrue(this.forma_.controller.floating,void 0,"LayoutItem.init","LayoutItem.swift",56),this.type_=a.ItemContentType.Floating,t=i.as(e.controller,u.TypeLockupController)){var c=t.text.length,h=i.opt(i.opt(t.lockupStyle,(function(e){return e.font})),(function(e){return e.fontData.postScriptName})),g=i.opt(t.lockupStyle,(function(e){return e.backingShapeID}));this.textInfo_=i.clone(a.TextInfo.init_91e2(c,h,g))}}else this.type_=a.ItemContentType.Image,(n=r.contentNode)&&(this.width_=i.toDouble(n.pixelWidth),this.height_=i.toDouble(n.pixelHeight),this.focus_=n.focusRegion)},init_e2cb:function(e,t,n,o,r,a,l){void 0===a&&(a=null),void 0===l&&(l=null),this.id_=e,this.type_=t,this.width_=n,this.height_=o,this.textInfo_=i.clone(r),this.aspectRatios_=i.clone(a),this.importance_=l,this.forma_=null},id:{get:function(){return this.id_}},forma:{get:function(){return this.forma_}},type:{get:function(){return this.type_}},width:{get:function(){return this.width_}},height:{get:function(){return this.height_}},textInfo:{get:function(){return this.textInfo_}},focusRegion:{get:function(){return this.focus_}},aspectRatios:{get:function(){return this.aspectRatios_},set:function(e){this.aspectRatios_=i.clone(e)}},importance:{get:function(){return this.importance_},set:function(e){this.importance_=e}}}}),r)},ERpL:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("wc1n"),l=n("cYVN"),s=n("djAF"),u=n("LGJg");r.ShapeRoleFeatures=a.defineEnum("ShapeRoleFeatures",{Area:"Area",ShapeWidth:"ShapeWidth",ShapeHeight:"ShapeHeight",CenterX:"CenterX",CenterY:"CenterY",RotCosine:"RotCosine",RotSine:"RotSine",PercentageDesignArea:"PercentageDesignArea",PercentageOutofBounds:"PercentageOutofBounds",OverlappingGraphicCount:"OverlappingGraphicCount",OverlappingTextCount:"OverlappingTextCount",PercentageTextOverlap:"PercentageTextOverlap",PercentageGraphicOverlap:"PercentageGraphicOverlap",MaskAverage:"MaskAverage",MaskAverageEdge:"MaskAverageEdge",PageHeight:"PageHeight",PageWidth:"PageWidth",ShapeCount:"ShapeCount",TextCount:"TextCount",BackgroundImageCount:"BackgroundImageCount",ForegroundImageCount:"ForegroundImageCount"}),r.ShapeRoleData=(o=function(e,t,n){l.RoleData.call(this,e,a.clone(t),a.clone(n))},a.defineClass({name:"ShapeRoleData",ctor:o,superName:"RoleData",statics:{getShapeRoleData:function(e){var t,n,l;if(l=a.as(e,s.ShapeForma)){var c=[r.ShapeRoleFeatures.Area,r.ShapeRoleFeatures.ShapeWidth,r.ShapeRoleFeatures.ShapeHeight,r.ShapeRoleFeatures.CenterX,r.ShapeRoleFeatures.CenterY,r.ShapeRoleFeatures.RotCosine,r.ShapeRoleFeatures.RotSine,r.ShapeRoleFeatures.PercentageDesignArea,r.ShapeRoleFeatures.PercentageOutofBounds,r.ShapeRoleFeatures.OverlappingGraphicCount,r.ShapeRoleFeatures.OverlappingTextCount,r.ShapeRoleFeatures.PercentageTextOverlap,r.ShapeRoleFeatures.PercentageGraphicOverlap,r.ShapeRoleFeatures.MaskAverage,r.ShapeRoleFeatures.MaskAverageEdge,r.ShapeRoleFeatures.PageHeight,r.ShapeRoleFeatures.PageWidth,r.ShapeRoleFeatures.ShapeCount,r.ShapeRoleFeatures.TextCount,r.ShapeRoleFeatures.BackgroundImageCount,r.ShapeRoleFeatures.ForegroundImageCount],h=i.FeatureExtractorFactory.getFeatureExtractor(i.FeatureExtractorType.Shape,l,a.clone(c)),g={};c.forEach((function(e){g[e]=(t=h.numericFeatureForKey(e))||null!=t?t:-1}));for(var p=a.iter(["line","heart","circle","arrow","square","instagram","rectangle","flower","star","love","triangle","food","music","party","?","birthday","sun","facebook","phone","youtube","badge"]);!p.done;p.next()){var d,f,y=p.value,m="search-"+y;c.push(m),g[m]=0,(d=a.as(l.contentNode,u.VectorContentNode))&&null!=(f=a.opt(a.opt(d.mediaMetadata,(function(e){return e.searchTerm})),(function(e){return e.toLowerCase()})))&&f==y&&(g[m]=1)}n=new o(e,a.clone(c),a.clone(g))}return n}}}),o)},EoOi:function(e,t,n){var o,r,a,i=t,l=n("oAGj"),s=n("ol4x"),u=n("7l9C"),c=n("d2x6");i.TypographyVariation=l.defineEnum("TypographyVariation",{Unset:0,Left:1,Right:2,Center:3,ScaledLeft:4,ScaledRight:5,ScaledCenter:6,FitEmphasized:7,FitEmphasizedAll:8,FitAll:9,TripletEmphasized:10,TripletUnemphasized:11,TripletEmphasizedRotated:12,TripletUnemphasizedRotated:13,LeftSpanRight:14,RightSpanLeft:15,RotateEmphasized:16,RotateEmphasizedMulti:17,RotateUnemphasized:18,RotateUnemphasizedAdjacent:19,RotateAndFit:20,FitAndRotate:21,DiagonalRightLeft:22,DiagonalFitFit:23,FitRotateFit:24,Corners:25,Corners2:26,Step:27,StepRotate:28,StepReverse:29,StepRotateReverse:30,Drop:31,Lift:32,Stagger:33,DropCap:34,DropCapTop:35,DropCapBottom:36,PunctuationStart:37,PunctuationEnd:38}),i.TypographyParams=(o=function(e){this.size_=e},l.defineClass({name:"TypographyParams",ctor:o}),o),i.TypographyScaleHint=l.defineEnum("TypographyScaleHint",{Width:0,Height:1,Aspect:2}),i.TypographyResult=(r=function(e,t,n,o){this.bounds=e,this.tokens=l.clone(t),this.matrices=l.clone(n),this.hint=o},l.defineClass({name:"TypographyResult",ctor:r}),r),i.TypographyComposer=(a=function e(t,n){e.initializeLayouts(),this.params_=t,this.words_=l.clone(n)},l.defineClass({name:"TypographyComposer",ctor:a,statics:{layouts:null,initializeLayouts:function(){null==a.layouts&&((a.layouts={})[i.TypographyVariation.Left]=s.ReflowAlignmentTypographyLayout.init_5a15(u.AlignmentIdiom.LLtb),a.layouts[i.TypographyVariation.Right]=s.ReflowAlignmentTypographyLayout.init_5a15(u.AlignmentIdiom.RRtb),a.layouts[i.TypographyVariation.Center]=s.ReflowAlignmentTypographyLayout.init_5a15(u.AlignmentIdiom.CCtb),a.layouts[i.TypographyVariation.ScaledLeft]=s.ScaledSimpleAlignmentTypographyLayout.init_5a15(u.AlignmentIdiom.LLtb),a.layouts[i.TypographyVariation.ScaledRight]=s.ScaledSimpleAlignmentTypographyLayout.init_5a15(u.AlignmentIdiom.RRtb),a.layouts[i.TypographyVariation.ScaledCenter]=s.ScaledSimpleAlignmentTypographyLayout.init_5a15(u.AlignmentIdiom.CCtb),a.layouts[i.TypographyVariation.FitEmphasized]=new s.FitTypographyLayout(s.FitTypographyLayout.FIT_EMPHASIZED),a.layouts[i.TypographyVariation.FitEmphasizedAll]=new s.FitTypographyLayout(s.FitTypographyLayout.FIT_EMPHASIZED_ALL),a.layouts[i.TypographyVariation.FitAll]=new s.FitTypographyLayout(s.FitTypographyLayout.FIT_ALL),a.layouts[i.TypographyVariation.TripletEmphasized]=new s.MiddleTypographyLayout(s.MiddleTypographyLayout.TRIPLET_EMPHASIZED),a.layouts[i.TypographyVariation.TripletUnemphasized]=new s.MiddleTypographyLayout(s.MiddleTypographyLayout.TRIPLET_UNEMPHASIZED),a.layouts[i.TypographyVariation.TripletEmphasizedRotated]=new s.MiddleTypographyLayout(s.MiddleTypographyLayout.TRIPLET_EMPHASIZED_ROTATED),a.layouts[i.TypographyVariation.TripletUnemphasizedRotated]=new s.MiddleTypographyLayout(s.MiddleTypographyLayout.TRIPLET_UNEMPHASIZED_ROTATED),a.layouts[i.TypographyVariation.LeftSpanRight]=new s.SpanMiddleTypographyLayout(s.SpanMiddleTypographyLayout.LEFT_RIGHT),a.layouts[i.TypographyVariation.RightSpanLeft]=new s.SpanMiddleTypographyLayout(s.SpanMiddleTypographyLayout.RIGHT_LEFT),a.layouts[i.TypographyVariation.RotateEmphasized]=new s.RotateTypographyLayout(s.RotateTypographyLayout.ROTATE_EMPHASIZED),a.layouts[i.TypographyVariation.RotateEmphasizedMulti]=new s.RotateTypographyLayout(s.RotateTypographyLayout.ROTATE_EMPHASIZED_MULTI),a.layouts[i.TypographyVariation.RotateUnemphasized]=new s.RotateTypographyLayout(s.RotateTypographyLayout.ROTATE_UNEMPHASIZED),a.layouts[i.TypographyVariation.RotateUnemphasizedAdjacent]=new s.RotateTypographyLayout(s.RotateTypographyLayout.ROTATE_UNEMPHASIZED_ADJACENT),a.layouts[i.TypographyVariation.RotateAndFit]=new s.RotateAndFitTypographyLayout,a.layouts[i.TypographyVariation.FitAndRotate]=new s.FitAndRotateTypographyLayout,a.layouts[i.TypographyVariation.DiagonalRightLeft]=new s.DiagonalBoxTypographyLayout(s.DiagonalBoxTypographyLayout.RIGHT_LEFT),a.layouts[i.TypographyVariation.DiagonalFitFit]=new s.DiagonalBoxTypographyLayout(s.DiagonalBoxTypographyLayout.FIT_FIT),a.layouts[i.TypographyVariation.FitRotateFit]=new s.FitRotateFitTypographyLayout,a.layouts[i.TypographyVariation.Corners]=new s.CornersTypographyLayout(s.CornersTypographyLayout.RIGHTTOP_LEFTBOTTOM),a.layouts[i.TypographyVariation.Corners2]=new s.CornersTypographyLayout(s.CornersTypographyLayout.LEFTTOP_RIGHTBOTTOM),a.layouts[i.TypographyVariation.Step]=new s.StepTypographyLayout(s.StepTypographyLayout.STEP),a.layouts[i.TypographyVariation.StepRotate]=new s.StepTypographyLayout(s.StepTypographyLayout.STEP_ROTATE),a.layouts[i.TypographyVariation.StepReverse]=new s.StepTypographyLayout(s.StepTypographyLayout.STEP_REVERSE),a.layouts[i.TypographyVariation.StepRotateReverse]=new s.StepTypographyLayout(s.StepTypographyLayout.STEP_ROTATE_REVERSE),a.layouts[i.TypographyVariation.Drop]=new s.DropTypographyLayout(s.DropTypographyLayout.DROP_DOWN),a.layouts[i.TypographyVariation.Lift]=new s.DropTypographyLayout(s.DropTypographyLayout.DROP_UP),a.layouts[i.TypographyVariation.Stagger]=new s.StaggerTypographyLayout,a.layouts[i.TypographyVariation.DropCap]=new s.DropCapTypographyLayout,a.layouts[i.TypographyVariation.DropCapTop]=new s.DropCapSingleTokenTypographyLayout(!0),a.layouts[i.TypographyVariation.DropCapBottom]=new s.DropCapSingleTokenTypographyLayout(!1),a.layouts[i.TypographyVariation.PunctuationStart]=new s.PunctuationAtStartTypographyLayout,a.layouts[i.TypographyVariation.PunctuationEnd]=new s.PunctuationAtEndTypographyLayout)}},props:{getApplicableLayouts:function(){for(var e=[],t=c.TypographyTree.buildArchetypeTree(l.clone(this.words_)),n=l.clone(t.getRoot().getTextRuns()),o=l.iter(l.keys(a.layouts));!o.done;o.next()){var r=o.value;a.layouts[r].conditionsMet(t,l.clone(n))&&e.push(r)}return e},isValidLayout:function(e){var t=c.TypographyTree.buildArchetypeTree(l.clone(this.words_)),n=l.clone(t.getRoot().getTextRuns()),o=a.layouts[e];return null!=o&&o.conditionsMet(t,l.clone(n))},layout:function(e){var t=c.TypographyTree.buildArchetypeTree(l.clone(this.words_)),n=l.clone(t.getRoot().getTextRuns()),o=a.layouts[e];null!=o&&o.conditionsMet(t,l.clone(n))||(o=a.layouts[i.TypographyVariation.Left]);var r=o.arrangeText(t,l.clone(n),this.params_);t.calcGlobalMatrices();for(var s=[],u=[],h=l.clone(t.getRoot().getTextNodes()),g=l.iter(h);!g.done;g.next()){var p=g.value;s.push(p.token_),u.push(p.global())}return new i.TypographyResult(t.getBounds(),l.clone(s),l.clone(u),r)}}}),a)},LqGn:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("cZuM"),l=n("XmBt"),s=n("SpAV"),u=n("FNB+"),c=n("6ZWm"),h=n("9Lk3"),g=n("/afT"),p=n("pnSN"),d=n("iCxV"),f=n("c+uM"),y=n("tGKA"),m=n("AxS/"),T=n("MZST"),S=n("8t9B"),L=n("oKlP");r.RetargetSuggestion=(o=function(e,t,n,o,r,i,l){this.correspondence_=a.clone(r),this.modelDoc_=o,this.forma_=e,this.modelForma_=n,this.score_=new T.RetargetScore(t,n,a.clone(r),a.clone(i),a.clone(l))},a.defineClass({name:"RetargetSuggestion",ctor:o,superName:"CoreObject",statics:{_implements:function(e){return"IDesignSuggestion"==e}},props:{getGroupCorrespondences:function(){for(var e=this.forma_,t=[],n=a.iter(this.correspondence_);!n.done;n.next()){for(var o=n.value,r=[],i=a.iter(o.a);!i.done;i.next()){var l=i.value;e.visitAll(u.FormaTraversal.PreOrder,(function(e){e.originalID==l.originalID&&r.push(e)}))}t.push({a:r,b:o.b})}return t},getHeightScale:function(e,t){return a.opt(e.controller,(function(e){return e.kind==a.opt(t.controller,(function(e){return e.kind}))}))?a.opt(t.controller,(function(e){return e.currentHeightScale})):a.opt(e.controller,(function(e){return e.currentHeightScale}))},matchGroups:function(e,t){if(0!=e.length&&0!=t.length){for(var n=e.length,o=t.length,r=null,i=[],l=[],u=a.iter(a.range(0,Math.min(o,n),!1));!u.done;u.next()){var c,h,g=u.value;null!=(c=this.getHeightScale(e[g],t[g]))&&l.push({forma:e[g],height:c}),e[g].match(t[g]),i.push(e[g]),(h=a.as(t[g].controller,S.TypeLockupController))&&(r=h.lockupStyle)}var p=[];if(n>o)for(var d=a.iter(a.range(o,n,!1));!d.done;d.next()){var y,m;if(g=d.value,(y=a.as(e[g].controller,S.TypeLockupController))&&(m=r)){var T=f.LockupStyle.createDefault();T.colors.match(m.colors),T.alignment=m.alignment,T.layout=m.layout,a.opt(y.forma,(function(e){return e.applyStyle(T)}))}p.push(e[g])}this.createAlignmentGroupForFormae(a.clone(t),a.clone(i),a.clone(p),a.clone(l))}else s.CoreAssert.fail("can't have an empty match","RetargetSuggestion.matchGroups","RetargetSuggestion.swift",73)},createAlignmentGroupForFormae:function(e,t,n,o){for(var r=null,s=null,c=a.iter(a.range(0,e.length,!1));!c.done;c.next()){var h=e[H=c.value].controller.visualParentExpansionFrame;r=null==r?h:r.unionWith(h),s=null==s?e[H].frame:s.unionWith(e[H].frame)}var f,m=null,T=null,R=null;if(0==n.length&&(f=a.clone(g.GroupDetector.detectVerticalAlignmentGroups(a.clone(e)))).length>0){var v=f[0],I=(C=a.as(e[0].page.createFormaWithController(p.GroupForma.KIND,l.AlignmentGroupController.KIND),p.GroupForma)).controller;(x=e[0].root).appendChild(C),I.fit(r);var A=v.formae[0].parent;a.opt(I.alignmentGroupStyle,(function(e){return e.numColumns=1})),I.setupWithFormae(a.clone(e),v.alignment),m=I.inferredSpacing,R=Math.max(0,r.maxY-s.maxY),T=Math.max(0,s.minY-r.minY),null!=m&&m<0&&(d.Host.logging.info("possible error in spacing: "+m+"\n"),m=null);for(var F=a.iter(C.visitAsArray(u.FormaTraversal.JustChildren));!F.done;F.next()){var _=F.value;a.opt(A,(function(e){return e.appendChild(_,!0)}))}C.removeFromParent(),I.dispose()}if(1==(f=a.clone(g.GroupDetector.detectVerticalAlignmentGroups(a.clone(t)))).length||n.length>0){var C,x;v=f[0],I=(C=a.as(this.forma_.page.createFormaWithController(p.GroupForma.KIND,l.AlignmentGroupController.KIND),p.GroupForma)).controller,(x=this.forma_).appendChild(C),A=v.formae[0].parent,I.fit(r);for(var b=a.iter(t);!b.done;b.next())1!=(k=b.value).placement.transformValues.rotCosine&&(k.placement=y.Matrix2D.Identity),I.addFormaToGroup(k);if(null!=I.alignmentGroupStyle)for(var D=a.iter(o);!D.done;D.next()){var M=D.value;I.alignmentGroupStyle.setScale(M.forma.formaID,M.height)}I.setHorizontalAlignment(v.alignment),v.alignment==i.AlignmentType.Left?a.opt(I.alignmentGroupStyle,(function(e){return e.marginLeft=s.minX-r.minX})):v.alignment==i.AlignmentType.Right&&a.opt(I.alignmentGroupStyle,(function(e){return e.marginRight=r.maxX-s.maxX})),null!=m?a.opt(I.alignmentGroupStyle,(function(e){return e.spacing=m})):n.length>0&&a.opt(I.alignmentGroupStyle,(function(e){return e.spacing=r.height/15})),null!=T&&a.opt(I.alignmentGroupStyle,(function(e){return e.marginTop=T})),null!=R&&a.opt(I.alignmentGroupStyle,(function(e){return e.marginBottom=R})),0==n.length&&a.opt(I.alignmentGroupStyle,(function(e){return e.numColumns=1})),null!=T&&null!=R&&Math.max(R,T)>r.height/10&&((T-R)/r.height>.2?a.opt(I.alignmentGroupStyle,(function(e){return e.verticalAlignment=i.AlignmentType.Bottom})):(R-T)/r.height>.2&&a.opt(I.alignmentGroupStyle,(function(e){return e.verticalAlignment=i.AlignmentType.Top})));for(var E=0,N=a.iter(n);!N.done;N.next()){var k;1!=(k=N.value).placement.transformValues.rotCosine&&(k.placement=y.Matrix2D.Identity);var w=!1;if(null!=I.alignmentGroupStyle)for(var G=a.iter(o);!G.done;G.next())M=G.value,a.opt(M.forma.controller,(function(e){return e.kind==a.opt(k.controller,(function(e){return e.kind}))}))&&(I.alignmentGroupStyle.setScale(k.formaID,M.height),w=!0);w||null==I.alignmentGroupStyle||(null!=a.as(k.controller,S.TypeLockupController)?I.alignmentGroupStyle.setScale(k.formaID,60):I.alignmentGroupStyle.setScale(k.formaID,x.frame.height/5)),I.insertForma(k,t.length+E),E+=1}I.updateGroup();for(var P=a.iter(C.visitAsArray(u.FormaTraversal.JustChildren));!P.done;P.next())_=P.value,a.opt(A,(function(e){return e.appendChild(_,!0)}));a.opt(C,(function(e){return e.removeFromParent()})),I.dispose()}for(var O=a.iter(a.range(0,e.length,!1));!O.done;O.next()){var H;if((H=O.value)<t.length){var Y=e[H].placement.transformValues,B=t[H].frame.center;t[H].move(y.Matrix2D.rotation(Y.rotCosine,Y.rotSine)),t[H].movePinToPoint(new L.TheoPoint(.5,.5),B)}}},apply:function(){for(var e=this,t=this.forma_,n=this.modelDoc_.beginTransaction("adjust_template"),o=a.clone(t.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1}))),r=a.iter(o);!r.done;r.next()){var i=r.value;a.opt(a.as(i.controller,S.TypeLockupController),(function(e){return e.updateGroup()}))}for(var s=a.clone(t.filterWithCallback((function(e){return a.opt(e.controller,(function(e){return e.kind==l.AlignmentGroupController.KIND}))}))),c=a.iter(s);!c.done;c.next()){for(var h=c.value,g=a.clone(h.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),u.FormaTraversal.JustChildren)),p=a.iter(g);!p.done;p.next()){var d=p.value;a.opt(h.parent,(function(e){return e.appendChild(d,!0)}))}h.removeFromParent()}for(var f=[],y=[],T=[],L=a.iter(this.getGroupCorrespondences());!L.done;L.next()){var R=L.value;if(1==R.a.length&&1==R.b.length){var v,I,A=R.a[0],F=R.b[0];null!=(v=this.getHeightScale(A,F))&&f.push({forma:A,height:v}),(I=a.opt(F.controller,(function(e){return e.getPin()})))&&(I.forma=A,y.push(I)),A.match(F),T.push({design:A,model:F})}else this.matchGroups(a.clone(R.a),a.clone(R.b))}for(var _=a.iter(f);!_.done;_.next()){var C=_.value;a.opt(C.forma.controller,(function(e){return e.setHeightScale(C.height)}))}a.opt(t.page.document,(function(t){return t.content.root.setTag(m.RootContentNode.THEME_ID_TAG,e.modelDoc_.uuid)})),t.page.colorLibraryController.restoreUndoState(a.as(this.modelDoc_.firstPage.colorLibrary.state.allProperties,"AnyObject")),t.applyStyle(t.style),n.rollback(),this.cleanupForma(t)},distanceTo:function(e){return s.CoreAssert.fail("no distance","RetargetSuggestion.distanceTo","RetargetSuggestion.swift",438),0},score:{get:function(){return a.opt(this.score_,(function(e){return e.score}))}},weightedScore:{get:function(){return this.score_}},forma:{get:function(){return this.forma_}},isLogoMatchedWithModelLogo:function(e){var t=this.modelForma_;return a.clone(t.filterWithCallback((function(e){return e.isLogo()}))).length>0&&this.correspondence_.filter((function(t){var n=t.a[0];return n.isLogo()&&n.originalID==e.originalID&&t.b[0].isLogo()}),this).length>0},cleanupForma:function(e){for(var t=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()&&e.frame.area>1}))),n=a.iter(t);!n.done;n.next()){var o,r=n.value;(x=a.as(r.controller,S.TypeLockupController))&&(x.snapSizeToBounds(),null!=(o=x.averageLineHeight)&&o<S.TypeLockupController.MIN_LINE_HEIGHT&&x.setHeightScale(S.TypeLockupController.MIN_LINE_HEIGHT))}for(var i=a.clone(e.filterWithCallback((function(e){return e.isLogo()}))),l=a.iter(i);!l.done;l.next()){var s,g=l.value;(s=a.as(g.controller,c.FrameController))&&(this.isLogoMatchedWithModelLogo(g)||s.placeAsLogo())}if(e.visible&&!this.modelForma_.visible)for(var d=a.iter(t);!d.done;d.next()){var y,m;if(r=d.value,(x=a.as(r.controller,S.TypeLockupController))&&(y=a.opt(x.lockupStyle,(function(e){return e.colors.fieldSecondary})))&&(m=a.opt(x.lockupStyle,(function(e){return e.colors.fieldPrimary})))){for(var T=e.page.colorLibraryController,L=-1,R=null,v=a.iter(T.getColorThemeAsArrayOfTheoColors());!v.done;v.next()){var I;if((I=v.value)!=y&&I!=m){var A=I.rgbColor.distanceTo(m)+I.rgbColor.distanceTo(y);A>L&&(L=A,R=I)}}(I=R)&&a.opt(e.controller,(function(e){return e.applyColors([I])}))}}a.sortInPlace(t,(function(e,t){var n=a.as(e,p.GroupForma),o=a.as(t,p.GroupForma),r=null!=n?n.childrenFinalFrame:null,i=null!=o?o.childrenFinalFrame:null;return null!=r&&null!=i&&r.area<i.area}));for(var F=[],_=0,C=a.iter(t);!C.done;C.next()){var x,b,D;if(r=C.value,_+=1,(x=a.as(r.controller,S.TypeLockupController))&&x.lockupStyle&&(b=a.as(r,p.GroupForma))&&(D=b.childrenFinalFrame))for(var M=a.iter(a.range(0,_-1,!1));!M.done;M.next()){var E,N=M.value;if((E=(H=t[N].controller).textFinalFrame)&&D.intersects(E)){F.push(t[N]);break}}}for(var k=a.clone(e.filterWithCallback((function(e){return e.hasIntent(u.Forma.INTENT_ICON)}))),w=a.iter(k);!w.done;w.next()){var G=w.value;a.opt(G.controller,(function(e){return e.contrastCheck(!1)}))}for(var P=a.iter(F);!P.done;P.next())(Y=(r=P.value).parent).removeChild(r),Y.appendChild(r);for(var O=a.iter(t);!O.done;O.next()){var H=(r=O.value).controller,Y=r.parent,B=H.lockupStyle.backing==f.LockupBacking.Knockout&&f.LockupStyle.isKnockoutLook(H.lockupStyle.textLook);if(null!=Y&&B){var W=a.clone(Y.filterWithCallback((function(e){return(e.isBackgroundImage()||e.isShape())&&null!=e.controller&&!e.controller.floating}),u.FormaTraversal.JustChildren));Y.insertChildAt(r,W.length)}}for(var U=a.iter(e.filterByControllerKind(h.GridController.KIND));!U.done;U.next()){var V,X=U.value;if(V=a.as(X.controller,h.GridController))for(var z=a.iter(V.gridStyle.gridCells);!z.done;z.next()){var j,Z=z.value;if(null!=(j=Z.colorID)&&null==e.page.colorLibrary.color(j)){var K=a.clone(e.page.colorLibraryController.unusedColorKeys(null,!0));K.length>0&&V.gridStyle.updateCell(Z,null,K[0],null)}}}},dummy:function(e){}}}),o)},LwcA:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("gXiO"),l=n("wc1n"),s=n("lmwz"),u=n("WlyK"),c=n("jV/A"),h=n("sIWg"),g=n("1NAc");r.RetargetCompatibilitySuggester=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"RetargetCompatibilitySuggester",ctor:o,superName:"CoreObject",statics:{sortDocuments:function(e,t){for(var n=a.clone(o.scoreDocuments(e,a.clone(t))),r=[],i=a.iter(n);!i.done;i.next()){var l=i.value;r.push(l.data)}return r},scoreDocuments:function(e,t){for(var n=o.createRetargetDocumentData(e),r=(t.filter((function(e){return 0==e.numImages}),this),a.clone(e.filterWithCallback((function(e){return s.ImageFacade.isPotentialBackgroundImage(e)}))),a.clone(n.lockupStrings)),i=(n.numImages,[]),l=a.iter(t);!l.done;l.next()){var c=l.value;a.isEmpty(c.layoutID);for(var h=(S=a.clone(c.lockupStrings)).length,g=!1,p=a.iter(i);!p.done;p.next()){var d=p.value;if(d.lockupStrings.length==h){for(var f=a.clone(d.lockupStrings),y=a.iter(a.range(0,h,!1));!y.done&&S[R=y.value]==f[R];y.next())R+1==h&&(g=!0);if(g)break}}g||r.length>3&&h<3||i.push(c)}for(var m=[],T=a.iter(i);!T.done;T.next()){var S;if(c=T.value,h=(S=a.clone(c.lockupStrings)).length,g=!1,r.length==h)for(var L=a.iter(a.range(0,h,!1));!L.done;L.next()){var R;if(S[R=L.value]!=r[R])break;R+1==h&&(g=!0)}if(!g){var v=new u.RetargetCompatibilityScore(e.frame,n,c);m.push({data:c,score:v})}}return a.sort(m,(function(e,t){return e.score.score>t.score.score}))},createRetargetDocumentData:function(e){var t=l.FeatureExtractorFactory.getFeatureExtractor(l.FeatureExtractorType.Retarget,e),n=a.clone(t.allFeatures_),o=a.as(n.Focus,"AnyObject"),r=o.length;return new c.RetargetDocumentExemplar("","","","","",g.TheoSize.decodeJson(a.as(n.Size,"AnyObject"))||g.TheoSize.Zero,2,2,"","",a.clone(n.LockupStrings),null!=o&&r>0?h.TheoRect.decodeJson(o):null,n.NumImages,a.clone(a.as(n.Edges,["Array","Double"])),n.LayoutId,n.NumGridsCells,n.NumMoveable,n.NumShapes,a.clone(n.VisualGroupInfo),a.clone(n.TextRoles),a.clone(n.ShapeRoles),n.SalientCoverage,n.GifsCount)}}}),o)},MZST:function(e,t,n){var o,r,a=t,i=n("oAGj"),l=n("FNB+"),s=n("c+uM"),u=n("8t9B"),c=n("9BFu");a.RetargetScore=(o=function e(t,n,o,r,a){this.rejectThreshold=-1e3,this.root_=t,this.model_=n,this.correspondence_=i.clone(o),this.designRoles_=i.clone(r),this.modelRoles_=i.clone(a),c.WeightedScore.call(this,e.Features.NUM_FEAT),this.setWeight(e.Features.MIN_TEXT_SIZE,0),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-30),this.setWeight(e.Features.WEIGHT_DIFF,0),this.setWeight(e.Features.RELATIVE_WEIGHT,-20),this.setWeight(e.Features.RELATIVE_LOCATION,-10),this.setWeight(e.Features.GROUP_SIZE_DIFF,-100),this.setWeight(e.Features.GROUP_COUNT_DIFF,-40),this.setWeight(e.Features.MISSING_TEXT,-5e3),this.setWeight(e.Features.TYPE_MISMATCH,-80),this.setWeight(e.Features.STYLE_MISMATCH,-80),this.setWeight(e.Features.ROLES_MISMATCH,-1e3),this.setFeatureName(e.Features.MIN_TEXT_SIZE,"Min Text Size"),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.WEIGHT_DIFF,"Weight Difference"),this.setFeatureName(e.Features.RELATIVE_WEIGHT,"Relative Weight"),this.setFeatureName(e.Features.RELATIVE_LOCATION,"Relative Location"),this.setFeatureName(e.Features.GROUP_SIZE_DIFF,"Group Size Diff"),this.setFeatureName(e.Features.GROUP_COUNT_DIFF,"Group Count Diff"),this.setFeatureName(e.Features.MISSING_TEXT,"Missing Text"),this.setFeatureName(e.Features.TYPE_MISMATCH,"Type Mismatch"),this.setFeatureName(e.Features.STYLE_MISMATCH,"Style Mismatch"),this.setFeatureName(e.Features.ROLES_MISMATCH,"Roles Mismatch"),this.setFeature(e.Features.MIN_TEXT_SIZE,0),this.setFeature(e.Features.LENGTH_TEXT_DIFF,0),this.setFeature(e.Features.WEIGHT_DIFF,0),this.setFeature(e.Features.RELATIVE_WEIGHT,0),this.setFeature(e.Features.RELATIVE_LOCATION,0),this.setFeature(e.Features.GROUP_SIZE_DIFF,0),this.setFeature(e.Features.GROUP_COUNT_DIFF,0),this.setFeature(e.Features.MISSING_TEXT,0),this.setFeature(e.Features.TYPE_MISMATCH,0),this.setFeature(e.Features.STYLE_MISMATCH,0),this.setFeature(e.Features.ROLES_MISMATCH,0),this.evaluateLayout()},r={},i.defineClass({name:"RetargetScore",ctor:o,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===r.Features&&(r.Features=i.defineEnum("Features",{MIN_TEXT_SIZE:0,WEIGHT_DIFF:1,LENGTH_TEXT_DIFF:2,RELATIVE_WEIGHT:3,RELATIVE_LOCATION:4,MISSING_TEXT:5,GROUP_SIZE_DIFF:6,GROUP_COUNT_DIFF:7,TYPE_MISMATCH:8,STYLE_MISMATCH:9,ROLES_MISMATCH:10,NUM_FEAT:11})),r.Features}}},props:{evaluateLayout:function(){var e,t,n=this;this.setFeature(o.Features.MIN_TEXT_SIZE,0);for(var r=[],a={},c={},h=0,g=0,p=i.iter(this.correspondence_);!p.done;p.next()){var d=p.value;g+=i.toDouble(Math.abs(d.a.length-d.b.length));for(var f=0,y=0,m=i.iter(d.a);!m.done;m.next())f+=(S=m.value).frame.area/S.root.frame.area;for(var T=i.iter(d.b);!T.done;T.next()){var S;y+=(S=T.value).frame.area/S.root.frame.area}var L=f-y;h+=i.toDouble(L*L);for(var R=i.iter(i.range(0,Math.min(d.a.length,d.b.length),!1));!R.done;R.next()){var v=R.value,I=d.a[v],A=d.b[v];r.push({forma:I,placed:A}),a[I.formaID]={forma:I,length:0,size:(e=I.controller.currentHeightScale)||null!=e?e:I.finalFrame.height,center:I.frame.center},c[A.formaID]={forma:A,length:0,size:(t=A.controller.currentHeightScale)||null!=t?t:A.finalFrame.height,center:A.frame.center}}}this.setFeature(o.Features.GROUP_SIZE_DIFF,h),this.setFeature(o.Features.GROUP_COUNT_DIFF,g/i.toDouble(this.correspondence_.length));for(var F=0,_=0,C=0,x=0,b=0,D=0,M=this.root_.frame.area,E=i.iter(r);!E.done;E.next()){var N,k,w,G,P=E.value;if((P.forma.isTypeLockup()&&P.placed.isGraphic()||P.forma.isGraphic()&&P.placed.isTypeLockup())&&(x+=1,(N=i.as(P.placed.controller,u.TypeLockupController))&&(N.lockupStyle.backing==s.LockupBacking.None&&N.lockupStyle.textLook==s.LockupTextLook.Fill||null!=(k=N.averageLineHeight)&&(b+=k/100))),null!=(w=a[P.forma.formaID])&&null!=(G=c[P.placed.formaID])){F+=Math.abs(w.size-G.size)/M;for(var O=i.iter(r);!O.done;O.next()){var H,Y,B=O.value;i.eq(l._equality_Forma_Forma,P.forma,B.forma)||i.eq(l._equality_Forma_Forma,P.placed,B.placed)||null!=(H=a[B.forma.formaID])&&null!=(Y=c[B.placed.formaID])&&((w.size-H.size>5&&G.size-Y.size<-5||w.size-H.size<-5&&G.size-Y.size>5)&&i.opt(w.forma.controller,(function(e){return e.kind==i.opt(H.forma.controller,(function(e){return e.kind}))}))&&i.opt(G.forma.controller,(function(e){return e.kind==i.opt(Y.forma.controller,(function(e){return e.kind}))}))&&(_+=1),(w.center.x-H.center.x>20&&G.center.x-Y.center.x<-20||w.center.x-H.center.x<-20&&G.center.x-Y.center.x>20)&&(C+=.5),(w.center.y-H.center.y>20&&G.center.y-Y.center.y<-20||w.center.y-H.center.y<-20&&G.center.y-Y.center.y>20)&&(C+=1))}}var W=i.clone(this.designRoles_[P.forma.formaID]),U=i.clone(this.modelRoles_[P.placed.formaID]);null!=W&&null!=U&&i.opt(W,(function(e){return e.role!=i.opt(U,(function(e){return e.role}))}))&&(D+=1)}for(var V=i.iter(this.correspondence_);!V.done;V.next()){d=V.value;for(var X=i.clone(d.a),z=i.iter(i.range(0,X.length,!1));!z.done;z.next()){v=z.value;for(var j=i.iter(i.range(0,X.length,!1));!j.done;j.next()){var Z=j.value;v>Z&&X[v].frame.center.y>X[Z].frame.center.y&&(C+=1)}}}this.setFeature(o.Features.WEIGHT_DIFF,F/i.toDouble(r.length)),this.setFeature(o.Features.RELATIVE_WEIGHT,_/i.toDouble(r.length)),this.setFeature(o.Features.RELATIVE_LOCATION,.5*C/i.toDouble(r.length)),this.setFeature(o.Features.TYPE_MISMATCH,x/i.toDouble(r.length)),this.setFeature(o.Features.STYLE_MISMATCH,b/i.toDouble(r.length)),this.setFeature(o.Features.ROLES_MISMATCH,D/i.toDouble(r.length));var K=0;this.model_.visit(l.FormaTraversal.PreOrder,(function(e,t,o){var r;if(r=i.as(e.controller,u.TypeLockupController)){for(var a=!1,s=i.iter(n.correspondence_);!s.done;s.next())for(var c=s.value,h=i.iter(c.b);!h.done;h.next()){var g=h.value;i.eq(l._equality_Forma_Forma,e,g)&&(a=!0)}if(!a){var p=i.toDouble(r.text.length);K+=e.frame.area/p}}return!1})),this.setFeature(o.Features.MISSING_TEXT,K/this.root_.frame.area)},reject:function(){return this.score<this.rejectThreshold}}}),o)},WlyK:function(e,t,n){var o,r,a=t,i=n("oAGj"),l=n("SpAV"),s=n("3DEm"),u=n("sIWg"),c=n("9BFu");a.RetargetCompatibilityScore=(o=function e(t,n,o){this.rejectThreshold=-500,c.WeightedScore.call(this,e.Features.NUM_FEAT),this.setFeature(e.Features.LENGTH_TEXT_DIFF,0),this.setFeature(e.Features.NUM_MOVEABLE_DIFF,0),this.setFeature(e.Features.NUM_IMAGE_DIFF,0),this.setFeature(e.Features.IMAGE_SIMILARITY,0),this.setFeature(e.Features.DESIGN_SIZE_DIFF,0),this.setFeature(e.Features.GRID_DESIGN,0),this.setFeature(e.Features.VISUAL_GROUP_DISSIMILARITY,0),this.setFeature(e.Features.LOCKUP_ROLE_DISSIMILARITY,0),this.setFeature(e.Features.SHAPE_ROLE_DISSIMILARITY,0),this.setFeature(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,0),this.setFeature(e.Features.NUM_GRIDCELL_DIFF,0),this.setFeature(e.Features.NUM_SHAPE_DIFF,0),this.setFeature(e.Features.NUM_GIFS_DIFF,0),this.setWeight(e.Features.LENGTH_TEXT_DIFF,-100),this.setWeight(e.Features.FAKE_DESIGN,-100),this.setWeight(e.Features.NUM_IMAGE_DIFF,-1e4),this.setWeight(e.Features.IMAGE_SIMILARITY,-50),this.setWeight(e.Features.DESIGN_SIZE_DIFF,-1e4),this.setWeight(e.Features.GRID_DESIGN,50),this.setWeight(e.Features.VISUAL_GROUP_DISSIMILARITY,-1e3),this.setWeight(e.Features.LOCKUP_ROLE_DISSIMILARITY,-1e3),this.setWeight(e.Features.SHAPE_ROLE_DISSIMILARITY,-1e3),this.setWeight(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,-100),this.setWeight(e.Features.NUM_GRIDCELL_DIFF,-1e3),this.setWeight(e.Features.NUM_SHAPE_DIFF,-1e3),this.setWeight(e.Features.NUM_GIFS_DIFF,-1e3),this.setFeatureName(e.Features.NUM_MOVEABLE_DIFF,"Moveable Count Difference"),this.setFeatureName(e.Features.FAKE_DESIGN,"Fake Design"),this.setFeatureName(e.Features.LENGTH_TEXT_DIFF,"Text Length Difference"),this.setFeatureName(e.Features.NUM_IMAGE_DIFF,"Image Count Difference"),this.setFeatureName(e.Features.IMAGE_SIMILARITY,"Image Similarity"),this.setFeatureName(e.Features.DESIGN_SIZE_DIFF,"Design Size Difference"),this.setFeatureName(e.Features.GRID_DESIGN,"Grid Design"),this.setFeatureName(e.Features.VISUAL_GROUP_DISSIMILARITY,"Visual Group Dissimilarity"),this.setFeatureName(e.Features.LOCKUP_ROLE_DISSIMILARITY,"Lockup Roles Dissimilarity"),this.setFeatureName(e.Features.SHAPE_ROLE_DISSIMILARITY,"Shape Roles Dissimilarity"),this.setFeatureName(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,"Salient Coverage Dissimilarity"),this.setFeatureName(e.Features.NUM_GRIDCELL_DIFF,"Grid Cells Difference"),this.setFeatureName(e.Features.NUM_SHAPE_DIFF,"Shape Count Difference"),this.setFeatureName(e.Features.NUM_GIFS_DIFF,"Gifs Count Difference");var r=i.clone(n.edgeMap),a=i.clone(o.edgeMap);if(null!=a&&null!=r)if(r.length==a.length){for(var h=1e-5,g=i.iter(i.range(0,a.length,!1));!g.done;g.next())h+=a[f=g.value];for(var p=0,d=i.iter(i.range(0,r.length,!1));!d.done;d.next()){var f=d.value;p+=Math.abs(r[f]-a[f]/h)}isNaN(p)&&l.CoreAssert.fail("nan ","RetargetCompatibilityScore.init","RetargetCompatibilityScore.swift",104),this.setFeature(e.Features.IMAGE_SIMILARITY,p)}else this.setFeature(e.Features.IMAGE_SIMILARITY,0);var y=i.toDouble(n.numMoveable-o.numMoveable),m=-2e3;function T(e,t){return e.length>t.length}y<0&&(m=-1e3),this.setWeight(e.Features.NUM_MOVEABLE_DIFF,m),this.setFeature(e.Features.NUM_MOVEABLE_DIFF,Math.abs(y));for(var S=i.sort(n.lockupStrings.concat(),T),L=i.sort(o.lockupStrings.concat(),T),R=(p=[],[]),v=i.iter(i.range(0,Math.min(S.length,L.length),!1));!v.done;v.next()){f=v.value;var I=i.toDouble(S[f].length),A=i.toDouble(L[f].length);p.push(I-A),R.push(Math.max(I,A))}function F(e){for(var t=0,n=i.iter(e);!n.done;n.next()){var o=n.value;t+=o*o}return Math.sqrt(t)}var _=F(i.clone(p))/(F(i.clone(R))+.001);this.setFeature(e.Features.LENGTH_TEXT_DIFF,_);for(var C=i.iter(o.lockupStrings);!C.done;C.next())C.value.toLowerCase().includes("lorem ipsum")&&this.setFeature(e.Features.FAKE_DESIGN,1);var x=i.toDouble(Math.abs(n.numImages-o.numImages));this.setFeature(e.Features.NUM_IMAGE_DIFF,x);var b=u.TheoRect.fromSize(o.size),D=u.TheoRect.fromSize(n.size).similarity(b);this.setFeature(e.Features.DESIGN_SIZE_DIFF,D),this.setFeature(e.Features.GRID_DESIGN,""==o.layoutID?0:1);var M=s.MathUtils.absDouble(n.salientCoverage-o.salientCoverage);this.setFeature(e.Features.SALIENT_COVERAGE_DISSSIMILARITY,M);var E=i.toDouble(Math.abs(n.numShapes-o.numShapes));this.setFeature(e.Features.NUM_SHAPE_DIFF,E);var N=i.toDouble(Math.abs(n.gifsCount-o.gifsCount));this.setFeature(e.Features.NUM_GIFS_DIFF,N);var k=this.scoreVisualGroups(i.clone(n.visualGroupInfo),i.clone(o.visualGroupInfo));this.setFeature(e.Features.VISUAL_GROUP_DISSIMILARITY,k);var w=i.toDouble(Math.abs(n.numGridCells-o.numGridCells));this.setFeature(e.Features.NUM_GRIDCELL_DIFF,w);var G=i.clone(n.textRoles),P=i.clone(o.textRoles),O=i.toDouble(this.roleDifference(i.clone(G),i.clone(P)));this.setFeature(e.Features.LOCKUP_ROLE_DISSIMILARITY,O);var H=i.clone(n.shapeRoles),Y=i.clone(o.shapeRoles),B=i.toDouble(this.roleDifference(i.clone(H),i.clone(Y)));this.setFeature(e.Features.LOCKUP_ROLE_DISSIMILARITY,B)},r={},i.defineClass({name:"RetargetCompatibilityScore",ctor:o,superName:"WeightedScore",statics:{Features:{get:function(){return void 0===r.Features&&(r.Features=i.defineEnum("Features",{NUM_MOVEABLE_DIFF:0,LENGTH_TEXT_DIFF:1,NUM_IMAGE_DIFF:2,IMAGE_SIMILARITY:3,DESIGN_SIZE_DIFF:4,FAKE_DESIGN:5,GRID_DESIGN:6,NUM_SHAPE_DIFF:7,NUM_GIFS_DIFF:8,VISUAL_GROUP_DISSIMILARITY:9,NUM_GRIDCELL_DIFF:10,LOCKUP_ROLE_DISSIMILARITY:11,SHAPE_ROLE_DISSIMILARITY:12,SALIENT_COVERAGE_DISSSIMILARITY:13,NUM_FEAT:14})),r.Features}}},props:{scoreVisualGroups:function(e,t){var n,o,r=0;if(null!=e.children&&null!=t.children&&(n=e.children)&&(o=t.children)){r+=s.MathUtils.absDouble(i.toDouble(n.length-o.length)),e.layoutStrategy!=t.layoutStrategy&&(r+=1);var a=this.computeAreaofGroups(i.clone(n)),l=this.computeAreaofGroups(i.clone(o));r+=s.MathUtils.absDouble(a-l)/Math.max(a,l);for(var u=[],c=i.iter(n);!c.done;c.next()){for(var h=c.value,g=1e5,p=0,d=i.iter(i.range(0,o.length,!1));!d.done;d.next()){var f=d.value,y=i.clone(o[f]);if(!u.includes(f)){var m=this.subTreeMisMatchScore(i.clone(h),i.clone(y));m<g&&(g=m,p=f)}}r+=g/i.toDouble(n.length),u.push(p)}}return r},computeAreaofGroups:function(e){for(var t=0,n=i.iter(e);!n.done;n.next()){var o,r=n.value;(o=u.TheoRect.decodeJson(r.frame))&&(t+=o.area)}return t},subTreeMisMatchScore:function(e,t){var n=this,o=0,r=i.clone(i.as(e.children,["Array",["Dictionary","String","AnyObject"]])),a=i.clone(i.as(t.children,["Array",["Dictionary","String","AnyObject"]]));if(null!=r&&null!=a){e.layoutStrategy!=t.layoutStrategy&&(o+=1);var l=i.clone(i.opt(r,(function(e){return e.filter((function(e){return"Group"!=i.as(e.type,"String")}),n)}))),u=i.clone(i.opt(a,(function(e){return e.filter((function(e){return"Group"!=i.as(e.type,"String")}),n)}))),c=i.clone(i.opt(l,(function(e){return e.map((function(e){return e.role}),n)}))),h=i.clone(i.opt(u,(function(e){return e.map((function(e){return e.role}),n)})));o+=i.toDouble(this.roleDifference(i.clone(c),i.clone(h)));var g=i.clone(i.opt(r,(function(e){return e.filter((function(e){return"Group"==i.as(e.type,"String")}),n)}))),p=i.clone(i.opt(a,(function(e){return e.filter((function(e){return"Group"==i.as(e.type,"String")}),n)})));if(g.length>0||p.length>0){var d=this.computeAreaofGroups(i.clone(g)),f=this.computeAreaofGroups(i.clone(p));o+=s.MathUtils.absDouble(d-f)/Math.max(d,f)}}return o},roleDifference:function(e,t,n){void 0===n&&(n=!0);var o=0,r=i.clone(e),a=i.clone(t);n||(r=i.clone(t),a=i.clone(e));for(var l=i.iter(r);!l.done;l.next()){var s=l.value;a.includes(s)||(o+=1)}return o},reject:function(){return this.score<this.rejectThreshold}}}),o)},XupS:function(e,t,n){var o,r,a=t,i=n("oAGj"),l=n("iCxV"),s=n("cEEQ"),u=n("c+uM"),c=n("tGKA"),h=n("EoOi"),g=n("8t9B"),p=n("3UhB"),d=n("7l9C"),f=n("oKlP"),y=n("uUew");a.FontMetricsParams=(o=function(e,t){this.font=e,this.fontSize=t},i.defineClass({name:"FontMetricsParams",ctor:o}),o),a.AutoTextLayoutStrategy=(r=function(){this.tokens_=null,this.text_=null,this.fontName_=null,this.hiliteFontName_=null,this.hiliteRanges_=null,this.previousLayoutVariation_=h.TypographyVariation.Unset,s.BaseLockupLayoutStrategy.call(this)},i.defineClass({name:"AutoTextLayoutStrategy",ctor:r,superName:"BaseLockupLayoutStrategy",statics:{SPACER_CHAR:" ",_implements:function(e){return"LockupLayoutStrategy"==e}},props:{supportsConfiguration:function(e){return e.style.layout==u.LockupLayout.Auto},calculateTracking:function(e,t){return 0},calculateLeading:function(e,t){return.35},layout:function(e){var t,n=e.style,o=n.font.fontData,r=g.TypeLockupController.HIGHLIGHT_STYLE,a=i.clone(e.characterStyleRanges),l=i.opt(i.opt(n.characterStyles[r],(function(e){return e.font})),(function(e){return e.fontData}))||o;null!=this.tokens_&&null!=this.text_&&this.text_==e.text&&null!=this.fontName_&&this.fontName_==o.postScriptName&&null!=this.hiliteFontName_&&this.hiliteFontName_==l.postScriptName&&null!=this.hiliteRanges_&&g.TypeLockupController.rangesEqual(i.clone(this.hiliteRanges_),i.clone(a))||(this.buildTokenList(e.text,i.clone(a),o,l,32),this.text_=e.text,this.fontName_=o.postScriptName,this.hiliteFontName_=l.postScriptName,this.hiliteRanges_=i.clone(a),this.previousLayoutVariation_=h.TypographyVariation.Unset);var p,d=[],y=e.containerSize,m=new h.TypographyComposer(new h.TypographyParams(y),i.clone(this.tokens_));if(e.style.spacing=.35,e.style.tracking=0,e.style.layoutVariation==h.TypographyVariation.Unset){var T=i.clone(m.getApplicableLayouts());if(this.previousLayoutVariation_!=h.TypographyVariation.Unset){var S=i.indexOf(T,this.previousLayoutVariation_);((t=S)||null!=t?t:-1)>=0?e.style.layoutVariation=T[(S+1)%T.length]:e.style.layoutVariation=i.first(T)}else e.style.layoutVariation=i.first(T);e.style.alignment=u.LockupAlignment.Auto}else this.previousLayoutVariation_!=h.TypographyVariation.Unset&&(e.style.layoutVariation=this.previousLayoutVariation_);this.previousLayoutVariation_=e.style.layoutVariation;var L,R=m.layout(e.style.layoutVariation),v=R.bounds;L=R.hint==h.TypographyScaleHint.Width?y.width/v.width:R.hint==h.TypographyScaleHint.Height?y.height/v.height:Math.sqrt(y.width*y.height/(v.width*v.height));for(var I=new s.TypographicBoundingRatios(0,0,0,0,0,!1),A=i.clone(R.matrices),F=new f.TheoPoint(v.minX,v.minY),_=i.iter(i.toSequence(R.tokens));!_.done;_.next()){var C=_.value,x=C.offset,b=C.element,D=R.matrices[x].calculateTransformValuesSKRT(),M=L*D.yscale*32,E=c.Matrix2D.Identity.rotate(D.rotCosine,D.rotSine).translateTo((D.tx-F.x)*L,(D.ty-F.y)*L-b.postVertOffset*M),N=s.LockupItem.init_e7b2(!0,1==b.weight?r:null,A[x].transformRect(b.bounds).size,E,b.text,1==b.weight?l:o,M,M,I,0,b.range);d.push(N)}return p=v.size.multiply(L),new s.LayoutResults(i.clone(d),p,c.Matrix2D.Identity,I,0)},buildTokenList:function(e,t,n,o,r){this.tokens_=[];for(var s=e,u=0,c=new a.FontMetricsParams(n,r),h=!0,f=p.TypeLockupUtils.getWordRanges(e,g.HighlightMethod.Verbs),m=i.iter(f);!m.done;m.next()){for(var T=m.value,S=0,L=i.iter(t);!L.done;L.next()){var R=L.value;if(T.start<R.end&&T.end-1>R.start){S=1;break}}for(var v=e.substr(T.start,T.length).trim();u<e.length&&!s.startsWith(v);)s=s.substr(1),u+=1;c.font=1==S?o:n;var I=l.Host.textModelUtils.calcFontMetrics(v,S,c);I.range=new y.TextRange(u,u+I.text.length);var A,F=I.text.length>2&&d.TextToken.getGlyphType(I.text.substr(0,1))!=d.GlyphType.GENERIC,_=I.text.length>2&&d.TextToken.getGlyphType(I.text.substr(I.text.length-1,1))!=d.GlyphType.GENERIC;F?((A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(0,1),I.weight,c)).hspace/=4,A.type=d.TextToken.getGlyphType(I.text.substr(0,1)),A.range=new y.TextRange(u,u+A.text.length),this.tokens_.push(A),_?((A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(1,I.text.length-2),I.weight,c)).hspace/=4,A.range=new y.TextRange(u+1,u+1+A.text.length),i.opt(I.subTokens,(function(e){return e.push(A)})),(A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(I.text.length-1,1),I.weight,c)).type=d.TextToken.getGlyphType(I.text.substr(I.text.length-1,1)),A.range=new y.TextRange(u+I.text.length-1,u+I.text.length-1+A.text.length),this.tokens_.push(A)):((A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(1,I.text.length-1),I.weight,c)).range=new y.TextRange(u+1,u+A.text.length),this.tokens_.push(A))):_?((A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(0,I.text.length-1),I.weight,c)).hspace/=4,A.range=new y.TextRange(u,u+A.text.length),this.tokens_.push(A),I.subTokens=[],(A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(I.text.length-1,1),I.weight,c)).type=d.TextToken.getGlyphType(I.text.substr(I.text.length-1,1)),A.range=new y.TextRange(u+I.text.length-1,u+I.text.length-1+A.text.length),this.tokens_.push(A)):(h&&I.text.length>2&&d.TextToken.getGlyphType(I.text.substr(0,1))==d.GlyphType.GENERIC&&(I.subTokens=[],(A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(0,1),I.weight,c)).hspace/=4,A.type=d.GlyphType.DROPCAP,A.range=new y.TextRange(u,u+A.text.length),i.opt(I.subTokens,(function(e){return e.push(A)})),(A=l.Host.textModelUtils.calcFontMetrics(I.text.substr(1,I.text.length-1),I.weight,c)).range=new y.TextRange(u+1,u+1+A.text.length),i.opt(I.subTokens,(function(e){return e.push(A)}))),this.tokens_.push(I)),h=!1,u+=I.text.length,s=s.substr(I.text.length)}}}}),r)},cYVN:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("SpAV");r.RoleData=(o=function(e,t,n){for(var o=a.iter(t);!o.done;o.next()){var r=o.value;i.CoreAssert.isTrue(null!=n[r],void 0,"RoleData.init","RoleData.swift",24)}for(var l=a.iter(a.keys(n));!l.done;l.next())r=l.value,i.CoreAssert.isTrue(t.includes(r),void 0,"RoleData.init","RoleData.swift",27);this.forma=e,this.featureOrder=a.clone(t),this.featureValues=a.clone(n)},a.defineClass({name:"RoleData",ctor:o,props:{feat:function(e){return this.featureValues[e]},getUniqueKey:function(){for(var e="",t=a.iter(this.getFeatureVector());!t.done;t.next()){var n=t.value;e=e+a.toString("%.2f",n)+"-"}return e=a.replaceAll(e,".","")},asString:{get:function(){for(var e="",t=a.iter(this.featureOrder);!t.done;t.next()){var n=t.value,o=Math.round(1e3*this.featureValues[n])/1e3;e+=n+": "+a.toString(o)+",\n"}return e}},asJson:{get:function(){return"{\n"+this.asString+"\n}"}},getFeatureVector:function(){for(var e=[],t=a.iter(this.featureOrder);!t.done;t.next()){var n=t.value;e.push(this.featureValues[n])}return e}}}),o)},d2x6:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("gXiO"),l=n("tGKA"),s=n("7l9C"),u=n("1NAc");r.TypographyTree=(o=function(){i.CoreObject.call(this),this.root_=null},a.defineClass({name:"TypographyTree",ctor:o,superName:"CoreObject",statics:{buildArchetypeTree:function(e){var t=new o;if(e.length>1){for(var n=-1,r=[],i=[],l=a.iter(a.toSequence(e));!l.done;l.next()){var c=l.value,h=c.offset,g=c.element,p=o.createTextNode(g,h);if(r.length>0&&g.weight!=n){var d=r[0];r.shift();for(var f=a.iter(r);!f.done;f.next()){var y=f.value;d=L=o.createGroupNode(d,y,s.AlignmentIdiom.LRBB)}i.push(d),r.splice(0)}r.push(p),n=g.weight}if(r.length>0){d=r[0],r.shift();for(var m=a.iter(r);!m.done;m.next())y=m.value,d=L=o.createGroupNode(d,y,s.AlignmentIdiom.LRBB);i.push(d)}var T=i[0];i.shift();for(var S=a.iter(i);!S.done;S.next())d=S.value,T=L=o.createGroupNode(T,d,s.AlignmentIdiom.LRBB);t.setRoot(T)}else{p=o.createTextNode(a.first(e),0);var L=o.createGroupNode(p,new s.SpacerNode(1,new u.TheoSize(0,0)),s.AlignmentIdiom.LRBB);t.setRoot(L)}return t},createTextNode:function(e,t){return new s.TextNode(e,t)},createGroupNode:function(e,t,n){var o=new s.GroupNode(e,t);return o.transAlign=n,o}},props:{setRoot:function(e){this.root_=e},getRoot:function(){return this.root_},getBounds:function(){return this.root_.localbounds()},calcGlobal:function(e){if(e.isSame(this.root_)){var t=e.local();e.globalMat=new l.Matrix2D(t.a,t.b,t.c,t.d,t.tx,t.ty)}else if(a.opt(e.parent,(function(e){return null==e.globalMat}))&&this.calcGlobal(e.parent),e instanceof s.TextNode){var n=new l.Matrix2D(1,0,0,1,0,e.getVerticalOffset());e.globalMat=n.concat(e.local()).concat(e.parent.globalMat)}else e.globalMat=e.local().concat(e.parent.globalMat);e instanceof s.GroupNode&&(this.calcGlobal(e.leftChild),this.calcGlobal(e.rightChild))},calcGlobalMatrices:function(){this.root_.calcTransform(),this.calcGlobal(this.root_)},rotateNode:function(e){if(null!=e.parent&&!a.opt(e.parent,(function(e){return null==e.parent}))){var t=e.parent,n=t.parent;if(null!=n.parent){var o=n.parent;t.parent=o,o.leftChild.isSame(n)?o.leftChild=t:o.rightChild=t}else t.parent=null,this.setRoot(t);n.leftChild.isSame(t)?(n.leftChild=t.rightChild,n.leftChild.parent=n,t.rightChild=n):(n.rightChild=t.leftChild,n.rightChild.parent=n,t.leftChild=n),n.parent=t}},description:{get:function(){var e="TypographyTree:\r\n";return null!=this.root_&&(e+=this.root_.description),e}}}}),o)},hywZ:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("SpAV"),l=n("UGKO"),s=n("cmoc"),u=n("xe42"),c=n("16hp"),h=n("9Lk3"),g=n("3DEm"),p=n("uxH+"),d=n("K0Rh"),f=n("sIWg");r.LogoPlacementSuggester=(o=function(e,t){this.CONTRAST_WEIGHT=-10,this.END_BORDER=.98,this.START_BORDER=.02,this.MID_CANONICAL=.5,this.MIN_LIGHTNESS_DIFF=20,this.SYMMETRIC_THRESHOLD=300,c.FormaPlacementSuggester.call(this,e,t)},a.defineClass({name:"LogoPlacementSuggester",ctor:o,superName:"FormaPlacementSuggester",statics:{KIND:{get:function(){return"LogoPlacementSuggester"}}},props:{createPlacementSuggestions:function(e,t){void 0===t&&(t=null);var n=this;if(null==this.group.frame)return[];var o=this.group.frame;if(this.group.kind==d.RootForma.KIND){var r=this.group.page.pageSize;o=f.TheoRect.fromSize(r);var i,s=0,y=this.group.root;if(null!=a.as(y.controller,p.RootController)){var m,T=a.clone(y.filterByControllerKind(h.GridController.KIND));T.length>0&&(m=a.as(T[0].controller,h.GridController))&&(s=m.margin)}(i=this.forma.finalFrame)&&s>0&&(s<i.height||s<i.width)&&(o=f.TheoRect.fromXYWH(s,s,r.width-2*s,r.height-2*s))}for(var S,L=c.FormaPlacementSuggester.createPlacementInputs(this.forma,this.group),R=a.clone(this.getSearchLocations(this.forma,o,L,e,t)),v=-1/0,I=this.initializeLogoPlacementScore(L),A=a.iter(R);!A.done;A.next()){for(var F=A.value,_=c.FormaPlacementSuggester.createPlacementSuggestion(this.forma,F,o,L,I),C=0,x=a.iter(L.backgroundRegions);!x.done;x.next()){var b=x.value;if(null!=F.intersectionWith(b.finalFrame)){var D=a.opt(this.forma.controller,(function(e){return e.getAverageColor(n.forma.finalFrame)})),M=a.opt(b.controller,(function(e){return e.getAverageColor(F)}));if(null!=D&&null!=M&&!a.opt(M,(function(e){return e.contrasts(D)}))){var E=g.MathUtils.absDouble(this.MIN_LIGHTNESS_DIFF-a.opt(M,(function(e){return e.lightnessDifference(D)})));C=g.MathUtils.maxDouble(C,E)}}}a.opt(_.weightedScore,(function(e){return e.setFeature(u.FormaPlacementScore.Features.CONTRAST,a.toDouble(C))})),_.weightedScore.reject()||(I=this.initializeLogoPlacementScore(L)),_.score>v&&(v=_.score,S=_,I=this.initializeLogoPlacementScore(L))}return[a.as(S,l.IDesignSuggestion)]},getSearchLocations:function(e,t,n,o,r){void 0===r&&(r=null),null!=r&&i.CoreAssert.warning("LogoPlacementSuggestor.getSearchLocations ignores requested aspect ratio");var l,s=[];if(l=e.finalFrame){var u=l.height,c=l.width,h=t.evalXY(this.END_BORDER,this.END_BORDER),g=new f.TheoRect(h.x-c,h.y-u,h.x,h.y),p=t.evalXY(this.END_BORDER,this.START_BORDER),d=new f.TheoRect(p.x-c,p.y,p.x,p.y+u);s.push(g),s.push(d);for(var y=a.iter(this.getContentAlignedLocations(t));!y.done;y.next()){var m=y.value;t.contains(m)&&s.push(m)}var T=t.evalXY(this.MID_CANONICAL,this.START_BORDER),S=new f.TheoRect(T.x-c/2,T.y,T.x+c/2,T.y+u),L=t.evalXY(this.START_BORDER,this.START_BORDER),R=new f.TheoRect(L.x,L.y,L.x+c,L.y+u),v=t.evalXY(this.START_BORDER,this.END_BORDER),I=new f.TheoRect(v.x,v.y-u,v.x+c,v.y),A=t.evalXY(this.MID_CANONICAL,this.END_BORDER),F=new f.TheoRect(A.x-c/2,A.y-u,A.x+c/2,A.y),_=this.getSymmetricContentLocations();_&&(s.push(F),s.push(I)),s.push(S),s.push(R),_||(s.push(I),s.push(F))}return s},initializeLogoPlacementScore:function(e){var t=new u.FormaPlacementScore(e);return t.setWeight(u.FormaPlacementScore.Features.XSYMM,0),t.setWeight(u.FormaPlacementScore.Features.YSYMM,0),t.setWeight(u.FormaPlacementScore.Features.EDGE,0),t.setWeight(u.FormaPlacementScore.Features.DISTANCE_TO_CENTER,0),t.setWeight(u.FormaPlacementScore.Features.ALIGNMENT,0),t.setWeight(u.FormaPlacementScore.Features.CONTRAST,a.toDouble(this.CONTRAST_WEIGHT)),t.setWeight(u.FormaPlacementScore.Features.TEXT_OVERLAP,-1e4),t.setWeight(u.FormaPlacementScore.Features.FLOATING_ELEMENT_OVERLAP,-5e3),t},getContentAlignedLocations:function(e){var t,n,o,r;if((t=a.as(this.forma,s.FrameForma))&&(n=t.root)&&(o=n.finalFrame)&&(r=this.forma.finalFrame)){var i=r.height,l=r.width,u=a.clone(n.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(u.length>0){var c=a.sort(u,(function(e,t){return e.finalFrame.maxY-o.minY<t.finalFrame.maxY-o.minY})),h=a.clone(c[c.length-1].finalFrame.points),g=a.clone(c[0].finalFrame.points),p=a.opt(n.finalFrame,(function(e){return e.locate(h[1].x,h[1].y)})),d=e.evalXY(a.opt(p,(function(e){return e.x})),a.opt(p,(function(e){return e.y}))+this.START_BORDER+.03),y=new f.TheoRect(d.x,d.y,d.x+l,d.y+i),m=a.opt(n.finalFrame,(function(e){return e.locate(h[3].x,h[3].y)})),T=e.evalXY(a.opt(m,(function(e){return e.x})),a.opt(m,(function(e){return e.y}))+this.START_BORDER+.03),S=new f.TheoRect(T.x-l,T.y,T.x,T.y+i),L=a.opt(n.finalFrame,(function(e){return e.locate(g[0].x,g[0].y)})),R=e.evalXY(a.opt(L,(function(e){return e.x})),a.opt(L,(function(e){return e.y}))-this.START_BORDER-.03);return[y,S,new f.TheoRect(R.x-l/2,R.y-i,R.x+l/2,R.y)]}}return[]},getSymmetricContentLocations:function(){var e,t,n,o=this;if((e=a.as(this.forma,s.FrameForma))&&(t=e.root)&&(n=t.finalFrame)){var r=a.clone(t.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));return!(r.filter((function(e){return g.MathUtils.absDouble(n.center.distanceTo(e.finalFrame.center))<o.SYMMETRIC_THRESHOLD}),this).length<=a.toInt(r.length/2))}return!1}}}),o)},i0RJ:function(e,t,n){n("oAGj")},iSwi:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("cZuM"),l=n("Z25M"),s=n("CaSj"),u=n("FNB+"),c=n("cmoc"),h=n("9Lk3"),g=n("ZK0l"),p=n("/afT"),d=n("c+uM"),f=n("LqGn"),y=n("7Ta2"),m=n("T6jX"),T=n("8t9B"),S=n("sIWg");r.RetargetSuggester=(o=function e(t,n,o){var r=o.beginTransaction("cleanupRoot");o.controller.setAutomaticLayoutInteractionMode(),o.firstPage.root.isModel=!0,o.firstPage.root.bounds=S.TheoRect.fromSize(o.firstPage.pageSize),this.origModelSize_=o.firstPage.pageSize,this.model_=o.firstPage.root,e.cleanupRoot(this.model_),o.firstPage.setPageSize(t.page.pageSize),r.end(),this.modelDoc_=o,this.originalRoot_=n,s.DesignSuggester.call(this,t,t)},a.defineClass({name:"RetargetSuggester",ctor:o,superName:"DesignSuggester",statics:{KIND:{get:function(){return"RetargetSuggester"}},cleanupRoot:function(e){for(var t=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()}))),n=a.iter(t);!n.done;n.next()){var r,i,l=n.value;if((r=a.as(l.controller,T.TypeLockupController))&&(i=r.lockupStyle)&&(r.updateGroup(),r.snapSizeToBounds(),1==r.numLines()))for(var s=a.iter(t);!s.done;s.next()){var c=s.value;if(!a.eq(u._equality_Forma_Forma,l,c)){var h=a.as(c.controller,T.TypeLockupController);h.updateGroup();var g=h.numLines(),p=a.opt(h.lockupStyle,(function(e){return e.alignment})),f=1==g||g>1&&(p==d.LockupAlignment.Center||p==d.LockupAlignment.UNSET),y=1==g||g>1&&p==d.LockupAlignment.Left,m=1==g||g>1&&p==d.LockupAlignment.Right;r.beginBlockedUpdate(),o.frameAligned(l,c,.5,null)&&f?(i.alignment=d.LockupAlignment.Center,i.layout=d.LockupLayout.Standard):o.frameAligned(l,c,0,null)&&y?(i.alignment=d.LockupAlignment.Left,i.layout=d.LockupLayout.Standard):o.frameAligned(l,c,1,null)&&m?(i.alignment=d.LockupAlignment.Right,i.layout=d.LockupLayout.Standard):(i.alignment=d.LockupAlignment.Center,i.layout=d.LockupLayout.Standard),r.endBlockedUpdate(),r.styleChanged()}}}},frameAligned:function(e,t,n,o){var r=e.frame,l=t.frame;if(null==r||null==l||null==n&&null==o)return!1;var s,u=1;(s=a.opt(e.page.view,(function(e){return e.getViewportTransform()})))&&(u=Math.sqrt(Math.abs(s.determinant)));var c=i.AlignmentDetector.DISTANCE_THRESHOLD/u,h=!0;return null!=n&&(h=h&&Math.abs(r.evalXY(n,.5).x-l.evalXY(n,.5).x)<c),null!=o&&(h=h&&Math.abs(r.evalXY(.5,o).y-l.evalXY(.5,o).y)<c),h}},props:{model:{get:function(){return this.model_}},createFormaMatches:function(e,t){var n,o;function r(e){return(!(n=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==n||!n)&&(!(!(o=a.opt(e.controller,(function(e){return e.userGroup})))&&null==o||!o)||!(!e.isTypeLockup()&&!e.hasIntent(u.Forma.INTENT_ICON))||!!(t=a.as(e,c.FrameForma))&&t.isLogo());var t}var i=a.clone(e.filterWithCallback(r)),l=a.clone(t.filterWithCallback(r)),g=!m.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.page),d=!m.TheoDocumentUtils.enableFastHeuristicsForComplexPage(t.page),f=a.clone(p.GroupDetector.detectProximityGroups(a.clone(i),null,g)),y=a.clone(p.GroupDetector.detectProximityGroups(a.clone(l),e.bounds.height/this.origModelSize_.height*150,d));y.length>f.length&&(f=a.clone(p.GroupDetector.splitFormaGroups(a.clone(f),y.length)));var T=a.clone(e.filterWithCallback((function(e){return a.opt(e.controller,(function(e){return e.kind==h.GridController.KIND}))}),u.FormaTraversal.JustChildren)),S=a.clone(t.filterWithCallback((function(e){return a.opt(e.controller,(function(e){return e.kind==h.GridController.KIND}))}),u.FormaTraversal.JustChildren)),L=a.clone(e.filterWithCallback((function(e){return e.isLogo()}))),R=a.clone(t.filterWithCallback((function(e){return e.isLogo()})));a.sortInPlace(f,(function(e,t){return e.length>t.length})),a.sortInPlace(y,(function(e,t){return e.length>t.length})),a.sortInPlace(R,(function(e,t){var n=e.root.finalFrame.center;return e.finalFrame.center.distanceTo(n)<t.finalFrame.center.distanceTo(n)}));for(var v=i.length!=l.length||i.length>4,I=[],A=a.iter(s.DesignSuggester.getPermutations(v?y.length:l.length));!A.done;A.next()){var F=A.value,_=[];if(_.push({a:[a.as(e,u.Forma)],b:[a.as(t,u.Forma)]}),T.length>0&&S.length>0)for(var C=a.iter(a.range(0,T.length,!1));!C.done;C.next()){var x=C.value;_.push({a:[T[x]],b:[S[x%S.length]]})}if(R.length>0)for(var b=a.iter(a.range(0,L.length,!1));!b.done;b.next())x=b.value,_.push({a:[L[x]],b:[R[x%R.length]]});if(i.length>0&&l.length>0)if(v){for(var D=y.concat(),M=[],E=a.iter(a.range(0,D.length,!1));!E.done;E.next())M.push([]);for(var N=a.iter(a.range(0,f.length,!1));!N.done;N.next()){var k=N.value,w=a.clone(f[k]),G=F[k%F.length];a.append(M[G],w)}for(var P=a.iter(a.range(0,D.length,!1));!P.done;P.next())M[x=P.value].length>0&&_.push({a:M[x],b:D[x]})}else for(var O=a.iter(a.range(0,i.length,!1));!O.done;O.next())k=O.value,_.push({a:[i[k]],b:[l[F[k%F.length]]]});I.push(a.clone(_));for(var H=a.iter(a.range(0,_.length,!1));!H.done;H.next()){var Y=_[x=H.value],B=Math.max(Y.a.length,Y.b.length);if(B>1)for(var W=Y.a.length==B,U=a.clone(s.DesignSuggester.getPermutations(B,10)),V=a.iter(a.range(1,U.length,!1));!V.done;V.next()){var X=V.value,z=a.clone(U[X]),j=_.concat(),Z=a.clone(j[x].a),K=a.clone(j[x].b);if(W){Z=[];for(var q=a.iter(a.range(0,B,!1));!q.done;q.next()){var J=q.value;Z.push(j[x].a[z[J]])}}else{K=[];for(var Q=a.iter(a.range(0,B,!1));!Q.done;Q.next())J=Q.value,K.push(j[x].b[z[J]])}j[x]={a:Z,b:K},I.push(a.clone(j))}}}return I},createSuggestions:function(){for(var e=this.forma,t=a.clone(this.createFormaMatches(this.originalRoot_,this.model)),n=a.clone(this.originalRoot_.filterWithCallback(l.DesignFeatureUtils.isFloating)),o=a.clone(this.model.filterWithCallback(l.DesignFeatureUtils.isFloating)),r={},i={},s=new y.RoleSuggester,u=this.model.filterWithCallback((function(e){return e.isTypeLockup()})).concat(this.originalRoot_.filterWithCallback((function(e){return e.isTypeLockup()}))),c=a.iter(u);!c.done;c.next()){var h=c.value;a.opt(a.as(h.controller,g.GroupController),(function(e){return e.beginBlockedUpdate()}))}if(!m.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.page)){for(var p=a.iter(n);!p.done;p.next()){var d=p.value;r[d.formaID]=a.clone(s.getRole(d))}for(var T=a.iter(o);!T.done;T.next()){var S=T.value;i[S.formaID]=a.clone(s.getRole(S))}}for(var L=[],R=a.iter(t);!R.done;R.next()){var v=R.value;L.push(new f.RetargetSuggestion(this.forma,this.originalRoot_,this.model,this.modelDoc_,a.clone(v),a.clone(r),a.clone(i)))}for(var I=a.iter(u);!I.done;I.next())h=I.value,a.opt(a.as(h.controller,g.GroupController),(function(e){return e.endBlockedUpdate()}));return a.sort(L,(function(e,t){return e.score>t.score}))}}}),o)},lYNH:function(e,t,n){var o,r,a,i=t,l=n("oAGj"),s=n("uj1m"),u=n("7Ta2"),c=n("taeg");i.ShapeRoleSuggesterFactory=(o=function(){},l.defineClass({name:"ShapeRoleSuggesterFactory",ctor:o,statics:{Create:function(e){return void 0===e&&(e=""),"MLP"==e?new i.ShapeRoleSuggesterMLP:new i.ShapeRoleSuggesterSimple}}}),o),i.ShapeRoleSuggesterMLP=(r=function(){c.RoleSuggesterMLP.call(this)},l.defineClass({name:"ShapeRoleSuggesterMLP",ctor:r,superName:"RoleSuggesterMLP",statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){var e=s.MLPModel.loadNNModel("ShapeRole");return l.opt(e,(function(e){return e.finalSoftmax=!1})),e}}}),r),i.ShapeRoleSuggesterSimple=(a=function(){},l.defineClass({name:"ShapeRoleSuggesterSimple",ctor:a,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t=u.InferredRoleType.Undefined;return e.forma.isGridCell()&&(t=e.forma.controller.floating?u.InferredRoleType.Backing:u.InferredRoleType.Background),u.InferredRole.init_84d1(t,1)}}}),a)},ol4x:function(e,t,n){var o,r,a,i,l,s,u,c,h,g,p,d,f,y,m,T,S,L,R,v,I,A,F,_=t,C=n("oAGj"),x=n("3DEm"),b=n("EoOi"),D=n("7l9C"),M=n("1NAc"),E=n("d2x6");_.SpacerIdiom=C.defineEnum("SpacerIdiom",{insertLeft:0,insertRight:1,insertAbove:2,insertBelow:3}),_.TypographyLayout=(o=function(){},C.defineClass({name:"TypographyLayout",ctor:o,statics:{clockWise:90,counterClockwise:270,leadingFactor:.1,propagateDown:function(e,t){if(e instanceof D.GroupNode){var n=e;o.propagateDown(n.leftChild,t),o.propagateDown(n.rightChild,t),n.transAlign=t}},longestRun:function(e,t){for(var n=0,r=null,a=C.iter(e);!a.done;a.next()){var i=a.value;t&&o.propagateDown(i,D.AlignmentIdiom.LRBB),i.calcTransform();var l=i.localbounds().width;l>n&&(n=l,r=i)}return r},longestWord:function(e,t){var n=0,o=null;if(t instanceof D.GroupNode)for(var r=C.clone(t.getTextNodes()),a=C.iter(r);!a.done;a.next()){var i=a.value;i.calcTransform();var l=i.localbounds().width;l>n&&(n=l,o=i)}else t instanceof D.TextNode&&(o=t);return o},canRotate:function(e){e.calcTransform();var t=e.localbounds();return t.width/t.height>1},getDesiredSize:function(e,t){var n=t.aspectRatio,o=e.width,r=o/n;return r<e.height&&(o*=e.height/r,r=e.height),new M.TheoSize(o,r)},insertSpacer:function(e,t,n,o,r,a){var i,l=t.parent;switch(a){case 12:i=new D.SpacerNode(o,new M.TheoSize(n,t.localbounds().height));break;default:i=new D.SpacerNode(o,new M.TheoSize(t.localbounds().width,n))}var s=r==_.SpacerIdiom.insertLeft||r==_.SpacerIdiom.insertAbove?new D.GroupNode(i,t):new D.GroupNode(t,i);s.transAlign=a,s.parent=l,l.leftChild.isSame(t)?l.leftChild=s:l.rightChild=s},getScore:function(e,t){return x.MathUtils.absDouble(e/t-1)},canLineBreak:function(e,t){return e.token_.type==D.GlyphType.GENERIC&&t.token_.type==D.GlyphType.GENERIC},lineWrap:function(e,t,n,r){var a=r.aspectRatio;o.propagateDown(t,D.AlignmentIdiom.LRBB),t.calcTransform();for(var i=o.getScore(a,t.localbounds().size.aspectRatio),l=C.clone(t.getTextNodes()),s=[],u=C.iter(l);!u.done;u.next()){var c=u.value,h=c.parent;h.isSame(t)||h.leftChild instanceof D.TextNode&&h.rightChild.isSame(c)||s.push(h)}for(var g=999999.9,p=[],d=[],f=C.iter(C.range(1,l.length,!0));!f.done;f.next()){var y=f.value;d.splice(0);for(var m=y;m<l.length;)d.push(m),m+=y;d.push(l.length),o.buildTreeFromLines(C.clone(l),t,C.clone(s),C.clone(d),n),t.calcTransform();var T=o.getScore(a,t.localbounds().size.aspectRatio);if(!(T<g))break;g=T,p.splice(0);for(var S=C.iter(d);!S.done;S.next())m=S.value,p.push(m)}return g<i?(o.buildTreeFromLines(C.clone(l),t,C.clone(s),C.clone(p),n),p.length>1):(o.propagateDown(t,D.AlignmentIdiom.LRBB),!1)},buildTreeFromLines:function(e,t,n,r,a){for(var i=C.iter(n);!i.done;i.next())i.value.parent=null;var l=t;l.leftChild=e[0],e[0].parent=l;for(var s=0==r[0]?1:0,u=0,c=1;c<e.length;){var h=o.canLineBreak(e[c-1],e[c]);if(1==c)l.rightChild=e[c],e[c].parent=l,h&&s<r.length&&c==r[s]?(l.transAlign=a,s+=1):t.transAlign=D.AlignmentIdiom.LRBB;else if(h&&s<r.length&&c==r[s])(g=n[u]).leftChild=t.leftChild,g.leftChild.parent=g,g.rightChild=t.rightChild,g.rightChild.parent=g,t.leftChild=g,g.parent=t,g.transAlign=t.transAlign,t.rightChild=e[c],e[c].parent=t,t.transAlign=a,l=t,u+=1,s+=1;else{var g=n[u],p=l.rightChild;g.leftChild=p,p.parent=g,g.rightChild=e[c],e[c].parent=g,l.rightChild=g,g.parent=l,g.transAlign=D.AlignmentIdiom.LRBB,l=g,u+=1}c+=1}},superscriptSymbols:function(e){var t=C.clone(e instanceof D.GroupNode?e.getTextNodes():[e]);t[0].token_.type==D.GlyphType.SYMBOL&&(t[0].scaleAlign=.5,t[0].parent.transAlign=D.AlignmentIdiom.LRtt),t[t.length-1].token_.type==D.GlyphType.SYMBOL&&(t[t.length-1].scaleAlign=.5,t[t.length-1].parent.transAlign=D.AlignmentIdiom.LRtt)}},props:{conditionsMet:function(e,t){return!0},arrangeText:function(e,t,n){return b.TypographyScaleHint.Aspect}}}),o),_.SimpleAlignmentTypographyLayout=(r=function(){},C.defineClass({name:"SimpleAlignmentTypographyLayout",ctor:r,superName:"TypographyLayout",props:{init_d41d:function(){this.alignment_=D.AlignmentIdiom.LRBB},init_5a15:function(e){this.alignment_=e},conditionsMet:function(e,t){return e.getRoot().getTextNodes().length>1},arrangeText:function(e,t,n){for(var o=C.iter(t);!o.done;o.next()){var r=o.value;_.TypographyLayout.propagateDown(r,D.AlignmentIdiom.LRBB),null!=r.parent&&(r.parent.transAlign=this.alignment_),_.TypographyLayout.superscriptSymbols(r)}return b.TypographyScaleHint.Aspect}}}),r),_.ReflowAlignmentTypographyLayout=(a=function(){},C.defineClass({name:"ReflowAlignmentTypographyLayout",ctor:a,superName:"SimpleAlignmentTypographyLayout",props:{conditionsMet:function(e,t){return _.SimpleAlignmentTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))||this.alignment_==D.AlignmentIdiom.LLtb&&e.getRoot().getTextNodes().length>1},arrangeText:function(e,t,n){var o=this;_.TypographyLayout.propagateDown(e.getRoot(),D.AlignmentIdiom.LRBB),e.getRoot().calcTransform();var r=e.getRoot().localbounds();_.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,C.clone(t),n),e.getRoot().calcTransform(),r=e.getRoot().localbounds();var a=_.TypographyLayout.getDesiredSize(r.size,n.size_);if(1==t.length)_.TypographyLayout.lineWrap(e,C.first(t),this.alignment_,a);else for(var i=C.iter(t);!i.done;i.next()){for(var l=i.value,s=C.iter(t);!s.done;s.next()){var u=s.value;if(u.getId()!=l.getId()){var c=u.localbounds().size;a=new M.TheoSize(a.width,a.height-c.height)}}l instanceof D.GroupNode&&_.TypographyLayout.lineWrap(e,l,this.alignment_,a),C.opt(l.parent,(function(e){return e.transAlign=o.alignment_}))}return b.TypographyScaleHint.Width},init_d41d:function(){C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_d41d)},init_5a15:function(e){C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_5a15,e)}}}),a),_.ScaledSimpleAlignmentTypographyLayout=(i=function(){},C.defineClass({name:"ScaledSimpleAlignmentTypographyLayout",ctor:i,superName:"SimpleAlignmentTypographyLayout",props:{conditionsMet:function(e,t){return t.length>1},arrangeText:function(e,t,n){for(var o=_.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,C.clone(t),n),r=0,a=0,i=C.iter(t);!i.done;i.next()){(c=i.value).calcTransform();var l=c.localbounds().width;1==c.getWeight()?l>r&&(r=l):l>a&&(a=l)}var s=r/a;if(s<1)for(var u=C.iter(t);!u.done;u.next()){var c;0==(c=u.value).getWeight()&&(c.calcTransform(),c.scaleAlign=s)}return o},init_d41d:function(){C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_d41d)},init_5a15:function(e){C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_5a15,e)}}}),i),_.FitTypographyLayout=(l=function(e){this.flavor_=e,C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_5a15,D.AlignmentIdiom.CCtb)},C.defineClass({name:"FitTypographyLayout",ctor:l,superName:"SimpleAlignmentTypographyLayout",statics:{FIT_EMPHASIZED:0,FIT_EMPHASIZED_ALL:1,FIT_ALL:2},props:{conditionsMet:function(e,t){if(_.SimpleAlignmentTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))){if(this.flavor_==l.FIT_ALL)return!0;if(t.length>1)return this.flavor_!=l.FIT_EMPHASIZED||0==_.TypographyLayout.longestRun(C.clone(t),!0).getWeight()}return!1},arrangeText:function(e,t,n){var o=_.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,C.clone(t),n);if(this.flavor_==l.FIT_ALL)if(1==t.length){_.TypographyLayout.propagateDown(e.getRoot(),D.AlignmentIdiom.LLtb),e.getRoot().calcTransform();for(var r=_.TypographyLayout.longestWord(e,e.getRoot()).localbounds().width,a=C.clone(e.getRoot().getTextNodes()),i=C.iter(a);!i.done;i.next())(p=i.value).scaleAlign=r/p.localbounds().width}else{_.ReflowAlignmentTypographyLayout.init_5a15(D.AlignmentIdiom.LLtb).arrangeText(e,C.clone(t),n),e.getRoot().calcTransform(),r=(d=_.TypographyLayout.longestRun(C.clone(t),!1)).localbounds().width;for(var s=C.iter(t);!s.done;s.next())for(var u=s.value,c=C.clone(u instanceof D.GroupNode?u.getTextNodes():[u]),h=C.iter(c);!h.done;h.next()){for(var g=h.value,p=C.as(g,D.TypographyNode);p.getId()!=u.getId()&&p.parent.transAlign!=D.AlignmentIdiom.LLtb;)p=p.parent;p.scaleAlign=r/p.localbounds().width}}else{r=(d=_.TypographyLayout.longestRun(C.clone(t),!0)).localbounds().width;for(var d,f=C.iter(t);!f.done;f.next())u=f.value,0!=this.flavor_||1==u.getWeight()?(u.calcTransform(),u.scaleAlign=r/u.localbounds().width):d.scaleAlign=1;0==t[0].getWeight()&&null!=t[0].parent&&(t[0].parent.transAlign=D.AlignmentIdiom.LLtb),0==t[t.length-1].getWeight()&&null!=t[t.length-1].parent&&(t[t.length-1].parent.transAlign=D.AlignmentIdiom.RRtb)}return o}}}),l),_.StepTypographyLayout=(s=function e(t){this.flavor_=t,C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_5a15,t>=e.STEP_REVERSE?D.AlignmentIdiom.LRbt:D.AlignmentIdiom.LRtb)},C.defineClass({name:"StepTypographyLayout",ctor:s,superName:"SimpleAlignmentTypographyLayout",statics:{STEP:0,STEP_ROTATE:1,STEP_REVERSE:2,STEP_ROTATE_REVERSE:3},props:{conditionsMet:function(e,t){return t.length>2},arrangeText:function(e,t,n){var o=_.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,C.clone(t),n);if(this.flavor_==s.STEP_ROTATE||this.flavor_==s.STEP_ROTATE_REVERSE)for(var r=C.iter(C.toSequence(t));!r.done;r.next()){var a=r.value,i=a.offset,l=a.element;i%2!=0?this.flavor_==s.STEP_ROTATE?(l.rotateAlign=_.TypographyLayout.clockWise,l.parent.transAlign=D.AlignmentIdiom.LRctt):(l.rotateAlign=_.TypographyLayout.counterClockwise,l.parent.transAlign=D.AlignmentIdiom.LRcbb):l.parent.transAlign=this.flavor_==s.STEP_ROTATE_REVERSE?D.AlignmentIdiom.LRtt:D.AlignmentIdiom.LRBB}return o}}}),s),_.DropTypographyLayout=(u=function e(t){this.flavor_=t,C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_5a15,t==e.DROP_DOWN?D.AlignmentIdiom.LRtt:D.AlignmentIdiom.LRBB)},C.defineClass({name:"DropTypographyLayout",ctor:u,superName:"SimpleAlignmentTypographyLayout",statics:{DROP_DOWN:0,DROP_UP:1},props:{conditionsMet:function(e,t){return t.length>2&&t.length%2==0},arrangeText:function(e,t,n){for(var o=_.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,C.clone(t),n),r=C.iter(C.toSequence(t));!r.done;r.next()){var a=r.value,i=a.offset,l=a.element;i%2!=0&&(l.rotateAlign=this.flavor_==u.DROP_DOWN?_.TypographyLayout.clockWise:_.TypographyLayout.counterClockwise)}return o}}}),u),_.StaggerTypographyLayout=(c=function(){_.TypographyLayout.call(this)},C.defineClass({name:"StaggerTypographyLayout",ctor:c,superName:"TypographyLayout",props:{conditionsMet:function(e,t){return t.length>=4&&t.length%2==0},arrangeText:function(e,t,n){for(var o=[],r=[],a=0;a<t.length;)_.TypographyLayout.propagateDown(t[a],D.AlignmentIdiom.LRBB),_.TypographyLayout.propagateDown(t[a+1],D.AlignmentIdiom.LRBB),1==t[a].getWeight()?t[a].scaleAlign=2:t[a+1].scaleAlign=2,(i=new D.GroupNode(t[a],t[a+1])).transAlign=D.AlignmentIdiom.LRmm,o.push(i),r.push(i),a+=2;for(;r.length>1;){var i;(i=new D.GroupNode(r[0],r[1])).transAlign=D.AlignmentIdiom.cCCtb,r.splice(1,1),r[0]=i}return e.setRoot(r[0]),b.TypographyScaleHint.Width}}}),c),_.DoubletTypographyLayout=(h=function(){_.TypographyLayout.call(this)},C.defineClass({name:"DoubletTypographyLayout",ctor:h,superName:"TypographyLayout",props:{conditionsMet:function(e,t){return 2==t.length}}}),h),_.RotateTypographyLayout=(g=function(e){this.flavor_=e,_.DoubletTypographyLayout.call(this)},C.defineClass({name:"RotateTypographyLayout",ctor:g,superName:"DoubletTypographyLayout",statics:{ROTATE_EMPHASIZED:0,ROTATE_EMPHASIZED_MULTI:1,ROTATE_UNEMPHASIZED:2,ROTATE_UNEMPHASIZED_ADJACENT:3},props:{runToRotate:function(e){return this.flavor_==g.ROTATE_EMPHASIZED||this.flavor_==g.ROTATE_EMPHASIZED_MULTI?1==e[0].getWeight()?0:1:0==e[0].getWeight()?0:1},conditionsMet:function(e,t){if(_.DoubletTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))){var n=this.runToRotate(C.clone(t));if(this.flavor_==g.ROTATE_EMPHASIZED_MULTI&&!(t[(n+1)%2]instanceof D.GroupNode))return!1;var o=t[n];return _.TypographyLayout.propagateDown(o,D.AlignmentIdiom.LRBB),_.TypographyLayout.canRotate(o)}return!1},arrangeText:function(e,t,n){var o,r=b.TypographyScaleHint.Aspect,a=this.runToRotate(C.clone(t)),i=1==t[a].getWeight()?a:(a+1)%2,l=t[i],s=t[(i+1)%2];switch(_.TypographyLayout.propagateDown(l,D.AlignmentIdiom.LRBB),_.TypographyLayout.superscriptSymbols(l),_.TypographyLayout.superscriptSymbols(s),t[a].rotateAlign=0==a?_.TypographyLayout.counterClockwise:_.TypographyLayout.clockWise,l.calcTransform(),this.flavor_==g.ROTATE_EMPHASIZED_MULTI?(h=(c=l.localbounds()).aspectRatio<n.size_.aspectRatio?new M.TheoSize(n.size_.width*c.height/n.size_.height-c.width,c.height):new M.TheoSize(c.width,c.height),r=b.TypographyScaleHint.Height,_.TypographyLayout.lineWrap(e,s,1==i?D.AlignmentIdiom.RRtb:D.AlignmentIdiom.LLtb,h)):_.TypographyLayout.propagateDown(s,D.AlignmentIdiom.LRBB),s.calcTransform(),this.flavor_){case 2:o=0==a?D.AlignmentIdiom.LLbt:D.AlignmentIdiom.RRtb;break;case 1:var u=s.localbounds().height/l.localbounds().height;u>1&&(l.scaleAlign=u),o=0==i?D.AlignmentIdiom.LRbb:D.AlignmentIdiom.LRtt;break;default:o=D.AlignmentIdiom.LRtt}t[1].parent.transAlign=o,e.getRoot().calcTransform();var c=e.getRoot().localbounds(),h=_.TypographyLayout.getDesiredSize(c.size,n.size_);switch(this.flavor_){case 3:l.scaleAlign=s.localbounds().height/l.localbounds().height,e.getRoot().calcTransform(),c=e.getRoot().localbounds();break;case 1:break;case 0:h.height>c.height&&(l.scaleAlign=h.height/c.height,l.calcTransform()),s.scaleAlign=(h.width-l.localbounds().width)/s.localbounds().width;break;default:h.width>c.width&&(l.scaleAlign=h.width/c.width,l.calcTransform()),s.scaleAlign=(h.height-l.localbounds().height)/s.localbounds().height}return r}}}),g),_.DropCapTypographyLayout=(p=function(){_.FitTypographyLayout.call(this,_.FitTypographyLayout.FIT_EMPHASIZED_ALL)},C.defineClass({name:"DropCapTypographyLayout",ctor:p,superName:"FitTypographyLayout",props:{conditionsMet:function(e,t){if(1==t.length&&e.getRoot().getTextNodes().length>1||_.FitTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))){var n=t[0]instanceof D.TextNode?t[0]:t[0].getTextNodes()[0];return null!=n.token_.subTokens&&2==n.token_.subTokens.length&&n.token_.subTokens[0].type==D.GlyphType.DROPCAP}return!1},arrangeText:function(e,t,n){var o,r=t[0]instanceof D.TextNode?t[0]:t[0].getTextNodes()[0],a=r.token_,i=E.TypographyTree.createTextNode(a.subTokens[0],-1),l=E.TypographyTree.createTextNode(a.subTokens[1],0),s=r.parent,u=e.getRoot();return s.leftChild.getId()==r.getId()?s.leftChild=l:s.rightChild=l,l.parent=s,t.length>1?(o=_.FitTypographyLayout.prototype.arrangeText.call(this,e,C.clone(u.getTextRuns()),n),e.setRoot(E.TypographyTree.createGroupNode(i,u,D.AlignmentIdiom.LRtt)),e.getRoot().calcTransform(),i.scaleAlign=e.getRoot().rightChild.localbounds().height/i.localbounds().height):(_.TypographyLayout.propagateDown(e.getRoot(),D.AlignmentIdiom.LLtb),e.setRoot(E.TypographyTree.createGroupNode(i,e.getRoot(),D.AlignmentIdiom.LRtt)),e.getRoot().calcTransform(),i.scaleAlign=e.getRoot().rightChild.localbounds().height/i.localbounds().height,o=b.TypographyScaleHint.Width),o}}}),p),_.DropCapSingleTokenTypographyLayout=(d=function(e){this.alignTop=e,C.super_init(this,_.SimpleAlignmentTypographyLayout,_.SimpleAlignmentTypographyLayout.prototype.init_d41d)},C.defineClass({name:"DropCapSingleTokenTypographyLayout",ctor:d,superName:"SimpleAlignmentTypographyLayout",props:{conditionsMet:function(e,t){var n=C.clone(e.getRoot().getTextNodes());if(1==n.length){var o=n[0];return null!=o.token_.subTokens&&2==o.token_.subTokens.length&&o.token_.subTokens[0].type==D.GlyphType.DROPCAP}return!1},arrangeText:function(e,t,n){var o=e.getRoot().getTextNodes()[0],r=o.token_,a=E.TypographyTree.createTextNode(r.subTokens[0],-1),i=E.TypographyTree.createTextNode(r.subTokens[1],0),l=o.parent;l.leftChild.getId()==o.getId()?(l.leftChild=a,l.rightChild=i):(l.leftChild=i,l.rightChild=a),a.parent=l,i.parent=l;var s=e.getRoot(),u=_.SimpleAlignmentTypographyLayout.prototype.arrangeText.call(this,e,C.clone(s.getTextRuns()),n);return l.transAlign=this.alignTop?D.AlignmentIdiom.LRtt:D.AlignmentIdiom.LRbb,s.calcTransform(),i.scaleAlign=a.localbounds().height/(3*i.localbounds().height),u}}}),d),_.PunctuationAtStartTypographyLayout=(f=function(){_.FitTypographyLayout.call(this,_.FitTypographyLayout.FIT_EMPHASIZED_ALL)},C.defineClass({name:"PunctuationAtStartTypographyLayout",ctor:f,superName:"FitTypographyLayout",props:{conditionsMet:function(e,t){if(_.FitTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))){var n=t[0].getLeftmostTextNode();return n.token_.type==D.GlyphType.PUNCTUATION||n.token_.type==D.GlyphType.SYMBOL}return!1},arrangeText:function(e,t,n){var o=t[0].getLeftmostTextNode();if(o.parent.getId()!=e.getRoot().getId()){var r=o.parent;r.parent.leftChild=r.rightChild,r.rightChild.parent=r.parent;var a=e.getRoot();r.parent=null,r.rightChild=a,a.parent=r,e.setRoot(r)}var i=e.getRoot().rightChild,l=i instanceof D.GroupNode?_.FitTypographyLayout.prototype.arrangeText.call(this,e,C.clone(i.getTextRuns()),n):b.TypographyScaleHint.Aspect;return o.calcTransform(),i.calcTransform(),o.scaleAlign=i.localbounds().height/o.localbounds().height,e.getRoot().transAlign=D.AlignmentIdiom.LRtt,l}}}),f),_.PunctuationAtEndTypographyLayout=(y=function(){_.FitTypographyLayout.call(this,_.FitTypographyLayout.FIT_EMPHASIZED_ALL)},C.defineClass({name:"PunctuationAtEndTypographyLayout",ctor:y,superName:"FitTypographyLayout",props:{conditionsMet:function(e,t){if(_.FitTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))){var n=t[t.length-1].getRightmostTextNode();return n.token_.type==D.GlyphType.PUNCTUATION||n.token_.type==D.GlyphType.SYMBOL}return!1},arrangeText:function(e,t,n){var o=t[t.length-1].getRightmostTextNode();if(o.parent.getId()!=e.getRoot().getId()){var r=o.parent;r.parent.rightChild=r.leftChild,r.leftChild.parent=r.parent;var a=e.getRoot();r.parent=null,r.leftChild=a,a.parent=r,e.setRoot(r)}var i=e.getRoot().leftChild,l=i instanceof D.GroupNode?_.FitTypographyLayout.prototype.arrangeText.call(this,e,C.clone(i.getTextRuns()),n):b.TypographyScaleHint.Aspect;return o.calcTransform(),i.calcTransform(),o.scaleAlign=i.localbounds().height/o.localbounds().height,e.getRoot().transAlign=D.AlignmentIdiom.LRtt,l}}}),y),_.TripletTypographyLayout=(m=function(){_.TypographyLayout.call(this)},C.defineClass({name:"TripletTypographyLayout",ctor:m,superName:"TypographyLayout",props:{conditionsMet:function(e,t){return 3==t.length}}}),m),_.MiddleTypographyLayout=(T=function(e){this.flavor_=e,_.TripletTypographyLayout.call(this)},C.defineClass({name:"MiddleTypographyLayout",ctor:T,superName:"TripletTypographyLayout",statics:{TRIPLET_EMPHASIZED:0,TRIPLET_UNEMPHASIZED:1,TRIPLET_EMPHASIZED_ROTATED:2,TRIPLET_UNEMPHASIZED_ROTATED:3},props:{conditionsMet:function(e,t){return!!_.TripletTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))&&(this.flavor_==T.TRIPLET_EMPHASIZED||this.flavor_==T.TRIPLET_EMPHASIZED_ROTATED?1==t[1].getWeight():0==t[1].getWeight())},arrangeText:function(e,t,n){_.TypographyLayout.propagateDown(t[1],D.AlignmentIdiom.LRBB),this.flavor_==T.TRIPLET_EMPHASIZED||this.flavor_==T.TRIPLET_EMPHASIZED_ROTATED?(_.TypographyLayout.propagateDown(t[0],D.AlignmentIdiom.RRtb),_.TypographyLayout.propagateDown(t[2],D.AlignmentIdiom.LLtb),this.flavor_==T.TRIPLET_EMPHASIZED_ROTATED&&(t[1].rotateAlign=_.TypographyLayout.counterClockwise)):(_.TypographyLayout.propagateDown(t[0],D.AlignmentIdiom.LRBB),new _.FitTypographyLayout(_.FitTypographyLayout.FIT_ALL).arrangeText(e,[t[1]],n),_.TypographyLayout.propagateDown(t[2],D.AlignmentIdiom.LRBB),this.flavor_==T.TRIPLET_UNEMPHASIZED_ROTATED&&(t[1].rotateAlign=_.TypographyLayout.counterClockwise)),t[0].calcTransform(),t[1].calcTransform(),t[2].calcTransform();var o=t[0].localbounds().height,r=t[1].localbounds().height,a=t[2].localbounds().height;return 1==t[1].getWeight()?(t[1].scaleAlign=2*(o+a)/r,t[0].parent.transAlign=D.AlignmentIdiom.LRtt,t[2].parent.transAlign=D.AlignmentIdiom.LRbb):(t[1].scaleAlign=x.MathUtils.maxDouble(o,a)/r,t[0].parent.transAlign=D.AlignmentIdiom.LRmm,t[2].parent.transAlign=D.AlignmentIdiom.LRmm),b.TypographyScaleHint.Aspect}}}),T),_.SpanMiddleTypographyLayout=(S=function(e){this.flavor_=e,_.TripletTypographyLayout.call(this)},C.defineClass({name:"SpanMiddleTypographyLayout",ctor:S,superName:"TripletTypographyLayout",statics:{LEFT_RIGHT:0,RIGHT_LEFT:1},props:{conditionsMet:function(e,t){return _.TripletTypographyLayout.prototype.conditionsMet.call(this,e,C.clone(t))&&1==t[1].getWeight()&&t[0]instanceof D.GroupNode&&t[2]instanceof D.GroupNode},arrangeText:function(e,t,n){_.TypographyLayout.propagateDown(t[1],D.AlignmentIdiom.LRBB),t[1].calcTransform();var o,r,a=t[1].localbounds(),i=_.TypographyLayout.getDesiredSize(a.size,n.size_),l=i.width/2,s=(i.height-a.height)/2;this.flavor_==S.LEFT_RIGHT?(o=D.AlignmentIdiom.LLtb,r=D.AlignmentIdiom.RRtb):(o=D.AlignmentIdiom.RRtb,r=D.AlignmentIdiom.LLtb);var u=new M.TheoSize(l,s),c=!0,h=!0;if(t[0]instanceof D.GroupNode&&(c=!_.TypographyLayout.lineWrap(e,t[0],o,u)),t[2]instanceof D.GroupNode&&(h=!_.TypographyLayout.lineWrap(e,t[2],r,u)),t[1].parent.transAlign=D.AlignmentIdiom.LLtb,t[2].parent.transAlign=D.AlignmentIdiom.RRtb,t[0].calcTransform(),t[2].calcTransform(),t[1].scaleAlign=(t[0].localbounds().width+t[2].localbounds().width)/i.width,c&&h){e.getRoot().calcTransform();var g=(a=e.getRoot().localbounds()).width,p=t[1].localbounds().height,d=a.height-(x.MathUtils.minDouble(t[0].localbounds().height,p)-x.MathUtils.minDouble(t[2].localbounds().height,p))/2;_.TypographyLayout.getScore(n.size_.aspectRatio,a.size.aspectRatio)<_.TypographyLayout.getScore(n.size_.aspectRatio,g/d)&&(t[0].parent.leftChild=t[1],t[0].parent.rightChild=t[0],t[0].parent.transAlign=D.AlignmentIdiom.LLbto,t[2].parent.transAlign=D.AlignmentIdiom.RRtbo)}return b.TypographyScaleHint.Aspect}}}),S),_.QuadraticTypographyLayout=(L=function(){_.TypographyLayout.call(this)},C.defineClass({name:"QuadraticTypographyLayout",ctor:L,superName:"TypographyLayout",props:{conditionsMet:function(e,t){return 4==t.length}}}),L),_.RotateAndFitTypographyLayout=(R=function(){_.QuadraticTypographyLayout.call(this)},C.defineClass({name:"RotateAndFitTypographyLayout",ctor:R,superName:"QuadraticTypographyLayout",props:{arrangeText:function(e,t,n){e.rotateNode(t[0].parent);var o=new b.TypographyParams(new M.TheoSize(n.size_.width/2,n.size_.height));new _.RotateTypographyLayout(_.RotateTypographyLayout.ROTATE_EMPHASIZED).arrangeText(e,[t[0],t[1]],o),new _.FitTypographyLayout(_.FitTypographyLayout.FIT_EMPHASIZED).arrangeText(e,[t[2],t[3]],o),e.getRoot().calcTransform();var r=t[0].parent.localbounds().width,a=t[2].parent.localbounds().width;return t[2].parent.scaleAlign=r/a,t[2].parent.transAlign=D.AlignmentIdiom.RRtb,e.getRoot().transAlign=D.AlignmentIdiom.LRbb,b.TypographyScaleHint.Width}}}),R),_.FitAndRotateTypographyLayout=(v=function(){_.QuadraticTypographyLayout.call(this)},C.defineClass({name:"FitAndRotateTypographyLayout",ctor:v,superName:"QuadraticTypographyLayout",props:{arrangeText:function(e,t,n){e.rotateNode(t[0].parent),new _.FitTypographyLayout(_.FitTypographyLayout.FIT_EMPHASIZED).arrangeText(e,[t[0],t[1]],n),new _.RotateTypographyLayout(_.RotateTypographyLayout.ROTATE_EMPHASIZED).arrangeText(e,[t[2],t[3]],n),t[0].parent.calcTransform(),t[2].parent.calcTransform();var o=t[0].parent.localbounds().width,r=t[2].parent.localbounds().width;return t[2].parent.scaleAlign=o/r,t[2].parent.parent.transAlign=D.AlignmentIdiom.RRtb,b.TypographyScaleHint.Width}}}),v),_.DiagonalBoxTypographyLayout=(I=function(e){this.flavor_=e,_.QuadraticTypographyLayout.call(this)},C.defineClass({name:"DiagonalBoxTypographyLayout",ctor:I,superName:"QuadraticTypographyLayout",statics:{RIGHT_LEFT:0,FIT_FIT:1},props:{arrangeText:function(e,t,n){return e.rotateNode(t[0].parent),this.flavor_==I.RIGHT_LEFT?(_.SimpleAlignmentTypographyLayout.init_5a15(D.AlignmentIdiom.RRtb).arrangeText(e,[t[0],t[1]],n),_.SimpleAlignmentTypographyLayout.init_5a15(D.AlignmentIdiom.LLtb).arrangeText(e,[t[2],t[3]],n)):(new _.FitTypographyLayout(_.FitTypographyLayout.FIT_EMPHASIZED).arrangeText(e,[t[0],t[1]],n),new _.FitTypographyLayout(_.FitTypographyLayout.FIT_EMPHASIZED).arrangeText(e,[t[2],t[3]],n)),t[2].parent.parent.transAlign=D.AlignmentIdiom.LRtb,b.TypographyScaleHint.Aspect}}}),I),_.FitRotateFitTypographyLayout=(A=function(){_.QuadraticTypographyLayout.call(this)},C.defineClass({name:"FitRotateFitTypographyLayout",ctor:A,superName:"QuadraticTypographyLayout",props:{arrangeText:function(e,t,n){e.rotateNode(t[0].parent),new _.FitTypographyLayout(_.FitTypographyLayout.FIT_EMPHASIZED).arrangeText(e,[t[0],t[1]],n),new _.FitTypographyLayout(_.FitTypographyLayout.FIT_EMPHASIZED).arrangeText(e,[t[2],t[3]],n),t[2].parent.rotateAlign=_.TypographyLayout.counterClockwise,t[0].parent.calcTransform(),t[2].parent.calcTransform();var o=t[0].parent.localbounds().height,r=t[2].parent.localbounds().height;return t[2].parent.scaleAlign=o/r,t[2].parent.parent.transAlign=D.AlignmentIdiom.LRtt,b.TypographyScaleHint.Aspect}}}),A),_.CornersTypographyLayout=(F=function(e){this.flavor_=e,_.QuadraticTypographyLayout.call(this)},C.defineClass({name:"CornersTypographyLayout",ctor:F,superName:"QuadraticTypographyLayout",statics:{RIGHTTOP_LEFTBOTTOM:0,LEFTTOP_RIGHTBOTTOM:1},props:{arrangeText:function(e,t,n){e.rotateNode(t[0].parent),_.TypographyLayout.propagateDown(t[0],D.AlignmentIdiom.LRBB),_.TypographyLayout.propagateDown(t[1],D.AlignmentIdiom.LRBB),this.flavor_==F.RIGHTTOP_LEFTBOTTOM?(t[1].rotateAlign=_.TypographyLayout.clockWise,t[1].parent.transAlign=0==t[0].getWeight()?D.AlignmentIdiom.LRtt:D.AlignmentIdiom.RRtb):(t[0].rotateAlign=_.TypographyLayout.counterClockwise,t[0].parent.transAlign=0==t[0].getWeight()?D.AlignmentIdiom.LLbt:D.AlignmentIdiom.LRtt),_.TypographyLayout.propagateDown(t[2],D.AlignmentIdiom.LRBB),_.TypographyLayout.propagateDown(t[3],D.AlignmentIdiom.LRBB),this.flavor_==F.RIGHTTOP_LEFTBOTTOM?(t[2].rotateAlign=_.TypographyLayout.clockWise,t[2].parent.transAlign=0==t[2].getWeight()?D.AlignmentIdiom.LLtb:D.AlignmentIdiom.LRbb):(t[3].rotateAlign=_.TypographyLayout.counterClockwise,t[3].parent.transAlign=0==t[3].getWeight()?D.AlignmentIdiom.RRbt:D.AlignmentIdiom.LRbb),t[0].parent.calcTransform(),t[2].parent.calcTransform(),e.getRoot().transAlign=this.flavor_==F.RIGHTTOP_LEFTBOTTOM?D.AlignmentIdiom.RLtb:D.AlignmentIdiom.LRtb,e.getRoot().calcTransform();var o=e.getRoot().localbounds(),r=_.TypographyLayout.getDesiredSize(o.size,n.size_);return r.width>o.width?_.TypographyLayout.insertSpacer(e,t[0].parent,r.width-o.width,1,this.flavor_==F.RIGHTTOP_LEFTBOTTOM?_.SpacerIdiom.insertLeft:_.SpacerIdiom.insertRight,D.AlignmentIdiom.LRbb):r.height>o.height&&_.TypographyLayout.insertSpacer(e,t[2].parent,r.height-o.height,1,_.SpacerIdiom.insertAbove,D.AlignmentIdiom.LLtb),b.TypographyScaleHint.Aspect}}}),F)},"p+tC":function(e,t,n){var o,r,a,i=t,l=n("oAGj"),s=n("SpAV"),u=n("uj1m"),c=n("txj3"),h=n("nrTo"),g=n("35Q0"),p=n("UqVc"),d=n("ThKb");i.predictCategory=!0,i.RawDataShapeSuggester=(o=function(){},l.defineClass({name:"RawDataShapeSuggester",ctor:o,props:{init_b1f8:function(e,t,n,o,r,a,i,l,s,u){this.numImages=e,this.numShapes=t,this.charLength=n,this.lineHeight=o,this.font=r,this.layout=a,this.textWidth=i,this.textHeight=l,this.centerX=s,this.centerY=u},getUniqueKey:function(){var e="";return e=(e=(e=(e=(e=(e=(e=(e=(e=(e=e+l.toString(this.numImages)+"-")+l.toString(this.numShapes)+"-")+l.toString(this.charLength)+"-")+l.toString(this.lineHeight)+"-")+this.font+"-")+this.layout+"-")+l.toString(this.textWidth)+"-")+l.toString(this.textHeight)+"-")+l.toString(this.centerX)+"-")+l.toString(this.centerY)+"-"},init_implicit:function(e,t,n,o,r,a,i,l,s,u){this.numImages=e,this.numShapes=t,this.charLength=n,this.lineHeight=o,this.font=r,this.layout=a,this.textWidth=i,this.textHeight=l,this.centerX=s,this.centerY=u},clone:function(){return o.init_implicit(this.numImages,this.numShapes,this.charLength,this.lineHeight,this.font,this.layout,this.textWidth,this.textHeight,this.centerX,this.centerY)}}}),o),i.ShapeSuggester=(r=function(){this.shapeCatMap={},this.shapeCatMap.banner=g.TagGroup.banner,this.shapeCatMap.square=g.TagGroup.square,this.shapeCatMap.other=g.TagGroup.other,this.shapeCatMap.circle=g.TagGroup.circle,this.shapeCatMap.decorative=g.TagGroup.decorative,this.shapeCatMap.none=g.TagGroup.none,l.defctor(this)},a={},l.defineClass({name:"ShapeSuggester",ctor:r,statics:{cache:{get:function(){return void 0===a.cache&&(a.cache=new h.PredictionCacheDouble),a.cache},set:function(e){a.cache=e}}},props:{getShapeSuggesterFeatures:function(e,t){var n=e.numImages,o=e.shapeCount,a=e.selectedLockup.charCount,s=l.toInt(e.selectedLockup.lineHeight),u=e.selectedLockup.font,c=e.selectedLockup.styleAttributes.layout,h=l.clone(e.selectedLockup.pts),g=(h[0].x+h[3].x)/2/e.width,p=(h[0].y+h[3].y)/2/e.height,d=l.toInt(e.selectedLockup.width),f=l.toInt(e.selectedLockup.height),y=l.clone(i.RawDataShapeSuggester.init_b1f8(n,o,a,s,u,c,d,f,g,p));return r.cache.cleanup(t.page.document.uuid),y},getScores:function(e,t){var n=this,o=t.getUniqueKey();if(null==r.cache.getCacheValue(o)){var a,h=[],f=0;if(a=u.MLPModel.loadNNModel("Shape")){var y,m,T,S=l.repeat(0,55),L=l.repeat(0,4),R=l.repeat(0,8);R[0]=l.toDouble(t.numShapes),R[1]=l.toDouble(t.numShapes),R[2]=l.toDouble(t.charLength),R[3]=l.toDouble(t.lineHeight),R[4]=l.toDouble(t.textWidth),R[5]=l.toDouble(t.textHeight),R[6]=l.toDouble(t.centerX),R[7]=l.toDouble(t.centerY),null!=(m=l.indexOf(a.fonts,t.font))&&(S[m]=1),null!=(T=l.indexOf(a.layouts,t.layout))&&(L[T]=1);var v=l.clone(R.concat(l.clone(S)).concat(l.clone(L)));s.CoreAssert.isTrue(67==v.length,void 0,"ShapeSuggester.getScores","ShapeSuggester.swift",148);var I=new d.TheoMatrix([v]).subtract(a.featureScalingMean).divide(a.featureScalingStd),A=new c.NNMLPClassifier(l.clone(a.coefficients),l.clone(a.intercepts)).predict(I.transpose()),F=l.clone(A.transpose().asArray);y=l.clone(a.shapes);for(var _={},C=l.iter(l.toSequence(F[0]));!C.done;C.next()){var x=C.value,b=x.offset,D=x.element;_[y[b]]=D,f=Math.max(f,D)}0==i.predictCategory?e.forEach((function(e){var t;null!=(t=_[e])?h.push(t+.2):h.push(0)})):e.forEach((function(e){var t=0;y.forEach((function(o){var r;l.opt(g.ShapeLibrary.getShapeDataForArtworkId(e),(function(e){return 1==e.tags.includes(n.shapeCatMap[o])}))&&null!=(r=_[o])&&(t=r)})),"row"==e?t=f+.5:l.opt(g.ShapeLibrary.getShapeDataForArtworkId(e),(function(e){return 1==e.tags.includes(n.shapeCatMap.none)}))&&(t=.1),h.push(t)}))}r.cache.setCacheValue(o,l.clone((new p.SuggestionUtils).normalizedWeights(l.clone(h))))}return r.cache.getCacheValue(o)}}}),r)},taeg:function(e,t,n){var o,r,a=t,i=n("oAGj"),l=n("iCxV"),s=n("txj3"),u=n("nrTo"),c=n("7Ta2"),h=n("ThKb");a.RoleSuggesterMLP=(o=function(){},r={},i.defineClass({name:"RoleSuggesterMLP",ctor:o,statics:{cache:{get:function(){var e;return void 0===r.cache&&(r.cache=((e=i.opt(l.Host.platform,(function(e){return e.isService})))||null!=e)&&e?i.opt(l.Host.learning,(function(e){return e.getHostPredictionCache()})):new u.PredictionCacheInferredRole),r.cache},set:function(e){r.cache=e}},_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){return null},getRole:function(e){var t,n,r=i.clone(c.InferredRole.init_84d1()),a=e.getUniqueKey();if(null==o.cache.getCacheValue(a)){var l,u=0,g="",p=0,d="";if(l=this.getRoleModel()){var f,y=i.clone(e.getFeatureVector()),m=i.clone(y),T=new h.TheoMatrix([m]).subtract(l.featureScalingMean).divide(l.featureScalingStd),S=new s.NNMLPClassifier(i.clone(l.coefficients),i.clone(l.intercepts),l.finalSoftmax).predict(T.transpose()),L=i.clone(S.transpose().asArray);f=i.clone(l.roles);for(var R={},v=i.iter(i.toSequence(L[0]));!v.done;v.next()){var I=v.value,A=I.offset,F=I.element;R[f[A]]=F,F>u?(p=u,d=g,u=F,g=f[A]):F>p&&(p=F,d=f[A])}}var _=(t=c.InferredRoleType.toCaseValue(g))||null!=t?t:c.InferredRoleType.Undefined,C=(n=c.InferredRoleType.toCaseValue(d))||null!=n?n:c.InferredRoleType.Undefined;r=i.clone(c.InferredRole.init_84d1(_,u,C,p)),o.cache.setCacheValue(a,i.clone(r))}return o.cache.getCacheValue(a)}}}),o)},"ws+m":function(e,t,n){var o,r,a=t,i=n("oAGj"),l=n("6ZWm"),s=n("7Ta2");a.ImageRoleSuggesterFactory=(o=function(){},i.defineClass({name:"ImageRoleSuggesterFactory",ctor:o,statics:{Create:function(e){return void 0===e&&(e=""),new a.ImageRoleSuggesterSimple}}}),o),a.ImageRoleSuggesterSimple=(r=function(){},i.defineClass({name:"ImageRoleSuggesterSimple",ctor:r,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t,n=e.forma,o=s.InferredRoleType.Undefined;if(t=i.as(n.controller,l.FrameController)){if(n.isGridCell())return s.InferredRole.init_84d1(s.InferredRoleType.Background,1);if(n.isLogo())return s.InferredRole.init_84d1(s.InferredRoleType.Logo,1,s.InferredRoleType.GraphicContent,.5);if(t.floating)return s.InferredRole.init_84d1(s.InferredRoleType.GraphicContent,1)}return s.InferredRole.init_84d1(o,1)}}}),r)},xRbc:function(e,t,n){var o,r=t,a=n("oAGj"),i=n("wc1n"),l=n("cYVN"),s=n("35Q0");r.LockupRoleFeatures=a.defineEnum("LockupRoleFeatures",{WordCount:"WordCount",CharacterCount:"CharacterCount",intsSpecialsCount:"intsSpecialsCount",webReferencesCount:"webReferencesCount",checkSocialChar:"checkSocialChar",Spacing:"Spacing",Padding:"Padding",ShapeFilled:"ShapeFilled",TextWidth:"TextWidth",TextHeight:"TextHeight",PercentageArea:"PercentageArea",CenterX:"CenterX",CenterY:"CenterY",PageHeight:"PageHeight",PageWidth:"PageWidth",otherLockupPercDesignArea:"otherLockupPercDesignArea",TextCount:"TextCount",actionWordsCount:"actionWordsCount",TextString:"TextString",BackingShape:"BackingShape",PerAreaAllLockups:"PercentageAreaAllLockups",CollisionPercentage:"CollisionPercentage",SurroundingAlignment:"SurroundingAlignment"}),r.LockupRoleData=(o=function(e,t,n){l.RoleData.call(this,e,a.clone(t),a.clone(n))},a.defineClass({name:"LockupRoleData",ctor:o,superName:"RoleData",statics:{digits:"0123456789/@|",webReferenceStrings:[".com","http",".edu",".org",".gov"],actionWordStrings:["join","now","today","try","view","swipe"],socialMediaStrings:["#","instagram"],getLockupRoleData:function(e){var t=[r.LockupRoleFeatures.WordCount,r.LockupRoleFeatures.CharacterCount,r.LockupRoleFeatures.intsSpecialsCount,r.LockupRoleFeatures.checkSocialChar,r.LockupRoleFeatures.webReferencesCount,r.LockupRoleFeatures.Spacing,r.LockupRoleFeatures.Padding,r.LockupRoleFeatures.ShapeFilled,r.LockupRoleFeatures.TextWidth,r.LockupRoleFeatures.TextHeight,r.LockupRoleFeatures.PercentageArea,r.LockupRoleFeatures.CenterX,r.LockupRoleFeatures.CenterY,r.LockupRoleFeatures.PageWidth,r.LockupRoleFeatures.PageHeight,r.LockupRoleFeatures.otherLockupPercDesignArea,r.LockupRoleFeatures.TextCount,r.LockupRoleFeatures.actionWordsCount],n=[r.LockupRoleFeatures.TextString,r.LockupRoleFeatures.BackingShape,r.LockupRoleFeatures.PerAreaAllLockups],l=i.FeatureExtractorFactory.getFeatureExtractor(i.FeatureExtractorType.LockupStyle,e,a.clone(a.as(t.concat(n),["Array","String"]))),s=a.clone(l.numericalFeatures);a.removeKey(s,r.LockupRoleFeatures.PerAreaAllLockups);var u=l.categoricalFeatureForKey(r.LockupRoleFeatures.TextString),c=l.categoricalFeatureForKey(r.LockupRoleFeatures.BackingShape),h=l.numericFeatureForKey(r.LockupRoleFeatures.PerAreaAllLockups);return s[r.LockupRoleFeatures.actionWordsCount]=a.toDouble(o.getNumActionWordReferences(u)),s[r.LockupRoleFeatures.checkSocialChar]=o.checkSocialMediaCharacters(u,c)?1:0,s[r.LockupRoleFeatures.intsSpecialsCount]=a.toDouble(o.getNumIntsAndSpecials(u)),s[r.LockupRoleFeatures.webReferencesCount]=a.toDouble(o.getNumWebReferences(u)),s[r.LockupRoleFeatures.otherLockupPercDesignArea]=h-s[r.LockupRoleFeatures.PercentageArea],new o(e,a.clone(t),a.clone(s))},getNumIntsAndSpecials:function(e){for(var t=0,n=a.iter(a.range(0,e.length,!1));!n.done;n.next()){var r=n.value,i=e.substr(r,1);o.digits.includes(i)&&(t+=1)}return t},getNumWebReferences:function(e){for(var t=0,n=a.iter(o.webReferenceStrings);!n.done;n.next()){var r=n.value;e.toLowerCase().includes(r)&&(t+=1)}return t},getNumActionWordReferences:function(e){for(var t=0,n=a.iter(o.actionWordStrings);!n.done;n.next()){var r=n.value;e.toLowerCase().includes(r)&&(t+=1)}return t},checkSocialMediaCharacters:function(e,t){for(var n,r=!1,i=a.iter(o.socialMediaStrings);!i.done;i.next()){var l=i.value;e.includes(l)&&(r=!0)}return(n=s.ShapeLibrary.shapeDictionary[t])&&n.category==s.ShapeCategory.Social&&(r=!0),r},checkLockupIsGraphic:function(e,t){for(var n=!1,o="",r=a.iter(a.range(0,e.length,!1));!r.done;r.next()){var i=r.value,l=e.substr(i,1);" "!=l&&"\n"!=l&&"\t"!=l&&"\r"!=l&&(o+=l)}return o.length<=1&&t.category!=s.ShapeCategory.None&&(n=!0),n}}}),o)},zbwF:function(e,t,n){var o,r,a,i=t,l=n("oAGj"),s=n("xRbc"),u=n("uj1m"),c=n("7Ta2"),h=n("taeg");i.LockupRoleSuggesterFactory=(o=function(){},l.defineClass({name:"LockupRoleSuggesterFactory",ctor:o,statics:{Create:function(e){return void 0===e&&(e=""),"MLP"==e?new i.LockupRoleSuggesterMLP:new i.LockupRoleSuggesterSimple}}}),o),i.LockupRoleSuggesterMLP=(r=function(){h.RoleSuggesterMLP.call(this)},l.defineClass({name:"LockupRoleSuggesterMLP",ctor:r,superName:"RoleSuggesterMLP",statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRoleModel:function(){return u.MLPModel.loadNNModel("TextRole")}}}),r),i.LockupRoleSuggesterSimple=(a=function(){},l.defineClass({name:"LockupRoleSuggesterSimple",ctor:a,statics:{_implements:function(e){return"RoleSuggesterProtocol"==e}},props:{getRole:function(e){var t,n=c.InferredRoleType.Undefined;if(t=l.as(e,s.LockupRoleData)){var o=t.feat(s.LockupRoleFeatures.WordCount),r=t.feat(s.LockupRoleFeatures.TextCount),a=t.feat(s.LockupRoleFeatures.TextHeight),i=t.feat(s.LockupRoleFeatures.intsSpecialsCount),u=t.feat(s.LockupRoleFeatures.checkSocialChar)>0,h=t.feat(s.LockupRoleFeatures.PercentageArea),g=t.feat(s.LockupRoleFeatures.otherLockupPercDesignArea);n=o<=5&&a>=80?c.InferredRoleType.Title:o<=9&&a>=250?c.InferredRoleType.Title:o<=14?c.InferredRoleType.SubTitle:c.InferredRoleType.Body,i>=5&&o<=18&&a<=220&&(n=c.InferredRoleType.Contact),u&&(n=c.InferredRoleType.Social),r<=3&&h>g&&(n!=c.InferredRoleType.Body&&n!=c.InferredRoleType.Social||(n=c.InferredRoleType.Title))}return c.InferredRole.init_84d1(n,1)}}}),a)}}]);
//# sourceMappingURL=vendors_npm_spark_c8102c22-b9b8ec8f.js.map
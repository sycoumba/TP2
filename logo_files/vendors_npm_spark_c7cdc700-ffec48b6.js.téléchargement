(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[30],{"FNB+":function(t,e,n){var r,i=e,o=n("oAGj"),a=n("ftr0"),s=n("SpAV"),u=n("HRWw"),l=n("ascj"),c=n("dJuF"),h=n("SmK9"),d=n("URxh"),m=n("H9Ol"),p=n("6ZWm"),f=n("G1DZ"),_=n("QbzR"),g=n("P83h"),E=n("9Lk3"),F=n("pnSN"),P=n("4mVB"),T=n("ZhwN"),v=n("iCxV"),C=n("tGKA"),R=n("Quhx"),y=n("K0Rh"),S=n("8t9B"),I=n("zjod");i.FormaPlatformView=o.defineProtocol("FormaPlatformView",{beginUpdate:"(FormaUpdateEvent) -> Void",endUpdate:"(FormaUpdateEvent) -> Void",formaDeleted:"() -> Void"}),i.FormaTraversal=o.defineEnum("FormaTraversal",{PreOrder:1,PostOrder:2,NearestAncestor:4,FurthestAncestor:5,JustChildren:6,PreOrderWithAuxiliaries:7,PostOrderWithAuxiliaries:8,JustAuxiliaries:9,JustChildrenAndAuxiliaries:10}),i.Forma=(r=function(){this.isFullCanvas=!1,this.stateChangeEvents=null,this.isModel_=!1},o.defineClass({name:"Forma",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:{get:function(){return"Forma"}},KIND:{get:function(){return""}},PROPERTY_KIND:"kind",PROPERTY_PLACEMENT:"placement",PROPERTY_STYLE:"style",PROPERTY_ANIMATION:"animation",PROPERTY_MOVEABLE:"moveable",PROPERTY_INTENT:"intent",PROPERTY_ORIGINAL_ID:"original-id",PROPERTY_SOURCE:"source",PROPERTY_TAGS:"tags",PROPERTY_CONTROLLER_KIND:"controller-kind",PROPERTY_CONTROLLER_METADATA:"controller-metadata",INTENT_LOGO:"logo",INTENT_PATTERN:"pattern",INTENT_ICON:"icon",INTENT_FLOATING_SHAPE:"floating-shape",INTENT_GRID_CELL:"grid-cell",INTENT_INFERRED_TEMP_GROUP:"inferred-temp-group",INTENT_STICKER:"sticker",INTENT_FLOATING_IMAGE:"floating-image",INTENT_TEMP_IMAGE_CROP:"temp-image-crop",INTENT_IMAGE_MASK:"image-mask",INTENT_CUTOUT_MASK:"cutout-mask",INTENT_USER_GROUP:"user-group",TAG_IS_AUXILIARY:"is-auxiliary",ancestorsNearest:function(t,e,n){return null==t?null:n(t,e,0)?t:r.ancestorsNearest(t.parent,e-1,n)},ancestorsFurthest:function(t,e,n){if(null==t)return null;var i=r.ancestorsFurthest(t.parent,e-1,n);return null!=i?i:n(t,e,0)?t:null},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,i){var a,s,u=this;if(this.parent_=i,this.page_=i.page,o.super_init(this,R.PostDCXObject,R.PostDCXObject.prototype.init_3181,e,n,t),null==o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle)&&this.set(r.PROPERTY_STYLE,_.FormaStyle.createDefault()),(a=o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle))&&(a.owner=this,a.colorLibrary=o.opt(this.page_,(function(t){return t.colorLibrary}))),s=this.animation)for(var l=o.iter(s.keyFrames);!l.done;l.next()){var c=l.value;o.opt(c.style,(function(t){return t.colorLibrary=o.opt(u.page_,(function(t){return t.colorLibrary}))}))}this.decodeController()},init_7dbd:function(t,e,n,i){var a,s,u=this;if(this.page_=i,o.super_init(this,R.PostDCXObject,R.PostDCXObject.prototype.init_3181,e,n,t),null==o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle)&&this.set(r.PROPERTY_STYLE,_.FormaStyle.createDefault()),(a=o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle))&&(a.owner=this,a.colorLibrary=this.page_.colorLibrary),s=this.animation)for(var l=o.iter(s.keyFrames);!l.done;l.next()){var c=l.value;o.opt(c.style,(function(t){return t.colorLibrary=u.page_.colorLibrary}))}this.decodeController()},init_812f:function(t,e){for(var n,i=t.database,a={path:function(){return T.GUIDUtils.makeGUID()},kind:function(){return r.KIND},"controller-kind":function(){return""},placement:function(){return C.Matrix2D.Identity},"controller-metadata":function(){return m.ControllerMetadata.init_d41d()},style:function(){return _.FormaStyle.createDefault()}},s=o.clone(e),u=o.iter(a);!u.done;u.next()){var l=u.key,c=u.value;null==e[l]&&(s[l]=c())}this.page_=t,o.super_init(this,R.PostDCXObject,R.PostDCXObject.prototype.init_5079,i,{},o.clone(s),""),(n=o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle))&&(n.owner=this,n.colorLibrary=this.page_.colorLibrary),this.initializeDefaultState(),this.decodeController()},init_d1c9:function(t,e){var n;this.parent_=null,this.page_=null,o.super_init(this,R.PostDCXObject,R.PostDCXObject.prototype.init_866e,e,t),null==o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle)&&this.set(r.PROPERTY_STYLE,_.FormaStyle.createDefault()),(n=o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle))&&(n.owner=this)},initializeDefaultState:function(){var t;(t=o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle))&&(this.cachedStyle_=t,this.cachedStyle_.colorLibrary=this.page.colorLibrary,this.subscribeToStyle(this.cachedStyle_))},willChangeState:function(t){var e=this;R.PostDCXObject.prototype.willChangeState.call(this,o.clone(t)),s.CoreAssert.isTrue(null==this.stateChangeEvents,"About to change states when a pending state change still has queued events","Forma.willChangeState","Forma.swift",176),this.stateChangeEvents={},o.keys(t).forEach((function(t){var n;(n=e.updateEventForProperty(t))&&(e.stateChangeEvents[t]=n)}));for(var n=o.iter(this.stateChangeEvents);!n.done;n.next()){var r=n.value;this.beginUpdate(r)}o.opt(this.controller,(function(n){return n.formaWillChangeState(e,o.clone(t))}))},didChangeState:function(t){var e=this;R.PostDCXObject.prototype.didChangeState.call(this,o.clone(t)),s.CoreAssert.isTrue(null!=this.stateChangeEvents,"Changed states without prior will-change notification","Forma.didChangeState","Forma.swift",195);for(var n=o.iter(this.stateChangeEvents);!n.done;n.next()){var r=n.value;this.endUpdate(r)}this.stateChangeEvents=null,o.opt(this.controller,(function(n){return n.formaDidChangeState(e,o.clone(t))}))},willCommitState:function(){var t=this;R.PostDCXObject.prototype.willCommitState.call(this),o.opt(this.controller,(function(e){return e.formaWillCommitState(t)}))},didCommitState:function(){var t=this;R.PostDCXObject.prototype.didCommitState.call(this),o.opt(this.controller,(function(e){return e.formaDidCommitState(t)}))},updateEventForProperty:function(t){var e=null;return t==r.PROPERTY_PLACEMENT?e=new g.FormaTransformChangedEvent(this):t==r.PROPERTY_STYLE&&(e=new g.FormaStyleChangedEvent(this)),e},initializeToDefaults:function(){},decodeController:function(){var t=this;if(0!=this.controllerKind.length){var e=o.opt(o.opt(this.page.document,(function(t){return t.controller})),(function(t){return t.controllerFactory}));null!=e?(this.controller=e.createController(this.controllerKind,this),null!=this.controller?null==this.controllerMetadata&&(s.CoreAssert.warning("Forma: No controller metadata found?"),this.set(r.PROPERTY_CONTROLLER_METADATA,m.ControllerMetadata.init_d41d()),o.opt(this.controller,(function(e){return e.controllerMetadata=t.controllerMetadata}))):s.CoreAssert.warning("Forma: Factory did not create a controller for "+this.controllerKind+"!")):s.CoreAssert.warning("Forma: No constructor for controller kind "+this.controllerKind+"!")}},postDecode:function(){this.style.colorLibrary=o.opt(this.page_,(function(t){return t.colorLibrary})),o.opt(this.styleSubscription_,(function(t){return t.unsubscribe()})),this.subscribeToStyle(this.style),o.opt(this.controller,(function(t){return t.postDecode()}))},destroy:function(){this.style.dispose(),o.opt(this.styleSubscription_,(function(t){return t.unsubscribe()})),this.styleSubscription_=null},controllerKind:{get:function(){var t;return(t=o.as(this.get(r.PROPERTY_CONTROLLER_KIND),"String"))||null!=t?t:""}},controllerMetadata:{get:function(){return o.as(this.get(r.PROPERTY_CONTROLLER_METADATA),m.ControllerMetadata)}},className:{get:function(){return r.SCHEMA_CLASS_NAME}},controller:{get:function(){return this.controller_},set:function(t){var e;null==t&&o.opt(v.Host.logging,(function(t){return t.warning("setting a nil controller")})),this.controller_=t,null!=this.controller_&&(this.set(r.PROPERTY_CONTROLLER_KIND,o.opt(this.controller_,(function(t){return t.kind}))),(e=this.controllerMetadata)&&(this.controller_.controllerMetadata=e))}},animation:{get:function(){return o.as(this.get(r.PROPERTY_ANIMATION),d.FormaAnimation)},set:function(t){var e,n,i=this,a=new g.FormaAnimationChangedEvent(this);if(this.beginUpdate(a),e=o.as(this.get(r.PROPERTY_ANIMATION),d.FormaAnimation))for(var s=o.iter(e.keyFrames);!s.done;s.next()){var u=s.value;o.opt(u.style,(function(t){return t.clearColorLibrarySub()}))}if(this.set(r.PROPERTY_ANIMATION,t),n=t)for(var l=o.iter(n.keyFrames);!l.done;l.next())u=l.value,o.opt(u.style,(function(t){return t.colorLibrary=o.opt(i.page_,(function(t){return t.colorLibrary}))}));this.endUpdate(a)}},formaID:{get:function(){return this.path}},contentID:{get:function(){return null!=this.controller?this.controller.contentID:null}},originalID_:{get:function(){return o.as(this.get(r.PROPERTY_ORIGINAL_ID),"String")},set:function(t){this.set(r.PROPERTY_ORIGINAL_ID,t)}},originalID:{get:function(){var t;return(t=this.originalID_)||null!=t?t:this.formaID}},source:{get:function(){return o.as(this.get(r.PROPERTY_SOURCE),"String")},set:function(t){s.CoreAssert.isTrue(f.FormaSourceUtils.isValid(t),void 0,"Forma","Forma.swift",337),this.set(r.PROPERTY_SOURCE,t)}},kind:{get:function(){return this.get(r.PROPERTY_KIND)}},isEqual:function(t){var e;return!!(e=o.as(t,r))&&this.formaID==e.formaID},parent:{get:function(){return this.parent_}},removeFromParent:function(){null!=this.parent_&&this.parent_.removeChild(this)},setParent:function(t,e){void 0===e&&(e=!1);var n=this,r=this.parent_;null!=this.parent_&&null==t&&o.opt(this.styleSubscription_,(function(t){return t.unsubscribe()})),this.parent_=t,null==r&&null!=t&&(this.styleSubscription_=o.opt(this.style_,(function(t){return t.subscribe(n,_.FormaStyleChangedMessage.TYPE)})))},subscribeToStyle:function(t){var e=this;null!=this.parent_?this.styleSubscription_=o.opt(t,(function(t){return t.subscribe(e,_.FormaStyleChangedMessage.TYPE)})):this.styleSubscription_=null},root:{get:function(){return null==this.parent_?o.as(this,F.GroupForma):this.parent_.root}},isDescendent:function(t){for(var e=this.parent;null!=e;){if(e==t)return!0;e=o.opt(e,(function(t){return t.parent}))}return!1},visit:function(t,e){switch(t){case 4:return r.ancestorsNearest(this,0,e);case 5:return r.ancestorsFurthest(this,0,e);case 6:return null;default:if(e(this,0,0))return this}return null},visitPlaced:function(t,e){var n=[];return this.visit(i.FormaTraversal.PreOrder,(function(r,i,a){return 0==i?n=[t]:(n=n.slice(0,1+i)).push(r.placement.concat(o.last(n))),e(r,o.last(n),i,a)}))},visitAll:function(t,e){this.visit(t,(function(t,n,r){return e(t),!1}))},visitAsArray:function(t){var e=[];return this.visitAll(t,(function(t){e.push(t)})),e},visitChildren:function(t){return this.visit(i.FormaTraversal.JustChildren,(function(e,n,r){return t(e,r)}))},filterByKind:function(t,e){void 0===e&&(e=i.FormaTraversal.PreOrder);var n=[];return this.visitAll(e,(function(e){e.kind==t&&n.push(e)})),n},filterByControllerKind:function(t,e){void 0===e&&(e=i.FormaTraversal.PreOrder);var n=[];return this.visitAll(e,(function(e){o.opt(e.controller,(function(e){return e.kind==t}))&&n.push(e)})),n},filterWithCallback:function(t,e){void 0===e&&(e=i.FormaTraversal.PreOrder);var n=[];return this.visitAll(e,(function(e){t(e)&&n.push(e)})),n},successor:function(){return null==this.parent_?null:null!=(t=this.parent_.indexOfChild(this))?this.parent_.childAt(t+1):null;var t},predecessor:function(){return null==this.parent_?null:null!=(t=this.parent_.indexOfChild(this))?this.parent_.childAt(t-1):null;var t},formaByID:function(t){return this.visit(i.FormaTraversal.PreOrder,(function(e,n,r){return e.formaID==t}))},formaByContentID:function(t){return this.visit(i.FormaTraversal.PreOrder,(function(e,n,r){var i;return!(!(i=o.as(e,I.VideoForma))||i.videoContentID!=t)||e.contentID==t}))},allowUserMove:{get:function(){return o.as(this.get(r.PROPERTY_MOVEABLE),"Bool")},set:function(t){this.set(r.PROPERTY_MOVEABLE,t)}},page:{get:function(){return this.page_},set:function(t){this.page_=t}},bounds:{get:function(){return this.boundsInCoordSpace(C.Matrix2D.Identity)},set:function(t){s.CoreAssert.fail("Forma does not support setting it's bounds","Forma","Forma.swift",569)}},boundsInCoordSpace:function(t){return null},frame:{get:function(){return this.boundsInCoordSpace(this.placement)}},finalFrame:{get:function(){return this.boundsInCoordSpace(this.totalPlacement)}},placement:{get:function(){var t;return(t=o.as(this.get(r.PROPERTY_PLACEMENT),C.Matrix2D))||null!=t?t:C.Matrix2D.Identity},set:function(t){if(!this.placement.equal(t)){s.CoreAssert.isTrue(t.finite&&0!=t.determinant,"Placement is not finite","Forma","Forma.swift",591);var e=new g.FormaTransformChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_PLACEMENT,t),this.endUpdate(e)}}},totalPlacement:{get:function(){var t=C.Matrix2D.Identity;return this.visitAll(i.FormaTraversal.FurthestAncestor,(function(e){t=e.placement.concat(t)})),t}},placementFromAncestor:function(t){for(var e=C.Matrix2D.Identity,n=o.iter(this.visitAsArray(i.FormaTraversal.NearestAncestor));!n.done;n.next()){var r=n.value;if(o.eq(i._equality_Forma_Forma,r,t))break;e=e.precat(r.placement)}return e},move:function(t){this.placement=this.placement.concat(t)},moveOriginToPoint:function(t){var e;(e=this.frame)?this.move(C.Matrix2D.translation(e.evalXY(0,0).multiply(-1)).translate(t)):s.CoreAssert.warning("moveOriginToPoint not possible because could not obtain frame")},moveCenterToPoint:function(t){var e;(e=this.frame)?this.move(C.Matrix2D.translation(e.evalXY(.5,.5).multiply(-1)).translate(t)):s.CoreAssert.warning("moveCenterToPoint not possible because could not obtain frame")},movePinToPoint:function(t,e){var n;(n=this.frame)?this.move(C.Matrix2D.translation(n.eval(t).multiply(-1)).translate(e)):s.CoreAssert.warning("moveCenterToPoint not possible because could not obtain frame")},rotation:function(){return 180*this.rotationInRadians()/Math.PI},rotationInRadians:function(){var t=this.placement.transformValues;return Math.atan2(t.rotSine,t.rotCosine)},containsPoint:function(t,e){if(void 0===e&&(e=0),null!=this.controller_)return this.controller.containsPoint(t,e);var n=this.bounds;return null!=n&&(0!=e&&(n=n.outsetXY(e,e)),n.containsPoint(t))},style_:{get:function(){return null==this.cachedStyle_&&(this.cachedStyle_=o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle)),this.cachedStyle_},set:function(t){null!=t&&this.internalSetStyle(t,!0,!0)}},style:{get:function(){return this.style_}},canApplyStyle:function(t){return null!=t},internalSetStyle:function(t,e,n){var i;if(void 0===e&&(e=!1),void 0===n&&(n=!0),i=t){var a=new g.FormaStyleChangedEvent(this);this.beginUpdate(a),o.opt(o.as(this.get(r.PROPERTY_STYLE),_.FormaStyle),(function(t){return t.dispose()})),this.cachedStyle_=null,o.opt(this.styleSubscription_,(function(t){return t.unsubscribe()})),this.set(r.PROPERTY_STYLE,i),this.cachedStyle_=i,this.cachedStyle_.colorLibrary=this.page_.colorLibrary,e&&(s.CoreAssert.isTrue(null==this.cachedStyle_.owner,"Setting a forma style that is already owned.","Forma.internalSetStyle","Forma.swift",735),this.cachedStyle_.owner=this),this.subscribeToStyle(this.cachedStyle_),n&&o.opt(this.controller,(function(t){return t.styleChanged()})),this.endUpdate(a)}},applyStyle:function(t){null!=t&&t!==this.style_&&(this.style_=t.clone()),o.opt(this.controller,(function(t){return t.styleChanged()}))},protectedSetStyle:function(t){this.style_=t},onMessage:function(t){var e;(e=o.as(t,_.FormaStyleChangedMessage))&&(e.isBefore?(s.CoreAssert.isTrue(null==this.styleUpdateEvent_,"nested FormaStyleChangedMessage not allowed right now","Forma.onMessage","Forma.swift",786),this.styleUpdateEvent_=new g.FormaStyleChangedEvent(this),this.beginUpdate(this.styleUpdateEvent_)):(o.opt(this.controller,(function(t){return t.styleChanged()})),this.endUpdate(this.styleUpdateEvent_),this.styleUpdateEvent_=null),e.isAfter&&o.opt(this.controller,(function(t){return t.styleChanged()})))},matchColors:function(t){var e,n;null!=(e=t.style.colors.colorID(l.ColorRole.FieldPrimary))&&this.style.colors.setColorId(l.ColorRole.FieldPrimary,e),null!=(n=t.style.colors.colorID(l.ColorRole.FieldSecondary))&&this.style.colors.setColorId(l.ColorRole.FieldSecondary,n)},match:function(t){var e;this.placement=t.placement,this.style.kind==t.style.kind?this.style.kind==P.GridStyle.KIND||this.style.kind==a.AlignmentGroupStyle.KIND?this.style.match(t.style):(e=t.style.cloneToDatabase(this.database))?this.protectedSetStyle(e):s.CoreAssert.fail("Forma.match: could not clone style","Forma.match","Forma.swift",833):this.matchColors(t),this.allowUserMove=t.allowUserMove,null!=this.controller&&null!=t.controller&&this.controller.match(t.controller)},siblingForma:function(){var t,e=[];if(t=this.parent)for(var n=o.clone(t.visitAsArray(i.FormaTraversal.JustChildren)),r=o.iter(n);!r.done;r.next()){var a=r.value;o.eq(i._equality_Forma_Forma,a,this)||e.push(a)}return e},postMatch:function(t){null!=this.controller&&null!=t.controller&&this.controller.postMatch(t.controller)},getGraph:function(t){var e;return(e=this.page_)?e.pgm.getGraphForForma(this,t):(s.CoreAssert.fail("Forma.getGraph: unexpectedly couldn't get a graph representation","Forma.getGraph","Forma.swift",874),null)},isText:function(){return!1},isImage:function(){return!1},isShape:function(){return!1},isVideo:function(){return!1},isSticker:function(){return!1},isGraphic:function(){return this.isImage()||this.isShape()},isTypeLockup:function(){return null!=this.controller&&o.opt(this.controller,(function(t){return t.kind==S.TypeLockupController.KIND}))},isLogo:function(){return this.hasIntent(r.INTENT_LOGO)},isGridCell:function(){var t;return!!(t=o.as(o.opt(this.parent,(function(t){return t.controller})),E.GridController))&&t.isGridCell(this)},isBackgroundImage:function(){var t;return!!(t=o.as(this.controller,p.FrameController))&&!t.floating&&!t.userGroupMember},hasIntent:function(t){var e;return null!=(e=this.intent)&&e==t},intent:{get:function(){return o.as(this.get(r.PROPERTY_INTENT),"String")},set:function(t){this.set(r.PROPERTY_INTENT,t)}},isModel:{get:function(){return this.isModel_},set:function(t){this.isModel_=t}},tags_:{get:function(){var t,e={};if(t=o.opt(this.getProperty(r.PROPERTY_TAGS),(function(t){return t.dictionaryValue})))for(var n=o.iter(t);!n.done;n.next()){var i,a=n.key;null!=(i=n.value.stringValue)&&(e[a]=i)}return e},set:function(t){for(var e={},n=o.iter(t);!n.done;n.next()){var r=n.key,i=n.value;e[r]=c.DBProperty.stringProperty(c.DBNamePath.init_b14a(u.ContentNode.PROPERTY_TAGS).append(r),i)}this.setProperty(u.ContentNode.PROPERTY_TAGS,c.DBProperty.dictProperty(c.DBNamePath.init_b14a(u.ContentNode.PROPERTY_TAGS),o.clone(e)))}},tags:{get:function(){for(var t=[],e=o.iter(this.tags_);!e.done;e.next()){var n=e.key;t.push(n)}return t}},hasTag:function(t){return null!=this.tags_[t]},clearTags:function(){this.tags_={}},getTag:function(t){return this.tags_[t]},setTag:function(t,e){void 0===e&&(e="");var n=o.clone(this.tags_);n[t]=e,this.tags_=o.clone(n)},removeTag:function(t){o.removeKey(this.tags_,t)},isSameContent:function(t){return this.kind==y.RootForma.KIND&&t.kind==y.RootForma.KIND||null!=this.contentID&&null!=t.contentID&&this.contentID==t.contentID&&this.kind==t.kind},asString:{get:function(){var t,e,n,r,i=(t=o.opt(this.contentID,(function(t){return t.substr(0,8)})))||null!=t?t:"nil",a=this.formaID.substr(0,8),s=(e=o.opt(this.controller,(function(t){return t.kind})))||null!=e?e:"";s==S.TypeLockupController.KIND&&"nil"==i&&this.contentID;var u=(n=o.opt(this.style.colors.library,(function(t){return t.asString})))||null!=n?n:"<none>",l=(r=o.opt(this.finalFrame,(function(t){return t.asString})))||null!=r?r:"(nil finalFrame)";return this.kind==y.RootForma.KIND?this.kind+": "+s+" "+a+" colorLibrary:("+u+") "+i+" "+this.style.opacity+" "+(null!=this.animation?"A":"NA")+" "+l:this.kind+": "+s+" "+a+" "+i+" "+this.style.opacity+" "+(null!=this.animation?"A":"NA")+" "+l}},print:function(){var t="";return this.visit(i.FormaTraversal.PreOrder,(function(e,n,r){for(var i="",a=o.iter(o.range(0,n,!0));!a.done;a.next())i+="    ";return null!=e.controller&&(t+=i+e.asString+"\n"),!1})),t},beginUpdate:function(t){this.isModel||o.opt(this.page_,(function(e){return e.beginUpdate(t)}))},endUpdate:function(t){this.isModel||o.opt(this.page_,(function(e){return e.endUpdate(t)}))},forkToDatabase:function(t,e,n,r){var i,o=R.PostDCXObject.prototype.forkToDatabase.call(this,t,e,n,r);return(i=o)&&(i.setProperty(R.PostDCXObject.PROPERTY_PATH,c.DBProperty.stringProperty(c.DBNamePath.init_b14a(R.PostDCXObject.PROPERTY_PATH),T.GUIDUtils.makeGUID())),null!=i.getProperty(h.DBSchema.PROPERTY_ID)&&i.setProperty(h.DBSchema.PROPERTY_ID,c.DBProperty.stringProperty(c.DBNamePath.init_b14a(h.DBSchema.PROPERTY_ID),t))),o}}}),r),i._equality_Forma_Forma=function(t,e){return t.isEqual(e)}},K0Rh:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("FNB+"),u=n("fWxZ"),l=n("QbzR"),c=n("P83h"),h=n("pnSN"),d=n("lmwz"),m=n("uxH+"),p=n("2ALn"),f=n("Zifs"),_=n("sIWg");i.RootForma=(r=function(){},o.defineClass({name:"RootForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Root"}},PROPERTY_FILLCOLOR_DEPRECATED:"fill-color",PROPERTY_ROOT_STYLE_DEPRECATED:"root-style",SCHEMA_CLASS_NAME:{get:function(){return"RootForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var s=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),u.FormaPage);return a.CoreAssert.isTrue(null!=s,"RootForma needs a parent page","RootForma","RootForma.swift",25),r.init_7dbd(t,e,n,s)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_7dbd:function(t,e,n,r){o.super_init(this,h.GroupForma,h.GroupForma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND},style:function(){return p.RootStyle.createDefault()}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,u=a.value;null==e[s]&&(i[s]=u())}o.super_init(this,h.GroupForma,h.GroupForma.prototype.init_812f,t,o.clone(i))},init_7186:function(t){var e={kind:r.KIND,style:p.RootStyle.createDefault()};this.init_812f(t,o.clone(e))},init_d1c9:function(t,e){o.super_init(this,h.GroupForma,h.GroupForma.prototype.init_d1c9,t,e)},initializeDefaultState:function(){null!=this.rootStyleDeprecated_&&this.protectedSetStyle(this.rootStyleDeprecated_),null!=this.fillColorDeprecated_&&(this.style.colors.fieldPrimary=this.fillColorDeprecated_),h.GroupForma.prototype.initializeDefaultState.call(this)},initializeToDefaults:function(){var t;(t=o.opt(this.page.document,(function(t){return t.controller})))&&(this.controller=t.controllerFactory.createController(m.RootController.KIND,this)),this.bounds=_.TheoRect.fromSize(this.page.pageSize),h.GroupForma.prototype.initializeToDefaults.call(this)},page:{get:function(){return this.page_},set:function(t){var e=this,n=this.page_;this.page_=t,null==n&&(this.styleSubscription_=o.opt(this.style_,(function(t){return t.subscribe(e,l.FormaStyleChangedMessage.TYPE)})))}},subscribeToStyle:function(t){var e=this;null!=this.page_?this.styleSubscription_=o.opt(t,(function(t){return t.subscribe(e,l.FormaStyleChangedMessage.TYPE)})):this.styleSubscription_=null},postDecode:function(){var t,e=this;h.GroupForma.prototype.postDecode.call(this),o.opt(this.controller,(function(t){return t.kind!=m.RootController.KIND}))&&(this.controller=o.opt(o.opt(this.page.document,(function(t){return t.controller})),(function(t){return t.controllerFactory.createController(m.RootController.KIND,e)}))),(t=o.as(this.controller,m.RootController))&&t.createGridControllerIfNone(),null==this.animation&&this.visit(s.FormaTraversal.PreOrder,(function(t,n,i){return!(t instanceof r||!o.opt(t.animation,(function(t){return null!=t.animationStyle}))||(e.page.animationLibrary.setStillAnimation(e,t.animation.animationStyle),0))})),d.ImageFacade.exitCropMode(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},bounds:{get:function(){return null!=this.setBounds?this.setBounds:_.TheoRect.fromSize(this.page.pageSize)},set:function(t){a.CoreAssert.isTrue(null!=t,"Can't set a nil root bounds","RootForma","RootForma.swift",138),a.CoreAssert.isTrue(_.TheoRect.fromSize(this.page.pageSize).equal(t),"Root bounds doesn't match the FormaPage pageSize.","RootForma","RootForma.swift",139),h.GroupForma._setters.bounds.call(this,t)}},placement:{get:function(){return h.GroupForma._getters.placement.call(this)},set:function(t){a.CoreAssert.isTrue(t.isIdentity,"RootForma: Someone's trying to set the root forma placement to something other than identity!","RootForma","RootForma.swift",147),h.GroupForma._setters.placement.call(this,t)}},contentID:{get:function(){return"root"}},isImage:function(){return!1},isGraphic:function(){return!1},isText:function(){return!1},isShape:function(){return!1},isLogo:function(){return!1},hackGenerateArtificialUpdateEvent:function(){var t=new c.FormaInsertedChildrenEvent(this,[],0);this.beginUpdate(t),this.endUpdate(t)},boundsInCoordSpace:function(t){return this.bounds.transform(t)},visible:{get:function(){var t;if(t=this.finalFrame){var e=!1,n=_.TheoRect.Zero;return this.visitAll(s.FormaTraversal.PreOrder,(function(t){var i;t instanceof r||((i=t.finalFrame)&&(n=n.unionWith(i)),t.isImage()&&(e=!0))})),!e||!n.contains(t)}return!1}},rootStyleDeprecated_:{get:function(){return o.as(this.get(r.PROPERTY_ROOT_STYLE_DEPRECATED),l.FormaStyle)}},fillColorDeprecated_:{get:function(){return o.as(this.get(r.PROPERTY_FILLCOLOR_DEPRECATED),f.SolidColor)}}}}),r)},NxMp:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("gXiO"),u=n("cmoc"),l=n("pnSN"),c=n("fdtz"),h=n("K0Rh"),d=n("djAF"),m=n("kSRw"),p=n("enh0"),f=n("WWR6"),_=n("zjod");i.FormaFactory=o.defineProtocol("FormaFactory",{createForma:"(FormaPage, String) -> Forma"}),i.DefaultFormaFactory=(r=function(){this.constructors_={},this.constructors_[h.RootForma.KIND]=function(t,e){return h.RootForma.init_7186(t)},this.constructors_[p.TextForma.KIND]=function(t,e){return p.TextForma.init_7186(t)},this.constructors_[c.ImageForma.KIND]=function(t,e){return c.ImageForma.init_7186(t)},this.constructors_[f.VectorForma.KIND]=function(t,e){return f.VectorForma.init_7186(t)},this.constructors_[l.GroupForma.KIND]=function(t,e){return l.GroupForma.init_7fcf(t,e)},this.constructors_[m.SmartGroupForma.KIND]=function(t,e){return l.GroupForma.init_7fcf(t,l.GroupForma.KIND)},this.constructors_[u.FrameForma.KIND]=function(t,e){return u.FrameForma.init_7186(t)},this.constructors_[d.ShapeForma.KIND]=function(t,e){return d.ShapeForma.init_7186(t)},this.constructors_[_.VideoForma.KIND]=function(t,e){return _.VideoForma.init_7186(t)},s.CoreObject.call(this)},o.defineClass({name:"DefaultFormaFactory",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"FormaFactory"==t}},props:{createForma:function(t,e){var n=this.constructors_[e];return null==n?(a.CoreAssert.warning("createForma: No constructor for kind "+e+" available."),null):n(t,e)}}}),r)},OdB2:function(t,e,n){var r,i,o,a,s,u,l,c,h=e,d=n("oAGj"),m=n("90dd");h.FormaPageView=d.defineProtocol("FormaPageView",{beginViewUpdate:"(FormaUpdateEvent) -> AnyObject",endViewUpdate:"(AnyObject) -> Void",getViewportTransform:"() -> Matrix2D",beginUserResize:"() -> Void",endUserResize:"() -> Void"}),h.FormaBeginUpdateMessage=(r=function t(e,n){this.event=n,m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"FormaBeginUpdateMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaBeginUpdateMessage"}}}}),r),h.FormaEndUpdateMessage=(i=function t(e,n){this.event=n,m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"FormaEndUpdateMessage",ctor:i,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaEndUpdateMessage"}}}}),i),h.PageSizeUpdateMessage=(o=function t(e,n){this.newSize=n,m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"PageSizeUpdateMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"PageSizeUpdateMessage"}}}}),o),h.BeginFormaDragMessage=(a=function t(e){m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"BeginFormaDragMessage",ctor:a,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaDragMessage"}}}}),a),h.FormaDragMessage=(s=function t(e){m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"FormaDragMessage",ctor:s,superName:"TheoMessage",statics:{TYPE:{get:function(){return"FormaDragMessage"}}}}),s),h.EndFormaDragMessage=(u=function t(e){m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"EndFormaDragMessage",ctor:u,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaDragMessage"}}}}),u),h.BeginFormaResizeMessage=(l=function t(e){m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"BeginFormaResizeMessage",ctor:l,superName:"TheoMessage",statics:{TYPE:{get:function(){return"BeginFormaResizeMessage"}}}}),l),h.EndFormaResizeMessage=(c=function t(e){m.TheoMessage.call(this,t.TYPE,e)},d.defineClass({name:"EndFormaResizeMessage",ctor:c,superName:"TheoMessage",statics:{TYPE:{get:function(){return"EndFormaResizeMessage"}}}}),c)},P83h:function(t,e,n){var r,i,o,a,s,u,l,c,h,d,m,p,f,_,g,E,F,P,T,v,C,R,y,S,I,A,O,D,b,N,x,L,Y=e,M=n("oAGj");Y.FormaUpdateEvent=(r=function(t,e){this.duration=0,this.type=t,this.forma=e},M.defineClass({name:"FormaUpdateEvent",ctor:r,superName:"CoreObject"}),r),Y.TextPlacementEvent=(i=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"TextPlacementEvent",ctor:i,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"TextPlacementEvent"}}}}),i),Y.FormaTransformChangedEvent=(o=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaTransformChangedEvent",ctor:o,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaTransformChangedEvent"}}}}),o),Y.FormaCreatedEvent=(a=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaCreatedEvent",ctor:a,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCreatedEvent"}}}}),a),Y.FormaNullChangedEvent=(s=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaNullChangedEvent",ctor:s,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaNullChangedEvent"}}}}),s),Y.FormaAnimationTransactionEvent=(u=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaAnimationTransactionEvent",ctor:u,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationTransactionEvent"}}}}),u),Y.FormaHierarchyChangedEvent=(l=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaHierarchyChangedEvent",ctor:l,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaHierarchyChangedEvent"}}}}),l),Y.FormaChildrenEvent=(c=function(t,e,n,r){this._children=n,this.index=r,Y.FormaUpdateEvent.call(this,Y.FormaInsertedChildrenEvent.TYPE,e)},M.defineClass({name:"FormaChildrenEvent",ctor:c,superName:"FormaUpdateEvent",props:{children:{get:function(){return this._children.concat()}},forEachChild:function(t){this._children.forEach(t)}}}),c),Y.FormaInsertedChildrenEvent=(h=function t(e,n,r){Y.FormaChildrenEvent.call(this,t.TYPE,e,n,r)},M.defineClass({name:"FormaInsertedChildrenEvent",ctor:h,superName:"FormaChildrenEvent",statics:{TYPE:{get:function(){return"FormaInsertedChildrenEvent"}}}}),h),Y.FormaInsertedAuxiliariesEvent=(d=function t(e,n,r){this.auxiliaries=n,this.index=r,Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaInsertedAuxiliariesEvent",ctor:d,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaInsertedAuxiliariesEvent"}}}}),d),Y.FormaRemovedChildrenEvent=(m=function t(e,n,r){Y.FormaChildrenEvent.call(this,t.TYPE,e,n,r)},M.defineClass({name:"FormaRemovedChildrenEvent",ctor:m,superName:"FormaChildrenEvent",statics:{TYPE:{get:function(){return"FormaRemovedChildrenEvent"}}}}),m),Y.FormaRemovedAuxiliariesEvent=(p=function t(e,n,r){this.auxiliaries=n,this.index=r,Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaRemovedAuxiliariesEvent",ctor:p,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaRemovedAuxiliariesEvent"}}}}),p),Y.FormaGeometryChangedEvent=(f=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaGeometryChangedEvent",ctor:f,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGeometryChangedEvent"}}}}),f),Y.FormaBoundsInvalidatedEvent=(_=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaBoundsInvalidatedEvent",ctor:_,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaBoundsInvalidatedEvent"}}}}),_),Y.FormaPathChangedEvent=(g=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaPathChangedEvent",ctor:g,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaPathChangedEvent"}}}}),g),Y.FormaColorChangedEvent=(E=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaColorChangedEvent",ctor:E,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaColorChangedEvent"}}}}),E),Y.FormaStrokeChangedEvent=(F=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaStrokeChangedEvent",ctor:F,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStrokeChangedEvent"}}}}),F),Y.FormaFillRuleChangedEvent=(P=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaFillRuleChangedEvent",ctor:P,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaFillRuleChangedEvent"}}}}),P),Y.FormaContentChangedEvent=(T=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaContentChangedEvent",ctor:T,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaContentChangedEvent"}}}}),T),Y.FormaCutoutChangedEvent=(v=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaCutoutChangedEvent",ctor:v,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaCutoutChangedEvent"}}}}),v),Y.FormaStyleChangedEvent=(C=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaStyleChangedEvent",ctor:C,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaStyleChangedEvent"}}}}),C),Y.AnimationStyleChangedEvent=(R=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"AnimationStyleChangedEvent",ctor:R,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStyleChangedEvent"}}}}),R),Y.AnimationTimeChangedEvent=(y=function t(e,n){this.time=n,Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"AnimationTimeChangedEvent",ctor:y,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationTimeChangedEvent"}}}}),y),Y.AnimationStateChangedEvent=(S=function t(e,n){this.state=n,Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"AnimationStateChangedEvent",ctor:S,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"AnimationStateChangedEvent"}}}}),S),Y.FormaAnimationChangedEvent=(I=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaAnimationChangedEvent",ctor:I,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAnimationChangedEvent"}}}}),I),Y.FormaAlignmentChangedEvent=(A=function t(e,n,r){this.activeSnaplines=M.clone(n),this.nearbySnaplines=M.clone(r),Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaAlignmentChangedEvent",ctor:A,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaAlignmentChangedEvent"}}}}),A),Y.FormaApplyMaskEvent=(O=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaApplyMaskEvent",ctor:O,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaApplyMaskEvent"}}}}),O),Y.FormaVideoStateChangedEvent=(D=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaVideoStateChangedEvent",ctor:D,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaVideoStateChangedEvent"}}}}),D),Y.FormaVideoTimeChangedEvent=(b=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaVideoTimeChangedEvent",ctor:b,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaVideoTimeChangedEvent"}}}}),b),Y.FormaGroupEvent=(N=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaGroupEvent",ctor:N,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaGroupEvent"}}}}),N),Y.FormaUngroupEvent=(x=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaUngroupEvent",ctor:x,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaUngroupEvent"}}}}),x),Y.FormaForceRerenderPseudoChangeEvent=(L=function t(e){Y.FormaUpdateEvent.call(this,t.TYPE,e)},M.defineClass({name:"FormaForceRerenderPseudoChangeEvent",ctor:L,superName:"FormaUpdateEvent",statics:{TYPE:{get:function(){return"FormaForceRerenderPseudoChangeEvent"}}}}),L)},WWR6:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("FNB+"),u=n("fWxZ"),l=n("P83h"),c=n("pnSN"),h=n("sIWg"),d=n("1NAc"),m=n("LGJg");i.VectorForma=(r=function(){this.cachedBounds_=null},o.defineClass({name:"VectorForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Vector"}},PROPERTY_COLOR:"color",PROPERTY_CONTENTID:"content-id",PROPERTY_SIZE:"size",SCHEMA_CLASS_NAME:{get:function(){return"VectorForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var s=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),c.GroupForma),l=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),u.FormaPage);return a.CoreAssert.isTrue(null!=s||null!=l,"VectorForma needs a parent group or page","VectorForma","VectorForma.swift",23),null!=s?r.init_3144(t,e,n,s):r.init_7dbd(t,e,n,l)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){o.super_init(this,s.Forma,s.Forma.prototype.init_3144,t,e,n,r)},init_7dbd:function(t,e,n,r){o.super_init(this,s.Forma,s.Forma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var u=a.key,l=a.value;null==e[u]&&(i[u]=l())}o.super_init(this,s.Forma,s.Forma.prototype.init_812f,t,o.clone(i))},init_7186:function(t){var e={kind:r.KIND};this.init_812f(t,o.clone(e))},init_d1c9:function(t,e){o.super_init(this,s.Forma,s.Forma.prototype.init_d1c9,t,e)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(t){return t==r.PROPERTY_CONTENTID?new l.FormaContentChangedEvent(this):s.Forma.prototype.updateEventForProperty.call(this,t)},contentNode:{get:function(){var t=this;return null==this.contentID?null:o.as(o.opt(this.page.document,(function(e){return e.content.nodeByID(t.contentID)})),m.VectorContentNode)},set:function(t){this.contentID=null==t?null:t.id}},color:{get:function(){return this.get(r.PROPERTY_COLOR)},set:function(t){this.set(r.PROPERTY_COLOR,t)}},size:{get:function(){return o.as(this.get(r.PROPERTY_SIZE),d.TheoSize)},set:function(t){this.set(r.PROPERTY_SIZE,t)}},contentID:{get:function(){var t;return(t=o.as(this.get(r.PROPERTY_CONTENTID),"String"))||null!=t?t:""},set:function(t){var e=new l.FormaContentChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_CONTENTID,t),this.cachedBounds_=null,this.endUpdate(e)}},boundsInCoordSpace:function(t){if(null==this.cachedBounds_){var e=this.contentNode;null!=e&&(this.cachedBounds_=h.TheoRect.fromSize(e.size))}return o.opt(this.cachedBounds_,(function(e){return e.transform(t)}))},isGraphic:function(){return!0}}}),r)},cmoc:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("CWW7"),u=n("Bpjk"),l=n("FNB+"),c=n("6ZWm"),h=n("fWxZ"),d=n("JEzR"),m=n("P83h"),p=n("pnSN"),f=n("fdtz"),_=n("lmwz"),g=n("djAF");i.FrameForma=(r=function(){},o.defineClass({name:"FrameForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"Frame"}},PROPERTY_CLIPMODE:"clipmode",PROPERTY_CROP_RATIO_ID:"cropRatioId",SCHEMA_CLASS_NAME:{get:function(){return"FrameForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var s=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),p.GroupForma),u=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),h.FormaPage);return a.CoreAssert.isTrue(null!=s||null!=u,"FrameForma needs a parent group or page","FrameForma","FrameForma.swift",23),null!=s?r.init_3144(t,e,n,s):r.init_7dbd(t,e,n,u)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){o.super_init(this,p.GroupForma,p.GroupForma.prototype.init_3144,t,e,n,r)},init_7dbd:function(t,e,n,r){o.super_init(this,p.GroupForma,p.GroupForma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND},style:function(){return d.FrameStyle.createDefault()},clipmode:function(){return!0},cropRatioId:function(){return u.CropRatioPresetLibrary.FREEFORM_ID}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==e[s]&&(i[s]=l())}o.super_init(this,p.GroupForma,p.GroupForma.prototype.init_812f,t,o.clone(i))},init_d1c9:function(t,e){o.super_init(this,p.GroupForma,p.GroupForma.prototype.init_d1c9,t,e)},init_7186:function(t){var e={kind:r.KIND,clipmode:!0,cropRatioId:u.CropRatioPresetLibrary.FREEFORM_ID};this.init_812f(t,o.clone(e))},decodeController:function(){var t;(t=o.opt(this.page.document,(function(t){return t.controller})))&&(this.controller=t.controllerFactory.createController(c.FrameController.KIND,this)),p.GroupForma.prototype.decodeController.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(t){switch(t){case"style":var e;return(e=_.ImageFacade.getImageFormaForForma(this))?new m.FormaCutoutChangedEvent(e):null;default:return p.GroupForma.prototype.updateEventForProperty.call(this,t)}},bounds:{get:function(){return p.GroupForma._getters.bounds.call(this)},set:function(t){var e,n,r,i=this.bounds;p.GroupForma._setters.bounds.call(this,t),(e=o.as(this.controller,c.FrameController))&&(n=i)&&(r=t)&&e.setChildrenCropping(e.getCurrentCropType(n,r),n)}},cropRatioId:{get:function(){var t;return(t=o.as(this.get(r.PROPERTY_CROP_RATIO_ID),"String"))||null!=t?t:u.CropRatioPresetLibrary.FREEFORM_ID},set:function(t){this.set(r.PROPERTY_CROP_RATIO_ID,t)}},clipMode:{get:function(){return this.get(r.PROPERTY_CLIPMODE)},set:function(t){this.set(r.PROPERTY_CLIPMODE,t)}},hasAlpha:function(){var t,e=!(!(t=o.opt(o.as(this.controller,c.FrameController),(function(t){return t.hasCutout})))&&null==t)&&t&&null==this.style.colors.fieldPrimary;return this.visitAll(l.FormaTraversal.JustChildren,(function(t){var n=o.as(t,f.ImageForma);null!=n&&n.hasAlpha()&&(e=!0)})),e},image:{get:function(){return _.ImageFacade.getImageFormaForForma(this)}},matchColors:function(t){},match:function(t){var e,n=this;if(p.GroupForma.prototype.match.call(this,t),e=o.as(t,r)){var i,a,u,l,h;if((i=_.ImageFacade.getMaskForForma(e))?_.ImageFacade.applyMaskToForma(this,i,null,!0):(a=_.ImageFacade.getMaskFormaForForma(this))&&(a instanceof g.ShapeForma||a instanceof f.ImageForma)&&_.ImageFacade.removeMaskForForma(this),(u=_.ImageFacade.getCutoutMaskFormaForForma(e))&&(l=u.contentNode)){var d=new s.AddFormaParams(void 0,void 0,void 0,void 0,s.AddFormaParentingHint.doNotAddFormaForContentToTree);s.CreationFacade.addImageForContentNode(t.page,l,d).then((function(e){var r;return(r=o.as(e,f.ImageForma))&&(_.ImageFacade.setCutoutForForma(n,r),_.ImageFacade.setCutoutModeForForma(n,_.ImageFacade.getCutoutModeForForma(t)),r.match(u)),null}))}else(h=o.as(this.controller,c.FrameController))&&_.ImageFacade.getCutoutMaskFormaForForma(this)&&h.hasCutout&&_.ImageFacade.removeCutoutForForma(this);this.cropRatioId=e.cropRatioId}}}}),r)},djAF:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("ascj"),u=n("FNB+"),l=n("fWxZ"),c=n("P83h"),h=n("pnSN"),d=n("iCxV"),m=n("tGKA"),p=n("35Q0"),f=n("u2iI"),_=n("byfQ"),g=n("8t9B"),E=n("hgLm"),F=n("sIWg"),P=n("1NAc"),T=n("LGJg");i.ShapeForma=(r=function(){this.cachedMaskImage_=null},o.defineClass({name:"ShapeForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Shape"}},PROPERTY_ARTWORK:"artwork",PROPERTY_CONTENTID:"content-id",PROPERTY_SHAPELIBRARYID:"shape-id",PROPERTY_SIZE:"size",PROPERTY_SLICE_BOX:"slice-box",PROPERTY_PRESCALE:"prescale",PROPERTY_SHAPE_STYLE_DEPRECATED:"style",PROPERTY_CONTENT_REGION:"content-region",PROPERTY_TEXT_BOX:"text-box",SCHEMA_CLASS_NAME:{get:function(){return"ShapeForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var s=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),h.GroupForma),u=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),l.FormaPage);return a.CoreAssert.isTrue(null!=s||null!=u,"ShapeForma needs a parent group or page","ShapeForma","ShapeForma.swift",31),null!=s?r.init_3144(t,e,n,s):r.init_7dbd(t,e,n,u)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,i){var a;o.super_init(this,u.Forma,u.Forma.prototype.init_3144,t,e,n,i),null!=this.shapeLibraryID&&(p.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(a=this.getProperty(r.PROPERTY_ARTWORK))&&(a.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,a)))},init_7dbd:function(t,e,n,i){var a;o.super_init(this,u.Forma,u.Forma.prototype.init_7dbd,t,e,n,i),null!=this.shapeLibraryID&&(p.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(a=this.getProperty(r.PROPERTY_ARTWORK))&&(a.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,a)))},init_812f:function(t,e){for(var n={kind:function(){return r.KIND},style:function(){return f.ShapeStyle.createDefault()},size:function(){return new P.TheoSize(1,1)}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==e[s]&&(i[s]=l())}o.super_init(this,u.Forma,u.Forma.prototype.init_812f,t,o.clone(i))},init_d1c9:function(t,e){var n;o.super_init(this,u.Forma,u.Forma.prototype.init_d1c9,t,e),null!=this.shapeLibraryID&&(p.ShapeLibrary.applyToShapeForma(this,this.shapeLibraryID),(n=this.getProperty(r.PROPERTY_ARTWORK))&&(n.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,n)))},init_7186:function(t){var e={kind:r.KIND,style:f.ShapeStyle.createDefault(),size:new P.TheoSize(1,1)};this.init_812f(t,o.clone(e))},postDecode:function(){u.Forma.prototype.postDecode.call(this),this.isGridCell()&&null==this.getProperty(u.Forma.PROPERTY_INTENT)&&this.set(u.Forma.PROPERTY_INTENT,u.Forma.INTENT_GRID_CELL)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(t){return t==r.PROPERTY_ARTWORK?new c.FormaContentChangedEvent(this):t==r.PROPERTY_PRESCALE?new c.FormaGeometryChangedEvent(this):t==r.PROPERTY_SLICE_BOX?new c.FormaContentChangedEvent(this):t==r.PROPERTY_CONTENT_REGION?new c.FormaContentChangedEvent(this):t==r.PROPERTY_SIZE?new c.FormaGeometryChangedEvent(this):t==r.PROPERTY_CONTENTID?new c.FormaContentChangedEvent(this):t==r.PROPERTY_SHAPELIBRARYID?new c.FormaContentChangedEvent(this):u.Forma.prototype.updateEventForProperty.call(this,t)},didChangeState:function(t){null==t[r.PROPERTY_ARTWORK]&&null==t[r.PROPERTY_PRESCALE]&&null==t[r.PROPERTY_SLICE_BOX]&&null==t[r.PROPERTY_SIZE]||(this.artworkSized_=null),u.Forma.prototype.didChangeState.call(this,o.clone(t))},match:function(t){var e,n,i;if(u.Forma.prototype.match.call(this,t),e=o.as(t,r)){var a=new c.FormaGeometryChangedEvent(this);this.beginUpdate(a),this.artwork_=e.canonicalArtwork.clone(),this.sliceBox=e.sliceBox,this.contentRegion=e.contentRegion,this.size=e.size,this.endUpdate(a)}(n=o.as(t.controller,g.TypeLockupController))&&null!=(i=o.opt(n.lockupStyle,(function(t){return t.textBacked})))&&i&&this.style.colors.setColorId(s.ColorRole.FieldPrimary,t.style.colors.colorID(s.ColorRole.FieldSecondary))},artwork_:{get:function(){var t,e=new E.TheoRectanglePath(F.TheoRect.fromSize(this.size||new P.TheoSize(1,1)));return(t=o.as(this.get(r.PROPERTY_ARTWORK),_.TheoArtworkNode))||null!=t?t:_.TheoArtworkShape.init_9312(null,[e])},set:function(t){this.set(r.PROPERTY_ARTWORK,t)}},canonicalArtwork:{get:function(){return this.artwork_},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.artwork_=t,this.artworkSized_=null,this.endUpdate(e)}},preScale:{get:function(){return o.as(this.get(r.PROPERTY_PRESCALE),"Double")},set:function(t){if(t!=this.preScale){var e=new c.FormaGeometryChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_PRESCALE,t),this.artworkSized_=null,this.endUpdate(e)}}},sizedArtwork:{get:function(){var t,e;return null==this.artworkSized_&&((t=this.artwork_.bounds)?(e=null!=this.preScale&&isFinite(this.preScale)?this.preScale:Math.min(this.size.width/t.width,this.size.height/t.height),this.artworkSized_=this.artwork_.applySlicing(t,F.TheoRect.fromSize(this.size),this.sliceBox,e,!0)):(a.CoreAssert.warning("No bounds obtained from artwork"),this.artworkSized_=this.artwork_.clone())),this.artworkSized_}},sliceBox:{get:function(){return o.as(this.get(r.PROPERTY_SLICE_BOX),F.TheoRect)},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_SLICE_BOX,t),this.artworkSized_=null,this.endUpdate(e)}},contentRegion:{get:function(){return o.as(this.get(r.PROPERTY_CONTENT_REGION),F.TheoRect)},set:function(t){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_CONTENT_REGION,t),this.endUpdate(e)}},size:{get:function(){return o.as(this.get(r.PROPERTY_SIZE),P.TheoSize)},set:function(t){if(this.size!=t){var e=new c.FormaGeometryChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_SIZE,t),this.artworkSized_=null,this.endUpdate(e)}}},bounds:{get:function(){return this.boundsInCoordSpace(m.Matrix2D.Identity)},set:function(t){var e;if(e=t){if(this.size.equal(e.size))return;this.size=e.size}else a.CoreAssert.fail("shouldnt be setting nil bounds for a shape","ShapeForma","ShapeForma.swift",285)}},boundsInCoordSpace:function(t){return o.opt(this.calcBounds(),(function(e){return e.transform(t)}))},calcBounds:function(){var t;return(t=this.size)?F.TheoRect.fromSize(t):null},contentID:{get:function(){return o.as(this.get(r.PROPERTY_CONTENTID),"String")},set:function(t){if(t!=this.contentID){var e=new c.FormaContentChangedEvent(this);this.beginUpdate(e),this.set(r.PROPERTY_CONTENTID,t),this.endUpdate(e)}}},contentNode:{get:function(){var t=this;return null==this.contentID?null:o.opt(this.page.document,(function(e){return e.content.nodeByID(t.contentID)}))},set:function(t){this.contentID=null==t?null:t.id}},shapeLibraryID:{get:function(){return o.as(this.get(r.PROPERTY_SHAPELIBRARYID),"String")},set:function(t){if(t!=this.shapeLibraryID){var e,n=new c.FormaContentChangedEvent(this);this.beginUpdate(n),this.set(r.PROPERTY_SHAPELIBRARYID,t),(e=this.getProperty(r.PROPERTY_ARTWORK))&&(e.shouldWrite=!1,this.setProperty(r.PROPERTY_ARTWORK,e)),this.endUpdate(n)}}},isGraphic:function(){return!0},isShape:function(){return!0},maskImage:{get:function(){if(null==this.cachedMaskImage_){var t=this.persisted?this.database.beginTransaction("cache_mask",null):null;d.Host.imageAnalysis.setShapeFormaTransparencyMask(this,25),o.opt(t,(function(t){return t.rollback()}))}return this.cachedMaskImage_},set:function(t){this.cachedMaskImage_=t}},getAverageAlpha:function(t){if(this.isGridCell())return 1;var e,n,r=t.transform(this.totalPlacement.inverse);if(this.contentNode instanceof T.VectorContentNode&&(e=this.maskImage)&&(n=this.bounds)){var i,a=o.toDouble(e.cols)/o.toDouble(n.width),s=o.toDouble(e.rows)/o.toDouble(n.height),u=r.multiplyXY(a,s).rounded();if(i=u.intersectionWith(new F.TheoRect(0,0,e.size.width-1,e.size.height-1)))return e.sumRegion(i)/u.area}return 1}}}),r)},enh0:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("ascj"),u=n("FNB+"),l=n("QgZx"),c=n("fWxZ"),h=n("P83h"),d=n("pnSN"),m=n("iCxV"),p=n("cEEQ"),f=n("c+uM"),_=n("Zifs"),g=n("a9ow"),E=n("9YN4"),F=n("8t9B"),P=n("3UhB"),T=n("x4Gy"),v=n("oKlP"),C=n("uUew"),R=n("sIWg"),y=n("LCGV");i.TextForma=(r=function(){this.renderRuns=new T.RenderRuns},o.defineClass({name:"TextForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"Text"}},PROPERTY_SIZE:"size",PROPERTY_TEXT:"text",PROPERTY_TEXT_STYLE:"text-style",PROPERTY_FILLCOLOR_DEPRECATED:"fill-color",PROPERTY_RANGEINLOCKUP:"range-in-lockup",PROPERTY_ROWINDEX:"row-index",SCHEMA_CLASS_NAME:{get:function(){return"TextForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var s=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),d.GroupForma),u=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),c.FormaPage);return a.CoreAssert.isTrue(null!=s||null!=u,"TextForma needs a parent group or page","TextForma","TextForma.swift",26),null!=s?r.init_3144(t,e,n,s):r.init_7dbd(t,e,n,u)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){o.super_init(this,u.Forma,u.Forma.prototype.init_3144,t,e,n,r)},init_7dbd:function(t,e,n,r){o.super_init(this,u.Forma,u.Forma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND},style:function(){return y.TextStyle.createDefault()},text:function(){return T.TextModel.init_d41d()}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==e[s]&&(i[s]=l())}o.super_init(this,u.Forma,u.Forma.prototype.init_812f,t,o.clone(i))},init_7186:function(t){var e={kind:r.KIND,style:y.TextStyle.createDefault(),text:T.TextModel.init_d41d()};this.init_812f(t,o.clone(e))},init_d1c9:function(t,e){o.super_init(this,u.Forma,u.Forma.prototype.init_d1c9,t,e)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},didChangeState:function(t){o.count(t)>0&&(this.cachedBounds_=null),o.keys(t).includes(r.PROPERTY_TEXT)&&(this.cachedText_=null),u.Forma.prototype.didChangeState.call(this,o.clone(t))},clearCache:function(){u.Forma.prototype.clearCache.call(this),this.renderRuns.clear()},updateEventForProperty:function(t){return t==r.PROPERTY_TEXT?new h.FormaGeometryChangedEvent(this):u.Forma.prototype.updateEventForProperty.call(this,t)},postDecode:function(){var t,e,n,r,i;if(u.Forma.prototype.postDecode.call(this),(e=o.opt(this.model_.getProperty(T.TextModel.PROPERTY_FONT_NAME),(function(t){return t.arrayValue})))&&(n=o.opt(o.first(e),(function(t){return t.dictionaryValue})))&&(r=o.opt(n[g.TextAttribute.PROPERTY_VALUE],(function(t){return t.dictionaryValue})))&&null!=(i=o.opt(r[l.FontDescriptor.PROPERTY_POSTSCRIPT_NAME],(function(t){return t.stringValue})))){var a=this.model_.fontName.value;a.postScriptName==i&&a.availability==l.FontAvailability.LOADED||o.opt(this.page.document,(function(t){return t.recordMissingFont(i)}))}if(((t=o.opt(this.page.document,(function(t){return t.versionDecoded.vers})))||null!=t?t:0)<E.TheoDocumentVersion.Grouping){var c=this.textModel.fontColor.value;o.eq(_._equality_SolidColor_SolidColor,c,this.style.colors.fieldPrimary)||this.style.colors.setColor(s.ColorRole.FieldPrimary,c)}},model_:{get:function(){return this.get(r.PROPERTY_TEXT)},set:function(t){this.set(r.PROPERTY_TEXT,t)}},textStyle:{get:function(){return o.as(this.get(r.PROPERTY_TEXT_STYLE),y.TextStyle)},set:function(t){this.set(r.PROPERTY_TEXT_STYLE,t)}},textColor:{get:function(){return o.as(this.get(r.PROPERTY_FILLCOLOR_DEPRECATED),_.SolidColor)}},rangeInLockup_:{get:function(){var t;return(t=o.as(this.get(r.PROPERTY_RANGEINLOCKUP),C.TextRange))||null!=t?t:new C.TextRange(0,0)},set:function(t){this.set(r.PROPERTY_RANGEINLOCKUP,t)}},rowIndex_:{get:function(){var t;return(t=o.as(this.get(r.PROPERTY_ROWINDEX),"Int"))||null!=t?t:0},set:function(t){this.set(r.PROPERTY_ROWINDEX,t)}},isSameContent:function(t){var e;return!!(e=o.as(t,r))&&this.model_.text==e.textModel.text},isText:function(){return!0},boundsInCoordSpace:function(t){var e,n;if(0==this.model_.text.length)return R.TheoRect.Zero;if(null==this.cachedBounds_){var r=this.model_,i=o.opt(o.as(r.attributeAtIndex(g.FontDescriptorAttribute.NAME,0).attr,g.FontDescriptorAttribute),(function(t){return t.value})),a=o.opt(o.as(r.attributeAtIndex(g.FontSizeAttribute.NAME,0).attr,g.FontSizeAttribute),(function(t){return t.value})),s=(e=o.opt(o.as(r.attributeAtIndex(g.FontStrokeWidthAttribute.NAME,0).attr,g.FontStrokeWidthAttribute),(function(t){return t.value})))||null!=e?e:0,u=(n=o.opt(o.as(r.attributeAtIndex(g.TrackingAttribute.NAME,0).attr,g.TrackingAttribute),(function(t){return t.value})))||null!=n?n:0;this.cachedBounds_=m.Host.textModelUtils.measureInkBoundsWithTracking(this.model_.text,i,a,u),0!=s&&(this.cachedBounds_=this.cachedBounds_.insetXY(-s/2,-s/2))}return this.cachedBounds_.transform(t)},baselineBoundsInCoordSpace:function(t){var e;if(0==this.model_.text.length)return R.TheoRect.Zero;var n=o.opt(o.as(this.model_.attributeAtIndex(g.FontDescriptorAttribute.NAME,0).attr,g.FontDescriptorAttribute),(function(t){return t.value})),r=o.opt(o.as(this.model_.attributeAtIndex(g.FontSizeAttribute.NAME,0).attr,g.FontSizeAttribute),(function(t){return t.value})),i=(e=o.opt(o.as(this.model_.attributeAtIndex(g.TrackingAttribute.NAME,0).attr,g.TrackingAttribute),(function(t){return t.value})))||null!=e?e:0;return m.Host.textModelUtils.measureBaselineBounds(this.model_.text,n,r,i).transform(t)},setTextProperties:function(t,e,n,r,i,o,a,u,l,c){var d=new h.FormaGeometryChangedEvent(this);this.beginUpdate(d),null!=this.cachedText_&&t==this.cachedText_||(this.model_.clear(),this.model_.insert(t,0),this.cachedText_=t);var m=this.model_.rangeAll;this.model_.apply(g.FontDescriptorAttribute.init_2063(e),m),this.model_.apply(g.FontSizeAttribute.init_2063(n),m),this.model_.apply(g.FontColorAttribute.init_2063(r),m),this.model_.apply(g.FontStrokeColorAttribute.init_2063(i),m),this.model_.apply(g.FontStrokeWidthAttribute.init_2063(o),m),this.model_.apply(g.TextLookAttribute.init_2063(a),m),this.model_.apply(g.TrackingAttribute.init_2063(c),m),this.cachedBounds_=null,this.rangeInLockup_=u,this.rowIndex_=l,this.style.colors.setColor(s.ColorRole.FieldPrimary,r),this.endUpdate(d)},textModel:{get:function(){return this.model_}},rangeInLockup:{get:function(){return this.rangeInLockup_}},lockupForma:{get:function(){var t=function(t){return t.visit(u.FormaTraversal.NearestAncestor,(function(t,e,n){var r;return!!(r=t.controller)&&r instanceof F.TypeLockupController}))};return a.CoreAssert.isTrue(t(this)==o.opt(o.opt(this.parent,(function(t){return t.parent})),(function(t){return t.parent})),void 0,"TextForma","TextForma.swift",248),o.as(t(this),d.GroupForma)}},isRangeStart:function(){var t,e=this.textModel.text.includes("");if(t=o.as(o.opt(this.lockupForma,(function(t){return t.controller})),F.TypeLockupController))for(var n=o.iter(t.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(e){if(r.end==this.rangeInLockup.end)return!0}else if(r.start==this.rangeInLockup.start)return!0}return!1},isRangeEnd:function(){var t,e=this.textModel.text.includes("");if(t=o.as(o.opt(this.lockupForma,(function(t){return t.controller})),F.TypeLockupController))for(var n=o.iter(t.getCharacterStyleRanges());!n.done;n.next()){var r=n.value;if(e){if(r.start==this.rangeInLockup.start)return!0}else if(r.end==this.rangeInLockup.end)return!0}return!1},rowIndex:{get:function(){return this.rowIndex_}},getBoundsCenter:function(){var t;if(t=o.opt(this.bounds,(function(t){return t.center}))){if(!m.Host.textModelUtils.usePGMRenderer())return t;var e,n;if(null!=(e=o.opt(o.as(o.opt(this.lockupForma,(function(t){return t.controller})),F.TypeLockupController),(function(t){return t.text})))&&(n=o.opt(o.opt(o.as(o.opt(this.lockupForma,(function(t){return t.style})),f.LockupStyle),(function(t){return t.font})),(function(t){return t.fontData})))){var r=p.getTypographicBoundingRatiosOfString(e,n,!1),i=this.textModel.fontSize.value,a=r.heightRatio*i/2+n.capRatio*i-r.textVerticalOffsetRatio*i;return new v.TheoPoint(t.x,a)}return t}return v.TheoPoint.ZERO},isWhiteSpace:function(){return P.TypeLockupUtils.isWhiteSpace(this.model_.text)}}}),r)},fWxZ:function(t,e,n){var r,i,o=e,a=n("oAGj"),s=n("6NRR"),u=n("KSe6"),l=n("SpAV"),c=n("9WSY"),h=n("yhkb"),d=n("quOg"),m=n("lqhW"),p=n("FNB+"),f=n("NxMp"),_=n("cmoc"),g=n("ylxa"),E=n("ML5t"),F=n("OdB2"),P=n("P83h"),T=n("pnSN"),v=n("iCxV"),C=n("U010"),R=n("fdtz"),y=n("b/QB"),S=n("Quhx"),I=n("K0Rh"),A=n("9YN4"),O=n("enh0"),D=n("sIWg"),b=n("1NAc");o.FormaPage=(r=function(){this.formaFactory_=new f.DefaultFormaFactory,this.pgmSource_=null,this.colorLibrary_=null},i={},a.defineClass({name:"FormaPage",ctor:r,superName:"PostDCXObject",statics:{SCHEMA_CLASS_NAME:"FormaPage",factory:{get:function(){return void 0===i.factory&&(i.factory=function(t,e,n,i){var o=a.as(a.opt(a.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),A.TheoDocument);return l.CoreAssert.isTrue(null!=o,"FormaPage needs a parent document","FormaPage","FormaPage.swift",15),r.init_3144(t,e,n,o)}),i.factory},set:function(t){i.factory=t}},PROPERTY_KIND:"kind",PROPERTY_PAGE_SIZE:"size",PROPERTY_TEMPLATE_ID:"template-id",PROPERTY_COLOR_LIBRARY:"color-library",PROPERTY_SIZE_ID:"size-id",PROPERTY_ORIGINAL_SIZE_ID:"original-size-id",PROPERTY_CUSTOM_SIZE_FORMAT:"custom-size-format",PROPERTY_CUSTOM_SIZE_PPI:"custom-size-ppi",PROPERTY_EXPORT_DATA:"export-data",PROPERTY_CHILDREN:"children",DEFAULT_SIZE_ID:"Instagram",DEFAULT_ORIGINAL_SIZE_ID:"Unknown",DEFAULT_CUSTOM_SIZE_FORMAT:{get:function(){return void 0===i.DEFAULT_CUSTOM_SIZE_FORMAT&&(i.DEFAULT_CUSTOM_SIZE_FORMAT=g.PageExportFormat.PIXELS),i.DEFAULT_CUSTOM_SIZE_FORMAT}},DEFAULT_CUSTOM_SIZE_PPI:300,DEFAULT_PAGE_SIZE:{get:function(){return void 0===i.DEFAULT_PAGE_SIZE&&(i.DEFAULT_PAGE_SIZE=new b.TheoSize(1200,1200)),i.DEFAULT_PAGE_SIZE}},DCXTYPE:{get:function(){return"application/vnd.adobe.theo.forma+dcx"}},PATH:{get:function(){return"forma-document"}},_implements:function(t){return"IDBObject"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){this.document_=r,this.imageFilterLibrary_=new y.ImageFilterLibrary,this.imageCutoutLibrary_=new C.ImageCutoutLibrary,this.animationLibrary_=new u.AnimationLibrary,a.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_3181,e,n,t),this.colorLibraryController_=new h.ColorLibraryController(this.colorLibrary,r),this.animationController_=new s.AnimationController(r)},init_d0e4:function(t){this.document_=t,this.imageFilterLibrary_=new y.ImageFilterLibrary,this.imageCutoutLibrary_=new C.ImageCutoutLibrary,this.animationLibrary_=new u.AnimationLibrary,a.super_init(this,S.PostDCXObject,S.PostDCXObject.prototype.init_11e0,t.database),this.set(S.PostDCXObject.PROPERTY_PATH,r.PATH),this.set(S.PostDCXObject.PROPERTY_TYPE,r.DCXTYPE),this.set(r.PROPERTY_PAGE_SIZE,r.DEFAULT_PAGE_SIZE),this.set(r.PROPERTY_SIZE_ID,r.DEFAULT_SIZE_ID),this.set(r.PROPERTY_COLOR_LIBRARY,c.ColorLibrary.init_d41d()),this.colorLibraryController_=new h.ColorLibraryController(this.colorLibrary,t),this.animationController_=new s.AnimationController(t),this.root_=a.as(this.createForma(I.RootForma.KIND),T.GroupForma)},postDecode:function(){var t=this;null==this.colorLibrary.color(a.as(this.colorLibraryController.getThemeColorKeys()[0],"String"))&&a.opt(this.colorLibraryController_,(function(e){return e.applyLegacyColorThemeFromDocument(t.document_)})),a.opt(this.colorLibraryController_,(function(t){return t.ensureDerivedColorsAreSet()})),this.root_.visitAll(p.FormaTraversal.PostOrder,(function(t){return t.postDecode()}))},className:{get:function(){return r.SCHEMA_CLASS_NAME}},document:{get:function(){return this.document_}},view:{get:function(){return this.view_},set:function(t){this.view_=t}},pgm:{get:function(){return this.pgmSource_=this.pgmSource_||new E.FormaPagePGMSource(this),this.pgmSource_}},setPageSizeFromDesignSize:function(t){var e=Math.max(this.pageSize_.width,this.pageSize_.height),n=t.aspectRatio>1?Math.round(e/t.aspectRatio):e,r=Math.round(t.aspectRatio*n);this.sizeID=t.id,this.customSizeFormat=t.exportData.format,this.customSizePPI=t.exportData.PPI,this.templateID=null,this.setPageSize(new b.TheoSize(r,n),t.exportData)},setPageSize:function(t,e){void 0===e&&(e=null),null!=e&&Math.abs((e.dimensions.aspectRatio-t.aspectRatio)/Math.max(e.dimensions.aspectRatio,t.aspectRatio))>.02?l.CoreAssert.fail("Incompatible dimensions","FormaPage.setPageSize","FormaPage.swift",145):(t.equal(this.pageSize_)||(this.pageSize_=t,this.root.bounds=D.TheoRect.fromSize(t),this.publish(new F.PageSizeUpdateMessage(this,t))),this.exportData_=e)},getExportDataWithLimitTo:function(t){return this.getExportData(t,null)},getPageExportData:function(){return this.getExportData(null,null)},getExportData:function(t,e){var n=null;if(null!=this.exportData_)n=this.exportData_;else{var r=m.DesignSizeLibrary.getById(this.sizeID);null!=r&&(n=r.exportData)}var i=this.pageSize_.aspectRatio,o=null!=e?e:m.DesignSizeLibrary.MAX_EDGE;null==n&&(n=i<1?new g.FormaPageExportData(new b.TheoSize(Math.round(o*i),o),g.PageExportFormat.PIXELS):new g.FormaPageExportData(new b.TheoSize(o,Math.round(o/i)),g.PageExportFormat.PIXELS));var a=Math.max(n.pixelDimensions.width,n.pixelDimensions.height);return null!=t&&a>t&&(o=t,n=i<1?new g.FormaPageExportData(new b.TheoSize(Math.round(o*i),o),g.PageExportFormat.PIXELS):new g.FormaPageExportData(new b.TheoSize(o,Math.round(o/i)),g.PageExportFormat.PIXELS)),n},pageSize_:{get:function(){var t;return(t=a.as(this.get(r.PROPERTY_PAGE_SIZE),b.TheoSize))||null!=t?t:r.DEFAULT_PAGE_SIZE},set:function(t){this.set(r.PROPERTY_PAGE_SIZE,t)}},pageSize:{get:function(){return this.pageSize_}},templateID:{get:function(){return a.as(this.get(r.PROPERTY_TEMPLATE_ID),"String")},set:function(t){this.set(r.PROPERTY_TEMPLATE_ID,t)}},sizeID:{get:function(){var t;return(t=a.as(this.get(r.PROPERTY_SIZE_ID),"String"))||null!=t?t:r.DEFAULT_SIZE_ID},set:function(t){this.set(r.PROPERTY_SIZE_ID,t)}},originalSizeID:{get:function(){var t;return(t=a.as(this.get(r.PROPERTY_ORIGINAL_SIZE_ID),"String"))||null!=t?t:r.DEFAULT_ORIGINAL_SIZE_ID},set:function(t){this.set(r.PROPERTY_ORIGINAL_SIZE_ID,t)}},customSizeFormat:{get:function(){var t,e,n=(t=a.as(this.get(r.PROPERTY_CUSTOM_SIZE_FORMAT),"Int"))||null!=t?t:r.DEFAULT_CUSTOM_SIZE_FORMAT;return(e=g.PageExportFormat.toCaseValue(n))||null!=e?e:r.DEFAULT_CUSTOM_SIZE_FORMAT},set:function(t){this.set(r.PROPERTY_CUSTOM_SIZE_FORMAT,t)}},customSizePPI:{get:function(){var t;return(t=a.as(this.get(r.PROPERTY_CUSTOM_SIZE_PPI),"Double"))||null!=t?t:r.DEFAULT_CUSTOM_SIZE_PPI},set:function(t){this.set(r.PROPERTY_CUSTOM_SIZE_PPI,t)}},colorLibrary:{get:function(){return null==this.colorLibrary_&&(this.colorLibrary_=a.as(this.get(r.PROPERTY_COLOR_LIBRARY),c.ColorLibrary)),this.colorLibrary_}},setColorLibrary:function(t){this.colorLibrary_=t,this.set(r.PROPERTY_COLOR_LIBRARY,t)},colorLibraryController:{get:function(){return this.colorLibraryController_}},exportData_:{get:function(){return a.as(this.get(r.PROPERTY_EXPORT_DATA),g.FormaPageExportData)},set:function(t){this.set(r.PROPERTY_EXPORT_DATA,t)}},exportData:{get:function(){return this.exportData_}},children_:{get:function(){var t;return(t=a.as(this.get(r.PROPERTY_CHILDREN),["Array",p.Forma]))||null!=t?t:[]}},root_:{get:function(){return this.children_.length>0?a.as(this.children_[0],T.GroupForma):null},set:function(t){if(null!=t&&0==this.children_.length){var e=a.clone(a.as(this.get(r.PROPERTY_CHILDREN),["Array",p.Forma]));null!=e&&e.length>0?(e[0]=t,this.set(r.PROPERTY_CHILDREN,a.clone(e))):this.set(r.PROPERTY_CHILDREN,[a.as(t,p.Forma)])}}},root:{get:function(){return this.root_}},hasRoot:function(){return null!=this.root_},imageFilterLibrary:{get:function(){return this.imageFilterLibrary_}},imageCutoutLibrary:{get:function(){return this.imageCutoutLibrary_}},animationLibrary:{get:function(){return this.animationLibrary_}},layoutLibrary:{get:function(){return this.document.gridLibrary}},animationController:{get:function(){return this.animationController_}},imageColors:{get:function(){var t,e,n=[],r=a.clone(this.root_.filterWithCallback((function(t){return t instanceof R.ImageForma})));return r.length>0&&(t=a.as(r[0],R.ImageForma))&&(e=a.opt(t.contentNode,(function(t){return t.image})))&&a.append(n,e.getImageColors(10)),n}},formaByID:function(t){return this.root_.formaByID(t)},selectableFormaeIntersectingRect:function(t){var e=[];return this.root_.visit(p.FormaTraversal.PreOrder,(function(n,r,i){if(null!=n.controller&&n.controller.canMultiSelect&&!n.isFullCanvas&&D.TheoRect.PointInCommon(t,n.totalPlacement.inverse,n.bounds)){if(n.controller.userGroupChild){for(var o=n;o.controller.userGroupChild;)o=o.parent;return a.containsEq(e,o,p._equality_Forma_Forma)||e.push(o),!1}var s,u;(s=a.as(n.parent,_.FrameForma))?D.TheoRect.PointInCommon(t,s.totalPlacement.inverse,s.bounds)&&e.push(n):(u=a.as(n,O.TextForma))?e.push(u.lockupForma):e.push(n)}return!1})),e},formaAtPoint:function(t,e,n,r){void 0===e&&(e=0),void 0===n&&(n=null),void 0===r&&(r=null);var i,o=this,s=null;return this.root_.visit(p.FormaTraversal.PreOrder,(function(u,c,h){var m;if(m=a.opt(u.totalPlacement.inverse,(function(e){return e.transformPoint(t)}))){var p=Math.sqrt(Math.abs(u.totalPlacement.determinant));l.CoreAssert.isTrue(0!=p,"framescale is zero","FormaPage.formaAtPoint","FormaPage.swift",395);var f=e/p;if(u.containsPoint(m,f)&&!u.isFullCanvas){if(o.document.controller.interactionMode==d.InteractionMode.AutomaticGrid&&null!=u.controller&&u.controller.floating&&!v.Host.platform.isWeb)return!0;if(null!=r&&0==r(u))return!1;if(((i=a.opt(u.controller,(function(t){return t.userGroup})))||null!=i)&&i)return!1;if(null!=n){for(var g=!1,E=a.iter(n);!E.done;E.next()){var F=E.value;if(u.kind==F&&(!u.isShape()||null!=u.controller)){g=!0;break}}if(0==g)return!1}var P,T;if(P=a.as(u.parent,_.FrameForma)){if(T=a.opt(P.totalPlacement.inverse,(function(e){return e.transformPoint(t)}))){var C=Math.sqrt(Math.abs(P.totalPlacement.determinant));l.CoreAssert.isTrue(0!=C,"framescale is zero","FormaPage.formaAtPoint","FormaPage.swift",434);var R=e/C;P.containsPoint(T,R)&&(s=u)}}else s=u}}return!1})),s},formaAtPointInSelection:function(t,e){var n=null;return e.forEachSelected((function(e){return e.visit(p.FormaTraversal.PreOrder,(function(e,r,i){var o;if((o=a.opt(e.totalPlacement.inverse,(function(e){return e.transformPoint(t)})))&&e.containsPoint(o)&&!e.isFullCanvas){if(e instanceof O.TextForma)return n=e,!0;var s,u;(s=a.as(e.parent,_.FrameForma))?(u=a.opt(s.totalPlacement.inverse,(function(e){return e.transformPoint(t)})))&&s.containsPoint(u)&&(n=e):n=e}return!1}))})),n},createForma:function(t){var e=this.formaFactory_.createForma(this,t);if(null==e)return null;var n=new P.FormaCreatedEvent(e);return this.beginUpdate(n),e.initializeToDefaults(),this.endUpdate(n),e},createFormaWithController:function(t,e){var n=this.formaFactory_.createForma(this,t);if(null==n)return null;var r=new P.FormaCreatedEvent(n);return this.beginUpdate(r),n.initializeToDefaults(),n.controller=a.opt(a.opt(this.document_,(function(t){return t.controller})),(function(t){return t.controllerFactory.createController(e,n)})),this.endUpdate(r),n},createModelForma:function(t){var e=this.formaFactory_.createForma(this,t);return null==e?null:(e.isModel=!0,e)},beginUpdate:function(t){null!=this.view_&&(t.token=this.view_.beginViewUpdate(t)),this.publish(new F.FormaBeginUpdateMessage(this,t))},endUpdate:function(t){this.publish(new F.FormaEndUpdateMessage(this,t)),null!=this.view_&&(t.type!=P.FormaInsertedChildrenEvent.TYPE&&a.opt(this.document_,(function(t){return t.recordModification()})),this.view_.endViewUpdate(t.token))}}}),r)},fdtz:function(t,e,n){var r,i,o,a=e,s=n("oAGj"),u=n("SpAV"),l=n("ascj"),c=n("FNB+"),h=n("6ZWm"),d=n("cmoc"),m=n("fWxZ"),p=n("P83h"),f=n("pnSN"),_=n("NkBu"),g=n("q5zr"),E=n("uWOl"),F=n("tGKA"),P=n("VkKB"),T=n("Zifs"),v=n("sIWg");a.LRUColorCacheEntry=(r=function(t,e){this.key=t,this.value=e},s.defineClass({name:"LRUColorCacheEntry",ctor:r}),r),a.LRUColorCache=(i=function(t){this.cachedItemsByKey_={},this.cachedItemsLRU_=[],void 0===t&&(t=50),this.maxEntries_=t},s.defineClass({name:"LRUColorCache",ctor:i,props:{get:function(t){var e;return(e=this.cachedItemsByKey_[t])?(s.remove(this.cachedItemsLRU_,e),this.cachedItemsLRU_.splice(0,0,e),e.value):null},remove:function(t){var e;(e=this.cachedItemsByKey_[t])&&(s.removeKey(this.cachedItemsByKey_,t),s.remove(this.cachedItemsLRU_,e))},add:function(t,e){(n=this.cachedItemsByKey_[t])&&(s.removeKey(this.cachedItemsByKey_,t),s.remove(this.cachedItemsLRU_,n));var n=new a.LRUColorCacheEntry(t,e);this.cachedItemsByKey_[t]=n,this.cachedItemsLRU_.splice(0,0,n);var r=this.cachedItemsLRU_.length;r>this.maxEntries_&&this.cachedItemsLRU_.splice(this.maxEntries_,r-this.maxEntries_)}}}),i),a.ImageForma=(o=function(){this.cachedBounds_=null,this.cachedContent_=null,this.avgColorCache_=new a.LRUColorCache},s.defineClass({name:"ImageForma",ctor:o,superName:"Forma",statics:{KIND:{get:function(){return"Image"}},PROPERTY_CONTENTID:"content-id",PROPERTY_IMAGE_STYLE_DEPRECATED:"image-style",SCHEMA_CLASS_NAME:{get:function(){return"ImageForma"}},factory:{get:function(){return function(t,e,n,r){if(null!=e){var i=s.as(s.opt(s.opt(r,(function(t){return t.backLink})),(function(t){return t.dereference()})),f.GroupForma),a=s.as(s.opt(s.opt(r,(function(t){return t.backLink})),(function(t){return t.dereference()})),m.FormaPage);return u.CoreAssert.isTrue(null!=i||null!=a,"ImageForma needs a parent group or page","ImageForma","ImageForma.swift",73),null!=i?o.init_3144(t,e,n,i):o.init_7dbd(t,e,n,a)}return o.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{deprecatedStyle_:{get:function(){return s.as(this.get(o.PROPERTY_IMAGE_STYLE_DEPRECATED),E.ImageStyle)}},init_3144:function(t,e,n,r){s.super_init(this,c.Forma,c.Forma.prototype.init_3144,t,e,n,r),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},init_7dbd:function(t,e,n,r){s.super_init(this,c.Forma,c.Forma.prototype.init_7dbd,t,e,n,r),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},init_812f:function(t,e){for(var n={kind:function(){return o.KIND},style:function(){return E.ImageStyle.createDefault()}},r=s.clone(e),i=s.iter(n);!i.done;i.next()){var a=i.key,u=i.value;null==e[a]&&(r[a]=u())}s.super_init(this,c.Forma,c.Forma.prototype.init_812f,t,s.clone(r))},init_7186:function(t){var e={kind:o.KIND,style:E.ImageStyle.createDefault()};this.init_812f(t,s.clone(e))},init_d1c9:function(t,e){s.super_init(this,c.Forma,c.Forma.prototype.init_d1c9,t,e),null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_)},initializeDefaultState:function(){null!=this.deprecatedStyle_&&this.protectedSetStyle(this.deprecatedStyle_),c.Forma.prototype.initializeDefaultState.call(this)},decodeController:function(){var t;null==this.controller&&(t=s.opt(this.page.document,(function(t){return t.controller})))&&(this.controller=t.controllerFactory.createController(_.ImageController.KIND,this)),c.Forma.prototype.decodeController.call(this)},className:{get:function(){return o.SCHEMA_CLASS_NAME}},updateEventForProperty:function(t){return t==o.PROPERTY_CONTENTID?new p.FormaContentChangedEvent(this):c.Forma.prototype.updateEventForProperty.call(this,t)},postDecode:function(){var t,e,n,r,i;(t=this.contentNode)&&(e=t.mediaMetadata)&&null!=(n=e.designIntent)&&(n==P.MediaMetadata.DESIGNINTENT_LOGO&&(this.intent=c.Forma.INTENT_LOGO),n==P.MediaMetadata.DESIGNINTENT_PATTERN&&(this.intent=c.Forma.INTENT_PATTERN),n==P.MediaMetadata.DESIGNINTENT_FLOATING_IMAGE&&(this.intent=c.Forma.INTENT_FLOATING_IMAGE)),this.isGridCell()&&null==this.getProperty(c.Forma.PROPERTY_INTENT)&&this.set(c.Forma.PROPERTY_INTENT,c.Forma.INTENT_GRID_CELL),(r=s.opt(this.parent,(function(t){return t.controller})))&&r.kind!=h.FrameController.KIND&&(i=s.as(this.page.createFormaWithController(d.FrameForma.KIND,h.FrameController.KIND),d.FrameForma))&&(s.opt(this.parent,(function(t){return t.appendChild(i)})),i.bounds=this.bounds,i.placement=this.placement,this.placement=F.Matrix2D.Identity,i.appendChild(this,!1),i.allowUserMove=!0),c.Forma.prototype.postDecode.call(this)},contentNode:{get:function(){var t,e;null!=(t=this.contentID)&&((!(e=this.cachedContent_)||e.id!=t)&&(this.cachedContent_=s.as(s.opt(this.page.document,(function(e){return e.content.nodeByID(t)})),g.ImageContentNode)));return this.cachedContent_},set:function(t){this.cachedContent_=t,this.contentID=s.opt(t,(function(t){return t.id}))}},contentUrl:{get:function(){return s.opt(this.contentNode,(function(t){return t.url}))}},mimeType:{get:function(){return s.opt(this.contentNode,(function(t){return t.mimeType}))}},contentID:{get:function(){return s.as(this.get(o.PROPERTY_CONTENTID),"String")},set:function(t){var e=new p.FormaContentChangedEvent(this);this.beginUpdate(e),this.set(o.PROPERTY_CONTENTID,t),this.cachedBounds_=null,s.opt(this.cachedContent_,(function(e){return e.id!=t}))&&(this.cachedContent_=null),this.avgColorCache_=new a.LRUColorCache,this.endUpdate(e)}},match:function(t){var e,n=this.placement;if(c.Forma.prototype.match.call(this,t),e=s.as(t,o)){if(0==e.style.colors.hasReferencedColorsFromColorLibrary()){var r,i,a=e.page.colorLibraryController.applyLegacyFilterColorsAndReturnKeys(e.style);null!=(r=a.primaryKey)&&e.style.colors.setColorId(l.ColorRole.FieldPrimary,r),null!=(i=a.secondaryKey)&&e.style.colors.setColorId(l.ColorRole.FieldSecondary,i)}this.applyStyle(e.style),t.contentID!=this.contentID&&(this.placement=n)}},boundsInCoordSpace:function(t){var e;return null==this.cachedBounds_&&(e=this.contentNode)&&(this.cachedBounds_=v.TheoRect.fromXYWH(0,0,s.toDouble(e.pixelWidth),s.toDouble(e.pixelHeight))),s.opt(this.cachedBounds_,(function(e){return e.transform(t)}))},invalidateCachedBounds:function(){var t=new p.FormaBoundsInvalidatedEvent(this);this.beginUpdate(t),this.cachedBounds_=null,this.endUpdate(t)},getFocusRegion:function(){var t;return(t=s.opt(this.contentNode,(function(t){return t.focusRegion})))?t.transform(this.placement):null},getAverageEdge:function(t){var e,n=t.transform(this.placement.inverse);return(e=this.contentNode)?e.getAverageEdge(n):0},getFaceIntersections:function(t){var e,n,r=t.transform(this.placement.inverse);if((e=this.contentNode)&&(n=e.image)){var i=s.toDouble(n.getWidth())/s.toDouble(e.pixelWidth),o=s.toDouble(n.getHeight())/s.toDouble(e.pixelHeight);return n.getFaceIntersections(r.multiplyXY(i,o))}return 0},getAverageColor:function(t){var e;if((e=this.avgColorCache_.get(t.asString))&&!s.eq(T._equality_SolidColor_SolidColor,e,T.SolidColor.BLACK))return e;var n,r,i=t.transform(this.placement.inverse);if((n=this.contentNode)&&(r=n.image)){var o,a=s.toDouble(r.getWidth())/s.toDouble(n.pixelWidth),u=s.toDouble(r.getHeight())/s.toDouble(n.pixelHeight);if(o=r.getAverageColor(i.multiplyXY(a,u),s.as(this.style,E.ImageStyle)))return this.avgColorCache_.add(t.asString,o),o}return null},hasAlpha:function(){return null!=this.contentNode&&this.contentNode.hasAlpha},isImage:function(){return!0}}}),o)},kSRw:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("fWxZ"),u=n("pnSN");i.SmartGroupForma=(r=function(){},o.defineClass({name:"SmartGroupForma",ctor:r,superName:"GroupForma",statics:{KIND:{get:function(){return"smart-group"}},PROPERTY_BOUNDS_DEPRECATED:"bounds",PROPERTY_CLIPMODE:"clipmode",SCHEMA_CLASS_NAME:{get:function(){return"SmartGroupForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var l=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),u.GroupForma),c=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),s.FormaPage);return a.CoreAssert.isTrue(null!=l||null!=c,"SmartGroupForma needs a parent group or page","SmartGroupForma","SmartGroupForma.swift",28),null!=l?u.GroupForma.init_3144(t,e,n,l):u.GroupForma.init_7dbd(t,e,n,c)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){o.super_init(this,u.GroupForma,u.GroupForma.prototype.init_3144,t,e,n,r)},init_7dbd:function(t,e,n,r){o.super_init(this,u.GroupForma,u.GroupForma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==e[s]&&(i[s]=l())}o.super_init(this,u.GroupForma,u.GroupForma.prototype.init_812f,t,o.clone(i))},init_7fcf:function(t,e){var n={kind:e};this.init_812f(t,o.clone(n))},init_d1c9:function(t,e){o.super_init(this,u.GroupForma,u.GroupForma.prototype.init_d1c9,t,e)},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r)},pnSN:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("13MC"),u=n("FNB+"),l=n("fWxZ"),c=n("QbzR"),h=n("P83h"),d=n("9Lk3"),m=n("ZK0l"),p=n("c+uM"),f=n("tGKA"),_=n("Quhx"),g=n("8t9B"),E=n("sIWg");i.GroupForma=(r=function(){this.cachedChildren_=null,this.cachedAuxiliaries_=null},o.defineClass({name:"GroupForma",ctor:r,superName:"Forma",statics:{KIND:{get:function(){return"group"}},PROPERTY_BOUNDS:"bounds",PROPERTY_CHILDREN:"children",OLD_PROPERTY_CHARSTYLES:"character-styles",OLD_PROPERTY_CHARSTYLERANGES:"charstyle-ranges",SCHEMA_CLASS_NAME:{get:function(){return"GroupForma"}},factory:{get:function(){var t;return function(e,n,i,s){if(null!=n){var u=o.as(o.opt(o.opt(s,(function(t){return t.backLink})),(function(t){return t.dereference()})),_.PostDCXObject),c=o.as(u,r),h=(t=o.as(u,l.FormaPage))||null!=t?t:o.opt(c,(function(t){return t.page}));return a.CoreAssert.isTrue(null!=h,"GroupForma needs a parent page","GroupForma","GroupForma.swift",27),null!=c?r.init_3144(e,n,i,c):r.init_7dbd(e,n,i,h)}return r.init_d1c9(e,i)}}},childrenPostOrder:function(t,e,n){for(var r=null,i=0,s=e.childCount,l=e.auxiliaryCount,c=o.iter(o.range(0,e.childCount,!1));!c.done;c.next()){var h=c.value;if(null!=(r=e.childAt(h).visit(t,(function(t,e,r){return n(t,e+1,(i+=1)-1)}))))return r}if(t==u.FormaTraversal.PostOrderWithAuxiliaries)for(var d=o.iter(o.range(0,e.auxiliaryCount,!1));!d.done;d.next())if(h=d.value,null!=(r=e.auxiliaryAt(h).visit(t,(function(t,e,r){return n(t,e+1,(i+=1)-1)}))))return r;return a.CoreAssert.isTrue(s<=e.childCount,"this function should not delete any children","GroupForma.childrenPostOrder","GroupForma.swift",749),a.CoreAssert.isTrue(l<=e.auxiliaryCount,"this function should not delete any auxiliaries","GroupForma.childrenPostOrder","GroupForma.swift",750),n(e,0,i)?e:r},childrenPreOrder:function(t,e,n){var r=null,i=0;if(n(e,0,i))return e;for(var s=e.childCount,l=e.auxiliaryCount,c=o.iter(o.range(0,e.childCount,!1));!c.done;c.next()){var h=c.value;if(null!=(r=e.childAt(h).visit(t,(function(t,e,r){return n(t,e+1,(i+=1)-1)}))))return r}if(t==u.FormaTraversal.PreOrderWithAuxiliaries)for(var d=o.iter(o.range(0,e.auxiliaryCount,!1));!d.done;d.next())if(h=d.value,null!=(r=e.auxiliaryAt(h).visit(t,(function(t,e,r){return n(t,e+1,(i+=1)-1)}))))return r;return a.CoreAssert.isTrue(s<=e.childCount,"this function should not delete any children","GroupForma.childrenPreOrder","GroupForma.swift",795),a.CoreAssert.isTrue(l<=e.auxiliaryCount,"this function should not delete any auxiliaries","GroupForma.childrenPreOrder","GroupForma.swift",796),r},childrenOnly:function(t,e){for(var n=o.iter(o.range(0,t.childCount,!1));!n.done;n.next()){var r=n.value,i=t.childAt(r);if(e(i,1,r))return i}return null},childrenAndAuxiliaries:function(t,e){var n;return(n=r.childrenOnly(t,e))?n:r.auxiliariesOnly(t,e)},auxiliariesOnly:function(t,e){for(var n=o.iter(o.range(0,t.auxiliaryCount,!1));!n.done;n.next()){var r,i=n.value;if((r=t.auxiliaryAt(i))&&e(r,1,i))return r}return null},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){o.super_init(this,u.Forma,u.Forma.prototype.init_3144,t,e,n,r)},init_7dbd:function(t,e,n,r){o.super_init(this,u.Forma,u.Forma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND},children:function(){return[]}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,l=a.value;null==e[s]&&(i[s]=l())}o.super_init(this,u.Forma,u.Forma.prototype.init_812f,t,o.clone(i))},init_7fcf:function(t,e){var n={kind:e};this.init_812f(t,o.clone(n))},init_d1c9:function(t,e){o.super_init(this,u.Forma,u.Forma.prototype.init_d1c9,t,e)},destroy:function(){u.Forma.prototype.destroy.call(this);for(var t=o.iter(this.children_);!t.done;t.next())t.value.destroy();for(var e=o.iter(this.auxiliaries_);!e.done;e.next())e.value.destroy()},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(t){return t==r.PROPERTY_BOUNDS?new h.FormaGeometryChangedEvent(this):t==r.PROPERTY_CHILDREN?new h.FormaHierarchyChangedEvent(this):u.Forma.prototype.updateEventForProperty.call(this,t)},postDecode:function(){var t;u.Forma.prototype.postDecode.call(this),this.populateChildrenAndAux(),this.controller instanceof g.TypeLockupController&&(t=o.as(this.style,p.LockupStyle))&&(t.wheelUsed=!1),this.controller instanceof d.GridController&&(this.validateOnSet=!0)},setProperty:function(t,e){u.Forma.prototype.setProperty.call(this,t,e),a.CoreAssert.isTrue(null!=this.getProperty(u.Forma.PROPERTY_KIND),"Group forma "+this.id+" missing kind; base state inaccessible","GroupForma.setProperty","GroupForma.swift",119),a.CoreAssert.isTrue(null!=this.getProperty(_.PostDCXObject.PROPERTY_PATH),"Group forma "+this.id+" missing path; base state inaccessible","GroupForma.setProperty","GroupForma.swift",120)},charStylesArray_:{get:function(){var t,e=null;if(t=o.opt(this.getProperty(r.OLD_PROPERTY_CHARSTYLES),(function(t){return t.dictionaryValue}))){e={};for(var n=o.iter(t);!n.done;n.next()){var i,a=n.key,s=n.value;(i=o.as(c.FormaStyle.codec.decode(s,this),p.LockupStyle))&&(e[a]=i)}}return e}},charStylesRangesArray:{get:function(){var t,e=null;if(t=o.opt(this.getProperty(r.OLD_PROPERTY_CHARSTYLERANGES),(function(t){return t.dictionaryValue}))){e={};for(var n=o.iter(t);!n.done;n.next()){var i=n.key,a=n.value,s=o.clone(a.arrayValue);if(null!=s){var u=s.map((function(t){return t.intValue}),this).filter((function(t){return null!=t}),this).map((function(t){return t}),this);e[i]=o.clone(u)}}}return e}},bounds_:{get:function(){return o.as(this.get(r.PROPERTY_BOUNDS),E.TheoRect)},set:function(t){this.set(r.PROPERTY_BOUNDS,t)}},children_:{get:function(){return this.populateChildrenAndAux(),this.cachedChildren_}},populateChildrenAndAux:function(){var t,e=null==this.cachedChildren_,n=null==this.cachedAuxiliaries_;if((e||n)&&(this.cachedChildren_=this.cachedChildren_||[],this.cachedAuxiliaries_=this.cachedAuxiliaries_||[],t=o.as(this.get(r.PROPERTY_CHILDREN),["Array",u.Forma])))for(var i=o.iter(t);!i.done;i.next()){var a=i.value,s=a.hasTag(u.Forma.TAG_IS_AUXILIARY);e&&!s?o.opt(this.cachedChildren_,(function(t){return t.push(a)})):n&&s&&o.opt(this.cachedAuxiliaries_,(function(t){return t.push(a)}))}},auxiliaries_:{get:function(){return this.populateChildrenAndAux(),this.cachedAuxiliaries_}},flushChildren:function(){if(null!=this.cachedChildren_||null!=this.cachedAuxiliaries_){a.CoreAssert.isTrue(o.is(this.state,s.IDBObjectMutableState),"flushChildren - group state not mutable!","GroupForma.flushChildren","GroupForma.swift",200);var t,e,n=[];if((t=this.cachedChildren_)&&(n=t.concat()),e=this.cachedAuxiliaries_)for(var i=o.iter(e);!i.done;i.next()){var u=i.value;n.push(u)}this.set(r.PROPERTY_CHILDREN,o.clone(n))}},clearCache:function(){this.flushChildren(),u.Forma.prototype.clearCache.call(this),this.cachedChildren_=null,this.cachedAuxiliaries_=null},childrenAsArray:{get:function(){return this.children_.concat()}},willCommitState:function(){this.flushChildren(),u.Forma.prototype.willCommitState.call(this)},willChangeState:function(t){var e=this;u.Forma.prototype.willChangeState.call(this,o.clone(t)),o.keys(t).includes(r.PROPERTY_CHILDREN)&&(o.opt(this.cachedChildren_,(function(t){return t.forEach((function(t){t.parent===e&&t.setParent(null)}))})),this.cachedChildren_=null,o.opt(this.cachedAuxiliaries_,(function(t){return t.forEach((function(t){t.parent===e&&t.setParent(null)}))})),this.cachedAuxiliaries_=null)},didChangeState:function(t){var e,n=this;o.keys(t).includes(r.PROPERTY_CHILDREN)&&(a.CoreAssert.isTrue(null==this.cachedChildren_,"Re-get of children happened while trying to change states","GroupForma.didChangeState","GroupForma.swift",259),a.CoreAssert.isTrue(null==this.cachedAuxiliaries_,"Re-get of auxiliaries happened while trying to change states","GroupForma.didChangeState","GroupForma.swift",260),this.cachedChildren_=null,this.cachedAuxiliaries_=null,(e=o.as(this.get(r.PROPERTY_CHILDREN),["Array",u.Forma]))&&e.forEach((function(t){return t.setParent(n,null==t.parent||t.parent!=n)}))),u.Forma.prototype.didChangeState.call(this,o.clone(t))},setParent:function(t,e){if(void 0===e&&(e=!1),u.Forma.prototype.setParent.call(this,t,!1),e)for(var n=o.iter(this.childrenAsArray);!n.done;n.next())n.value.setParent(this,!0)},state:{get:function(){return u.Forma._getters.state.call(this)},set:function(t){o.is(u.Forma._getters.state.call(this),s.IDBObjectMutableState)&&this.flushChildren(),u.Forma._setters.state.call(this,t)}},bounds:{get:function(){return null!=this.bounds_?this.bounds_:this.childrenBoundsInCoordSpace(f.Matrix2D.Identity)},set:function(t){var e=this;if(!(null!=t&&null!=this.bounds_&&t.equal(this.bounds_)||null==t&&null==this.bounds_)){var n=new h.FormaGeometryChangedEvent(this);this.beginUpdate(n),o.opt(o.as(this.controller,m.GroupController),(function(t){return t.beginUpdateGroup(e.bounds_)})),this.bounds_=t,o.opt(o.as(this.controller,m.GroupController),(function(t){return t.updateGroup()})),o.opt(o.as(this.controller,m.GroupController),(function(t){return t.endUpdateGroup()})),this.endUpdate(n)}}},setBounds:{get:function(){return this.bounds_}},contentID:{get:function(){if(null!=(r=u.Forma._getters.contentID.call(this)))return r;var t=[];if(this.visit(u.FormaTraversal.JustChildren,(function(e,n,r){var i;return null!=(i=e.contentID)&&t.push(i),!1})),0==t.length)return null;o.sortInPlace(t);for(var e="",n=o.iter(t);!n.done;n.next()){var r;e+=r=n.value}return e}},match:function(t){if(u.Forma.prototype.match.call(this,t),!this.bounds.equal(t.bounds))if(null!=this.controller&&this.controller.maintainAspectRatio){var e=t.bounds.fitAspectRatioWithin(this.bounds.aspectRatio);this.bounds=E.TheoRect.fromXYWH(t.bounds.minX,t.bounds.minY,e.width,e.height)}else this.bounds=t.bounds},visit:function(t,e){switch(t){case 1:case 7:return r.childrenPreOrder(t,this,e);case 2:case 8:return r.childrenPostOrder(t,this,e);case 6:return r.childrenOnly(this,e);case 9:return r.auxiliariesOnly(this,e);case 10:return r.childrenAndAuxiliaries(this,e);default:return u.Forma.prototype.visit.call(this,t,e)}},insertChildrenInternal:function(t,e,n){if(e<0||e>this.children_.length)a.CoreAssert.fail("insertChildrenInternal: invalid index "+e,"GroupForma.insertChildrenInternal","GroupForma.swift",400);else{for(var r=o.iter(t);!r.done;r.next())if((l=r.value).page.uuid!=this.page.uuid)return void a.CoreAssert.fail("insertChildrenAt: attempting to insert children from a different page","GroupForma.insertChildrenInternal","GroupForma.swift",407);var i=new h.FormaInsertedChildrenEvent(this,t,e);this.beginUpdate(i),this.makeMutable();for(var s=e,u=o.iter(t);!u.done;u.next()){var l,c=(l=u.value).totalPlacement;if(null!=l.parent&&(l.parent!=this?l.parent.removeChild(l):o.remove(this.children_,l)),l.setParent(this),this.children_.splice(s,0,l),s+=1,n){var d=l.totalPlacement;d.equal(c)||l.move(f.Matrix2D.concat2(d.inverse,c))}}this.endUpdate(i)}},insertChildrenAt:function(t,e,n){void 0===n&&(n=!1),this.insertChildrenInternal(t,e,n)},appendChild:function(t,e){void 0===e&&(e=!1);var n=[];n.push(t),this.insertChildrenInternal(n,this.children_.length,e)},appendChildren:function(t,e){void 0===e&&(e=!1),this.insertChildrenAt(t,this.children_.length,e)},insertBefore:function(t,e,n){void 0===n&&(n=!1),null==e?this.insertChildAt(t,this.children_.length,n):e.parent!==this?(a.CoreAssert.fail("insertBefore: refForma must be a child of this forma; appending","GroupForma.insertBefore","GroupForma.swift",462),this.insertChildAt(t,this.children_.length,n)):this.insertChildAt(t,o.indexOfEq(this.children_,e,u._equality_Forma_Forma),n)},insertChildAt:function(t,e,n){void 0===n&&(n=!1);var r=[];r.push(t),this.insertChildrenAt(r,e,n)},removeChildrenAt:function(t,e){if(t<0||e<0||t+e>this.children_.length)a.CoreAssert.fail("removeChildrenAt: Invalid index ("+t+") or count ("+e+")","GroupForma.removeChildrenAt","GroupForma.swift",477);else if(0==e);else{var n=this.children_.slice(t,t+e),r=new h.FormaRemovedChildrenEvent(this,n,t);this.beginUpdate(r),this.makeMutable();for(var i=o.iter(n);!i.done;i.next())i.value.setParent(null);this.children_.splice(t,e),this.endUpdate(r)}},removeChild:function(t){var e;null!=(e=o.indexOfEq(this.children_,t,u._equality_Forma_Forma))?this.removeChildAt(e):a.CoreAssert.fail("Child is not part of this group","GroupForma.removeChild","GroupForma.swift",500)},removeChildAt:function(t){this.removeChildrenAt(t,1)},removeAllChildren:function(){this.removeChildrenAt(0,this.children_.length)},indexOfChild:function(t){return o.indexOfEq(this.children_,t,u._equality_Forma_Forma)},indexOfTop:function(t){for(var e=-1,n=o.iter(o.range(0,this.childCount,!1).reversed());!n.done;n.next()){var r=n.value;if(t(this.childAt(r))){e=r;break}}return e},findChild:function(t){return this.children_.find(t,this)},childAt:function(t){return a.CoreAssert.isTrue(t>=0&&t<this.children_.length,void 0,"GroupForma.childAt","GroupForma.swift",532),t>=0&&t<this.children_.length?this.children_[t]:null},childCount:{get:function(){return this.children_.length}},boundsInCoordSpace:function(t){return null!=this.bounds_?this.bounds_.transform(t):this.childrenBoundsInCoordSpace(t)},childrenFinalFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.totalPlacement)}},childrenFrame:{get:function(){return this.childrenBoundsInCoordSpace(this.placement)}},childrenBoundsInCoordSpace:function(t){var e=null;return this.children_.forEach((function(n){var i;if(i=o.as(n,r))e=E.TheoRect.unionOf(e,i.childrenBoundsInCoordSpace(n.placement.concat(t)));else if(!n.isFullCanvas){var a=n.boundsInCoordSpace(n.placement.concat(t));e=E.TheoRect.unionOf(e,a)}})),e},auxiliaryCount:{get:function(){return this.auxiliaries_.length}},auxiliaryAt:function(t){return a.CoreAssert.isTrue(t>=0&&t<this.auxiliaries_.length,void 0,"GroupForma.auxiliaryAt","GroupForma.swift",583),t>=0&&t<this.auxiliaries_.length?this.auxiliaries_[t]:null},indexOfAuxiliary:function(t){return o.indexOfEq(this.auxiliaries_,t,u._equality_Forma_Forma)},findAuxiliary:function(t){return this.auxiliaries_.find(t,this)},appendAuxiliary:function(t){var e=[];e.push(t),this.insertAuxiliaryInternal(e,this.auxiliaries_.length)},removeAuxiliary:function(t){var e;null!=(e=o.indexOfEq(this.auxiliaries_,t,u._equality_Forma_Forma))?this.removeAuxiliaryAt(e):a.CoreAssert.fail("Auxiliary is not part of this group","GroupForma.removeAuxiliary","GroupForma.swift",611)},removeAuxiliaryAt:function(t){this.removeAuxiliariesAt(t,1)},removeAuxiliariesAt:function(t,e){if(t<0||e<0||t+e>this.auxiliaries_.length)a.CoreAssert.fail("removeAuxiliariesAt: Invalid index ("+t+") or count ("+e+")","GroupForma.removeAuxiliariesAt","GroupForma.swift",621);else if(e>0){var n=this.auxiliaries_.slice(t,t+e),r=new h.FormaRemovedAuxiliariesEvent(this,n,t);this.beginUpdate(r),this.makeMutable();for(var i=o.iter(n);!i.done;i.next())i.value.setParent(null);this.auxiliaries_.splice(t,e),this.endUpdate(r)}},insertAuxiliaryInternal:function(t,e){if(e<0||e>this.auxiliaries_.length)a.CoreAssert.fail("insertAuxiliaryInternal: invalid index "+e,"GroupForma.insertAuxiliaryInternal","GroupForma.swift",640);else{for(var n=o.iter(t);!n.done;n.next()){if((l=n.value).page.uuid!=this.page.uuid)return void a.CoreAssert.fail("insertAuxiliaryInternal: attempting to insert formae from a different page","GroupForma.insertAuxiliaryInternal","GroupForma.swift",647);l.setTag(u.Forma.TAG_IS_AUXILIARY)}var r=new h.FormaInsertedAuxiliariesEvent(this,t,e);this.beginUpdate(r),this.makeMutable();for(var i=e,s=o.iter(t);!s.done;s.next()){var l,c;(c=(l=s.value).parent)&&(c!=this?c.removeAuxiliary(l):o.remove(this.auxiliaries_,l)),i>this.auxiliaries_.length&&(i=this.auxiliaries_.length),l.setParent(this),this.auxiliaries_.splice(i,0,l),i+=1}this.endUpdate(r)}},isImage:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isImage()}),this)},isGraphic:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isGraphic()}),this)},isText:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isText()}),this)},isShape:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isShape()}),this)},isVideo:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isVideo()}),this)},isLogo:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isLogo()}),this)},isSticker:function(){return this.children_.length>0&&null==this.children_.find((function(t){return!t.isSticker()}),this)}}}),r)},ylxa:function(t,e,n){var r,i,o=e,a=n("oAGj"),s=n("SpAV"),u=n("fWxZ"),l=n("1NAc");o.PageExportFormat=a.defineEnum("PageExportFormat",{PIXELS:0,MILLIMETERS:1,INCHES:2}),o.describePageExportFormat=function(t){switch(t){case 0:return"pixels";case 1:return"millimeters";case 2:return"inches"}},o.FormaPageExportData=(r=function(t,e,n){void 0===n&&(n=null),this.dimensions_=t,this.format_=e,this.ppi_=n,null!=n||e!=o.PageExportFormat.MILLIMETERS&&e!=o.PageExportFormat.INCHES||s.CoreAssert.fail("Must specify ppi for mm or inches","FormaPageExportData.init","FormaPageExportData.swift",49)},i={},a.defineClass({name:"FormaPageExportData",ctor:r,superName:"CoreObject",statics:{PROPERTY_DIMENSIONS:"dimensions",PROPERTY_FORMAT:"format",PROPERTY_PPI:"ppi",MM_TO_INCHES:{get:function(){return void 0===i.MM_TO_INCHES&&(i.MM_TO_INCHES=1/25.4),i.MM_TO_INCHES}},POINTS_PER_INCH:72,DEFAULT_PPI:300,exportPixels:function(t){return new r(t,o.PageExportFormat.PIXELS,null)},exportInches:function(t,e){return new r(t,o.PageExportFormat.INCHES,e)},exportMillimeters:function(t,e){return new r(t,o.PageExportFormat.MILLIMETERS,e)},decodeJson:function(t){var e;if(null==t)return null;var n=a.as(t,["Dictionary","String","Any"]);if(null==n)return s.CoreAssert.fail("FormaPageExportData.decodeJSON : object passed isn't a dictionary","FormaPageExportData.decodeJson","FormaPageExportData.swift",128),null;var i,u,c,h=null,d=o.PageExportFormat.PIXELS,m=l.TheoSize.Zero;return(i=l.TheoSize.decodeJson(a.as(n[r.PROPERTY_DIMENSIONS],"AnyObject")))&&(m=i),null!=(u=a.as(n[r.PROPERTY_FORMAT],"Int"))?d=(e=o.PageExportFormat.toCaseValue(u))||null!=e?e:o.PageExportFormat.PIXELS:s.CoreAssert.fail("Must have format encoded","FormaPageExportData.decodeJson","FormaPageExportData.swift",144),null!=(c=a.as(n[r.PROPERTY_PPI],"Double"))&&(h=c),new r(m,d,h)}},props:{dimensions:{get:function(){return this.dimensions_}},format:{get:function(){return this.format_}},PPI:{get:function(){return null==this.ppi?u.FormaPage.DEFAULT_CUSTOM_SIZE_PPI:this.ppi_}},ppi:{get:function(){return this.ppi_}},pixelDimensions:{get:function(){return this.format_==o.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*this.ppi_):this.format_==o.PageExportFormat.INCHES?this.dimensions_.multiply(this.ppi_):(s.CoreAssert.isTrue(this.format_==o.PageExportFormat.PIXELS,void 0,"FormaPageExportData","FormaPageExportData.swift",87),this.dimensions_)}},pointDimensions:{get:function(){return this.format_==o.PageExportFormat.MILLIMETERS?this.dimensions_.multiply(r.MM_TO_INCHES*r.POINTS_PER_INCH):this.format_==o.PageExportFormat.INCHES?this.dimensions_.multiply(r.POINTS_PER_INCH):(s.CoreAssert.isTrue(this.format_==o.PageExportFormat.PIXELS,void 0,"FormaPageExportData","FormaPageExportData.swift",104),this.dimensions_)}},encodeJson:function(){var t={};return t[r.PROPERTY_DIMENSIONS]=this.dimensions_.encodeJson(),t[r.PROPERTY_FORMAT]=this.format_,null!=this.ppi_&&(t[r.PROPERTY_PPI]=this.ppi_),t}}}),r)},zjod:function(t,e,n){var r,i=e,o=n("oAGj"),a=n("SpAV"),s=n("fWxZ"),u=n("P83h"),l=n("pnSN"),c=n("Qlvz"),h=n("fdtz"),d=n("uWOl"),m=n("9YN4"),p=n("RkYL"),f=n("fGVU"),_=n("sW6f"),g=n("QTen");i.VideoPlayerStatus=o.defineEnum("VideoPlayerStatus",{stopped:0,playing:1}),i.VideoMode=o.defineEnum("VideoMode",{stillImage:0,playback:1,publish:2,trim:3}),i.VideoForma=(r=function(){this.cachedVideoContent_=null,this.currentTime_=p.TheoTime.Zero,this.playerStatus_=i.VideoPlayerStatus.stopped,this.mode_=i.VideoMode.stillImage},o.defineClass({name:"VideoForma",ctor:r,superName:"ImageForma",statics:{KIND:{get:function(){return"Video"}},PROPERTY_VIDEO_CONTENTID:"video-content-id",SCHEMA_CLASS_NAME:{get:function(){return"VideoForma"}},factory:{get:function(){return function(t,e,n,i){if(null!=e){var u=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),l.GroupForma),c=o.as(o.opt(o.opt(i,(function(t){return t.backLink})),(function(t){return t.dereference()})),s.FormaPage);return a.CoreAssert.isTrue(null!=u||null!=c,"VideoForma needs a parent group or page","VideoForma","VideoForma.swift",45),null!=u?r.init_3144(t,e,n,u):r.init_7dbd(t,e,n,c)}return r.init_d1c9(t,n)}}},_implements:function(t){return"IDBObject"==t||"TheoMessageSubscriber"==t||"TheoMessagePublisher"==t}},props:{init_3144:function(t,e,n,r){o.super_init(this,h.ImageForma,h.ImageForma.prototype.init_3144,t,e,n,r)},init_7dbd:function(t,e,n,r){o.super_init(this,h.ImageForma,h.ImageForma.prototype.init_7dbd,t,e,n,r)},init_812f:function(t,e){for(var n={kind:function(){return r.KIND},style:function(){return g.VideoStyle.createDefault()}},i=o.clone(e),a=o.iter(n);!a.done;a.next()){var s=a.key,u=a.value;null==e[s]&&(i[s]=u())}o.super_init(this,h.ImageForma,h.ImageForma.prototype.init_812f,t,o.clone(i))},init_7186:function(t){var e={kind:r.KIND,style:g.VideoStyle.createDefault()};this.init_812f(t,o.clone(e))},init_d1c9:function(t,e){o.super_init(this,h.ImageForma,h.ImageForma.prototype.init_d1c9,t,e)},getFrameForTime:function(t){var e;if(e=this.videoContentNode){if(0==e.times.length)return 0;var n=o.opt(this.animation,(function(t){return t.startTime}))||e.times[0],r=e.times[e.times.length-1],i=o.opt(this.animation,(function(t){return t.endTime}))||r;if(t.seconds>i.seconds)return e.times.length-1;if(t.seconds-n.seconds<=0)return 0;var a=t.subtract(n),s=new p.TheoTime(o.toInt(a.seconds*o.toDouble(r.timescale))%r.value,r.timescale);if(s.value<e.times[0].value)return 0;for(var u=o.iter(o.range(0,e.times.length-1,!1));!u.done;u.next()){var l=u.value;if(s.value>=e.times[l].value&&s.value<e.times[l+1].value)return l+1}return e.times.length-1}return 0},decodeController:function(){var t;null==this.controller&&(t=o.opt(this.page.document,(function(t){return t.controller})))&&(this.controller=t.controllerFactory.createController(f.VideoController.KIND,this)),h.ImageForma.prototype.decodeController.call(this)},className:{get:function(){return r.SCHEMA_CLASS_NAME}},updateEventForProperty:function(t){return t==r.PROPERTY_VIDEO_CONTENTID?new u.FormaContentChangedEvent(this):h.ImageForma.prototype.updateEventForProperty.call(this,t)},isVideo:function(){return!0},isSticker:function(){var t,e;return!!((t=this.videoContentNode)&&(e=o.opt(this.parent,(function(t){return t.controller})))&&t.isGIF&&e.moveable)},videoContentNode:{get:function(){var t,e;null!=(t=this.videoContentID)&&((!(e=this.cachedVideoContent_)||e.id!=t)&&(this.cachedVideoContent_=o.as(o.opt(this.page.document,(function(e){return e.content.nodeByID(t)})),_.VideoContentNode)));return this.cachedVideoContent_},set:function(t){var e=new u.FormaContentChangedEvent(this);this.beginUpdate(e),this.cachedVideoContent_=t,this.set(r.PROPERTY_VIDEO_CONTENTID,o.opt(t,(function(t){return t.id}))),this.endUpdate(e)}},videoContentID:{get:function(){return o.as(this.get(r.PROPERTY_VIDEO_CONTENTID),"String")}},currentTime:{get:function(){return this.currentTime_},set:function(t){if(t!=this.currentTime_){var e=new u.FormaVideoTimeChangedEvent(this);this.beginUpdate(e),this.currentTime_=t,this.endUpdate(e)}}},videoPlayerStatus:{get:function(){return this.playerStatus_},set:function(t){if(t!=this.playerStatus_){var e=new u.FormaVideoStateChangedEvent(this);this.beginUpdate(e),this.playerStatus_=t,this.endUpdate(e)}}},mode:{get:function(){return this.mode_},set:function(t){if(t!=this.mode_){var e=new u.FormaVideoStateChangedEvent(this);this.beginUpdate(e),this.mode_=t,this.endUpdate(e)}}},setVideoPlayerStatusAndMode:function(t,e,n){if(n||t!=this.playerStatus_||e!=this.mode_){var r=new u.FormaVideoStateChangedEvent(this);this.beginUpdate(r),this.mode_=e,this.playerStatus_=t,this.endUpdate(r)}},forceStateChange:function(){var t=new u.FormaVideoStateChangedEvent(this);this.beginUpdate(t),this.endUpdate(t)},postDecode:function(){var t,e,n=this;if(h.ImageForma.prototype.postDecode.call(this),e=o.as(this.style,d.ImageStyle)){if(!(this.style instanceof g.VideoStyle)){var r=(t=o.opt(this.page.document,(function(t){return t.versionDecoded.vers})))||null!=t?t:0;a.CoreAssert.isTrue(r<m.TheoDocumentVersion.VideoSupport,"Why is there no VideoStyle for VideoForma in version - "+o.toString(r),"VideoForma.postDecode","VideoForma.swift",277);var i,s,u=g.VideoStyle.createDefault();(i=this.videoContentNode)&&(u.duration=i.duration),(s=u.mergeWithImageStyle(e))&&this.protectedSetStyle(s),o.opt(this.videoContentNode,(function(t){return null==t.mediaMetadata&&o.opt(n.contentNode,(function(t){return null!=t.mediaMetadata}))}))&&o.opt(this.videoContentNode,(function(t){return t.mediaMetadata=o.opt(n.contentNode,(function(t){return t.mediaMetadata}))}))}e.filter=null,e.adjustments=c.ImageAdjustments.createDefault(),e.name=d.ImageStyle.DEFAULT_NAME}},canApplyStyle:function(t){return h.ImageForma.prototype.canApplyStyle.call(this,t)&&t instanceof g.VideoStyle},applyStyle:function(t){var e,n,r;(e=o.as(t,d.ImageStyle))&&(n=o.as(this.style,g.VideoStyle))&&(r=n.mergeWithImageStyle(e))&&(r.filter=null,r.adjustments=c.ImageAdjustments.createDefault(),r.name=d.ImageStyle.DEFAULT_NAME,this.internalSetStyle(r))},resetToStartTime:function(){var t;if(t=o.as(this.style,g.VideoStyle)){var e=t.startTime;if(e!=this.currentTime_){var n=new u.FormaVideoStateChangedEvent(this);this.beginUpdate(n),this.currentTime_=e,this.endUpdate(n)}}}}}),r)}}]);
//# sourceMappingURL=vendors_npm_spark_c7cdc700-ffec48b6.js.map
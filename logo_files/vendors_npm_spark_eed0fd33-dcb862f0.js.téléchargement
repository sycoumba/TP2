(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[35],{"8/a0":function(t,e,o){var a,r=e,i=o("oAGj"),n=o("SpAV"),l=o("JgVS"),s=o("cEEQ"),c=o("c+uM"),u=o("tGKA"),h=o("hgLm"),g=o("oKlP"),p=o("sIWg"),d=o("1NAc");r.BannerDecorationStrategy=(a=function(){this.spacingScalar=.75,l.BaseDecorationStrategy.call(this)},i.defineClass({name:"BannerDecorationStrategy",ctor:a,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{easeOutQuad:function(t,e,o,a){var r=t/a;return-o*r*(r-2)+e},easeOut:function(t,e,o){return this.easeOutQuad(o,t,e-t,1)},supportsConfiguration:function(t){return t.style.backing==c.LockupBacking.Banner},decorate:function(t,e){function o(t,e){return new g.TheoPoint(t,e)}var a=t.style,r=a.padding;e.numberOfLines>1&&(r+=a.spacing*this.spacingScalar);var f=e.avgTextPointSize*r,y=[],k=p.TheoRect.fromSize(e.size).transform(e.placement),S=!1;t.style.backing==c.LockupBacking.BannerHorizontal?S=!1:t.style.backing==c.LockupBacking.BannerVertical?S=!0:n.CoreAssert.isTrue(!1,"Invalid backing shape.","BannerDecorationStrategy.decorate","BannerDecorationStrategy.swift",99);var L=l.BaseDecorationStrategy.getHorizontalOffsetForItalicAngle(e.avgLinePointSize*e.typographicBoundingRatios.heightFromBaselineRatio,t.style.font.fontData.italicAngle),m=e.typographicBoundingRatios.backingVerticalOffsetRatio*e.avgLinePointSize,C=this.easeOut(0,m,Math.min(1,r)),v=S?k.minX-f:-4093,A=S?-4093:k.minY-f+C,w=h.TheoPathBuilder.init_d41d(),b=L+(S?k.size.width+2*f:8186),R=S?8186:k.size.height+2*f,D=new d.TheoSize(b,R),T=u.Matrix2D.translationXY(v,A),x=function(t,e,a){var r=h.TheoPathBuilder.init_d41d(),n=e.transformPoint(t.eval(o(0,0)));r.moveTo(n.x,n.y);var l=new p.TheoRect(n.x,n.y,n.x,n.y);if(a)for(var s=i.iter([o(0,1),o(1,1),o(1,0)]);!s.done;s.next()){var c=s.value;n=e.transformPoint(t.eval(c)),r.lineTo(n.x,n.y),l=l.expandToFit(n)}else for(var u=i.iter([o(1,0),o(1,1),o(0,1)]);!u.done;u.next())c=u.value,n=e.transformPoint(t.eval(c)),r.lineTo(n.x,n.y),l=l.expandToFit(n);return r.closePath(),{path:r.path,bounds:l}}(p.TheoRect.fromSize(D),u.Matrix2D.Identity,!0).path;w.addPath(x,e.placement);var I=w.path,O=new d.TheoSize(i.opt(I.bounds,(function(t){return t.width})),i.opt(I.bounds,(function(t){return t.height})));return y.push(s.LockupItem.init_708e(!1,O,T,I)),new l.DecorationResults(i.clone(y))}}}),a)},"9kak":function(t,e,o){var a,r=e,i=o("oAGj");r.LockupRowInfo=(a=function(t,e){if(this.aspectRatio=0,this.words=[],this.text="",this.appendable=!0,this.rowHeightAdjustRatio=1,this.colOffsetLeft=0,this.colOffsetRight=0,void 0===t&&(t=null),void 0===e&&(e=!0),null!=t)for(var o=i.iter(t);!o.done;o.next()){var a=o.value;this.addWord(a)}this.appendable=e},i.defineClass({name:"LockupRowInfo",ctor:a,props:{addWord:function(t){if(this.words.length>0){var e=this.words[this.words.length-1];this.aspectRatio+=e.spaceAspectRatio,this.text+=" "}this.text+=t.text,this.words.push(t),this.aspectRatio+=t.aspectRatio,1!=this.words.length&&t.characterHeightRatio!=this.rowHeightAdjustRatio?this.rowHeightAdjustRatio=1:this.rowHeightAdjustRatio=t.characterHeightRatio}}}),a)},EDIN:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("8t9B");r.NoDecorationStrategy=(a=function(){n.BaseDecorationStrategy.call(this)},i.defineClass({name:"NoDecorationStrategy",ctor:a,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.backing==s.LockupBacking.None},decorate:function(t,e){var o,a=t.style,r=!1;if((o=t.style.characterStyles[c.TypeLockupController.HIGHLIGHT_STYLE])&&(r=o.textLook==s.LockupTextLook.FillAndOutline2),a.textLook!=s.LockupTextLook.FillAndOutline2&&!r)return new n.DecorationResults([]);for(var u=[],h=i.iter(i.range(0,e.items.length,!1));!h.done;h.next()){var g=h.value,p=e.items[g];if(p.type==l.LockupItemType.Text){var d,f,y=a.textLook==s.LockupTextLook.FillAndOutline2;null!=(d=p.characterStyle)&&(f=t.style.characterStyles[d])&&(y=f.textLook==s.LockupTextLook.FillAndOutline2||f.textLook==s.LockupTextLook.UNSET&&y),y&&((p=p.clone()).hasPrimaryColor=!1,u.push(p))}}return new n.DecorationResults(i.clone(u))}}}),a)},GFAD:function(t,e,o){var a,r=e,i=o("oAGj");r.LockupUtils=(a=function(){},i.defineClass({name:"LockupUtils",ctor:a,statics:{percentageDiff:function(t,e){return 100*Math.abs((t-e)/((t+e)/2))}}}),a)},JEnV:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");r.EvenRowHeightsLayoutStrategy=(a=function(t){this.paddingScalar=.6,this.spacingScalar=.75,t==c.LockupAlignment.Left||t==c.LockupAlignment.Right||t==c.LockupAlignment.Center?this.alignment=t:(n.CoreAssert.fail("Unexpected alignment: "+t,"EvenRowHeightsLayoutStrategy.init","EvenRowHeightsLayoutStrategy.swift",22),this.alignment=c.LockupAlignment.Left)},i.defineClass({name:"EvenRowHeightsLayoutStrategy",ctor:a,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.Standard&&t.style.alignment==this.alignment},layout:function(t){var e=t.text,o=t.style,a=o.font.fontData,r=t.containerSize,n=r.width,s=r.height,c=o.spacing*this.spacingScalar,u=n,y=s,k=u/y,S=l.getTypographicBoundingRatiosOfString(e,a,!1),L=g.TypeLockupController.HIGHLIGHT_STYLE,m=i.opt(i.opt(o.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=p.TypeLockupUtils.getCharFontAdjust(o,S.hasUppercase),v=!1,A=t.characterStyleRanges.length>0&&null!=o.characterStyles[L]&&-1!=o.characterStyles[L].spacing&&0!=o.characterStyles[L].spacing;A&&o.characterStyles[L].spacing>1&&((o=t.style.clone()).characterStyles[L].spacing=C,v=!0,null!=m&&(m=a,a=o.characterStyles[L].font.fontData,o.characterStyles[L].font=o.font));var w=i.clone(this.getCompactedRows(t,k,t.highlightMethod,null!=t.preferredFontSize,S));if(0==w.length)return new l.LayoutResults([],new f.TheoSize(0,0),h.Matrix2D.Identity,S,0);var b,R,D,T=this.getAspectRatioOfAllRows(i.clone(w),c),x=this.getWidestRowAspectRatio(i.clone(w));if(0==x.aspectRatio)return new l.LayoutResults([],new f.TheoSize(0,0),h.Matrix2D.Identity,S,0);null!=(D=t.preferredFontSize)?y=(u=(b=(R=D)*S.heightRatio)*x.aspectRatio)/T:(T<k?u=y*T:y=u/T,R=(b=u/x.aspectRatio)/S.heightRatio);for(var I=y,O=u,B=u/(x.aspectRatio/c),F=R*C,E=R*a.capRatio,_=R*S.textVerticalOffsetRatio-E,P=p.TypeLockupUtils.getCharFontYAdjust(o,R,F),W=_,U=0,M=[],N=0,V=i.iter(i.range(0,w.length,!1));!V.done;V.next()){var H=V.value,K=w[H],G=K.words.length>20||e.length>300&&w.length>5?0:3;if(N=R,A){for(var z=!0,Y=i.iter(K.words);!Y.done;Y.next()){var j=Y.value;if(i.isEmpty(j.characterStyle)||R==F){z=!1;break}}N=z?F:R}H>0&&(W+=B);var q=K.aspectRatio*b;switch(this.alignment){case 0:U=0;break;case 1:U=u-q+0;break;case 2:U=0+(u-q)/2}for(var X=0,J=0,Q=i.iter(K.words);!Q.done;Q.next()){j=Q.value;var Z=i.isEmpty(j.characterStyle)||N==F?0:P,$=i.isEmpty(j.characterStyle)?R:F,tt=j.aspectRatio*b,et=U,ot=W+0+Z,at=i.isEmpty(j.characterStyle)?null:j.characterStyle;v&&(at=i.isEmpty(j.characterStyle)?L:null);var rt,it=l.LockupItem.init_e7b2(!0,at,new f.TheoSize(tt,E),h.Matrix2D.translationXY(et,ot),j.text,i.isEmpty(j.characterStyle)?a:m||a,$,R,S,H,j.rangeInLockup);if(rt=i.last(M)){var nt=rt.font.spaceWidthRatio*rt.pointSize;if((Math.abs(nt-X)<.001||0==X)&&t.useOptimization&&rt.characterStyle==it.characterStyle&&rt.placement.ty==ot&&J>G&&J<K.words.length-G&&!t.forceLetterForma){var lt=rt.clone();lt.text=0!=X?lt.text+" "+it.text:lt.text+it.text,lt.rangeInLockup=new d.TextRange(rt.rangeInLockup.start,it.rangeInLockup.end),lt.size=new f.TheoSize(lt.size.width+X+it.size.width,E),M.pop(),M.push(lt)}else M.push(it)}else M.push(it);J+=1,U+=tt+(X=j.spaceAspectRatio*b)}W+=N*S.heightRatio}return new l.LayoutResults(i.clone(M),new f.TheoSize(O,I),h.Matrix2D.translationXY(0,0),S,x.aspectRatio)},calculateTracking:function(t,e){var o=t.text,a=t.style.font.fontData,r=t.containerSize.width,n=t.style.spacing*this.spacingScalar,s=l.getTypographicBoundingRatiosOfString(o,a,!1),c=0,u=e.width,h=e.height,g=u/h,p=i.clone(this.getCompactedRows(t,g,t.highlightMethod,!0,s));if(0==p.length)return t.style.tracking;var d=this.getAspectRatioOfAllRows(i.clone(p),n),f=this.getWidestRowAspectRatio(i.clone(p)),y=f.aspectRatio;if(0==y)return t.style.tracking;var k=(u=h*d)/y,S=y*k;if(S<r){c=this.getSpacing(i.clone(p),f,k,r,!1).letterSpacing;for(var L=i.iter(p);!L.done;L.next()){var m=L.value;if(m.words.length>1){var C=this.getSpacing(i.clone(p),m,k,r,!1);C.letterSpacing<c&&(c=C.letterSpacing)}}(c/=k/s.heightRatio)<.01&&(c=0)}else c=-S;return c},calculateLeading:function(t,e){var o=t.containerSize,a=o.width,r=o.height,n=0,s=e.width,c=e.height,u=s/c,h=l.getTypographicBoundingRatiosOfString(t.text,t.style.font.fontData,!1),g=i.clone(this.getCompactedRows(t,u,t.highlightMethod,!1,h));if(g.length<=1)return t.style.spacing;var p=this.getAspectRatioOfAllRows(i.clone(g),n),d=this.getWidestRowAspectRatio(i.clone(g));c=s/p;var f=s/d.aspectRatio,y=d.aspectRatio*f;if(c<r){var k=a/((r-c)/(i.toDouble(g.length)-1));n=d.aspectRatio/k/this.spacingScalar}else i.info("fits in width. old tracking is :",t.style.tracking,y,"CW:",a,r,s,c),n=-c;return n},getSpacing:function(t,e,o,a,r){var n=0,l=0,s=0,c=0;if(e.words.length<=1)return{letterSpacing:s,wordSpacing:c};for(var u=i.iter(e.words);!u.done;u.next()){var h=u.value;n+=h.aspectRatio*o+h.spaceAspectRatio*o,0!=h.spaceAspectRatio&&h.canBreak&&(l+=1)}return n-=i.last(e.words).spaceAspectRatio*o,r?c=(a-n)/(i.toDouble(l)-1):(s=(a-n)/(i.toDouble(e.words.length)-1),l>1&&s>0&&(s=(a-n-(c=s)*(i.toDouble(l)-1))/(i.toDouble(e.words.length)-1))),{letterSpacing:s,wordSpacing:c}},getWidestRowAspectRatio:function(t){for(var e=t[0],o=i.iter(t);!o.done;o.next()){var a=o.value;a.aspectRatio>e.aspectRatio&&(e=a)}return e},getAspectRatioOfAllRows:function(t,e){var o=t.length-1,a=this.getWidestRowAspectRatio(i.clone(t));if(0==a.aspectRatio)return 0;for(var r=a.aspectRatio/e,n=0,l=i.iter(t);!l.done;l.next()){var s=l.value;n+=1/a.aspectRatio*s.rowHeightAdjustRatio}return 1/(n+1/r*i.toDouble(o))},rowsForTargetRowAspectRatio:function(t,e,o){var a=[];a.push(new s.LockupRowInfo);for(var r=0,i=0,n=!0,l=t.length,c=0;c<l;){var h=a[r],g=t[c];if(g.isNewLine)h.appendable=!1,a[r]=h,c+=1;else{for(var p=h.aspectRatio,d=g.aspectRatio+g.spaceAspectRatio,f=c;f+1<l&&!t[f].canBreak;)d+=t[f+=1].aspectRatio+t[f].spaceAspectRatio;var y=p+d,k=u.LockupUtils.percentageDiff(e,p),S=u.LockupUtils.percentageDiff(e,y);if(i>0&&k<S||0==h.appendable||!n&&c>0&&t[c-1].canBreak){r+=1,i=1;var L=new s.LockupRowInfo;if(o)n=!(c>0&&!t[c-1].canBreak);else for(;!g.canBreak&&c<l;)L.addWord(g),(c+=1)<l&&(g=t[c]);L.addWord(g),a.push(L)}else{if(!o)for(;!g.canBreak&&c<l;)h.addWord(g),(c+=1)<l&&(g=t[c]);h.addWord(g),i+=1,a[r]=h}c+=1}}return a},getCompactedRows:function(t,e,o,a,r){var n=t.text,l=t.style,c=l.font.fontData,u=l.spacing*this.spacingScalar,h=l.tracking,f=a||t.forceLetterForma,y=i.clone(t.characterStyleRanges),k=g.TypeLockupController.HIGHLIGHT_STYLE,S=i.opt(i.opt(l.characterStyles[k],(function(t){return t.font})),(function(t){return t.fontData})),L=p.TypeLockupUtils.getCharFontAdjust(l,r.hasUppercase);t.characterStyleRanges.length>0&&null!=l.characterStyles[k]&&-1!=l.characterStyles[k].spacing&&0!=l.characterStyles[k].spacing&&l.characterStyles[k].spacing>1&&((l=t.style.clone()).characterStyles[k].spacing=L,y=i.clone(p.TypeLockupUtils.invertRanges(i.clone(t.characterStyleRanges),n.length)),null!=S&&(S=c,c=l.characterStyles[k].font.fontData,l.characterStyles[k].font=l.font));var m=i.clone(p.TypeLockupUtils.computeLockupMeasurements(n,c,r.heightRatio,!1,f,h,i.clone(y),i.clone(l.characterStyles),L,t.forceLetterForma)),C=m.length;if(0==C)return[];var v,A=new s.LockupRowInfo(i.clone(m)).aspectRatio,w=.5,b=.6+1.6*A;if(null!=(v=t.preferredFontSize)){var R=v*r.heightRatio,D=t.containerSize.width/R;w=D,b=D}for(var T=i.clone(this.getOptimalCompactedRows(i.clone(m),A,e,u,w,b,!1,a)),x=0,I=i.iter(m);!I.done;I.next())x+=I.value.isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==x&&(!t.allowFewerLineBreaks||T.length>=t.rowWordLengths.length)&&(T=i.clone(this.getPrecomputedRows(i.clone(m),i.clone(t.rowWordLengths)))),null!=l.characterStyles[k]&&null!=l.characterStyles[k].font&&(C>1&&!f||f&&T.length>1)&&(o==g.HighlightMethod.EvenRows||o==g.HighlightMethod.OddRows||o==g.HighlightMethod.Bracket||o==g.HighlightMethod.InsideBracket)){var O=i.clone(p.TypeLockupUtils.computeLockupMeasurements(n,c,r.heightRatio,!1,f,h,i.clone([]),i.clone({}),void 0,t.forceLetterForma)),B=[new d.TextRange(0,i.chars(n).length)],F=i.clone(p.TypeLockupUtils.computeLockupMeasurements(n,S,r.heightRatio,!1,f,h,i.clone(B),i.clone(l.characterStyles),L,t.forceLetterForma));T=i.clone(this.getOptimalCompactedAutoRows(i.clone(O),i.clone(F),A,e,u,.5,.6+1.6*A,!1,!1,o))}if(a&&l.tracking>0)for(var E=i.iter(i.range(0,T.length,!1));!E.done;E.next()){var _=E.value;T[_].aspectRatio=0;for(var P=i.iter(i.range(0,T[_].words.length,!1));!P.done;P.next()){var W=P.value;T[_].aspectRatio+=T[_].words[W].aspectRatio,T[_].words[W].canBreak&&W!=T[_].words.length-1?(T[_].words[W].spaceAspectRatio=c.spaceWidthRatio/r.heightRatio,T[_].aspectRatio+=T[_].words[W].spaceAspectRatio):T[_].words[W].spaceAspectRatio=0}}return T},getOptimalCompactedRows:function(t,e,o,a,r,n,l,s){var c=n-r,h=.25*c,g=r+.5*c,p=r+h,d=n-h,f=i.clone(this.rowsForTargetRowAspectRatio(i.clone(t),p,l)),y=i.clone(this.rowsForTargetRowAspectRatio(i.clone(t),d,l)),k=this.getAspectRatioOfAllRows(i.clone(f),a),S=this.getAspectRatioOfAllRows(i.clone(y),a),L=u.LockupUtils.percentageDiff(o,k),m=u.LockupUtils.percentageDiff(o,S);return c<.2?L<m?f:y:L<=m?this.getOptimalCompactedRows(i.clone(t),e,o,a,r,g,l,s):this.getOptimalCompactedRows(i.clone(t),e,o,a,g,n,l,s)},getWordForAutoMethod:function(t,e,o,a,r){var i=o%2==(r==g.HighlightMethod.EvenRows?0:1)?e:t;return r!=g.HighlightMethod.Bracket&&r!=g.HighlightMethod.InsideBracket||(i=0==o||a?r==g.HighlightMethod.Bracket?e:t:r==g.HighlightMethod.InsideBracket?e:t),i},rowsForTargetRowAspectRatioAutoRows:function(t,e,o,a,r,n){var l=[];l.push(new s.LockupRowInfo);for(var c=0,h=0,p=!0,d=t.length,f=0,y=0;f<d;){var k=l[c],S=this.getWordForAutoMethod(t[f],e[f],c,f==d-1,n);if(S.isNewLine)k.appendable=!1,l[c]=k,f+=1;else{for(var L=k.aspectRatio,m=S.aspectRatio+S.spaceAspectRatio,C=f;C+1<d&&!t[C].canBreak;)m+=t[C+=1].aspectRatio+t[C].spaceAspectRatio;var v=L+m,A=u.LockupUtils.percentageDiff(a,L),w=u.LockupUtils.percentageDiff(a,v);if(h>0&&A<w||0==k.appendable||!p&&f>0&&t[f-1].canBreak){c+=1,y=f,S=this.getWordForAutoMethod(t[f],e[f],c,f==d-1,n),h=1;var b=new s.LockupRowInfo;if(r)p=!(f>0&&!t[f-1].canBreak);else for(;!S.canBreak&&f<d;)b.addWord(S),(f+=1)<d&&(S=this.getWordForAutoMethod(t[f],e[f],c,f==d-1,n));b.addWord(S),l.push(b)}else{if(!r)for(;!S.canBreak&&f<d;)k.addWord(S),(f+=1)<d&&(S=this.getWordForAutoMethod(t[f],e[f],c,f==d-1,n));k.addWord(S),h+=1,l[c]=k}f+=1}}if(n==g.HighlightMethod.Bracket||n==g.HighlightMethod.InsideBracket){for(var R=new s.LockupRowInfo,D=i.iter(i.range(y,d,!1));!D.done;D.next()){f=D.value;var T=n==g.HighlightMethod.Bracket?e[f]:t[f];R.addWord(T)}l[l.length-1]=R}return l},getOptimalCompactedAutoRows:function(t,e,o,a,r,l,s,c,h,g){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowHeightsLayoutStrategy.getOptimalCompactedAutoRows","EvenRowHeightsLayoutStrategy.swift",905);var p=s-l,d=.25*p,f=l+.5*p,y=l+d,k=s-d,S=i.clone(this.rowsForTargetRowAspectRatioAutoRows(i.clone(t),i.clone(e),r,y,c,g)),L=i.clone(this.rowsForTargetRowAspectRatioAutoRows(i.clone(t),i.clone(e),r,k,c,g)),m=this.getAspectRatioOfAllRows(i.clone(S),r),C=this.getAspectRatioOfAllRows(i.clone(L),r);if(h){if(m>a&&C<a)return L;if(C>a&&m<a)return S}var v=u.LockupUtils.percentageDiff(a,m),A=u.LockupUtils.percentageDiff(a,C);return p<.2?v<A?S:L:v<=A?this.getOptimalCompactedAutoRows(i.clone(t),i.clone(e),o,a,r,l,f,c,h,g):this.getOptimalCompactedAutoRows(i.clone(t),i.clone(e),o,a,r,f,s,c,h,g)}}}),a)},JgVS:function(t,e,o){var a,r,i=e,n=o("oAGj"),l=o("SpAV");i.DecorationResults=(a=function(t){this.items=n.clone(t)},n.defineClass({name:"DecorationResults",ctor:a}),a),i.LockupDecorationStrategy=n.defineProtocol("LockupDecorationStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",decorate:"(LockupConfiguration, LayoutResults) -> DecorationResults"}),i.BaseDecorationStrategy=(r=function(){},n.defineClass({name:"BaseDecorationStrategy",ctor:r,statics:{getHorizontalOffsetForItalicAngle:function(t,e){var o=Math.abs(e),a=(180-o-90)*Math.PI/180,r=o*Math.PI/180,i=t/Math.sin(a)*Math.sin(r);return(i>t||i<0)&&(i=t/2),i},_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.supportsConfiguration","LockupDecorationStrategy.swift",31),!1},decorate:function(t,e){return l.CoreAssert.fail("Implement in subclass","BaseDecorationStrategy.decorate","LockupDecorationStrategy.swift",36),new i.DecorationResults([])}}}),r)},KdeS:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("1NAc");r.LockupWordInfo=(a=function(t,e,o,a,r,i,l,s,c){void 0===c&&(c=n.TheoSize.Zero),this.text=t,this.aspectRatio=e,this.spaceAspectRatio=o,this.characterStyle=a,this.characterHeightRatio=r,this.isNewLine=i,this.canBreak=l,this.rangeInLockup=s,this.relativeMargins=c},i.defineClass({name:"LockupWordInfo",ctor:a}),a)},PXlJ:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("JgVS"),l=o("cEEQ"),s=o("c+uM"),c=o("tGKA"),u=o("JKVa"),h=o("8t9B"),g=o("sIWg");r.LetterDecorationStrategy=(a=function(){n.BaseDecorationStrategy.call(this)},i.defineClass({name:"LetterDecorationStrategy",ctor:a,superName:"BaseDecorationStrategy",statics:{_implements:function(t){return"LockupDecorationStrategy"==t}},props:{supportsConfiguration:function(t){return s.LockupStyle.isLetterGrid(t.style.layout)},decorate:function(t,e){var o,a,r=[];if(0==e.items.length)return new n.DecorationResults(i.clone(r));var u,p,d,f,y=t.style,k=i.opt(y.font,(function(t){return t.fontData}));y.backing==s.LockupBacking.SVGBackground&&(u=y.backingArtworkID);var S,L,m,C=null;if(0==!t.characterStyleRanges.length&&(S=y.characterStyles[h.TypeLockupController.HIGHLIGHT_STYLE])&&(p=i.opt(S.font,(function(t){return t.fontData})),(d=S.backing)!=s.LockupBacking.UNSET&&(C=S.padding),d==s.LockupBacking.SVGBackground&&(f=S.backingArtworkID)),null==u&&null==f)return new n.DecorationResults(i.clone(r));for(var v=i.iter(i.toSequence(e.items));!v.done;v.next()){var A=v.value,w=A.offset,b=A.element,R=k,D=null,T=!1;if(b.characterStyle==h.TypeLockupController.HIGHLIGHT_STYLE?(T=!0,R=p||R,D=d==s.LockupBacking.UNSET?u:f):D=u,null!=D){var x,I,O,B,F=g.TheoRect.fromXYWH(b.placement.tx,b.placement.ty,b.size.width,b.size.height).outsetXY((o=i.opt(b.margins,(function(t){return t.width})))||null!=o?o:0,(a=i.opt(b.margins,(function(t){return t.height})))||null!=a?a:0),E=T?m:L;if(null==E&&(E=this.getSVGConfig(t.style,T?C:null,e,D,b,F),T?m=E:L=E),null!=(x=i.opt(R,(function(t){return t.capRatio})))&&null!=(I=b.pointSize)&&null!=(O=E)&&null!=(B=D)){var _=(e.typographicBoundingRatios.textVerticalOffsetRatio-x)*I,P=c.Matrix2D.translation(O.frame.origin).translate(F.origin).translateXY(0,-_);r.push(l.LockupItem.init_9cc6(!1,O.frame.size,P,B,O.preScale,w+e.numberOfLines,b.characterStyle))}}}return new n.DecorationResults(i.clone(r))},getSVGConfig:function(t,e,o,a,r,n){var c,h,g=new l.LayoutResults([r],n.size,o.placement,o.typographicBoundingRatios,o.avgRowAspect),p=t;return null!=(c=e)&&(h=i.as(p.clone(),s.LockupStyle))&&(h.padding=c,p=h),new u.SVGBackgroundDecorationStrategy(a).calcSVGConfiguration(p,g)}}}),a)},TkOd:function(t,e,o){var a,r,i,n,l,s,c,u,h,g,p,d,f,y,k=e,S=o("oAGj"),L=o("0wFF"),m=o("cZuM"),C=o("6h7+"),v=o("SpAV"),A=o("yhkb"),w=o("gXiO"),b=o("C42b"),R=o("YSlt"),D=o("Ohrj"),T=o("ascj"),x=o("FNB+"),I=o("lq1z"),O=o("G1DZ"),B=o("iCxV"),F=o("3lr5"),E=o("VDg0"),_=o("c+uM"),P=o("hb8m"),W=o("3DEm"),U=o("jcfx"),M=o("Zifs"),N=o("35Q0"),V=o("p+tC"),H=o("UqVc"),K=o("EoOi"),G=o("umUn"),z=o("T6jX"),Y=o("8t9B"),j=o("3UhB"),q=o("oKlP"),X=o("oKI3");k.kColorPairDistanceThreshold=10,k.kPuffyTextThreshold=.12,S.gvar(k,"BACKING_SHAPES_BASIC",(function(){return N.ShapeLibrary.NonSvgBackingShapeIDs})),S.gvar(k,"BACKING_SHAPES_SVG",(function(){return N.ShapeLibrary.BrowsableBackingShapes})),S.gvar(k,"ALLOWED_BACKING_VALUES",(function(){return k.BACKING_SHAPES_BASIC.concat(k.BACKING_SHAPES_SVG)})),S.gvar(k,"BACKING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_BACKING_VALUES.length)})),S.gvar(k,"ALLOWED_LAYOUT_VALUES",(function(){return["left","right","center","fill"]})),S.gvar(k,"LAYOUT_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_LAYOUT_VALUES.length)})),S.gvar(k,"ALLOWED_OPACITY_VALUES",(function(){return["full","mediumBacking","faintBacking","medium","faint"]})),S.gvar(k,"OPACITY_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_OPACITY_VALUES.length)})),S.gvar(k,"ALLOWED_SHADOWANGLE_VALUES",(function(){return[45,135,225,315]})),S.gvar(k,"SHADOWANGLE_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SHADOWANGLE_VALUES.length)})),S.gvar(k,"ALLOWED_PADDING_VALUES",(function(){return[0,.33,.66,1]})),S.gvar(k,"PADDING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_PADDING_VALUES.length)})),S.gvar(k,"ALLOWED_SPACING_VALUES",(function(){return[0,.5,1]})),S.gvar(k,"SPACING_COUNT_SCALE",(function(){return S.toDouble(k.ALLOWED_SPACING_VALUES.length)})),S.gvar(k,"ALLOWED_TRACKING_VALUES",(function(){return[-.1,0,.5]})),k.LockupStyleAttributes=(a=function(){this.font=0,this.layout="fill",this.backing="none",this.opacity="useLockupOpacities",this.textOpacity=1,this.backingOpacity=1,this.primaryColor="themeColor0",this.secondaryColor="themeColor1",this.shadowAngle=135,this.spacing=.35,this.tracking=0,this.padding=.35,this.textLook="fill",this.shadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET,this.strokeWeight=_.LockupStyle.DEFAULT_STROKEWEIGHT,this.layoutVariation=K.TypographyVariation.Unset,this.wheelUsed=!1},S.defineClass({name:"LockupStyleAttributes",ctor:a,props:{clone:function(){var t=new a;return t.font=this.font,t.layout=this.layout,t.backing=this.backing,t.opacity=this.opacity,t.textOpacity=this.textOpacity,t.backingOpacity=this.backingOpacity,t.primaryColor=this.primaryColor,t.secondaryColor=this.secondaryColor,t.shadowAngle=this.shadowAngle,t.spacing=this.spacing,t.tracking=this.tracking,t.padding=this.padding,t.textLook=this.textLook,t.shadowOffset=this.shadowOffset,t.strokeWeight=this.strokeWeight,t.wheelUsed=this.wheelUsed,t}}}),a),k.getFontPairingMatrix=function(t){for(var e={},o=t.count,a=S.iter(S.range(0,o,!1));!a.done;a.next()){for(var r=a.value,i=t.fontAt(r),n=i.postScriptName,l={},s=S.iter(S.range(0,o,!1));!s.done;s.next()){var c=s.value,u=t.fontAt(c),h=u.postScriptName,g=r==c,p=1;p+=1+S.toDouble(10-W.MathUtils.absInt(i.formality-u.formality)),p+=1+S.toDouble(10-W.MathUtils.absInt(i.width-u.width)),p+=1+S.toDouble(W.MathUtils.absInt(i.blackness-u.blackness));var d=S.toDouble(i.drama-u.drama);p+=d,d<-1&&(p*=.1),i.square==u.square&&(p*=2),i.geometric==u.geometric&&(p*=2),i.italic==u.italic&&(p*=2),i.handdrawn&&u.handdrawn&&(p*=2);var f=i.slab&&u.slab,y=0==(i.slab||u.slab);f&&(p*=2);var k=i.serif&&u.serif;k&&y&&(p*=2),0==(i.serif||u.serif)&&(p*=2),k&&i.slab!=u.slab&&(p*=0);var L=i.decorative&&u.decorative;0==g&&L&&(p*=0),i.calligraphic&&u.calligraphic&&0==g&&(p*=0),l[h]=p}e[n]=S.clone(l)}return e},k.getFontPairScore=function(t,e,o){var a,r;if((a=t[e])&&null!=(r=a[o]))return r;return 0},k.hasSufficientLegibilityContrast=function(t,e){return t.contrasts(e,!1)},k.needsContrastingColor=function(t,e,o){return e!=_.LockupTextLook.Fill&&e!=_.LockupTextLook.KnockoutOnly||o},k.getTextOpacity=function(t){switch(t.opacity){case"medium":return E.kOpacityRuleMediumAlpha;case"faint":return E.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.textOpacity;default:return 1}},k.getBackingOpacity=function(t){switch(t.opacity){case"medium":case"mediumBacking":return E.kOpacityRuleMediumAlpha;case"faint":case"faintBacking":return E.kOpacityRuleFaintAlpha;case"useLockupOpacities":return t.backingOpacity;default:return 1}},k.getTextLook=function(t){var e;switch(t.textLook){case"fill":e=_.LockupTextLook.Fill;break;case"knockoutOnly":e=_.LockupTextLook.KnockoutOnly;break;case"knockoutAndOutline":e=_.LockupTextLook.KnockoutAndOutline;break;case"outlineOnly":e=_.LockupTextLook.OutlineOnly;break;case"fillAndOutline":e=_.LockupTextLook.FillAndOutline;break;case"fillAndOutline2":e=_.LockupTextLook.FillAndOutline2;break;case"shadow":e=_.LockupTextLook.Shadow;break;case"shadowAndOutline":e=_.LockupTextLook.ShadowAndOutline;break;case"knockoutAndShadow":e=_.LockupTextLook.KnockoutAndShadow;break;default:e=_.LockupTextLook.Fill}return e},k.InterestingLockupData=(r=function(t){var e,o,a,r,i,n,l,s,c,u,h,g,p,d,f,y,L,m,C,v,A,w,b;(A=S.as(t.style,_.LockupStyle))&&(g=k.lockupStyleToLockupStyleAttributes(A,t.page.document),u=S.opt(A.font,(function(t){return t.fontData.postScriptName})),(w=S.as(t.controller,Y.TypeLockupController))&&(h=w.getCurrentFontSize()),v=k.lockupStyleToLockupStyleAttributes(A,t.page.document).backing),(w=S.as(t.controller,Y.TypeLockupController))&&((b=w.size)&&(m=b.width,C=b.height,p=S.toDouble(b.width/b.height)),d=S.clone(t.totalPlacement.transformPoints(S.clone(t.bounds.points))),f=w.text.length,y=w.text,L=w.wordCount()),this.id=t.formaID,this.width=(e=m)||null!=e?e:100,this.height=(o=C)||null!=o?o:100,this.font=(a=u)||null!=a?a:"BebasNeue",this.lineHeight=(r=h)||null!=r?r:1,this.styleAttributes=g||new k.LockupStyleAttributes,this.aspectRatio=(i=p)||null!=i?i:1,this.pts=S.clone(d||[]),this.wordCount=(n=L)||null!=n?n:1,this.charCount=(l=f)||null!=l?l:1,this.originalBacking=(s=v)||null!=s?s:"",this.lockupString=(c=y)||null!=c?c:""},S.defineClass({name:"InterestingLockupData",ctor:r}),r),k.InterestingPageData=(i=function(t){this.colorsBehindSelectedLockup=[],this.numImages=0,this.shapeCount=0,this.selectedLockup=new k.InterestingLockupData(t);var e=this.selectedLockup,o=[this.selectedLockup],a=10,r=1e3,i=1e3;if(t.page.hasRoot()){var n,l;r=t.page.pageSize.width,i=t.page.pageSize.height,(n=S.as(t.controller,Y.TypeLockupController))&&(this.colorsBehindSelectedLockup=S.clone(n.getBackgroundColors()),a=n.getBackgroundLightnessSpread(S.clone(this.colorsBehindSelectedLockup)),this.shapeCount=n.shapeCount()),0==this.colorsBehindSelectedLockup.length&&(l=t.page.root.style.colors.fieldPrimary)&&this.colorsBehindSelectedLockup.push(l);for(var s=S.clone(t.page.root.filterWithCallback((function(t){return t.isTypeLockup()}))),c=S.iter(s);!c.done;c.next())if((t=c.value).formaID!=this.selectedLockup.id){var u=new k.InterestingLockupData(t);u.lineHeight>e.lineHeight&&(e=u),o.push(u)}}this.height=i,this.width=r,this.numImages=t.root.filterWithCallback((function(t){return t.isBackgroundImage()})).length,this.lockups=S.clone(o),this.largestLineHeightLockup=e,0==this.colorsBehindSelectedLockup.length&&this.colorsBehindSelectedLockup.push(M.SolidColor.BLACK),this.lightnessSpreadBehindSelectedLockup=a},S.defineClass({name:"InterestingPageData",ctor:i,props:{isColorVisibleAgainstBackground:function(t){for(var e=S.iter(this.colorsBehindSelectedLockup);!e.done;e.next()){var o=e.value;if(!k.hasSufficientLegibilityContrast(t,o))return!1}return!0},ensureCorrectBackgroundColors:function(t){var e,o,a=[];(e=S.as(t.controller,Y.TypeLockupController))&&(a=S.clone(e.getBackgroundColors())),0==a.length&&(o=t.page.root.style.colors.fieldPrimary)&&a.push(o),a.length>0&&(this.colorsBehindSelectedLockup=S.clone(a))}}}),i),k.getBackingStringForBackingEnumAndArtworkId=function(t,e){var o="none";switch(t){case 0:o="none";break;case 2:o="row";break;case 9:o="bannerHorizontal";break;case 8:o="bannerVertical";break;case 11:o="knockout";break;case 4:o="none";break;default:null!=e&&(o=e)}return o},k.getBackingEnumAndArtworkIdForBackingString=function(t){var e,o=null;switch(t){case"none":e=_.LockupBacking.None;break;case"row":e=_.LockupBacking.Rows;break;case"bannerHorizontal":e=_.LockupBacking.BannerHorizontal;break;case"bannerVertical":e=_.LockupBacking.BannerVertical;break;case"knockout":e=_.LockupBacking.Knockout;break;default:e=_.LockupBacking.SVGBackground,o=t}return{backing:e,artworkID:o}},k.lockupStyleToLockupStyleAttributes=function(t,e){var o,a=new k.LockupStyleAttributes,r=B.Host.fontProvider.getIncludedFonts(e);a.shadowAngle=t.shadowAngle;var i,n,l,s,c,u=-1;switch((i=t.font)&&(u=(o=r.indexOf(i.fontData))||null!=o?o:-1),a.font=u,a.spacing=t.spacing,a.tracking=t.tracking,a.padding=t.padding,a.textLook=t.textLookAsString,a.shadowOffset=t.shadowOffset,a.strokeWeight=t.strokeWeight,null!=(n=t.colors.colorID(T.ColorRole.FieldPrimary))&&(a.primaryColor=n),null!=(l=t.colors.colorID(T.ColorRole.FieldSecondary))&&(a.secondaryColor=l),t.opacityRule){case 1:s="mediumBacking";break;case 2:s="faintBacking";break;case 3:s="medium";break;case 4:s="faint";break;case 0:s="full";break;default:s="useLockupOpacities"}a.opacity=s,a.textOpacity=t.textOpacity,a.backingOpacity=t.backingOpacity,a.layoutVariation=t.layoutVariation;var h=t.layout;if(_.LockupStyle.isLetterGrid(h)||h==_.LockupLayout.Standard){var g=_.LockupStyle.isLetterGrid(h)?"letter-grid-":"";switch(t.alignment){case 0:c=g+"left";break;case 1:c=g+"right";break;case 2:c=g+"center";break;default:v.CoreAssert.fail("Unexpected alignment: "+t.alignment,"lockupStyleToLockupStyleAttributes","LockupStyleController.swift",664),c=g+"left"}}else if(_.LockupStyle.isAutoLayout(h))c="auto";else if(_.LockupStyle.isPath(h)){c="path"+t.pathID}else c="fill";return a.layout=c,a.backing=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID),a.wheelUsed=t.wheelUsed,a},k.lockupStyleAttributesToLockupStyle=function(t,e,o){var a,r,i=null,n=t.font;(v.CoreAssert.isTrue(n>-1,"lockupStyleAttributesToLockupStyle called with no font. It is valid for a character style to have no font but this function doesn't work for character styles ","lockupStyleAttributesToLockupStyle","LockupStyleController.swift",705),n>-1)&&((r=B.Host.fontProvider.getIncludedFonts(o).fontAt(n))&&(i=j.TypeLockupUtils.createTheoFont(r,B.Host.brandkitManager.brandkitForDocument(o))));var l,s,c=T.ColorTable.init_25f6([{key:T.ColorRole.FieldPrimary,value:t.primaryColor},{key:T.ColorRole.FieldSecondary,value:t.secondaryColor}]);switch(t.opacity){case"mediumBacking":l=_.OpacityRule.MediumBacking;break;case"faintBacking":l=_.OpacityRule.FaintBacking;break;case"medium":l=_.OpacityRule.Medium;break;case"faint":l=_.OpacityRule.Faint;break;case"full":l=_.OpacityRule.Full;break;default:l=_.OpacityRule.UseLockupOpacities}var u,h,g=_.LockupAlignment.UNSET,p=X.TextPathID.UNSET,d=null;if(t.layout.startsWith("path"))s=_.LockupLayout.Path,null!=(u=S.toInt(t.layout.substr("path".length)))&&(p=(a=X.TextPathID.toCaseValue(u))||null!=a?a:X.TextPathID.UNSET)==X.TextPathID.Custom&&(h=e.customPath)&&(d=h);else switch(t.layout){case"auto":s=_.LockupLayout.Auto,g=_.LockupAlignment.Auto;break;case"left":s=_.LockupLayout.Standard,g=_.LockupAlignment.Left;break;case"right":s=_.LockupLayout.Standard,g=_.LockupAlignment.Right;break;case"center":s=_.LockupLayout.Standard,g=_.LockupAlignment.Center;break;case"letter-grid-left":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Left;break;case"letter-grid-right":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Right;break;case"letter-grid-center":s=_.LockupLayout.LetterGrid,g=_.LockupAlignment.Center;break;case"fill":default:s=_.LockupLayout.FitJustified}var f=k.getBackingEnumAndArtworkIdForBackingString(t.backing),y=k.getTextLook(t),L=t.wheelUsed,m=_.LockupStyle.init_2885(t.textOpacity,t.backingOpacity,c,i,t.spacing,t.tracking,t.padding,f.backing,f.artworkID,t.shadowAngle,s,g,t.layoutVariation,l,y,t.shadowOffset,t.strokeWeight,p,d,L);return m.setCharacterStyles(S.clone(e.characterStyles)),m},k.randomDbl=function(){return S.toDouble(b.CoreRandom.nextInt)/S.toDouble(b.CoreRandom.randMax)},k.getWeightedIndex=function(t,e){for(var o=t.length,a=e*k.randomDbl(),r=0,i=0,n=S.iter(S.range(0,o,!1));!n.done;n.next()){var l=n.value;if((r+=t[l])>=a){i=l;break}}return i},k.selectWeightedValue=function(t,e,o,a,r){var i,n=a,l=S.clone(o);return null!=(i=S.indexOf(e,t))&&o[i]>0&&(l[i]+=n*r,n+=n*r),e[k.getWeightedIndex(S.clone(l),n)]},k.WeightedAttributeSelector=S.defineProtocol("WeightedAttributeSelector",{inertiaRatio:"Double",forma:"Forma",pageData:"InterestingPageData",values:"Array<TypeAlias>",weights:"Array<Double>",weightSum:"Double",scoreValue:"(TypeAlias) -> Double",updateWeights:"(InterestingPageData) -> Void",select:"(LockupStyleAttributes, Boolean, Boolean, Boolean, Boolean) -> TypeAlias"}),k.WeightedFontSelector=(n=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.machineRecommend=!0;var a=this;this.forma=e,this.pageData=o,this.listOfFonts=B.Host.fontProvider.getIncludedFonts(e.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1));var r=this.listOfFonts.revisionNumber,i=this.listOfFonts.fontSetID;r==t.cacheRevisionNumber&&i==t.cacheFontSetID?this.fontPairingMatrix=S.clone(t.fontPairingMatrixCache):(this.fontPairingMatrix={},t.fontPairingMatrixCache={},S.each(k.getFontPairingMatrix(this.listOfFonts),(function(e,o){a.fontPairingMatrix[e]=S.clone(o),t.fontPairingMatrixCache[e]=S.clone(o)})),t.cacheRevisionNumber=r,t.cacheFontSetID=i)},S.defineClass({name:"WeightedFontSelector",ctor:n,statics:{cacheRevisionNumber:0,cacheFontSetID:"charlie",_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t;var e=!1;if(this.values.length!=B.Host.fontProvider.getIncludedFonts(this.forma.page.document).count&&(this.listOfFonts=B.Host.fontProvider.getIncludedFonts(this.forma.page.document),this.values=S.toArray(S.range(0,this.listOfFonts.count,!1)),e=!0),this.machineRecommend){var o,a=new I.FontSuggester;(o=a.getFontFeatures(t,this.forma))?(e&&a.clearCache(),this.weights=S.clone(a.getScores(this.listOfFonts,o))):this.weights=this.values.map(this.scoreValue,this)}0!=this.machineRecommend&&1!=(new H.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},getTopFonts:function(t){v.CoreAssert.isTrue(t<this.listOfFonts.count,"cannot get top fonts more than total number","WeightedFontSelector.getTopFonts","LockupStyleController.swift",1006);for(var e=[],o=S.iter(S.toSequence(this.weights));!o.done;o.next()){var a=o.value,r=a.offset,i=a.element;e.push([i,r])}e=S.sort(e,(function(t,e){return t[0]>e[0]}));for(var n=[],l=0,s=S.iter(e);!s.done;s.next()){var c=s.value;if(!(l<t))break;n.push(this.listOfFonts.fontAt(c[1])),l+=1}return n},scoreValue:function(t){return this.manuallyScoreValue(t)},manuallyScoreValue:function(t){var e=this.listOfFonts.fontAt(t),o=e.postScriptName,a=B.Host.fontProvider.descriptorForPostScriptName(o,F.ANY_DOCUMENT),r=this.pageData.selectedLockup.lineHeight;if(!B.Host.fontProvider.getSuggestableFonts(S.opt(this.forma,(function(t){return t.page.document}))).contains(e))return 0;for(var i=.1,n=S.iter(this.pageData.lockups);!n.done;n.next()){var l=n.value;if(l.id!=this.pageData.selectedLockup.id){var s=W.MathUtils.absDouble(r-l.lineHeight)/r,c=l.lineHeight>r,u=c?l.font:o,h=c?o:l.font;i+=k.getFontPairScore(S.clone(this.fontPairingMatrix),u,h),o==l.font&&(i*=2,s<.5&&(i*=2))}}return i*=a.popularity,j.TypeLockupUtils.createTheoFont(e,B.Host.brandkitManager.brandkitForDocument(this.forma.page.document)).isSparkFont()&&(i*=2),r<40&&0==a.bodyAllowed&&(i=0),r>150&&0==a.displayAllowed&&(i=0),i},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.font,n=o?this.inertiaRatio:0;return k.selectWeightedValue(i,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),n),k.WeightedLayoutSelector=(l=function(t,e){this.inertiaRatio=0,this.values=k.ALLOWED_LAYOUT_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedLayoutSelector",ctor:l,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.aspectRatio,a=this.pageData.selectedLockup.wordCount,r=this.pageData.selectedLockup.id;"left"!=t&&"right"!=t||(a<=1||o>4?e=0:e*=.05),0==this.pageData.lockups.length&&("fill"==t&&(e*=5),"center"==t&&(e*=4)),"fill"==t&&this.pageData.selectedLockup.wordCount>10&&(e*=4/S.toDouble(this.pageData.selectedLockup.wordCount));var i=[];z.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.forma.page)||(i=S.clone(m.AlignmentDetector.init_a05b(this.forma).detectFormaAlignments(20)));for(var n=!1,l=!1,s=S.iter(i);!s.done;s.next()){var c=s.value;c.line.type==m.AlignmentType.Left&&(n=!0),c.line.type==m.AlignmentType.Right&&(l=!0)}n&&!l&&"left"==t&&(e=2.5),l&&!n&&"right"==t&&(e=2.5);for(var u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;h.id!=r&&t==h.styleAttributes.layout&&(e*=k.LAYOUT_COUNT_SCALE/2)}return e},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.layout,n=o?this.inertiaRatio:0;return k.selectWeightedValue(i,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),l),k.WeightedBackingSelector=(s=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_BACKING_VALUES,this.weights=[],this.weightSum=0,this.machineRecommend=!0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedBackingSelector",ctor:s,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){if(this.pageData=t,1==this.machineRecommend){var e=new V.ShapeSuggester,o=S.clone(e.getShapeSuggesterFeatures(t,this.forma));this.weights=S.clone(e.getScores(S.clone(this.values),S.clone(o)))}0!=this.machineRecommend&&1!=(new H.SuggestionUtils).weightsEqualNaNOrEmpty(S.clone(this.weights))||(this.weights=this.values.map(this.scoreValue,this)),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=this.pageData.largestLineHeightLockup,a=e.lineHeight,r=o.id==e.id,i=N.ShapeLibrary.shapeDictionary[t]||N.ShapeLibrary.shapeDictionary.none,n=1;if(i.premium)return 0;if(N.ShapeLibrary.NonSuggestableBackingShapes.includes(t))return 0;this.pageData.lockups.length>0&&k.BACKING_SHAPES_SVG.includes(t)&&(n*=.1);for(var l=S.iter(this.pageData.lockups);!l.done;l.next()){var s,c=l.value;c.id!=e.id&&(W.MathUtils.absDouble(a-c.lineHeight)/a<.4&&(n*=3),(s=N.ShapeLibrary.shapeDictionary[c.styleAttributes.backing])&&(n*=(11-S.toDouble(W.MathUtils.absInt(i.formality-s.formality)))/2,n*=(11-S.toDouble(W.MathUtils.absInt(i.drama-s.drama)))/2))}var u,h=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height);if(i.maxScale<1&&h>i.maxScale&&(n=0),(i.maxAspect<e.aspectRatio||i.minAspect>e.aspectRatio)&&(n=0),0==r&&(u=N.ShapeLibrary.shapeDictionary[o.styleAttributes.backing])){var g=u.drama;i.drama<g&&(n*=2)}return"none"==t&&(n*=10),"row"==t&&(n*=10),this.pageData.lightnessSpreadBehindSelectedLockup>=20&&0==i.filled&&(n*=.01),n},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=this.values.length,n=S.clone(this.weights),l=t.layout,s="center"==l||"fill"==l,c=!1,u=B.Host.fontProvider.getIncludedFonts(this.forma.page.document).fontAt(t.font),h=this.pageData.selectedLockup.width/this.pageData.selectedLockup.height,g=!0,p=this.pageData.selectedLockup.originalBacking;"none"!=p&&"shadow"!=p&&"row"!=p||(g=!1),"knockout"==t.backing&&(g=!1);for(var d=S.iter(this.pageData.lockups);!d.done;d.next()){var f,y=d.value,L=y.styleAttributes.backing;y.id!=this.pageData.selectedLockup.id&&("none"!=L&&(c=!0),t.font==y.styleAttributes.font&&null!=(f=S.indexOf(k.ALLOWED_BACKING_VALUES,L))&&(n[f]*=5))}for(var m=S.iter(S.range(0,i,!1));!m.done;m.next()){var C,v=m.value,A=this.values[v];if(C=N.ShapeLibrary.shapeDictionary[A]){s&&1==C.centered&&(n[v]*=5),h>4&&C.category==N.ShapeCategory.Circle&&(n[v]*=0),h<4&&C.category==N.ShapeCategory.Banner&&(n[v]*=0),C.category!=N.ShapeCategory.Cutout&&C.category!=N.ShapeCategory.Avoid||(n[v]*=0),"knockoutOnly"!=t.textLook||"none"!=A&&"shadow"!=A||(n[v]*=0);var w=S.toDouble(10-W.MathUtils.absInt(u.formality-C.formality));n[v]*=w/5;var b=S.toDouble(10-W.MathUtils.absInt(u.drama-C.drama));n[v]*=b/5,c&&"row"!=A&&"none"!=A&&(n[v]/=5)}}var R=t.backing,D=o?this.inertiaRatio:0,T=n.reduce((function(t,e){return t+e}),0);return R=1==g?k.selectWeightedValue(R,S.clone(this.values),S.clone(n),T,D):p}}}),s),k.WeightedShadowAngleSelector=(c=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SHADOWANGLE_VALUES,this.weights=[],this.weightSum=0,this.foo=4,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedShadowAngleSelector",ctor:c,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.shadowAngle,n=o?this.inertiaRatio:0;return k.selectWeightedValue(i,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),c),k.WeightedOpacitySelector=(u=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_OPACITY_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedOpacitySelector",ctor:u,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=this.pageData.selectedLockup.width*this.pageData.selectedLockup.height,a=this.pageData.width*this.pageData.height;return"full"==t&&o>.5*a&&(e*=.1),"faint"==t&&(o<.5*a?e=0:e*=.5),e},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.opacity,n=S.clone(this.weights);(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled?(n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"faint")]=0,n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"medium")]=0):(n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"faintBacking")]=0,n[S.indexOf(k.ALLOWED_OPACITY_VALUES,"mediumBacking")]=0);var l=o?this.inertiaRatio:0,s=n.reduce((function(t,e){return t+e}),0);return k.selectWeightedValue(i,S.clone(this.values),S.clone(n),s,l)}}}),u),k.WeightedPaddingSelector=(h=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_PADDING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedPaddingSelector",ctor:h,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=this.pageData.selectedLockup,o=1,a=1;if(0==this.pageData.lockups.length)a=W.MathUtils.absDouble(t-_.LockupStyle.DEFAULT_PADDING);else for(var r=S.iter(this.pageData.lockups);!r.done;r.next()){var i=r.value;a=W.MathUtils.minDouble(a,W.MathUtils.absDouble(t-i.styleAttributes.padding))}o*=W.MathUtils.maxDouble(1/(a+.1),.05);var n=W.MathUtils.maxDouble(e.width/this.pageData.width,e.height/this.pageData.height)+t;return o/=4*W.MathUtils.absDouble(n-1)},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.padding,n=o?this.inertiaRatio:0;return k.selectWeightedValue(i,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),h),k.WeightedSpacingSelector=(g=function(t,e){this.inertiaRatio=1,this.values=k.ALLOWED_SPACING_VALUES,this.weights=[],this.weightSum=0,this.forma=t,this.pageData=e},S.defineClass({name:"WeightedSpacingSelector",ctor:g,statics:{_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){var e=1,o=1;if(0==this.pageData.lockups.length)o=W.MathUtils.absDouble(t-_.LockupStyle.DEFAULT_SPACING);else for(var a=S.iter(this.pageData.lockups);!a.done;a.next()){var r=a.value;o=W.MathUtils.minDouble(o,W.MathUtils.absDouble(t-r.styleAttributes.spacing))}return e*=W.MathUtils.maxDouble(1/(o+.1),.05)},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.spacing,n=o?this.inertiaRatio:0;return k.selectWeightedValue(i,S.clone(this.values),S.clone(this.weights),this.weightSum,n)}}}),g),k.PrimaryColorSelector=(p=function t(e,o){this.inertiaRatio=1,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"PrimaryColorSelector",ctor:p,statics:{updateColorValues:function(t){var e;return(e=t)?e.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS).concat(e.page.colorLibraryController.getProfilingColorKeys()):[]},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(p.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return"themeDerivedDark"==t?.1:1},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled||"fill"!=t.textLook;this.values=S.clone(p.updateColorValues(this.forma));for(var n=this.values.length,l=t.primaryColor,s=S.clone(this.weights),c=new R.ColorRankSuggester,u=[],h=S.iter(S.range(0,n,!1));!h.done;h.next()){var g,d=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[d]))&&u.push(g)}if(v.CoreAssert.isTrue(n==u.length,"not all value colors were added.","PrimaryColorSelector.select","LockupStyleController.swift",2089),n!=u.length)return l;var f=[];if(0==i){this.pageData.ensureCorrectBackgroundColors(this.forma);for(var y=S.iter(this.pageData.colorsBehindSelectedLockup);!y.done;y.next()){var L=y.value;f.push(S.clone(R.ColorForComparison.init_c063(L,1)))}}else{var m;(m=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&f.push(S.clone(R.ColorForComparison.init_c063(m,1)))}a&&(m=this.forma.page.colorLibraryController.getSolidColorForKey(t.primaryColor))&&f.push(S.clone(R.ColorForComparison.init_c063(m,.33))),s=S.clone(c.weightedColorContrastRanker(S.clone(f),S.clone(u),r));var C=(s=S.clone((new H.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),A=o?this.inertiaRatio:0;return k.selectWeightedValue(l,S.clone(this.values),S.clone(s),C,A)}}}),p),k.SecondaryColorSelector=(d=function t(e,o){this.inertiaRatio=0,this.weights=[],this.weightSum=0,this.forma=e,this.pageData=o,this.values=S.clone(t.updateColorValues(e))},S.defineClass({name:"SecondaryColorSelector",ctor:d,statics:{updateColorValues:function(t){var e;return(e=t)?e.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS):[]},_implements:function(t){return"WeightedAttributeSelector"==t}},props:{updateWeights:function(t){this.pageData=t,this.values=S.clone(d.updateColorValues(this.forma)),this.weights=this.values.map(this.scoreValue,this),this.weightSum=this.weights.reduce((function(t,e){return t+e}),0)},scoreValue:function(t){return 1},select:function(t,e,o,a,r){void 0===a&&(a=!1),void 0===r&&(r=!0);var i=t.secondaryColor,n=(N.ShapeLibrary.shapeDictionary[t.backing]||N.ShapeLibrary.shapeDictionary.none).filled;this.values=S.clone(d.updateColorValues(this.forma));for(var l=this.values.length,s=S.clone(this.weights),c=new R.ColorRankSuggester,u=[],h=S.iter(S.range(0,l,!1));!h.done;h.next()){var g,p=h.value;(g=this.forma.page.colorLibraryController.getSolidColorForKey(this.values[p]))?u.push(g):v.CoreAssert.isTrue(!1,"failed to get SolidColor for key "+this.values[p]+". colorCount:"+l+". num color keys:"+this.forma.page.colorLibraryController.getNumThemeColorKeys(),"SecondaryColorSelector.select","LockupStyleController.swift",2209)}if(v.CoreAssert.isTrue(l==u.length,"not all value colors were added.","SecondaryColorSelector.select","LockupStyleController.swift",2212),l!=u.length)return i;var f=[];if(a&&n){var y;(y=this.forma.page.colorLibraryController.getSolidColorForKey(t.secondaryColor))&&f.push(S.clone(R.ColorForComparison.init_c063(y,1)))}else{this.pageData.ensureCorrectBackgroundColors(this.forma);for(var L=S.iter(this.pageData.colorsBehindSelectedLockup);!L.done;L.next()){var m=L.value;f.push(S.clone(R.ColorForComparison.init_c063(m,1)))}}s=S.clone(c.weightedColorContrastRanker(S.clone(f),S.clone(u),r));var C=(s=S.clone((new H.SuggestionUtils).normalizedWeights(S.clone(s)))).reduce((function(t,e){return t+e}),0),A=o?this.inertiaRatio:0;return k.selectWeightedValue(i,S.clone(this.values),S.clone(s),C,A)}}}),d),k.LockupStyleController=(f=function(t){this._sessionAttrs=new k.SessionAttrs,this.hasScoresForAttributes=!1,this.loggedDesignIngredientColorChanged=!1,this.forma=t,this.targetedLockupStyleName_="",this.pageData=new k.InterestingPageData(t),this.fontSelector=new k.WeightedFontSelector(t,this.pageData),this.layoutSelector=new k.WeightedLayoutSelector(t,this.pageData),this.backingSelector=new k.WeightedBackingSelector(t,this.pageData),this.opacitySelector=new k.WeightedOpacitySelector(t,this.pageData),this.primaryColorSelector=new k.PrimaryColorSelector(t,this.pageData),this.profilingBackgroundColorSelector=new D.ProfilingBackgroundColorSelector(t,!0),this.profilingPrimaryColorSelector=new D.ProfilingPrimaryColorSelector(t,!1),this.secondaryColorSelector=new k.SecondaryColorSelector(t,this.pageData),this.shadowAngleSelector=new k.WeightedShadowAngleSelector(t,this.pageData),this.spacingSelector=new k.WeightedSpacingSelector(t,this.pageData),this.paddingSelector=new k.WeightedPaddingSelector(t,this.pageData),w.CoreObject.call(this)},S.defineClass({name:"LockupStyleController",ctor:f,superName:"CoreObject",props:{targetedLockupStyleName:{get:function(){var t;return((t=S.opt(S.opt(S.opt(this.forma,(function(t){return t.page.document})),(function(t){return t.controller})),(function(t){return t.selection.inCharStyleMode})))||null!=t)&&t?Y.TypeLockupController.HIGHLIGHT_STYLE:""}},targetedLockupStyle:{get:function(){return""!=this.targetedLockupStyleName?this.forma.controller.getCharacterStyle(this.targetedLockupStyleName):this.forma.style}},targetedFont:{get:function(){var t;return(t=this.targetedLockupStyle.font)?t:this.forma.style.font}},targetedShadowAngle:{get:function(){return this.forma.style.shadowAngle},set:function(t){this.forma.style.shadowAngle=t}},targetedShadowOffset:{get:function(){return this.forma.style.shadowOffset},set:function(t){this.forma.style.shadowOffset=t}},targetedStrokeWeight:{get:function(){return this.forma.style.strokeWeight},set:function(t){this.forma.style.strokeWeight=t}},targetedTextLook:{get:function(){return this.targetedLockupStyle.textLook!=_.LockupTextLook.UNSET?this.targetedLockupStyle.textLook:this.forma.style.textLook}},updateScoring:function(){this.pageData=new k.InterestingPageData(this.forma),this.fontSelector.updateWeights(this.pageData),this.layoutSelector.updateWeights(this.pageData),this.backingSelector.updateWeights(this.pageData),this.opacitySelector.updateWeights(this.pageData),this.primaryColorSelector.updateWeights(this.pageData),this.secondaryColorSelector.updateWeights(this.pageData),this.shadowAngleSelector.updateWeights(this.pageData),this.spacingSelector.updateWeights(this.pageData),this.paddingSelector.updateWeights(this.pageData),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.hasScoresForAttributes=!0},getRecommendedFonts:function(){return this.fontSelector.getTopFonts(10)},onlineLearning:function(t){var e,o=new I.FontSuggester;(e=o.getFontFeatures(this.pageData,this.forma))&&o.onlineLearning(t,e)},getDominantColorRole:function(){var t,e=k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,this.forma.page.document).backing,o=T.ColorRole.FieldPrimary;return(t=N.ShapeLibrary.shapeDictionary[e])&&1==t.filled&&(o=T.ColorRole.FieldSecondary),o},fixUpSecondaryColor:function(){var t;if((t=S.as(this.forma.controller,Y.TypeLockupController))&&t.secondaryColorVisible()&&this.targetedLockupStyle.textBacked&&this.targetedLockupStyle.backing!=_.LockupBacking.UNSET){var e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary),a=this.calculateContrastingSecondaryColorID();null!=a&&a!=o&&a!=e&&null!=this.forma.page.colorLibraryController.getSolidColorForKey(a)&&this.targetedLockupStyle.colors.setColorId(T.ColorRole.FieldSecondary,a)}},calculateContrastingSecondaryColorID:function(){var t,e=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldPrimary),o=this.targetedLockupStyle.colors.colorID(T.ColorRole.FieldSecondary);if(null!=e&&e==o&&(t=this.forma.page.colorLibraryController.getSolidColorForKey(e)))for(var a=S.iter(this.forma.page.colorLibraryController.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!a.done;a.next()){var r,i=a.value;if(i!=e&&(r=this.forma.page.colorLibraryController.getSolidColorForKey(i))&&r.contrasts(t,!1)){o=i;break}}return o},fixUpBackingShape:function(){var t,e,o=this.forma.style;if((t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])){if(_.LockupStyle.isKnockoutLook(this.targetedLockupStyle.textLook)){(this.targetedLockupStyle===this.forma.style?t.filled:_.LockupStyle.isLetterGrid(o.layout)?(this.targetedLockupStyle.backing!=_.LockupBacking.None?e:t).filled:t.filled||e.filled)||(S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.beginBlockedUpdate()})),this.targetedLockupStyle.backing=_.LockupBacking.SVGBackground,this.targetedLockupStyle.backingArtworkID="square_001",S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.endBlockedUpdate()})),S.opt(S.as(this.forma.controller,Y.TypeLockupController),(function(t){return t.styleChanged()})))}!e.filled||this.targetedLockupStyle.textLook!=_.LockupTextLook.Shadow&&this.targetedLockupStyle.textLook!=_.LockupTextLook.ShadowAndOutline&&this.targetedLockupStyle.textLook!=_.LockupTextLook.FillAndOutline&&this.targetedLockupStyle.textLook!=_.LockupTextLook.FillAndOutline2&&this.targetedLockupStyle.textLook!=_.LockupTextLook.OutlineOnly||1!=this.targetedLockupStyle.backingOpacity||(this.targetedLockupStyle.opacityRule=_.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.backingOpacity=.5)}},getKnockoutColor:function(){var t,e,o=this.forma.style;return this.targetedLockupStyle!==this.forma.style&&(t=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(o.backing,o.backingArtworkID)])&&(e=N.ShapeLibrary.shapeDictionary[k.getBackingStringForBackingEnumAndArtworkId(this.targetedLockupStyle.backing,this.targetedLockupStyle.backingArtworkID)])&&(e.filled||!t.filled)?this.targetedLockupStyle.colors.fieldSecondary:o.colors.fieldSecondary},getTextLookForUI:function(){return this.targetedTextLook==_.LockupTextLook.FillAndOutline2||this.targetedTextLook==_.LockupTextLook.OutlineOnly?_.LockupTextLook.FillAndOutline:this.targetedTextLook},getStrokeWeightPercentForUI:function(){return 99*this.targetedStrokeWeight+1},getShadowOffsetPercentForUI:function(){return 99*this.targetedShadowOffset+1},setTextLook:function(t){this.targetedLockupStyle!==this.forma.style&&t==this.forma.style.textLook?this.targetedLockupStyle.textLook=_.LockupTextLook.UNSET:(this.targetedLockupStyle.textLook=t,this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutAndShadow&&(135==this.targetedShadowAngle&&225==this.targetedShadowAngle||(this.targetedShadowAngle=135)),this.targetedLockupStyle.textLook==_.LockupTextLook.ShadowAndOutline?this.targetedShadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET/2:this.targetedShadowOffset=_.LockupStyle.DEFAULT_SHADOWOFFSET,this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutAndOutline?this.targetedStrokeWeight=0:this.targetedStrokeWeight=_.LockupStyle.DEFAULT_STROKEWEIGHT),this.fixUpSecondaryColor(),this.fixUpBackingShape(),this.forma.controller.styleChanged()},applyBacking:function(t,e){var o,a,r,i,n,l;if((o=this.forma)&&(a=o.parent)&&(r=o.root)&&(i=o.page.document)&&(n=S.as(o.style,_.LockupStyle))&&(l=S.as(o.controller,Y.TypeLockupController))){l.beginBlockedUpdate();var s,c=k.getBackingStringForBackingEnumAndArtworkId(t,e);if(null!=(s=o.source)&&O.FormaSourceUtils.isDesignIngredient(s)){var u=C.BadgeFacade.getDesignIngredientIDAndType(s),h=u.id,g=u.type;S.opt(B.Host.logging,(function(t){return t.logToAnalytics(L.AnalyticsConstants.kDesignIngredientBackingShapeChanged,{contextualData1:"designIngredientId:"+h,contextualData2:"designIngredientType:"+g,contextualData12:"shapeName:"+c})}))}var p,d=k.lockupStyleToLockupStyleAttributes(this.targetedLockupStyle,i),f=!1,y=!1,m=this.targetedLockupStyle.currentBackingOpacity,A=this.targetedLockupStyle.textLook;if(t==_.LockupBacking.Knockout){_.LockupStyle.isKnockoutLook(A)||(A=_.LockupTextLook.KnockoutOnly,d.textLook="knockoutOnly"),r.visitAll(x.FormaTraversal.PreOrder,(function(t){var e;(e=S.as(t.style,_.LockupStyle))&&e.backing==_.LockupBacking.Knockout&&(e.backing=_.LockupBacking.None,e.textLook=_.LockupTextLook.Fill)}));var w=S.clone(a.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape())&&S.opt(t.controller,(function(t){return 0==t.floating}))}),x.FormaTraversal.JustChildren));a.insertChildAt(o,w.length)}this.targetedLockupStyle!==n&&((V=this.targetedLockupStyle).backing==_.LockupBacking.UNSET&&(v.CoreAssert.isTrue(_.LockupStyle.isLetterGrid(n.layout),"LockupBacking.UNSET in secondary styles for non-letter-grid layouts?","LockupStyleController.applyBacking","LockupStyleController.swift",2835),V.padding=n.padding),t==_.LockupBacking.None||t==_.LockupBacking.Rows||t==_.LockupBacking.SVGBackground?(V.backing=t,V.backingArtworkID=e):t==_.LockupBacking.Knockout&&(V.backing=_.LockupBacking.UNSET,A=_.LockupTextLook.KnockoutOnly),d=k.lockupStyleToLockupStyleAttributes(V,i),c=k.getBackingStringForBackingEnumAndArtworkId(V.backing,V.backingArtworkID),A=V.textLook),d.backing!=c&&(p=N.ShapeLibrary.shapeDictionary[c])&&(f=k.needsContrastingColor(c,A,p.filled),p.filled||A==_.LockupTextLook.FillAndOutline||A==_.LockupTextLook.FillAndOutline2||(y=!0),p.filled||(m=1)),d.backing=c,t!=_.LockupBacking.None||A!=_.LockupTextLook.KnockoutOnly&&A!=_.LockupTextLook.KnockoutAndOutline||(d.textLook="none");var b=this.updateOpacityAttributes(m,d);if(f&&(P=o.page.colorLibraryController.getSolidColorForKey(d.secondaryColor))&&(E=o.page.colorLibraryController.getSolidColorForKey(d.primaryColor))){var R=k.getBackingOpacity(d);R==_.LockupStyle.OPACITY_UNSET&&(R=k.getBackingOpacity(k.lockupStyleToLockupStyleAttributes(n,i)));for(var D=!0,T=S.iter(this.pageData.colorsBehindSelectedLockup);!T.done;T.next()){var I=T.value.blend(P,R);if(!k.hasSufficientLegibilityContrast(E,I)){D=!1;break}}if(!D){var F=this.getContrastingColorKey(d.secondaryColor,d.primaryColor);b.secondaryColor=F}}if(y){var E,P,W,U=d.primaryColor,M=d.secondaryColor;(E=o.page.colorLibraryController.getSolidColorForKey(U))&&(this.pageData.isColorVisibleAgainstBackground(E)||(P=o.page.colorLibraryController.getSolidColorForKey(M))&&(this.pageData.isColorVisibleAgainstBackground(P)&&!S.opt(N.ShapeLibrary.shapeDictionary[c],(function(t){return t.category==N.ShapeCategory.Cutout}))?(b.primaryColor=M,b.secondaryColor=U):null!=(W=this.getThemeColorContrastingWithBackground())&&(b.primaryColor=W)))}if(this.targetedLockupStyle!==n){var V;(V=this.targetedLockupStyle).textOpacity!=_.LockupStyle.OPACITY_UNSET&&(V.textOpacity=b.textOpacity),V.backingOpacity!=_.LockupStyle.OPACITY_UNSET&&(V.backingOpacity=b.backingOpacity),this.pickVisibleColorsForCharStyle()}else{var H=k.lockupStyleAttributesToLockupStyle(b,n,i);if(H.shapeSupportsKnockout)_.LockupStyle.doesLookColorMatchShapeColor(H.textLook)&&1==H.backingOpacity&&(H.backingOpacity=.5);else{_.LockupStyle.isKnockoutLook(H.textLook)&&(H.textLook=_.LockupTextLook.Fill);for(var K=S.iter(H.characterStyles);!K.done;K.next()){var G=K.value;!G.shapeSupportsKnockout&&_.LockupStyle.isKnockoutLook(G.textLook)&&(G.textLook=_.LockupTextLook.UNSET)}}o.applyStyle(H)}l.endBlockedUpdate(),l.styleChanged(),this.onBackingShapeChanged()}},switchPrimaryColorAndSecondaryColor:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(null!=a&&null!=r){var i=o.primaryColor;o.primaryColor=o.secondaryColor,o.secondaryColor=i;var n=k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(n),e=!0}}return e},getContrastingThemeColorBasedOnSolidColor:function(t,e){if(void 0===e&&(e=null),null==t)return null;for(var o=this.forma.page.colorLibraryController,a=S.iter(o.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!a.done;a.next()){var r,i=a.value;if((r=o.getSolidColorForKey(i))&&r.contrasts(t,!1)&&!r.isEqual(e))return i}return null},getThemeColorContrastingWithBackground:function(t){void 0===t&&(t=null);for(var e=this.forma.page.colorLibraryController,o=S.iter(e.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!o.done;o.next()){var a,r=o.value;if((a=e.getSolidColorForKey(r))&&(null==t||!a.isEqual(t))){for(var i=!0,n=S.iter(this.pageData.colorsBehindSelectedLockup);!n.done;n.next()){var l=n.value;if(!a.contrasts(l,!1)){i=!1;break}}if(i)return r}}return null},doesLockupContrastWithBackground:function(){var t,e=!0;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);t.secondaryColorVisible?t.textBacked?null!=a&&null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(r)&&a.contrasts(r,!1)):null!=a&&null!=r&&(e=this.pageData.isColorVisibleAgainstBackground(a)&&this.pageData.isColorVisibleAgainstBackground(r)):null!=a&&(e=this.pageData.isColorVisibleAgainstBackground(a))}return e},pickVisibleColorsForLockup:function(){var t=this.pickVisibleColorsForTextAndShape(),e=this.pickVisibleColorsForCharStyle(),o=t||e;return o&&this.forma.controller.styleChanged(),o},pickVisibleColorsForTextAndShape:function(){if(this.doesLockupContrastWithBackground())return!1;if(this.switchPrimaryColorAndSecondaryColor()){if(this.doesLockupContrastWithBackground())return!0;this.switchPrimaryColorAndSecondaryColor()}var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var o=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),a=this.forma.page.colorLibraryController.getSolidColorForKey(o.primaryColor),r=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);if(t.secondaryColorVisible){if(t.textBacked){if(null!=a&&null!=r)if(this.pageData.isColorVisibleAgainstBackground(r))a.contrasts(r,!1)||null!=(i=this.getContrastingThemeColorBasedOnSolidColor(r))&&(o.primaryColor=i,e=!0);else if(null!=(l=this.getThemeColorContrastingWithBackground())){o.secondaryColor=l;var i,n=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor);e=!0,k.hasSufficientLegibilityContrast(a,n)||null!=(i=this.getContrastingThemeColorBasedOnSolidColor(n))&&(o.primaryColor=i)}}else if(null!=a&&null!=r){var l;this.pageData.isColorVisibleAgainstBackground(a)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0),this.pageData.isColorVisibleAgainstBackground(r)||(a.isEqual(r)?(o.secondaryColor=o.primaryColor,e=!0):null!=(l=this.getThemeColorContrastingWithBackground(a))?(o.secondaryColor=l,e=!0):(o.secondaryColor=o.primaryColor,e=!0))}}else null!=a&&(this.pageData.isColorVisibleAgainstBackground(a)||null!=(l=this.getThemeColorContrastingWithBackground())&&(o.primaryColor=l,e=!0));if(e){var s=k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document);this.forma.applyStyle(s)}}return e},pickVisibleColorsForCharStyle:function(){var t,e=!1;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){if(0==S.count(t.characterStyles))return e;for(var o=_.LockupStyle.isKnockoutLook(t.textLook)?"":t.colors.colorID(T.ColorRole.FieldPrimary),a=t.textBacked?t.colors.colorID(T.ColorRole.FieldSecondary):"",r=this.forma.page.colorLibraryController,i=[],n=S.iter(r.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!n.done;n.next()){var l,s=n.value;(l=r.getSolidColorForKey(s))&&this.pageData.isColorVisibleAgainstBackground(l)&&i.push(s)}for(var c=S.iter(t.characterStyles);!c.done;c.next()){var u=c.value,h=u.colors.colorID(T.ColorRole.FieldPrimary),g=u.secondaryColorVisible?u.colors.colorID(T.ColorRole.FieldSecondary):"";if(u.secondaryColorVisible&&u.backing!=_.LockupBacking.UNSET){var p,d=!1;if(""==a&&(p=r.getSolidColorForKey(g))&&(this.pageData.isColorVisibleAgainstBackground(p)||(d=!0)),d)for(var f=S.iter(i);!f.done;f.next())(R=f.value)!=a&&(u.colors.setColorId(T.ColorRole.FieldSecondary,R),e=!0);else if(g==a)for(var y=S.iter(r.getThemeColorKeys().concat(A.ColorLibraryController.THEME_DERIVED_BW_KEYS));!y.done;y.next())(s=y.value)!=a&&(u.colors.setColorId(T.ColorRole.FieldSecondary,s),e=!0)}var k=!1,L=h!=o,m=r.getSolidColorForKey(t.colors.colorID(T.ColorRole.FieldPrimary));if(null==m)return e;if(!u.textBacked){var C=r.getSolidColorForKey(h);L&&""!=o&&(L=C.contrasts(m,!1)),""!=a||this.pageData.isColorVisibleAgainstBackground(C)||(k=!0)}if((u.backing!=_.LockupBacking.None&&u.backing!=_.LockupBacking.UNSET||L&&h!=a)&&!k){if(u.textBacked&&h==u.colors.colorID(T.ColorRole.FieldSecondary))for(var v=S.iter(r.getThemeColorKeys());!v.done;v.next())if((s=v.value)!=u.colors.colorID(T.ColorRole.FieldSecondary)){u.colors.setColorId(T.ColorRole.FieldPrimary,s),e=!0;break}}else for(var w=S.iter(i);!w.done;w.next()){var b=w.value,R=r.getSolidColorForKey(b),D=""==o||R.contrasts(m,!1);if(b!=o&&b!=a&&(!D&&e||u.colors.setColorId(T.ColorRole.FieldPrimary,b),e=!0,D))break}}}return e},getBrandkitColorsInUse:function(){for(var t=[],e=this.forma.page.colorLibraryController,o=S.iter(e.getColorThemeAsArrayOfTheoColors());!o.done;o.next()){var a=o.value;a.isBrandkitColor()&&t.push(a)}return t},getAllColorsFromDocumentBrandkit:function(){var t=[],e=B.Host.brandkitManager.brandkitForDocument(this.forma.page.document);if(null!=e)for(var o=S.iter(e.colors);!o.done;o.next()){var a=o.value,r=G.TheoColor.init_bb45(a);t.push(r)}return t},getBaseSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=S.clone(t.getColorThemeAsArrayOfTheoColors()),o=S.clone(t.getThemeDerivedColorsAsArrayOfTheoColors()),a=S.clone(t.getSuggestedColorsAsArraysOfTheoColors()),r=e.concat(a).concat(o),i=[],n=S.clone(this.getAllColorsFromDocumentBrandkit()),l=S.iter(r);!l.done;l.next()){var s=l.value;if(!s.isBrandkitColor()){for(var c=!0,u=S.iter(i);!u.done;u.next()){var h=u.value;if(s.rgbColor.distanceTo(h)<20){c=!1;break}}for(var g=S.iter(n);!g.done;g.next()){var p=g.value;if(s.rgbColor.distanceTo(p.rgbColor)<20){c=!1;break}}if(c&&i.push(s.rgbColor),i.length>=10)break}}return i},getSuggestableSingleColors:function(){for(var t=S.clone(this.getBaseSuggestableColors()),e=k.getTextOpacity(this.pageData.selectedLockup.styleAttributes),o=[],a=S.iter(t);!a.done;a.next()){for(var r=a.value,i=r.withAlphaOf(e),n=!0,l=S.iter(this.pageData.colorsBehindSelectedLockup);!l.done;l.next()){var s=l.value;if(!k.hasSufficientLegibilityContrast(i,s)){n=!1;break}}n&&o.push(r)}return o},getSuggestableColors:function(){var t=S.clone(this.getSuggestableColorPairs());if(0==t.length)for(var e=S.clone(this.getSuggestableSingleColors()),o=S.iter(e);!o.done;o.next()){var a=o.value;t.push([a])}for(var r=[],i=S.iter(t);!i.done;i.next()){for(var n=i.value,l=[],s=S.iter(n);!s.done;s.next()){var c=s.value;l.push(this.forma.page.colorLibraryController.getTheoColorForSolidColor(c))}r.push(S.clone(l))}return r},isCurrentlyShowingMultipleColors:function(){var t;return!((t=S.as(this.forma.controller,Y.TypeLockupController))&&(!t.secondaryColorVisible()||this.targetedLockupStyle.textLook==_.LockupTextLook.KnockoutOnly||this.targetedLockupStyle.textLook==_.LockupTextLook.OutlineOnly))},getSuggestableColorPairs:function(){var t=[];if(!this.isCurrentlyShowingMultipleColors())return t;var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=(N.ShapeLibrary.shapeDictionary[o.backing]||N.ShapeLibrary.shapeDictionary.none).filled,r=k.getBackingOpacity(o);r==_.LockupStyle.OPACITY_UNSET&&(r=k.getBackingOpacity(k.lockupStyleToLockupStyleAttributes(this.forma.style,this.forma.page.document)));var i=S.clone(this.getBaseSuggestableColors()),n=i.length;if(0==n)return t;for(var l={},s=S.toArray(S.range(0,n,!1)),c=S.clone(S.shuffle(s)),u=S.iter(this.pageData.lockups);!u.done;u.next()){var h=u.value;if(h.id!=this.forma.formaID&&"none"!=h.styleAttributes.backing){var g=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.primaryColor),p=this.forma.page.colorLibraryController.getSolidColorForKey(h.styleAttributes.secondaryColor);if(null!=g&&null!=p&&k.hasSufficientLegibilityContrast(g,p)){for(var d=-1,f=-1,y=S.iter(S.range(0,i.length,!1));!y.done;y.next()){var L=y.value;i[L].distanceTo(g)<.1&&(d=L),i[L].distanceTo(p)<.1&&(f=L)}null==l[w=S.toString(W.MathUtils.maxInt(d,f))+" "+S.toString(W.MathUtils.minInt(d,f))]&&(t.push([g,p]),l[w]=!0)}}}for(var m=S.iter(S.range(0,2,!0));!m.done;m.next()){for(var C=S.iter(c);!C.done;C.next()){d=C.value;for(var v=S.clone(S.shuffle(s)),A=S.iter(v);!A.done;A.next()){var w;if(f=A.value,t.length>=10)break;if(null==l[w=S.toString(W.MathUtils.maxInt(d,f))+" "+S.toString(W.MathUtils.minInt(d,f))]){var b=i[d],R=i[f],D=b,T=R;b.lightness<R.lightness&&(D=R,T=b);var x=[];x=this.pageData.colorsBehindSelectedLockup[0].lightness>D.lightness?[T,D]:[D,T],a&&(x=S.reverse(x));for(var I=x[0],O=!0,B=S.iter(this.pageData.colorsBehindSelectedLockup);!B.done;B.next()){var F=B.value.blend(x[1],r),E=I.distanceTo(x[1]);if(!k.hasSufficientLegibilityContrast(I,F)||E<k.kColorPairDistanceThreshold){O=!1;break}}O&&(l[w]=!0,t.push(S.clone(x)))}}if(t.length>=10)break}if(t.length>=10)break}return t},applyColors:function(t,e){var o=this.targetedLockupStyle,a=this.forma.page.colorLibraryController;if(0!=t.length){var r;if(null!=(r=S.opt(this.forma,(function(t){return t.source})))&&!this.loggedDesignIngredientColorChanged&&O.FormaSourceUtils.isDesignIngredient(r)){var i=C.BadgeFacade.getDesignIngredientIDAndType(r),n=i.id,l=i.type;S.opt(B.Host.logging,(function(t){return t.logToAnalytics(L.AnalyticsConstants.kDesignIngredientColorChanged,{contextualData1:"designIngredientId:"+n,contextualData2:"designIngredientType:"+l})})),this.loggedDesignIngredientColorChanged=!0}var s=S.clone(a.addColorsToTheme(S.clone(t),this.targetedLockupStyle!==this.forma.style?null:this.forma));if(1==t.length)this.applyColor(e,s[0]);else{var c=e==T.ColorRole.FieldPrimary?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary;o.colors.setColorIDs([{key:e,value:s[0]},{key:c,value:s[1]}])}this.targetedLockupStyle!==this.forma.style&&(this.forma.style.colorTableBeforeChanged(),this.forma.style.colorTableAfterChanged(),this.forma.controller.styleChanged())}},applyColor:function(t,e){var o=this.targetedLockupStyle,a=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),r=(N.ShapeLibrary.shapeDictionary[a.backing]||N.ShapeLibrary.shapeDictionary.none).filled,i=k.needsContrastingColor(a.backing,o.textLook,r),n=this.getContrastingColorKey(e,null);switch(t){case 1:a.primaryColor=e,a.secondaryColor=i?n:e;break;case 2:a.secondaryColor=e,a.primaryColor=i?n:e;break;default:return}o.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:a.primaryColor},{key:T.ColorRole.FieldSecondary,value:a.secondaryColor}])},getContrastingColorKey:function(t,e){var o,a=this.forma.page.colorLibraryController.getTheoColorForKey(t);if(null==a)return"";null!=e&&(o=this.forma.page.colorLibraryController.getTheoColorForKey(e));var r=this.forma.page.colorLibraryController,i="";if(a.isBrandkitColor())for(var n=S.clone(this.getBrandkitColorsInUse()),l=a.getBrandkitShadeRole(),s=S.iter(n);!s.done;s.next()){var c=s.value,u=c.getBrandkitShadeRole();if((null==l&&(u==G.TheoColor.SPARK_COLOR_ROLE_SHADE0||u==G.TheoColor.SPARK_COLOR_ROLE_SHADE6)||null!=l&&(u==G.TheoColor.SPARK_COLOR_ROLE_SHADE1||u==G.TheoColor.SPARK_COLOR_ROLE_SHADE5))&&c.rgbColor.distanceTo(a.rgbColor)>30&&(null==o||c.rgbColor.distanceTo(o.rgbColor)>30)){i=r.getKeyOfColorInTheme(c);break}}return""==i&&null!=a&&(i=r.setLightnessContrastColorAndReturnKey(t,a)),i},setContrastingColor:function(t,e,o,a,r){var i=t.contrastWithColor(e),n=A.ColorLibraryController.getBackgroundContrastKey(a);return this.forma.page.colorLibraryController.setTheoColorToLibrary(G.TheoColor.init_5344(i,null,null),n),r.colors.setColorIDs([{key:o,value:n}]),n},backgroundContrastCheck:function(t){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=N.ShapeLibrary.shapeDictionary[o.backing],r=S.count(e.characterStyles)>0;if(null!=a){var i=a.filled;if(!i||e.textLook==_.LockupTextLook.KnockoutOnly||r){for(var n,l,s=e.textLook==_.LockupTextLook.KnockoutOnly,c=e.strokeWeight>.15,u=s||c?T.ColorRole.FieldSecondary:T.ColorRole.FieldPrimary,h=!1,g=S.iter(this.forma.style.characterStyles);!g.done;g.next())(L=g.value).colors.colorID(u)==e.colors.colorID(u)&&(h=!0);if((n=S.as(this.forma.controller,Y.TypeLockupController))&&(l=n.getBackgroundColor())){var p=e.colors.color(u);if(null!=p&&!p.contrasts(l,t)){var d=this.getContrastingColorKey(e.colors.colorID(u),null);e.colors.setColorId(u,d),this.forma.controller.styleChanged()}if(r&&!h)for(var f=S.iter(this.forma.style.characterStyles);!f.done;f.next()){var y,L=f.value;if(y=i?e.colors.color(T.ColorRole.FieldSecondary):l){var m=L.colors.color(u);if(null!=m&&!m.contrasts(y,t)){var C=L.colors.colorID(u);d=this.getContrastingColorKey(C,null),L.colors.setColorId(u,d)}}}}}}else v.CoreAssert.fail("shape is not set up in ShapeLibrary.shapeDictionary","LockupStyleController.backgroundContrastCheck","LockupStyleController.swift",3841)},shuffleColorAssignment:function(){this.updateScoring();var t=S.as(this.forma.controller,Y.TypeLockupController);null!=t&&t.beginBlockedUpdate();var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook),r=!1;a||(r=N.ShapeLibrary.shapeDictionary[o.backing].filled),("none"!=o.backing||a)&&(o.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0));var i,n=null;(r||a)&&(i=this.forma.page.colorLibraryController.getSolidColorForKey(o.secondaryColor))&&(n=S.clone(R.ColorForComparison.init_c063(i,a?.7:1)));var l=!r;l&&this.pageData.lockups.length<=2?o.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!1):o.primaryColor=this.profilingPrimaryColorSelector.selectColorForGlobalRecolor(l,S.clone(n),!0),this.setSecondaryMultiStyleLockupColors(e,o),e.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o.primaryColor},{key:T.ColorRole.FieldSecondary,value:o.secondaryColor}]),null!=t&&t.endBlockedUpdate(),this.forma.controller.styleChanged()},shuffleMultiStyleLockupColors:function(){this.pageData=new k.InterestingPageData(this.forma),this.profilingPrimaryColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup)),this.profilingBackgroundColorSelector.updateBackgroundColors(S.clone(this.pageData.colorsBehindSelectedLockup));var t=this.targetedLockupStyle,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);this.setSecondaryMultiStyleLockupColors(t,e)},setSecondaryMultiStyleLockupColors:function(t,e,o){void 0===o&&(o=!0);for(var a=S.iter(t.characterStyles);!a.done;a.next()){var r=a.value,i=S.eq(M._equality_SolidColor_SolidColor,t.colors.fieldPrimary,t.colors.fieldSecondary);if(r.backing!=_.LockupBacking.None&&r.backing!=_.LockupBacking.UNSET&&!i&&S.eq(M._equality_SolidColor_SolidColor,r.colors.fieldPrimary,t.colors.fieldSecondary)&&S.eq(M._equality_SolidColor_SolidColor,r.colors.fieldSecondary,t.colors.fieldPrimary)&&o)r.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:e.secondaryColor},{key:T.ColorRole.FieldSecondary,value:e.primaryColor}]);else{for(var n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,r,!0)),l=S.iter(S.range(0,5,!0));!l.done&&n[0]==n[1];l.next())n=S.clone(this.getStylePrimarySecondaryColorForMSL(e,r,!0));r.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:n[0]},{key:T.ColorRole.FieldSecondary,value:n[1]}])}}},getStylePrimarySecondaryColor:function(t){var e=t.clone();e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);for(var o=S.iter(S.range(0,5,!0));!o.done&&e.primaryColor==e.secondaryColor;o.next())e.secondaryColor=this.secondaryColorSelector.select(e,!1,!0,!1,!1),e.primaryColor=this.primaryColorSelector.select(e,!1,!0,!1,!1);return[e.primaryColor,e.secondaryColor]},getStylePrimarySecondaryColorForMSL:function(t,e,o){var a,r=this.secondaryColorSelector.select(t,!0,!1,!0,o),i=!0;if(e.backing!=_.LockupBacking.None||_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook)){var n=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);n.secondaryColor=r,a=this.primaryColorSelector.select(n,!0,!1,!1,o)}else i=!1,a=this.primaryColorSelector.select(t,!1,!1,!0,o);var l,s,c=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(r,this.forma.formaID+U.ProfilingColorMap.lockupMSLBackingColorKey),u=(new U.ProfilingColorMap).overridePaletteMappingDueToContrast(a,this.forma.formaID+U.ProfilingColorMap.lockupMSLPrimaryColorKey);return(l=this.forma.page.colorLibraryController.getSolidColorForKey(u))&&(s=this.forma.page.colorLibraryController.getSolidColorForKey(c))&&(i&&!s.contrasts(l)||(r=c,a=u)),[a,r]},generateAndApplyInitialStyleAttributes:function(){0==this.hasScoresForAttributes&&this.updateScoring();for(var t=this.forma.style,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),o=["Lato-Light","Lora-Regular","Montserrat-Regular","PlayfairDisplay-Regular","CantataOne-Regular","FuturaPT-Medium"],a=["square_001","row"],r=o[b.CoreRandom.nextIntUniform(o.length)],i=B.Host.fontProvider.getIncludedFonts(this.forma.page.document),n=S.iter(S.range(0,i.count,!1));!n.done;n.next()){var l=n.value;S.opt(i.fontAt(l),(function(t){return t.postScriptName==r}))&&(e.font=l)}e.layout=this.layoutSelector.select(e,!1,!1,!1,!1),"fill"!=e.layout&&"right"!=e.layout||(e.layout="center");var s=b.CoreRandom.nextIntUniform(a.length);e.backing=a[s],e.padding=0,"row"==e.backing&&(e.spacing=1,e.padding=.33),e.textOpacity=1,e.backingOpacity=1,e=this.setNewStyleColors(e,t);var c=k.lockupStyleAttributesToLockupStyle(e,this.forma.style,this.forma.page.document);this.forma.applyStyle(c)},setNewStyleColors:function(t,e){var o,a=t.clone(),r=N.ShapeLibrary.shapeDictionary[a.backing].filled,i=_.LockupStyle.isOutlineLook(e.textLook)||_.LockupStyle.isShadowLook(e.textLook),n=null,l=!r;return("none"!=a.backing||i)&&(a.secondaryColor=this.profilingBackgroundColorSelector.selectColorForGlobalRecolor(!0,void 0,!0),(o=this.forma.page.colorLibraryController.getSolidColorForKey(a.secondaryColor))&&(n=S.clone(R.ColorForComparison.init_c063(o,i?.7:1)))),a.primaryColor=this.profilingPrimaryColorSelector.selectColorForIndividualRecolor(l,S.clone(n),!0),a},getNewStyleAttributes:function(t,e,o){void 0===t&&(t=!0),0==this.hasScoresForAttributes&&this.updateScoring();var a,r,i=this.forma.style,n=k.lockupStyleToLockupStyleAttributes(i,this.forma.page.document);return n.font=this.fontSelector.select(n,!1,t,!1,!1),n.layout=this.layoutSelector.select(n,!1,t,!1,!1),n.backing=this.backingSelector.select(n,!1,t,!1,!1),o||(n.secondaryColor=this.secondaryColorSelector.select(n,!1,t,!1,!1),n.primaryColor=this.primaryColorSelector.select(n,!1,t,!1,!1),this.setSecondaryMultiStyleLockupColors(i,n,!1)),n.shadowAngle=this.shadowAngleSelector.select(n,!1,t,!1,!1),n.spacing=this.spacingSelector.select(n,!1,t,!1,!1),n.wheelUsed=!0,o?(a=k.lockupStyleAttributesToLockupStyle(n,i,this.forma.page.document),a=this.updateLockupStyleWithNewColors(a),(r=e)&&(a=r.lockupStyleEvaluator.styleEvaluatedWithReadability(a))):(a=k.lockupStyleAttributesToLockupStyle(n,i,this.forma.page.document),(r=e)&&r.lockupStyleEvaluator.initializeReadabilityInformation(a)),a},evaluateLockupStyleWithReadability:function(t){return new P.LockupStyleEvaluator(this.forma).styleEvaluatedWithReadability(t)},updateLockupStyleWithNewColors:function(t){(new U.ProfilingColorMap).eraseCurrentPaletteMappingDictionary();var e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document),o=S.clone(this.getStylePrimarySecondaryColor(e));return e.primaryColor=o[0],e.secondaryColor=o[1],t.colors.setColorIDs([{key:T.ColorRole.FieldPrimary,value:o[0]},{key:T.ColorRole.FieldSecondary,value:o[1]}]),this.setSecondaryMultiStyleLockupColors(t,e,!1),t},updateOpacityAttributes:function(t,e){var o=(N.ShapeLibrary.shapeDictionary[e.backing]||N.ShapeLibrary.shapeDictionary.none).filled,a=e.clone();return a.opacity="useLockupOpacities",o?(k.getTextLook(a)==_.LockupTextLook.KnockoutAndOutline?a.textOpacity=t:a.textOpacity=1,a.backingOpacity=t):(a.textOpacity=t,a.backingOpacity=t),a},setOpacity:function(t){var e=this.targetedLockupStyle,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=this.updateOpacityAttributes(t,o);this.targetedLockupStyle===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(a,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.opacityRule=_.OpacityRule.UseLockupOpacities,this.targetedLockupStyle.textOpacity=a.textOpacity,this.targetedLockupStyle.backingOpacity=a.backingOpacity,this.forma.controller.styleChanged())},getOpacityValue:function(){return this.targetedLockupStyle.opacityRule!=_.OpacityRule.UNSET?this.targetedLockupStyle.currentBackingOpacity:this.forma.style.currentBackingOpacity},hasSpacingOptions:function(){var t,e;return!(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t||this.targetedLockupStyle!==this.forma.style||!(e=S.as(this.forma.controller,Y.TypeLockupController))||!(e.numLines()>1||0==e.numLines()))},hasPaddingOptions:function(){var t;if(!(t=S.opt(S.opt(this.forma,(function(t){return t.controller})),(function(t){return t.enableChildMove})))&&null==t||!t)return!1;var e=this.targetedLockupStyle;return e.backing!=_.LockupBacking.None&&e.backing!=_.LockupBacking.Knockout&&e.backing!=_.LockupBacking.UNSET},areSpacingAndPaddingOptionsAvailable:function(){return this.hasSpacingOptions()||this.hasPaddingOptions()},setNextSpacingAndPaddingOption:function(){var t,e;if(this.targetedLockupStyle===this.forma.style){var o=this.hasPaddingOptions(),a=this.hasSpacingOptions();if(o||a){var r=this.forma.style,i=k.lockupStyleToLockupStyleAttributes(r,this.forma.page.document),n=k.ALLOWED_PADDING_VALUES.length,l=k.ALLOWED_SPACING_VALUES.length,s=n*l,c=(t=S.indexOf(k.ALLOWED_PADDING_VALUES,i.padding))||null!=t?t:0,u=(e=S.indexOf(k.ALLOWED_SPACING_VALUES,i.spacing))||null!=e?e:0,h=(o?u*n+c:c*l+u)+1;h%=s;var g=o?S.toInt(h/n):h%l,p=o?h%n:S.toInt(h/l);i.padding=k.ALLOWED_PADDING_VALUES[p],i.spacing=k.ALLOWED_SPACING_VALUES[g],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(i,this.forma.style,this.forma.page.document))}}else this.setNextPaddingOption()},setNextSpacingOption:function(){var t,e=this.forma.style,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=((t=S.indexOf(k.ALLOWED_SPACING_VALUES,o.spacing))||null!=t?t:0)+1;a>=k.ALLOWED_SPACING_VALUES.length&&(a=0),o.spacing=k.ALLOWED_SPACING_VALUES[a],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))},setSpacingFromSlider:function(t){this.setSpacing(z.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setSpacing:function(t){var e,o=this.forma.style,a=k.lockupStyleToLockupStyleAttributes(o,this.forma.page.document),r=((e=S.indexOf(k.ALLOWED_SPACING_VALUES,a.spacing))||null!=e?e:0)+1;r>=k.ALLOWED_SPACING_VALUES.length&&(r=0),a.spacing=t,this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(a,this.forma.style,this.forma.page.document))},setNextPaddingOption:function(){var t;if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==_.LockupBacking.Rows&&this.forma.style.backing==_.LockupBacking.Rows&&(e=this.forma.style);var o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=((t=S.indexOf(k.ALLOWED_PADDING_VALUES,o.padding))||null!=t?t:0)+1;a>=k.ALLOWED_PADDING_VALUES.length&&(a=0),o.padding=k.ALLOWED_PADDING_VALUES[a],e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setPaddingFromSlider:function(t){this.setPadding(z.TheoDocumentUtils.sliderToSpacingPaddingMapping(t))},setPadding:function(t){if(this.hasPaddingOptions()){var e=this.targetedLockupStyle;this.targetedLockupStyle!=this.forma.style&&this.targetedLockupStyle.backing==_.LockupBacking.Rows&&this.forma.style.backing==_.LockupBacking.Rows&&(e=this.forma.style);var o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document);o.padding=t,e===this.forma.style?this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document)):(this.targetedLockupStyle.padding=o.padding,this.forma.controller.styleChanged())}},setNextTrackingOption:function(){var t=this.forma.style,e=k.lockupStyleToLockupStyleAttributes(t,this.forma.page.document);e.tracking+=.2,e.tracking>.9&&(e.tracking=0),this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(e,this.forma.style,this.forma.page.document))},setTrackingFromSlider:function(t){var e;if(e=S.as(S.opt(this.forma,(function(t){return t.controller})),Y.TypeLockupController)){var o=e.getCurrentFontSize();this.targetedLockupStyle.tracking=t;var a=S.opt(e.getPin(!0,!0),(function(t){return t.pinPoint}))||q.TheoPoint.ZERO;e.setSizeSliderValue(o,[],a)}},setNextShadowAngle:function(){var t;if(_.LockupStyle.isShadowLook(this.targetedLockupStyle.textLook)){var e=this.forma.style,o=k.lockupStyleToLockupStyleAttributes(e,this.forma.page.document),a=((t=S.indexOf(k.ALLOWED_SHADOWANGLE_VALUES,o.shadowAngle))||null!=t?t:0)+1;a>=k.ALLOWED_SHADOWANGLE_VALUES.length&&(a=0),o.shadowAngle=k.ALLOWED_SHADOWANGLE_VALUES[a],this.forma.applyStyle(k.lockupStyleAttributesToLockupStyle(o,this.forma.style,this.forma.page.document))}},legacyColorConversion:function(){if(null==this.forma)return B.Host.logging.info("forma has been de-alloc'd"),void v.CoreAssert.isTrue(!1,void 0,"LockupStyleController.legacyColorConversion","LockupStyleController.swift",4581);for(var t=this.forma.style,e=[T.ColorRole.FieldPrimary,T.ColorRole.FieldSecondary],o=S.iter(e);!o.done;o.next()){var a=o.value,r=t.colors.color(a),i=t.colors.colorID(a),n=null!=i&&A.ColorLibraryController.keyFromImage(i);if(null!=r&&null==i||n){var l=this.forma.page.colorLibraryController.addUnlinkedColor(r);t.colors.setColorId(a,l)}}},onTrackingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle))&&this._sessionAttrs.setTracking(t.tracking,t.layout)},onSpacingChanged:function(){var t;(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle))&&this._sessionAttrs.setSpacing(t.spacing,t.layout)},onBackingShapeChanged:function(){var t;if(t=S.as(S.opt(this.forma,(function(t){return t.style})),_.LockupStyle)){var e=k.getBackingStringForBackingEnumAndArtworkId(t.backing,t.backingArtworkID);this._sessionAttrs.setBackingShape(e,t.layout,t.pathID)}},onLayoutChanged:function(t){var e=t.layout,o=t.pathID,a=this.forma.style,r=a.layout,i=a.pathID;if(this._sessionAttrs.needsUpdate(e,o,r,i)){var n,l;this._sessionAttrs.setTracking(a.tracking,e),this._sessionAttrs.setSpacing(a.spacing,e),null!=(n=this._sessionAttrs.getTracking(r))&&(a.tracking=n),null!=(l=this._sessionAttrs.getSpacing(r))&&(a.spacing=l);var s=k.getBackingStringForBackingEnumAndArtworkId(a.backing,a.backingArtworkID);this._sessionAttrs.recordInitialBackingShape(s,e,o);for(var c=!1,u=S.iter(this._sessionAttrs.getPotentialBackingShapes(r,i,s));!u.done;u.next()){var h=u.value,g=k.getBackingEnumAndArtworkIdForBackingString(h),p=g.backing,d=g.artworkID;if(N.ShapeLibrary.isBackingShapeStyleCompatible(a,p,d)){a.backing=p,a.backingArtworkID=d,c=!0;break}}c||(a.backing=_.LockupBacking.None,a.backingArtworkID=null)}},endSession:function(){this._sessionAttrs.reset()}}}),f),k.SessionAttrs=(y=function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this.reset()},S.defineClass({name:"SessionAttrs",ctor:y,statics:{TRACKING_KEY:"tracking",SPACING_KEY:"spacing",BACKING_KEY:"backing"},props:{reset:function(){this._attrsDict={},this._hasBackingShapeEntry=!1,this.setTracking(0,_.LockupLayout.Standard),this.setSpacing(.35,_.LockupLayout.Standard),this.setTracking(.35,_.LockupLayout.LetterGrid),this.setSpacing(.35,_.LockupLayout.LetterGrid),this.setTracking(.15,_.LockupLayout.Path),this.setSpacing(.35,_.LockupLayout.Path),this.setTracking(0,_.LockupLayout.Auto),this.setSpacing(.35,_.LockupLayout.Auto)},needsUpdate:function(t,e,o,a){return this.getLayoutClass("",t,e)!=this.getLayoutClass("",o,a)},getTracking:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,t)],"Double")},setTracking:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.TRACKING_KEY,e)]=t},getSpacing:function(t){return S.as(this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,t)],"Double")},setSpacing:function(t,e){this._attrsDict[this.getSessionAttrsKey(y.SPACING_KEY,e)]=t},getBackingShape:function(t,e,o){return void 0===o&&(o=null),S.as(this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)],"String")},setBackingShape:function(t,e,o){void 0===o&&(o=null),this._attrsDict[this.getSessionAttrsKey(y.BACKING_KEY,e,o)]=t,this._hasBackingShapeEntry=!0},recordInitialBackingShape:function(t,e,o){void 0===o&&(o=null),this._hasBackingShapeEntry||this.setBackingShape(t,e,o)},getPotentialBackingShapes:function(t,e,o){void 0===e&&(e=null);for(var a=this,r=[],i=[],n=S.iter(this._attrsDict);!n.done;n.next()){var l=n.key,s=n.value;l.includes(y.BACKING_KEY)&&(S.as(s,"String")==o?r.push(o):i.push(l))}return S.sortInPlace(i,(function(o,r){return a.getBackingShapeKeyDistance(o,t,e)<a.getBackingShapeKeyDistance(r,t,e)})),r.concat(i.map((function(t){return a._attrsDict[t]}),this))},getBackingShapeKeyDistance:function(t,e,o){var a;if(void 0===o&&(o=null),null!=(a=this.extractLayoutClass(y.BACKING_KEY,t))){var r=this.getLayoutClass(y.BACKING_KEY,e,o);return a==r?0:a==k.LayoutClass.PathDefault&&r==k.LayoutClass.PathAsymmetric||a==k.LayoutClass.PathAsymmetric&&r==k.LayoutClass.PathDefault?1:a==k.LayoutClass.Default?2:3+r}return 1e4},getLayoutClass:function(t,e,o){var a;return void 0===o&&(o=null),_.LockupStyle.isLetterGrid(e)?k.LayoutClass.LetterGrid:_.LockupStyle.isAutoLayout(e)?k.LayoutClass.Auto:_.LockupStyle.isPath(e)?t==y.SPACING_KEY||t==y.TRACKING_KEY?k.LayoutClass.PathDefault:X.TextPathLibrary.isPathSymmetric((a=o)||null!=a?a:X.TextPathID.Circle)?k.LayoutClass.PathDefault:k.LayoutClass.PathAsymmetric:k.LayoutClass.Default},extractLayoutClass:function(t,e){if(e.startsWith(t)){var o,a=e.substr(t.length);if(null!=(o=S.toInt(a)))return k.LayoutClass.toCaseValue(o)}return null},getSessionAttrsKey:function(t,e,o){return void 0===o&&(o=null),t+this.getLayoutClass(t,e,o)}}}),y),k.LayoutClass=S.defineEnum("LayoutClass",{Default:0,LetterGrid:1,PathDefault:2,PathAsymmetric:3,Auto:4})},UB0O:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("SpAV"),l=o("cEEQ"),s=o("9kak"),c=o("c+uM"),u=o("GFAD"),h=o("tGKA"),g=o("8t9B"),p=o("3UhB"),d=o("uUew"),f=o("1NAc");r.EvenRowWidthsLayoutStrategy=(a=function(){this.paddingScalar=.6,this.spacingScalar=.75,l.BaseLockupLayoutStrategy.call(this)},i.defineClass({name:"EvenRowWidthsLayoutStrategy",ctor:a,superName:"BaseLockupLayoutStrategy",statics:{getCombinedAspectOfAllRows:function(t,e){for(var o=0,a=i.iter(t);!a.done;a.next())o+=1/a.value.aspectRatio;return e>0?1/(i.toDouble(t.length-1)*(1/e)+o):1/o},getCombinedAspectOfAllRowsFinal:function(t,e){for(var o=0,a=i.iter(t);!a.done;a.next()){var r=a.value,n=r.rowHeightAdjustRatio<1?r.rowHeightAdjustRatio:1;o+=1/r.aspectRatio*(n*n)}return 0!=e?1/(i.toDouble(t.length-1)*(1/e)+o):1/o},getAverageRowAspect:function(t){for(var e=0,o=i.iter(i.range(0,t.length,!1).reversed());!o.done;o.next())e+=t[o.value].aspectRatio;return e/i.toDouble(t.length)},getTallestRowPairIndex:function(t){for(var e=5e3,o=t.length,a=null,r=i.iter(i.range(0,o-1,!1));!r.done;r.next()){var n=r.value,l=t[n];if(l.appendable){var s=t[n+1],c=l.aspectRatio+s.aspectRatio;c<e&&(e=c,a=n)}}return a},aspectDifference:function(t,e){return 1/(1/t-1/e)},aspectStacked:function(t,e){return 1/(1/t+1/e)},mergeRows:function(t,e,o){var a=i.clone(t);n.CoreAssert.isTrue(e<o,void 0,"EvenRowWidthsLayoutStrategy.mergeRows","EvenRowWidthsLayoutStrategy.swift",592);var r=a[e].words.concat(a[o].words),l=new s.LockupRowInfo(i.clone(r),a[o].appendable);return a.splice(o,1),a.splice(e,1),a.splice(e,0,l),a},mergeAutoRows:function(t,e,o,r,n,l){for(var s=i.clone(a.mergeRows(i.clone(t),e,o)),c=l==g.HighlightMethod.EvenRows?0:1,u=0,h=i.iter(i.range(0,s.length,!1));!h.done;h.next()){for(var p=h.value,d=0,f=i.iter(i.range(0,s[p].words.length,!1));!f.done;f.next()){for(var y=f.value;r[u].isNewLine;)u+=1;var k=p%2==c?n[u]:r[u];s[p].words[y]=k,d+=k.aspectRatio,y-1>=0&&(d+=s[p].words[y-1].spaceAspectRatio),u+=1}s[p].aspectRatio=d}return s},compactRowsIntoAspect:function(t,e,o){var r=t.length;if(r<=1)return t;var n=a.getCombinedAspectOfAllRows(i.clone(t),0),l=a.getTallestRowPairIndex(i.clone(t));if(null==l)return t;for(var s=l+1,c=t[l],h=t[s],g=c.aspectRatio,p=h.aspectRatio,d=g+p,f=0,y=0,k=i.iter(i.toSequence(t));!k.done;k.next()){var S=k.value,L=S.offset,m=S.element;f+=m.aspectRatio,L==l?y+=d:L!=s&&(y+=m.aspectRatio)}var C=f/i.toDouble(r),v=y/i.toDouble(r)/o,A=C/o/i.toDouble(r-1),w=v/i.toDouble(r-2),b=a.aspectStacked(a.aspectDifference(n,a.aspectStacked(p,g)),d),R=a.aspectStacked(w,b),D=a.aspectStacked(A,n);if(u.LockupUtils.percentageDiff(e,D)<=u.LockupUtils.percentageDiff(e,R))return t;var T=i.clone(a.mergeRows(i.clone(t),l,s));return a.compactRowsIntoAspect(i.clone(T),e,o)},compactAutoRowsIntoAspect:function(t,e,o,r,n,l){var s=t.length;if(s<=1)return t;var c=a.getCombinedAspectOfAllRows(i.clone(t),0),h=a.getTallestRowPairIndex(i.clone(t));if(null==h)return t;for(var g=h+1,p=t[h],d=t[g],f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=i.iter(i.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var w=S/i.toDouble(s),b=L/i.toDouble(s)/o,R=w/o/i.toDouble(s-1),D=b/i.toDouble(s-2),T=a.aspectStacked(a.aspectDifference(c,a.aspectStacked(y,f)),k),x=a.aspectStacked(D,T),I=a.aspectStacked(R,c);if(u.LockupUtils.percentageDiff(e,I)<=u.LockupUtils.percentageDiff(e,x))return t;var O=i.clone(a.mergeAutoRows(i.clone(t),h,g,i.clone(r),i.clone(n),l));return a.compactAutoRowsIntoAspect(i.clone(O),e,o,i.clone(r),i.clone(n),l)},getOptimalCompactedAutoRows:function(t,e,o,r,n,l){var s=t.length;if(s<=1)return t;var c=a.getCombinedAspectOfAllRows(i.clone(t),0),h=a.getTallestRowPairIndex(i.clone(t));if(null==h)return t;for(var g=h+1,p=t[h],d=t[g],f=p.aspectRatio,y=d.aspectRatio,k=f+y,S=0,L=0,m=i.iter(i.toSequence(t));!m.done;m.next()){var C=m.value,v=C.offset,A=C.element;S+=A.aspectRatio,v==h?L+=k:v!=g&&(L+=A.aspectRatio)}var w=S/i.toDouble(s),b=L/i.toDouble(s)/n,R=w/n/i.toDouble(s-1),D=b/i.toDouble(s-2),T=a.aspectStacked(a.aspectDifference(c,a.aspectStacked(y,f)),k),x=a.aspectStacked(D,T),I=a.aspectStacked(R,c);if(u.LockupUtils.percentageDiff(r,I)<=u.LockupUtils.percentageDiff(r,x))return t;var O=i.clone(a.mergeAutoRows(i.clone(t),h,g,i.clone(e),i.clone(o),l));return a.compactAutoRowsIntoAspect(i.clone(O),r,n,i.clone(e),i.clone(o),l)},_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return t.style.layout==c.LockupLayout.FitJustified},layout:function(t){var e=t.text,o=t.style.font.fontData,r=t.containerSize,s=r.width,u=r.height,y=t.style,k=y.spacing*this.spacingScalar,S=s,L=u,m=S/L,C=i.clone(t.characterStyleRanges);y.alignment!=c.LockupAlignment.UNSET&&n.CoreAssert.warning("Unexpected alignment "+y.alignment+" for fit-justified text");var v=o.allCapsAllowed?e.toUpperCase():e,A=l.getTypographicBoundingRatiosOfString(v,o),w=g.TypeLockupController.HIGHLIGHT_STYLE,b=i.opt(i.opt(y.characterStyles[w],(function(t){return t.font})),(function(t){return t.fontData})),R=p.TypeLockupUtils.getCharFontAdjust(y,A.hasUppercase),D=!1;t.characterStyleRanges.length>0&&null!=y.characterStyles[w]&&-1!=y.characterStyles[w].spacing&&0!=y.characterStyles[w].spacing&&y.characterStyles[w].spacing>1&&((y=t.style.clone()).characterStyles[w].spacing=R,C=i.clone(p.TypeLockupUtils.invertRanges(i.clone(t.characterStyleRanges),e.length)),D=!0,null!=b&&(b=o,o=y.characterStyles[w].font.fontData,y.characterStyles[w].font=y.font));for(var T=i.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,t.forceLetterForma,y.tracking,i.clone(C),i.clone(y.characterStyles),R,t.forceLetterForma)),x=i.clone(this.getUncompactedRows(i.clone(T),!1)),I=i.clone(a.compactRowsIntoAspect(i.clone(x),m,k)),O=0,B=i.iter(T);!B.done;B.next())O+=(ct=B.value).isNewLine?0:1;if(null!=t.rowWordLengths&&t.rowWordLengths.reduce((function(t,e){return t+e}),0)==O&&(!t.allowFewerLineBreaks||I.length>=t.rowWordLengths.length)&&(I=i.clone(this.getPrecomputedRows(i.clone(T),i.clone(t.rowWordLengths)))),T.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=w&&null!=y.characterStyles[w]&&null!=b){var F=i.clone(p.TypeLockupUtils.computeLockupMeasurements(v,o,A.heightRatio,o.allCapsAllowed,!1,y.tracking,i.clone([]),i.clone({}))),E=[new d.TextRange(0,i.chars(e).length)],_=i.clone(p.TypeLockupUtils.computeLockupMeasurements(v,b,A.heightRatio,o.allCapsAllowed,!1,y.tracking,i.clone(E),i.clone(y.characterStyles),R)),P=i.clone(this.getUncompactedAutoRows(i.clone(F),i.clone(_),!1,t.highlightMethod));I=i.clone(a.getOptimalCompactedAutoRows(i.clone(P),i.clone(F),i.clone(_),m,k,t.highlightMethod))}if(0==I.length)return new l.LayoutResults([],new f.TheoSize(0,0),h.Matrix2D.Identity,A,0);var W=a.getAverageRowAspect(i.clone(I)),U=W/k,M=a.getCombinedAspectOfAllRowsFinal(i.clone(I),U);M<m?S=L*M:L=S/M;for(var N=S/U,V=L,H=S,K=0,G=0,z=[],Y=i.iter(i.range(0,I.length,!1));!Y.done;Y.next()){var j=Y.value,q=I[j],X=q.rowHeightAdjustRatio<1?q.rowHeightAdjustRatio:1,J=S/(isFinite(q.aspectRatio)?q.aspectRatio:1)*X,Q=l.getTypographicBoundingRatiosOfString(q.text,o);G=0,X<1&&(G+=(S-q.aspectRatio*J)/2);for(var Z=J/A.heightRatio,$=Z*R,tt=Z*o.capRatio,et=A.textVerticalOffsetRatio,ot=A.heightRatio,at=Q.textVerticalOffsetRatio,rt=et-(ot/2-Q.heightRatio/2)-at,it=p.TypeLockupUtils.getCharFontYAdjust(y,Z,$),nt=(A.textVerticalOffsetRatio-o.capRatio-rt)*Z,lt=K+0,st=i.iter(i.range(0,q.words.length,!1));!st.done;st.next()){var ct,ut=st.value,ht=(ct=q.words[ut]).aspectRatio*J,gt=ct.spaceAspectRatio*J,pt=G,dt=o.allCapsAllowed?ct.text.toUpperCase():ct.text,ft=i.isEmpty(ct.characterStyle)?Z:$,yt=i.isEmpty(ct.characterStyle)||1!=X?0:it,kt=i.isEmpty(ct.characterStyle)?null:ct.characterStyle;D&&(kt=i.isEmpty(ct.characterStyle)?w:null);var St=l.LockupItem.init_e7b2(!0,kt,new f.TheoSize(ht,tt),h.Matrix2D.translationXY(pt,lt+nt+yt),dt,i.isEmpty(ct.characterStyle)?o:b||o,ft,Z,Q,j,ct.rangeInLockup);z.push(St),G+=ht+gt}K+=X<1?$*A.heightRatio+N:J+N}return new l.LayoutResults(i.clone(z),new f.TheoSize(H,V),h.Matrix2D.translationXY(0,0),A,W)},calculateTracking:function(t,e){var o=t.text,r=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=u.spacing*this.spacingScalar,f=c,y=r.allCapsAllowed?o.toUpperCase():o,k=l.getTypographicBoundingRatiosOfString(y,r),S=0,L=g.TypeLockupController.HIGHLIGHT_STYLE,m=i.opt(i.opt(u.characterStyles[L],(function(t){return t.font})),(function(t){return t.fontData})),C=1;null!=m&&(C=k.hasUppercase?r.capRatio/m.capRatio:r.meanRatio/m.meanRatio);var v=i.clone(p.TypeLockupUtils.computeLockupMeasurements(y,r,k.heightRatio,!1,!0,u.tracking,i.clone(t.characterStyleRanges),i.clone(u.characterStyles),C,t.forceLetterForma));if(0==v.length)return t.style.tracking;var A=i.clone(this.getUncompactedRows(i.clone(v),!1)),w=e.width/e.height,b=i.clone(a.compactRowsIntoAspect(i.clone(A),w,h));if(v.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=L&&null!=u.characterStyles[L]&&null!=m){var R=i.clone(p.TypeLockupUtils.computeLockupMeasurements(y,r,k.heightRatio,r.allCapsAllowed,!0,u.tracking,i.clone([]),i.clone({}),void 0,t.forceLetterForma)),D=[new d.TextRange(0,i.chars(o).length)],T=i.clone(p.TypeLockupUtils.computeLockupMeasurements(y,m,k.heightRatio,r.allCapsAllowed,!0,u.tracking,i.clone(D),i.clone(u.characterStyles),C,t.forceLetterForma)),x=i.clone(this.getUncompactedAutoRows(i.clone(R),i.clone(T),!1,t.highlightMethod));b=i.clone(a.getOptimalCompactedAutoRows(i.clone(x),i.clone(R),i.clone(T),w,h,t.highlightMethod))}if(0==b.length)return t.style.tracking;if(u.tracking>0)for(var I=i.iter(i.range(0,b.length,!1));!I.done;I.next()){var O=I.value;b[O].aspectRatio=0;for(var B=i.iter(i.range(0,b[O].words.length,!1));!B.done;B.next()){var F=B.value;b[O].aspectRatio+=b[O].words[F].aspectRatio,b[O].words[F].canBreak&&F!=b[O].words.length-1?(b[O].words[F].spaceAspectRatio=r.spaceWidthRatio/k.heightRatio,b[O].aspectRatio+=b[O].words[F].spaceAspectRatio):b[O].words[F].spaceAspectRatio=0}}var E=a.getAverageRowAspect(i.clone(b))/h,_=f*a.getCombinedAspectOfAllRows(i.clone(b),E)/(isFinite(b[0].aspectRatio)?b[0].aspectRatio:1),P=b[0].aspectRatio*_;if(P<s)if(b[0].words.length<=1)S=0;else{var W=(s-P)/i.toDouble(b[0].words.length-1);S=W<1?0:W/(_/k.heightRatio)}else S=-P;return S},calculateLeading:function(t,e){var o=t.text,r=t.style.font.fontData,n=t.containerSize,s=n.width,c=n.height,u=t.style,h=0,f=r.allCapsAllowed?o.toUpperCase():o,y=l.getTypographicBoundingRatiosOfString(f,r),k=u.tracking,S=g.TypeLockupController.HIGHLIGHT_STYLE,L=i.opt(i.opt(u.characterStyles[S],(function(t){return t.font})),(function(t){return t.fontData})),m=1;null!=L&&(m=y.hasUppercase?r.capRatio/L.capRatio:r.meanRatio/L.meanRatio);var C=i.clone(p.TypeLockupUtils.computeLockupMeasurements(f,r,y.heightRatio,!1,!0,k,i.clone(t.characterStyleRanges),i.clone(u.characterStyles),m,t.forceLetterForma));if(0==C.length)return t.style.spacing;var v=i.clone(this.getUncompactedRows(i.clone(C),!1)),A=e.width,w=e.height,b=A/w,R=i.clone(a.compactRowsIntoAspect(i.clone(v),b,t.style.spacing));if(C.length>1&&(t.highlightMethod==g.HighlightMethod.EvenRows||t.highlightMethod==g.HighlightMethod.OddRows)&&""!=S&&null!=u.characterStyles[S]&&null!=L){var D=i.clone(p.TypeLockupUtils.computeLockupMeasurements(f,r,y.heightRatio,r.allCapsAllowed,!0,u.tracking,i.clone([]),i.clone({}),void 0,t.forceLetterForma)),T=[new d.TextRange(0,i.chars(o).length)],x=i.clone(p.TypeLockupUtils.computeLockupMeasurements(f,L,y.heightRatio,r.allCapsAllowed,!0,u.tracking,i.clone(T),i.clone(u.characterStyles),m,t.forceLetterForma)),I=i.clone(this.getUncompactedAutoRows(i.clone(D),i.clone(x),!1,t.highlightMethod));R=i.clone(a.getOptimalCompactedAutoRows(i.clone(I),i.clone(D),i.clone(x),b,h,t.highlightMethod))}if(R.length<=1)return u.spacing;var O=a.getAverageRowAspect(i.clone(R))/h;if((w=A/a.getCombinedAspectOfAllRows(i.clone(R),O))<c){var B=s/((c-w)/(i.toDouble(R.length)-1));h=R[0].aspectRatio/B/this.spacingScalar}else h=-w;return h},getUncompactedRows:function(t,e){for(var o=[],a=0;a<t.length;){var r=t[a],i=new s.LockupRowInfo;if(r.isNewLine)o.length>0&&(o[o.length-1].appendable=!1);else{if(!e)for(;!r.canBreak&&a<t.length;)i.addWord(r),(a+=1)<t.length&&(r=t[a]);i.addWord(r),o.push(i)}a+=1}return o},getUncompactedAutoRows:function(t,e,o,a){n.CoreAssert.isTrue(t.length==e.length,void 0,"EvenRowWidthsLayoutStrategy.getUncompactedAutoRows","EvenRowWidthsLayoutStrategy.swift",812);for(var r=[],i=0,l=a==g.HighlightMethod.EvenRows?0:1,c=0;c<t.length;){var u=i%2==l?e[c]:t[c],h=new s.LockupRowInfo;if(u.isNewLine)r.length>0&&(r[r.length-1].appendable=!1);else{if(!o)for(;!u.canBreak&&c<t.length;)h.addWord(u),(c+=1)<t.length&&(u=t[c]);h.addWord(u),r.push(h),i+=1}c+=1}return r}}}),a)},VDg0:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("8t9B");r.kOpacityRuleFaintAlpha=.5,r.kOpacityRuleMediumAlpha=.7,r.LockupConfiguration=(a=function(t,e,o,a,r,i,l,s){this.characterStyleRanges=[],this.highlightMethod=n.HighlightMethod.Manual,this.rowWordLengths=null,this.allowFewerLineBreaks=!1,this.preferredFontSize=null,void 0===a&&(a=null),void 0===r&&(r=null),void 0===i&&(i=!1),void 0===l&&(l=!1),void 0===s&&(s=null),this.text=t,this.style=e,this.containerSize=o,this.placement=a,this.parentBounds=r,this.useOptimization=i,this.forceLetterForma=l,this.preferredFontSize=s},i.defineClass({name:"LockupConfiguration",ctor:a}),a)},Zc5V:function(t,e,o){var a,r=e,i=o("oAGj");r.GridArrangementUtils=(a=function(){},i.defineClass({name:"GridArrangementUtils",ctor:a,statics:{MAX_COLS:100,ASPECT_RATIO_EPSILON:.005,getArrangement:function(t,e,o,r){var n=i.max(r),l=t*i.toDouble(o)/i.toDouble(n),s=a.getBestFittingArrangement(l,e,n),c=s.numCols,u=a.evaluateAllSegments(t,e,o,i.clone(r),c),h=u.penalty,g=u.aspectRatioDelta;if(0!=h)for(var p=a.getColumnCountSearchRange(o,c),d=i.iter(i.range(p.start,p.end,!0));!d.done;d.next()){var f=d.value;if(f!=s.numCols){var y=(u=a.evaluateAllSegments(t,e,o,i.clone(r),f)).penalty,k=u.aspectRatioDelta;(y<h||y==h&&k<g)&&(c=f,h=y,g=k)}}return{numRows:a.getNumRows(o,c),numCols:c}},getNumRows:function(t,e){return i.toInt(t/e)+(t%e==0?0:1)},getGridAspectRatio:function(t,e,o){var r=a.getNumRows(e,o);return i.toDouble(o)/i.toDouble(r)*t},getBestFittingArrangement:function(t,e,o,r,n){var l,s;void 0===r&&(r=1),void 0===n&&(n=a.MAX_COLS);var c=Math.min(o,n);if(r<c){l=i.toInt((r+c)/2),s=a.getGridAspectRatio(e,o,l);var u=Math.abs(t-s);if(u>a.ASPECT_RATIO_EPSILON){var h,g=(h=s<t?a.getBestFittingArrangement(t,e,o,l+1,c):a.getBestFittingArrangement(t,e,o,r,l-1)).numCols,p=h.aspectRatio;Math.abs(t-p)<u&&(l=g,s=p)}}else s=a.getGridAspectRatio(e,o,l=r);return{numCols:l,aspectRatio:s}},evaluateAllSegments:function(t,e,o,r,n){for(var l=0,s=0,c=i.iter(r);!c.done;c.next()){var u=c.value;a.evaluateOneSegment(u,n)||(l+=1),s+=1/a.getGridAspectRatio(e,u,n)}return s=1/s,{penalty:l,aspectRatioDelta:Math.abs(t-s)}},evaluateOneSegment:function(t,e){if(t<=e)return!0;var o=t%e;0==o&&(o=e);var r=i.toDouble(o)/i.toDouble(e),n=.5;return e>4&&a.getNumRows(t,e)>2&&(n=.25),r>=n},getColumnCountSearchRange:function(t,e){var o=Math.min(2,i.toInt(t/6));return{start:Math.max(1,e-o),end:Math.min(e+o,t)}}}}),a)},cEEQ:function(t,e,o){var a,r,i,n,l=e,s=o("oAGj"),c=o("SpAV"),u=o("9kak"),h=o("tGKA"),g=o("1NAc");l.LockupItemType=s.defineEnum("LockupItemType",{Text:0,Path:1,Artwork:2}),l.LockupItem=(a=function(){this.isFullCanvas=!1},s.defineClass({name:"LockupItem",ctor:a,props:{init_447b:function(t){this.type=t.type,this.hasPrimaryColor=t.hasPrimaryColor,this.size=t.size,this.placement=t.placement,this.text=t.text,this.font=t.font,this.pointSize=t.pointSize,this.rowPointSize=t.rowPointSize,this.rowIndex=t.rowIndex,this.margins=t.margins,this.typographicBoundingRatios=t.typographicBoundingRatios,this.characterStyle=t.characterStyle,this.rangeInLockup=t.rangeInLockup,this.path=t.path,this.artworkID=t.artworkID,this.preScale=t.preScale,this.isFullCanvas=t.isFullCanvas},init_e7b2:function(t,e,o,a,r,i,n,s,c,u,h,g){void 0===g&&(g=null),this.type=l.LockupItemType.Text,this.hasPrimaryColor=t,this.characterStyle=e,this.size=o,this.placement=a,this.text=r,this.font=i,this.pointSize=n,this.rowPointSize=s,this.typographicBoundingRatios=c,this.rowIndex=u,this.rangeInLockup=h,this.margins=g},init_708e:function(t,e,o,a,r,i,n){void 0===r&&(r=null),void 0===i&&(i=!1),void 0===n&&(n=null),this.type=l.LockupItemType.Path,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.path=a,this.rowIndex=r,this.isFullCanvas=i,this.characterStyle=n},init_9cc6:function(t,e,o,a,r,i,n){void 0===i&&(i=null),void 0===n&&(n=null),this.type=l.LockupItemType.Artwork,this.hasPrimaryColor=t,this.size=e,this.placement=o,this.artworkID=a,this.preScale=r,this.rowIndex=i,this.characterStyle=n},clone:function(){return a.init_447b(this)}}}),a),l.descenderCharacters="gjqpyQ",l.shortCharacters=" qweryuopasg;zxcvnm,.*-~",l.tallSpecialsThatAreNotCaps="!^'",l.TypographicBoundingRatios=(r=function(t,e,o,a,r,i){this.sideInsetRatio=t,this.textVerticalOffsetRatio=e,this.backingVerticalOffsetRatio=o,this.heightRatio=a,this.heightFromBaselineRatio=r,this.hasUppercase=i},s.defineClass({name:"TypographicBoundingRatios",ctor:r}),r),l.getTypographicBoundingRatiosOfString=function(t,e,o){void 0===o&&(o=!0);for(var a=t.split("\n").join(),r=!1,i=!1,n=!1,c=!1,u=!1,h=!1,g=!1,p=!1,d=!1,f=e.meanRatio,y=0,k=0,S=0,L=0,m=0,C=0,v=s.iter(s.chars(a));!v.done;v.next()){var A=v.value,w=!1,b=!1;" "!=A&&(k+=1,w||null==e.upperCaseCharsDict[A]?b||null==e.lowerCaseCharsDict[A]||(b=!0):w=!0,!r&&w?r=!0:!i&&b&&(i=!0),null!=e.meanCharsDict[A]?S+=e.meanRatio:null!=e.capCharsDict[A]?(u=!0,S+=e.capRatio):null!=e.ascentCharsDict[A]?(c=!0,S+=e.ascentRatio):null!=e.meanAccentCharsDict[A]?(h=!0,S+=e.meanAccentRatio):null!=e.capAccentCharsDict[A]?(n=!0,S+=e.capAccentRatio):(u=!0,S+=e.capRatio),w&&(k+=1,S+=e.capRatio),w||b||""==A||""==A||""==A||(d=!0),null!=e.tailCharsDict[A]?(g=!0,L+=e.tailRatio):null!=e.descentCharsDict[A]&&(p=!0,L+=e.descentRatio))}if(d&&(f=1),n&&(f=Math.max(f,e.capAccentRatio)),c&&(f=Math.max(f,e.ascentRatio)),u&&(f=Math.max(f,e.capRatio)),h&&(f=Math.max(f,e.meanAccentRatio)),g&&(y=Math.max(y,e.tailRatio)),p&&(y=Math.max(y,e.descentRatio)),k>0&&(m=S/k,C=L/k),o){var R=f-(r?e.capRatio:e.meanRatio);m=f+=Math.max(0,y-R),C=y}var D=y/2,T=e.baselineOffsetRatio+f,x=.8*(f-m-y+C),I=f+y;return new l.TypographicBoundingRatios(D,T,x,I,f,r)},l.LayoutResults=(i=function(t,e,o,a,r){for(var i=0,n=0,c=0,u=1e5,h=0,g=0,p=0,d={},f=s.iter(t);!f.done;f.next()){var y=f.value;y.type==l.LockupItemType.Text&&(i+=y.size.height,n+=y.pointSize,c+=1,y.rowIndex<u&&(u=y.rowIndex),y.rowIndex>h&&(h=y.rowIndex),null==d[y.rowIndex]&&(g+=y.pointSize,d[y.rowIndex]=!0),y.pointSize>p&&(p=y.pointSize))}this.items=s.clone(t),this.size=e,this.placement=o,this.numberOfLines=h<u?0:h-u+1,this.avgLinePointSize=g/s.toDouble(this.numberOfLines),this.avgTextItemHeight=i/c,this.avgTextPointSize=n/c,this.largestPointSize=p,this.typographicBoundingRatios=a,this.avgRowAspect=r},s.defineClass({name:"LayoutResults",ctor:i,props:{flipForRightToLeft:function(){for(var t=this.size.width,e=[],o=s.iter(this.items);!o.done;o.next()){var a=o.value;a.placement=h.Matrix2D.scalingXY(-1,1).translateXY(a.size.width,0).concat(a.placement.scaleXY(-1,1)).translateXY(t,0),e.splice(0,0,a)}this.items=s.clone(e)}}}),i),l.LockupLayoutStrategy=s.defineProtocol("LockupLayoutStrategy",{supportsConfiguration:"(LockupConfiguration) -> Boolean",layout:"(LockupConfiguration) -> LayoutResults",reflow:"(TheoSize, LockupConfiguration, LayoutResults) -> LayoutResults",calculateTracking:"(LockupConfiguration, TheoSize) -> Double",calculateLeading:"(LockupConfiguration, TheoSize) -> Double",adjustHeightForLeading:"(TheoRect, LayoutResults, Double, Double) -> Double",adjustWidthForTracking:"(String, LayoutResults, Double, Double) -> Double"}),l.LockupLayoutStrategyFactory=s.defineProtocol("LockupLayoutStrategyFactory",{supportsConfiguration:"(LockupConfiguration) -> Boolean",createForConfiguration:"(LockupConfiguration) -> LockupLayoutStrategy"}),l.BaseLockupLayoutStrategy=(n=function(){},s.defineClass({name:"BaseLockupLayoutStrategy",ctor:n,statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return c.CoreAssert.fail("Implement in subclass","BaseLockupLayoutStrategy.supportsConfiguration","LockupLayoutStrategy.swift",480),!1},layout:function(t){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.layout","LockupLayoutStrategy.swift",485),new l.LayoutResults([],new g.TheoSize(0,0),h.Matrix2D.Identity,new l.TypographicBoundingRatios(0,1,0,1,1,!1),0)},reflow:function(t,e,o){return null},calculateTracking:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateTracking","LockupLayoutStrategy.swift",511),0},calculateLeading:function(t,e){return c.CoreAssert.fail("implement in subclass","BaseLockupLayoutStrategy.calculateLeading","LockupLayoutStrategy.swift",518),0},adjustHeightForLeading:function(t,e,o,a){var r=a-o;return s.toDouble(e.numberOfLines-1)*(t.width/e.avgRowAspect)*(.75*r)},adjustWidthForTracking:function(t,e,o,a){var r=0,i=a-o;if(0!=i){for(var n=-1,l=0,c=0,u=0,h=0,g=t,p=s.iter(e.items);!p.done;p.next()){var d=p.value;d.rowIndex!=n?(u>h&&(h=u,r=l),c=d.placement.tx,l=0):l+=i*d.pointSize,l+=i*d.pointSize*s.toDouble(d.text.length-1),u=d.placement.tx+d.size.width-c,d.rangeInLockup.start>0&&" "==g.substr(d.rangeInLockup.start-1,1)&&c!=d.placement.tx&&(a<0?l-=i*d.pointSize:l+=i*d.pointSize),n=d.rowIndex}u>h&&(h=u,r=l)}return r},getPrecomputedRows:function(t,e){var o=[];if(0==t.length||0==e.length)return o;for(var a=new u.LockupRowInfo,r=0,i=0,n=s.iter(t);!n.done;n.next()){var l=n.value;l.isNewLine||(i>=e[r]&&(o.push(a),a=new u.LockupRowInfo,r+=1,i=0),a.addWord(l),i+=1)}return o.push(a),o}}}),n)},d3iY:function(t,e,o){var a,r,i=e,n=o("oAGj"),l=o("Zc5V"),s=o("iCxV"),c=o("cEEQ"),u=o("9kak"),h=o("c+uM"),g=o("KdeS"),p=o("tGKA"),d=o("8t9B"),f=o("3UhB"),y=o("uUew"),k=o("1NAc");i.LetterGridLayoutStrategy=(a=function(){this.trackingScalar=3,this.spacingScalar=3,c.BaseLockupLayoutStrategy.call(this)},n.defineClass({name:"LetterGridLayoutStrategy",ctor:a,superName:"BaseLockupLayoutStrategy",statics:{_implements:function(t){return"LockupLayoutStrategy"==t}},props:{supportsConfiguration:function(t){return h.LockupStyle.isLetterGrid(t.style.layout)},layout:function(t){var e=[],o=0,a=0,r=0,i=this.getWireframeLayout(t),l=i.typographicBoundingRatios,s=n.clone(i.rows);if(0==!s.length){var u,h,g,y,S=i.horizontalPaddingRatio,L=i.verticalPaddingRatio,m=this.getCombinedAspectRatio(n.clone(s),S,L),C=t.style,v=i.font;null!=(y=t.preferredFontSize)?(h=(u=y)*l.heightRatio,g=(a=(o=i.constraintWidth)/m)/n.toDouble(s.length)):(m<i.constraintAspectRatio?(a=i.constraintHeight,o=i.constraintHeight*m):(o=i.constraintWidth,a=i.constraintWidth/m),u=(h=(g=a/n.toDouble(s.length))/(1+L))/l.heightRatio);var A=L*h,w=S*h;i.charFontAdjustRatio>1&&(u/=i.charFontAdjustRatio);for(var b=u*v.capRatio,R=u*l.textVerticalOffsetRatio-b,D=n.opt(n.opt(C.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||v,T=u*i.charFontAdjustRatio,x=f.TypeLockupUtils.getCharFontYAdjust(C,u,T),I=A/2+R,O=n.iter(n.toSequence(s));!O.done;O.next()){var B=O.value,F=B.offset,E=B.element;if(0==!E.words.length)for(var _=n.first(E.words).aspectRatio*h,P=_+w,W=w/2+E.colOffsetLeft*P,U=n.iter(E.words);!U.done;U.next()){var M=U.value,N=M.characterStyle,V=N==d.TypeLockupController.HIGHLIGHT_STYLE,H=V?D:v,K=V?T:u,G=M.relativeMargins.multiply(h),z=G.width,Y=W+z,j=I+(V?x:0),q=c.LockupItem.init_e7b2(!0,N,new k.TheoSize(_-2*z,b),p.Matrix2D.translationXY(Y,j),M.text,H,K,u,l,F,M.rangeInLockup,G);e.push(q),W+=P}I+=g}r=this.getWidestRowAndAspectRatio(n.clone(s),S,L).aspectRatio}return new c.LayoutResults(n.clone(e),new k.TheoSize(o,a),p.Matrix2D.Identity,l,r)},getCharacterStyle:function(t,e,o){for(var a=n.iter(t);!a.done;a.next()){var r=a.value;if(e>=r.start&&e<r.end)return d.TypeLockupController.HIGHLIGHT_STYLE}return""},getWireframeLayout:function(t,e){var o;void 0===e&&(e=null);for(var a=t.text.toUpperCase(),r=t.style,h=r.alignment,p=t.containerSize,S=(e||p).width,L=(e||p).height,m=S/L,C=r.spacing*this.spacingScalar,v=r.tracking*this.trackingScalar,A=r.font.fontData,w=c.getTypographicBoundingRatiosOfString(a,A,!1),b=0,R=0,D=[],T=(o=t.preferredFontSize)||null!=o?o:32,x=n.opt(n.opt(r.characterStyles[d.TypeLockupController.HIGHLIGHT_STYLE],(function(t){return t.font})),(function(t){return t.fontData}))||A,I=f.TypeLockupUtils.getCharFontAdjust(r,w.hasUppercase,!1),O=T*I,B=[],F=n.iter(n.toSequence(n.chars(a)));!F.done;F.next()){var E=F.value,_=E.offset,P=E.element,W=n.toString(P);if(f.TypeLockupUtils.isWhiteSpace(W)){if("\n"==W){var U=R;R=_-b,D.push(R-U)}b+=1}var M=this.getCharacterStyle(n.clone(t.characterStyleRanges),_,_+1)==d.TypeLockupController.HIGHLIGHT_STYLE,N=M?x:A,V=M?O:T,H=s.Host.textModelUtils.measureInkBounds(W,N,V);B.push(H.width)}var K=B.length-b;D.push(K-R);var G,z=Math.max(T,O)*w.heightRatio,Y=n.max(B)/z,j=(Y+v)/(1+C);G=null!=t.preferredFontSize?n.toInt(Math.floor(S/(n.max(B)+v*z))):l.GridArrangementUtils.getArrangement(m,j,K,n.clone(D)).numCols;for(var q=new u.LockupRowInfo,X=[],J=(_=0,n.iter(n.chars(a)));!J.done;J.next()){if(P=J.value,W=n.toString(P),f.TypeLockupUtils.isWhiteSpace(W))"\n"==P&&(this.commitRow(X,q,G,h),q=new u.LockupRowInfo);else{W=n.toString(P);var Q=(Y-B[_]/z)/2,Z=new g.LockupWordInfo(W,Y,0,this.getCharacterStyle(n.clone(t.characterStyleRanges),_,_+1),1,!1,!0,new y.TextRange(_,_+1),new k.TheoSize(Q,0));q.words.length==G&&(this.commitRow(X,q,G,h),q=new u.LockupRowInfo),q.addWord(Z)}_+=1}return this.commitRow(X,q,G,h),i.WireframeLayout.init_c604(A,w,I,S,L,m,v,C,n.clone(X),G)},commitRow:function(t,e,o,a){var r=n.toDouble(o-e.words.length);a==h.LockupAlignment.Right?e.colOffsetLeft=r:a==h.LockupAlignment.Center&&(e.colOffsetLeft=r/2,e.colOffsetRight=r/2),t.push(e)},calculateTracking:function(t,e){var o=this.getWireframeLayout(t,e),a=n.clone(o.rows);if(0==a.length)return t.style.tracking;var r=this.getCombinedAspectRatio(n.clone(a),0,o.verticalPaddingRatio),i=o.constraintHeight*r,l=t.containerSize.width;if(i<l){var s=n.toDouble(a.length);return(l-i)/n.toDouble(o.numCols)/(o.constraintHeight/s/(1+o.verticalPaddingRatio))/this.trackingScalar}return-i},calculateLeading:function(t,e){var o=this.getWireframeLayout(t,e),a=n.clone(o.rows);if(0==a.length)return t.style.spacing;var r=this.getCombinedAspectRatio(n.clone(a),o.horizontalPaddingRatio,0),i=o.constraintWidth/r,l=t.containerSize.height;if(i<l){var s=n.toDouble(a.length),c=i/s;return(l/s-c)/c/this.spacingScalar}return-i},adjustHeightForLeading:function(t,e,o,a){if(0==!e.items.length){var r=a-o,i=n.first(e.items);return n.toDouble(e.numberOfLines)*i.rowPointSize*i.typographicBoundingRatios.heightRatio*r*this.spacingScalar}return 0},adjustWidthForTracking:function(t,e,o,a){var r=this.getNumColsInLayout(e);if(r>0){var i=a-o,l=n.first(e.items);return l.rowPointSize*l.typographicBoundingRatios.heightRatio*i*this.trackingScalar*n.toDouble(r)}return 0},getNumColsInLayout:function(t){for(var e=0,o=0,a=-1,r=n.iter(t.items);!r.done;r.next()){var i=r.value;a!=i.rowIndex?(a=i.rowIndex,o=1):o+=1,e=Math.max(e,o)}return e},calculateRowAspectRatio:function(t,e,o,a){var r=n.toDouble(t.words.length),i=r+n.toDouble(a),l=t.aspectRatio*i/r;return(l+=i*e)/(1+o)},getWidestRowAndAspectRatio:function(t,e,o){for(var a,r=0,i=n.iter(t);!i.done;i.next()){var l=i.value,s=this.calculateRowAspectRatio(l,e,o,n.toInt(l.colOffsetLeft+l.colOffsetRight));s>r&&(a=l,r=s)}return{row:a,aspectRatio:r}},getCombinedAspectRatio:function(t,e,o){return this.getWidestRowAndAspectRatio(n.clone(t),e,o).aspectRatio/n.toDouble(t.length)}}}),a),i.WireframeLayout=(r=function(){},n.defineClass({name:"WireframeLayout",ctor:r,props:{init_c604:function(t,e,o,a,r,i,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=a,this.constraintHeight=r,this.constraintAspectRatio=i,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u},init_implicit:function(t,e,o,a,r,i,l,s,c,u){this.font=t,this.typographicBoundingRatios=e,this.charFontAdjustRatio=o,this.constraintWidth=a,this.constraintHeight=r,this.constraintAspectRatio=i,this.horizontalPaddingRatio=l,this.verticalPaddingRatio=s,this.rows=n.clone(c),this.numCols=u}}}),r)},fGVU:function(t,e,o){var a,r=e,i=o("oAGj"),n=o("NkBu"),l=o("RkYL"),s=o("sW6f"),c=o("zjod");r.VideoController=(a=function(t,e,o){n.ImageController.call(this,t,e,o)},i.defineClass({name:"VideoController",ctor:a,superName:"ImageController",statics:{KIND:{get:function(){return"video"}}},props:{replaceable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},canMultiSelect:{get:function(){return!1}},contentNode:{get:function(){var t=i.opt(i.as(this.forma,c.VideoForma),(function(t){return t.videoContentID}));return null==t?null:i.as(i.opt(i.opt(this.forma,(function(t){return t.page.document})),(function(e){return e.content.nodeByID(t)})),s.VideoContentNode)}},videoDuration:{get:function(){return i.opt(this.contentNode,(function(t){return t.duration}))||l.TheoTime.Zero}}}}),a)}}]);
//# sourceMappingURL=vendors_npm_spark_eed0fd33-dcb862f0.js.map
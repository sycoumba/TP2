(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[36],{"5YbD":function(t,e,n){n("oAGj")},DjTP:function(t,e,n){var r,o,i=e,a=n("oAGj"),l=n("cZuM"),s=n("SpAV"),u=n("gXiO"),c=n("FNB+"),h=n("iCxV"),m=n("fdtz"),f=n("c+uM"),p=n("tGKA"),g=n("8t9B"),d=n("ThKb"),v=n("oKlP"),C=n("sIWg"),S=n("1NAc"),y=n("zjY7");i.SpringConstraint=(r=function(t,e,n,r,o,i,a){this.nodeA=t,this.nodeB=e,this.pinA=n,this.pinB=r,this.vertical=o,this.length=i,this.stiffness=a,this.oldLengthDebug=0,this.oldStiffnessDebug=0,this.proportional=!1},a.defineClass({name:"SpringConstraint",ctor:r}),r),i.SpringLayoutController=(o=function(t){this.parentNode_=null,this.springConstraints_={},this.debugPrint_=!1,this.STRONG_STIFF=9e4,this.STRUT_STIFF=9e7,this.ITERATION_STEP_SIZE=50,this.SPACER_UPDATE_THRESHOLD=50,this.LOGISTIC_L_SCALE=1e3,this.LOGISTIC_K_SCALE=.01,this.LOGISTIC_X_SCALE=100,this.LOGISTIC_B_SCALE=1,this.SPACER_LOGISTIC_L=.5,this.SPACER_LOGISTIC_K=1,this.SPACER_LOGISTIC_X=0,this.SPACER_LOGISTIC_B=10,this.NODE_LOGISTIC_L=1,this.NODE_LOGISTIC_K=.5,this.NODE_LOGISTIC_X=0,this.NODE_LOGISTIC_B=1,this.group_=t,u.CoreObject.call(this)},a.defineClass({name:"SpringLayoutController",ctor:o,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,null!=this.oldBounds_){var t=a.clone(this.group_.filterWithCallback((function(t){return null!=t.controller&&!t.isGridCell()&&t.kind!=m.ImageForma.KIND&&t.frame.area>1}),c.FormaTraversal.JustChildren));this.parentNode_=new y.VisualStructureDetector(a.clone(t),this.group_).inferVisualStructure();for(var e=a.iter(this.group_.filterWithCallback((function(t){return t.isTypeLockup()})));!e.done;e.next()){var n,r=e.value;(n=a.as(r.controller,g.TypeLockupController))&&n.addLineBreakConstraints()}}},endUpdateGroup:function(){for(var t=a.iter(this.group_.filterWithCallback((function(t){return t.isTypeLockup()})));!t.done;t.next()){var e,n=t.value;(e=a.as(n.controller,g.TypeLockupController))&&e.removeLineBreakConstraints()}},updateGroup:function(){var t,e,n;(t=this.oldBounds_)&&(e=this.group_.bounds)&&(n=this.solveSpringSystem(t,e))&&this.updateFormaFromStructure(n)},solveSpringSystem:function(t,e){if(null==this.parentNode_)return null;var n={};n[this.parentNode_.id]=this.parentNode_;for(var r=a.iter(this.parentNode_.descendents);!r.done;r.next()){var o=r.value;n[o.id]=o}var i=this.parentNode_.clone();this.createSpringConstraints(i),this.updateAllConstraints(i,!1);var l=[i];a.append(l,i.descendents);for(var u=a.clone(this.getForegroundLeafs(i)),c=i.frame.scaleXY(e.width/t.width,e.height/t.height,v.TheoPoint.ZERO),h=a.toInt(Math.ceil(Math.max(Math.abs(c.height-i.frame.height),Math.abs(c.width-i.frame.width))/this.ITERATION_STEP_SIZE)+1),m=a.iter(a.range(0,h,!1));!m.done;m.next()){var f=m.value;this.debugPrint_&&(a.info("\n-----------------\niteration: "+f+"\n"),this.printNodes(i),a.info("\n")),i.frame=c;for(var p=f>=h-1,g=a.iter(l);!g.done;g.next()){var d,S,F,b=g.value;if((d=b.frame)&&(S=a.as(b,y.VisualNodeGroup))&&(F=this.springConstraints_[S.id])){s.CoreAssert.isTrue(null!=n[b.origNode.id],void 0,"SpringLayoutController.solveSpringSystem","SpringLayoutController.swift",180),this.debugPrint_&&a.info("node:"+b.description+" oldFrame: "+n[b.origNode.id].frame.asIntString);for(var A=a.iter(F);!A.done;A.next()){var T=A.value,_=T[0].vertical,D=_?d.height:d.width,x=_?S.frame.minY:S.frame.minX,P=this.adjustSpringSet(a.clone(T),D,x,p,i);S.frame=_?new C.TheoRect(d.minX,d.minY,d.maxX,d.minY+P):new C.TheoRect(d.minX,d.minY,d.minX+P,d.maxY),this.setSpringStiffnesses(S,a.clone(T),a.clone(u),this.debugPrint_),this.adjustSpringsToMatchOldSize(a.clone(T),a.clone(n))&&this.setSpringStiffnesses(S,a.clone(T),a.clone(u))}}}}return this.debugPrint_&&(a.info("\n -----------------------------\n  after resize: "),this.printNodes(i)),i},adjustSpringSet:function(t,e,n,r,o){if(t.length<1)return 0;for(var i=t[0].vertical,l=0,s=0,u=a.iter(t);!u.done;u.next())l+=(S=u.value).length,s+=1/((S.proportional?1:S.stiffness)*(e/S.length));var c=e-l,m=1/s,f=c;Math.abs(c)>this.ITERATION_STEP_SIZE&&!r&&(f=c<0?-1*this.ITERATION_STEP_SIZE:this.ITERATION_STEP_SIZE);var g=m*f;this.debugPrint_&&a.info("  constraint set: "+(i?"vert":"horiz")+"  desiredL "+Math.round(e)+" currL "+Math.round(l)+" totalD "+Math.round(c)+"  currD "+Math.round(f));for(var d=0,v=a.iter(a.range(0,t.length,!1));!v.done;v.next()){var S,y=v.value;(S=t[y]).oldLengthDebug=S.length,S.oldStiffnessDebug=S.stiffness;var F=g/((S.proportional?1:S.stiffness)*(e/S.length));isNaN(F)&&(a.opt(h.Host.logging,(function(t){return t.error("nan update")})),F=0);var b=Math.max(0,S.length+F);if(S.nodeA==S.nodeB){var A=S.nodeA,T=A.frame.aspectRatio,_=n+d;if(A.frame=i?new C.TheoRect(A.frame.minX,_,A.frame.maxX,_+b):new C.TheoRect(_,A.frame.minY,_+b,A.frame.maxY),A.maintainAspectRatio&&!S.proportional&&A.parent!=o){var D=C.TheoRect.fromSize(A.frame.fitAspectRatioWithin(T));if(D.height>15){var x=this.getParentChildPin(A.frame,A.parent.frame),P=p.Matrix2D.translation(A.frame.eval(x).subtract(D.eval(x)));D=D.transform(P);var w=i?A.frame.height-D.height:A.frame.width-D.width;A.frame=D;var I=S.vertical?x.y:x.x;.5==I?(t[y-1].length+=w/2,t[y+1].length+=w/2):0==I?t[y+1].length+=w:1==I&&(t[y-1].length+=w),b=i?D.height:D.width}}}S.length=b,d+=b}return d},adjustSpringsToMatchOldSize:function(t,e){for(var n=!1,r=a.iter(a.range(1,t.length-1,!1));!r.done;r.next()){var o=r.value,i=t[o];if(i.nodeA==i.nodeB&&!i.proportional){var l=i.nodeA,s=e[l.origNode.id].frame,u=l.frame;if(s.area-u.area>0){var c=t[o-1],h=t[o+1],m=.2*Math.max(c.length,h.length);if(m<10)continue;var f=i.vertical?u.height:u.width,p=s.area/(i.vertical?u.width:u.height)-f;Math.abs(p)>m&&(p=p<0?-1*m:m);var g=1/(1/c.stiffness+1/i.stiffness+1/h.stiffness)*p,d=g/c.stiffness,v=c.length;c.length-d>this.SPACER_UPDATE_THRESHOLD&&(c.length=Math.max(1e-4,c.length-d));var C=g/h.stiffness,S=h.length;h.length-C>this.SPACER_UPDATE_THRESHOLD&&(h.length=Math.max(1e-4,h.length-C));var y=i.length;i.length=i.length+(v-c.length)+(S-h.length),n=n||Math.abs(y-i.length)>0}}}return n},createSpringConstraints:function(t){this.springConstraints_={};for(var e=a.clone(this.getForegroundLeafs(t)),n=[t];n.length>0;){var r,o=n[0];n.splice(0,1),(r=a.as(o,y.VisualNodeGroup))&&(this.springConstraints_[r.id]=this.createSpringConstraintsForGroup(r,!1,a.clone(e)).concat(this.createSpringConstraintsForGroup(r,!0,a.clone(e))),n=r.children.concat(n))}},updateAllConstraints:function(t,e){void 0===t&&(t=null),void 0===e&&(e=!1);for(var n=null!=t?t:this.parentNode_,r=[n],o=a.clone(this.getForegroundLeafs(n));r.length>0;){var i,l,s=r[0];if(r.splice(0,1),(i=a.as(s,y.VisualNodeGroup))&&(l=this.springConstraints_[i.id])){for(var u=a.iter(l);!u.done;u.next()){var c=u.value;this.setSpringStiffnesses(i,a.clone(c),a.clone(o),e)}r=i.children.concat(r)}}},printNodes:function(t){for(var e=[t],n=[];e.length>0;){var r,o=e[0];if(e.splice(0,1),(C=a.as(o,y.VisualNodeGroup))&&(r=this.springConstraints_[C.id])){for(var i=a.iter(r);!i.done;i.next())for(var l=i.value,s=a.iter(l);!s.done;s.next()){var u=s.value;if(u.nodeA==u.nodeB){var c=this.getNodeStiffness(u.nodeA,u.vertical);n.push({node:u.nodeA,vertical:u.vertical,stiffness:c})}}e=C.children.concat(e)}}for(var h=[],m={},f=a.iter(n);!f.done;f.next())if(c=f.value,!h.includes(c.node)){for(var p="",g=(o=c.node).parent;null!=g;)g=a.opt(g,(function(t){return t.parent})),p+="\t";p+="node: "+o.description;for(var d=a.iter(n);!d.done;d.next()){var v=d.value;v.node==o&&(p+=(v.vertical?" v: ":" h: ")+a.toString(Math.round(v.stiffness)))}m[o.shortID]=p,h.push(o)}for(e=[t];e.length>0;){var C,S;o=e[0],e.splice(0,1),(C=a.as(o,y.VisualNodeGroup))&&(e=C.children.concat(e)),this.debugPrint_&&null!=(S=m[o.shortID])&&a.info(S)}},setConstraintsOnNode:function(t,e,n,r,o){var i,l=o?t.frame.minY:t.frame.minX,s=(o?t.frame.maxY:t.frame.maxX)-l,u=o?e.frame.minY:e.frame.minX,c=(o?e.frame.maxY:e.frame.maxX)-u,h=!1,m=!1,f=!1;n<.1*s&&(h=!0),r<.1*s&&(m=!0),(i=a.as(e,y.VisualNodeLeaf))&&(i.forma.isTypeLockup()?c>.66*s&&(h=!0,m=!0):Math.abs(n-r)<=1&&n<.25*s&&(h=!0,m=!0)),h&&m||(f=!0),o?(e.constraintBottom=h,e.constraintTop=m,e.constraintHeight=f):(e.constraintLeft=h,e.constraintRight=m,e.constraintWidth=f)},getContextualSpacerLength:function(t,e,n){var r,o=t.vertical,i=t.nodeA==e?t.nodeB:t.nodeA,l=t.length,u=!1,c=[];null!=(f=a.as(i,y.VisualNodeLeaf))&&(u=f.hasForegroundRole,c=[f]),(r=a.as(i,y.VisualNodeGroup))&&(u=(c=a.clone(this.getForegroundLeafs(r))).length>0);for(var h=n.concat(),m=a.iter(c);!m.done;m.next()){var f=m.value;h.includes(f)&&a.remove(h,f)}if(u){var p=C.TheoRect.Zero;if(o){var g=t.nodeA.frame.horizontalLine(t.pinA).p1.y,d=t.nodeB.frame.horizontalLine(t.pinB).p1.y;p=new C.TheoRect(i.frame.minX,g,i.frame.maxX,d)}else{var v=t.nodeA.frame.verticalLine(t.pinA).p1.x,S=t.nodeB.frame.verticalLine(t.pinB).p1.x;p=new C.TheoRect(v,i.frame.minY,S,i.frame.maxY)}for(var F=a.iter(h);!F.done;F.next()){f=F.value,s.CoreAssert.isTrue(i!=f,void 0,"SpringLayoutController.getContextualSpacerLength","SpringLayoutController.swift",682);for(var b,A=!1,T=a.iter(c);!T.done;T.next()){var _=T.value;(f.forma.finalFrame.xDistance(_.forma.finalFrame)<=0&&!o||f.forma.finalFrame.yDistance(_.forma.finalFrame)<=0&&o)&&(A=!0)}A||(b=a.opt(f.frame,(function(t){return t.intersectionWith(p)})))&&(l=Math.min(l,b.L1Distance(i.frame)))}}return l},setSpringStiffnesses:function(t,e,n,r){if(void 0===r&&(r=!1),0!=e.length){var o=e[0].vertical,i=o?t.frame.minY:t.frame.minX,l=(o?t.frame.maxY:t.frame.maxX)-i;if(3==e.length){s.CoreAssert.isTrue(e[1].nodeA==e[1].nodeB,void 0,"SpringLayoutController.setSpringStiffnesses","SpringLayoutController.swift",720);var u=e[1].nodeA,c=this.getContextualSpacerLength(e[0],t,a.clone(n)),m=this.getContextualSpacerLength(e[2],t,a.clone(n));u.resetConstraints(o),u instanceof y.VisualNodeLeaf&&this.setConstraintsOnNode(t,u,c,m,o);var f=o?u.constraintBottom:u.constraintLeft,p=o?u.constraintHeight:u.constraintWidth,g=o?u.constraintTop:u.constraintRight;e[0].stiffness=f?this.STRONG_STIFF:this.getSpacerStiffness(c,l,o),e[1].stiffness=p?this.STRONG_STIFF:this.getNodeStiffness(u,o),e[2].stiffness=g?this.STRONG_STIFF:this.getSpacerStiffness(m,l,o),(0==e[0].stiffness||isNaN(e[0].stiffness)||0==e[1].stiffness||isNaN(e[1].stiffness)||0==e[2].stiffness||isNaN(e[2].stiffness))&&a.opt(h.Host.logging,(function(t){return t.error("error in spring stiffness")}))}else for(var d=a.iter(e);!d.done;d.next())(F=d.value).nodeA==F.nodeB?F.stiffness=this.getNodeStiffness(F.nodeA,F.vertical):F.stiffness=this.getSpacerStiffness(F.length,l,F.vertical),(0==F.stiffness||isNaN(F.stiffness))&&a.opt(h.Host.logging,(function(t){return t.error("error in spring stiffness")}));for(var v=a.iter(e);!v.done;v.next())(F=v.value).length<1&&(F.stiffness=this.STRUT_STIFF);for(var C=!1,S=a.iter(e);!S.done;S.next()){var F=S.value;Math.abs(F.oldLengthDebug-F.length)>1&&(C=r)}if(C)for(var b=a.iter(e);!b.done;b.next()){var A=b.value,T=A.vertical?"vert":"horiz";a.info("\t A:"+A.nodeA.shortID+" B:"+A.nodeB.shortID+" "+T+" oldK:"+Math.round(A.oldStiffnessDebug)+"  newK:"+Math.round(A.stiffness)+" oldL:"+Math.round(A.oldLengthDebug)+"  newL:"+Math.round(A.length)+"  ")}}},createFlowSpringConstraints:function(t,e){s.CoreAssert.isTrue(t.children.length>1,void 0,"SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",806);var n=e?t.frame.minY:t.frame.minX,r=e?t.frame.maxY:t.frame.maxX,o=r-n,l=a.sort(t.children,(function(t,n){return e?t.frame.minY<n.frame.minY:t.frame.minX<n.frame.minX})),u=[],c=e?l[0].frame.minY:l[0].frame.minX,h=(F=e?l[l.length-1].frame.maxY:l[l.length-1].frame.maxX)-c,m=Math.max(c-n,0),f=Math.max(r-F,0),p=Math.max(n-c,0)/h,g=Math.max(F-r,0)/h;u.push(new i.SpringConstraint(t,l[0],0,p,e,m,this.getSpacerStiffness(m,o,e)));for(var d=!1,v=a.iter(a.range(0,l.length,!1));!v.done;v.next()){var C=v.value;d=d||l[C].bgConstraint;var S=e?l[C].frame.minY:l[C].frame.minX,y=e?l[C].frame.maxY:l[C].frame.maxX;if(u.push(new i.SpringConstraint(l[C],l[C],0,1,e,y-S,this.getNodeStiffness(l[C],e))),C<l.length-1){var F=e?l[C].frame.maxY:l[C].frame.maxX,b=e?l[C+1].frame.minY:l[C+1].frame.minX,A=Math.abs(F-b);u.push(new i.SpringConstraint(l[C],l[C+1],1,0,e,A,this.getSpacerStiffness(A,o,e)))}}u.push(new i.SpringConstraint(l[l.length-1],t,g,1,e,f,this.getSpacerStiffness(f,o,e)));for(var T=a.iter(u);!T.done;T.next())T.value.proportional=d;for(var _=0,D=a.iter(u);!D.done;D.next())_+=D.value.length;return Math.abs(o-_)>1&&s.CoreAssert.fail("constraint length failure","SpringLayoutController.createFlowSpringConstraints","SpringLayoutController.swift",874),u},createParentSpringConstraints:function(t,e,n,r){var o=n?t.frame.minY:t.frame.minX,l=n?t.frame.maxY:t.frame.maxX,s=n?e.frame.minY:e.frame.minX,u=n?e.frame.maxY:e.frame.maxX,c=[],h=Math.max(s-o,0),m=Math.max(l-u,0),f=Math.abs(h-m)/(l-o);if(f<.05&&f>0){var p=(h+m)/2;h=p,m=p}c.push(new i.SpringConstraint(t,e,0,0,n,h,1)),c.push(new i.SpringConstraint(e,e,0,1,n,u-s,1)),c.push(new i.SpringConstraint(e,t,1,1,n,m,1));for(var g=a.iter(c);!g.done;g.next())g.value.proportional=e.bgConstraint;return this.setSpringStiffnesses(t,a.clone(c),a.clone(r)),c},createSpringConstraintsForGroup:function(t,e,n){if(t.layoutStrategy==y.GroupLayoutStrategy.VerticalFlow&&e||t.layoutStrategy==y.GroupLayoutStrategy.HorizontalFlow&&!e)return[this.createFlowSpringConstraints(t,e)];for(var r=[],o=a.iter(t.children);!o.done;o.next()){var i=o.value;r.push(a.clone(this.createParentSpringConstraints(t,i,e,a.clone(n))))}return r},getNodeStiffness:function(t,e){if((e?t.frame.height:t.frame.width)<10)return 1e6;var n,r,o=1;if(n=a.as(t,y.VisualNodeLeaf)){var i,l,s=t.frame;if((i=a.as(n.forma.controller,g.TypeLockupController))&&(l=n.forma.finalFrame)){var u=i.getAverageFontSize(),c=a.toDouble(i.numLines())/a.toDouble(i.text.split("\n").length),h=l.height/c,m=l.width*c,f=new S.TheoSize(m,h).aspectRatio,p=l.aspectRatio,d=s.fitAspectRatioWithin(f).area,v=s.fitAspectRatioWithin(p).area,C=Math.max(d,v)/l.area;o=this.getFormaStiffness(u*C)}else o=this.getFormaStiffness(s.height)}else if(r=a.as(t,y.VisualNodeGroup)){var F;if(F=this.springConstraints_[r.id]){for(var b=0,A=a.iter(F);!A.done;A.next()){var T=A.value;if(T[0].vertical==e){for(var _=1,D=1,x=a.iter(T);!x.done;x.next()){var P=x.value,w=P.nodeA==P.nodeB?this.getNodeStiffness(P.nodeA,e):P.stiffness;w<this.STRONG_STIFF&&(_+=P.length*w,D+=P.length)}b=Math.max(b,_/a.toDouble(D))}}o=0==b?1:b}}return o},getParentChildPin:function(t,e){var n=.5,r=.5;return Math.abs(t.minX-e.minX)/e.width<.1&&(n=0),Math.abs(t.maxX-e.maxX)/e.width<.1&&(n=1),Math.abs(t.center.x-e.center.x)/e.width<.1&&(n=.5),Math.abs(t.minY-e.minY)/e.height<.1&&(r=0),Math.abs(t.maxY-e.maxY)/e.height<.1&&(r=1),Math.abs(t.center.y-e.center.y)/e.height<.1&&(r=.5),new v.TheoPoint(n,r)},updateFormaFromStructure:function(t){for(var e=[],n=a.clone(t.leafDescendents),r=a.iter(n);!r.done;r.next()){var o=r.value;e.push(o.forma)}for(var i={},s=a.iter(n);!s.done;s.next()){(o=s.value).inferenceData=y.VisualNodeData.init_ff0a(o,a.clone(e));for(var u=a.iter(n);!u.done;u.next()){var c,h=u.value;o!=h&&(nt=o.forma.finalFrame)&&(c=h.forma.finalFrame)&&(i[o.forma.formaID+h.forma.formaID]=nt.intersects(c),i[h.forma.formaID+o.forma.formaID]=nt.intersects(c))}}for(var m=a.iter(t.descendents);!m.done;m.next()){var d,C,S,F=m.value;if((o=a.as(F,y.VisualNodeLeaf))&&(Y=o.frame)&&(d=o.forma.frame)&&(C=o.initFrame)&&(S=o.parent)){var b=o.forma,A=Y,T=!1;(G=a.as(o.forma.controller,g.TypeLockupController))&&1==G.numLines()&&f.LockupStyle.layoutSupportsAlignments(G.lockupStyle.layout)&&(T=!0);var _=b.placement.transformValues,D=Math.abs(_.rotCosine)/(Math.abs(_.rotCosine)+Math.abs(_.rotSine)),x=Math.abs(_.rotSine)/(Math.abs(_.rotCosine)+Math.abs(_.rotSine)),P=new v.TheoPoint(A.width/C.width,A.height/C.height),w=new v.TheoPoint(P.x*D+P.y*x,P.x*x+P.y*D);if(null!=b.controller&&b.controller.maintainAspectRatio){var I=Math.min(w.x,w.y);b.bounds=a.opt(b.bounds,(function(t){return t.scaleXY(I,I,new v.TheoPoint(0,0))}))}else b.bounds=a.opt(b.bounds,(function(t){return t.scaleXY(w.x,w.y,new v.TheoPoint(0,0))}));(G=a.as(o.forma.controller,g.TypeLockupController))&&G.snapSizeToBounds();var G,L=.5,M=.5,k=A.center.x,R=A.center.y,N=S.layoutStrategy==y.GroupLayoutStrategy.VerticalFlow&&1==S.alignments.length&&S.alignments.includes(l.AlignmentType.Left),B=S.layoutStrategy==y.GroupLayoutStrategy.VerticalFlow&&1==S.alignments.length&&S.alignments.includes(l.AlignmentType.Right);if(!(Math.abs(C.center.x-d.center.x)/C.width<.01)){var E=C.minX-d.minX,O=d.maxX-C.maxX;N=N||E>0&&O<=0,B=B||O>0&&E<=0}N?(L=(C.minX-d.minX)/d.width,k=A.minX):B&&(L=1-(d.maxX-C.maxX)/d.width,k=A.maxX),T&&(G=a.as(o.forma.controller,g.TypeLockupController))&&(G.beginBlockedUpdate(),a.opt(G.lockupStyle,(function(t){return t.layout=f.LockupLayout.Standard})),G.lockupStyle.alignment=N?f.LockupAlignment.Left:B?f.LockupAlignment.Right:f.LockupAlignment.Center,G.endBlockedUpdate(),G.styleChanged()),C.minY-d.minY>0&&(M=(C.minY-d.minY)/d.height,R=A.minY),d.maxY-C.maxY>0&&(M=1-(d.maxY-C.maxY)/d.height,R=A.maxY),b.movePinToPoint(new v.TheoPoint(L,M),new v.TheoPoint(k,R))}}for(var X=a.iter(t.descendents);!X.done;X.next()){var Y;if(F=X.value,(o=a.as(F,y.VisualNodeLeaf))&&(Y=o.forma.frame)){var z,U=null,H=1/0,K=null,V=null,j=1/0,W=null;if(z=a.opt(o.inferenceData,(function(t){return t.alignments})))for(var Z=a.iter(n);!Z.done;Z.next()){var J;if(J=z[(st=Z.value).forma.formaID])for(var q=st.forma.frame,Q=a.iter(J);!Q.done;Q.next()){var $=Q.value,tt=null;$.line.type==l.AlignmentType.Right&&(tt=Math.abs(q.maxX-Y.maxX)+.1*q.L1Distance(Y)),$.line.type==l.AlignmentType.Left&&(tt=Math.abs(q.minX-Y.minX)+.1*q.L1Distance(Y)),$.line.type==l.AlignmentType.CenterX&&(tt=Math.abs(q.center.x-Y.center.x)+.1*q.L1Distance(Y)),null!=tt&&tt<H&&$.line.line.length<600&&(H=tt,K=$.line.type,U=q);var et=null;$.line.type==l.AlignmentType.Top&&(et=Math.abs(q.minY-Y.minY)+.1*q.L1Distance(Y)),$.line.type==l.AlignmentType.Bottom&&(et=Math.abs(q.maxY-Y.maxY)+.1*q.L1Distance(Y)),$.line.type==l.AlignmentType.CenterY&&(et=Math.abs(q.center.y-Y.center.y)+.1*q.L1Distance(Y)),null!=et&&et<j&&$.line.line.length<600&&(j=et,W=$.line.type,V=q)}}var nt,rt,ot=0,it=0;if(null!=K&&K==l.AlignmentType.CenterX&&(ot=U.center.x-o.forma.frame.center.x),null!=K&&K==l.AlignmentType.Left&&(ot=U.minX-o.forma.frame.minX),null!=K&&K==l.AlignmentType.Right&&(ot=U.maxX-o.forma.frame.maxX),null!=W&&W==l.AlignmentType.CenterY&&(it=V.center.y-o.forma.frame.center.y),null!=W&&W==l.AlignmentType.Bottom&&(it=V.maxY-o.forma.frame.maxY),null!=W&&W==l.AlignmentType.Top&&(it=V.minY-o.forma.frame.minY),ot=Math.min(ot,0),it=Math.min(it,0),(ot<0||it<0)&&(null!=K&&o.forma.controller.setAlignmentType(K),o.forma.move(p.Matrix2D.translationXY(ot,it)),(nt=o.forma.finalFrame)&&(rt=a.opt(o.forma.parent,(function(t){return t.finalFrame}))))){for(var at=!1,lt=a.iter(n);!lt.done;lt.next()){var st;(st=lt.value)!=o&&st.forma.finalFrame.intersects(nt)&&!i[o.forma.formaID+st.forma.formaID]&&(at=!0)}rt.contains(nt)&&!at||o.forma.move(p.Matrix2D.translationXY(-ot,-it))}}}this.debugPrint_&&a.info("after update: \n "+this.group_.print())},getSpacerStiffness:function(t,e,n){if(t<1)return this.STRUT_STIFF;var r=this.SPACER_LOGISTIC_L*this.LOGISTIC_L_SCALE,o=this.SPACER_LOGISTIC_K*this.LOGISTIC_K_SCALE,i=this.SPACER_LOGISTIC_X*this.LOGISTIC_X_SCALE,a=this.SPACER_LOGISTIC_B*this.LOGISTIC_B_SCALE;return r/(1+Math.pow(d.TheoMatrix.E_DOUBLE,o*(t-i)))+a},getFormaStiffness:function(t){var e=this.NODE_LOGISTIC_L*this.LOGISTIC_L_SCALE,n=this.NODE_LOGISTIC_K*this.LOGISTIC_K_SCALE,r=this.NODE_LOGISTIC_X*this.LOGISTIC_X_SCALE,o=this.NODE_LOGISTIC_B*this.LOGISTIC_B_SCALE;return e/(1+Math.pow(d.TheoMatrix.E_DOUBLE,n*(t-r)))+o},getForegroundLeafs:function(t){for(var e=[],n=a.iter(t.leafDescendents);!n.done;n.next()){var r=n.value;r.hasForegroundRole&&e.push(r)}return e}}}),o)},H9Ol:function(t,e,n){var r,o,i,a,l=e,s=n("oAGj"),u=n("0wFF"),c=n("cZuM"),h=n("XmBt"),m=n("SpAV"),f=n("yhkb"),p=n("yGNn"),g=n("ascj"),d=n("fVJ2"),v=n("dJuF"),C=n("quOg"),S=n("wNKJ"),y=n("FNB+"),F=n("6ZWm"),b=n("waL6"),A=n("yHU1"),T=n("Pil/"),_=n("cmoc"),D=n("OdB2"),x=n("P83h"),P=n("9Lk3"),w=n("ZK0l"),I=n("/afT"),G=n("pnSN"),L=n("iCxV"),M=n("fdtz"),k=n("lmwz"),R=n("c+uM"),N=n("tGKA"),B=n("3DEm"),E=n("jcfx"),O=n("KIfs"),X=n("K0Rh"),Y=n("JO5d"),z=n("Zifs"),U=n("djAF"),H=n("35Q0"),K=n("umUn"),V=n("fAXt"),j=n("8t9B"),W=n("mL0c"),Z=n("oKlP"),J=n("sIWg"),q=n("1NAc");l.ControllerMetadata=(r=function(){},o={},s.defineClass({name:"ControllerMetadata",ctor:r,superName:"DBObject",statics:{SCHEMA_CLASS_NAME:"ControllerMetadata",codec:{get:function(){return void 0===o.codec&&(o.codec=v.DBPropertyCodec.registerCodec(r.SCHEMA_CLASS_NAME,v.DBPropertyCodec.directObjectCodec(r.SCHEMA_CLASS_NAME))),o.codec}},factory:{get:function(){return function(t,e,n,o){return r.init_866e(n,t)}}},_implements:function(t){return"IDBObject"==t}},props:{init_866e:function(t,e){s.super_init(this,d.DBObject,d.DBObject.prototype.init_866e,t,e)},init_dd5d:function(t,e){s.super_init(this,d.DBObject,d.DBObject.prototype.init_dd5d,s.clone(t),s.clone(e))},init_d41d:function(){s.super_init(this,d.DBObject,d.DBObject.prototype.init_dd5d,{},{})},className:{get:function(){return r.SCHEMA_CLASS_NAME}}}}),r),l.FormaController=(i=function(t,e,n){this.blockedUpdate_=0,this.controllerMetadata_=null,this.kind=t,this.forma_=e,this.owner_=n},s.defineClass({name:"FormaController",ctor:i,superName:"CoreObject",props:{owner:{get:function(){return this.owner_}},forma:{get:function(){return this.forma_}},parentController:function(){for(var t=s.opt(this.forma,(function(t){return t.parent}));null!=t&&null!=t.controller;)t=t.parent;return null==t?null:t.controller},moveable:{get:function(){return null==this.forma.allowUserMove||this.forma.allowUserMove}},floating:{get:function(){return this.moveableInDirection(new Z.TheoPoint(1,0))&&this.moveableInDirection(new Z.TheoPoint(0,1))}},moveableInDirection:function(t){var e;return(e=s.as(s.opt(s.opt(this.forma,(function(t){return t.parent})),(function(t){return t.controller})),w.GroupController))?e.childMoveableInDirection(this.forma,t)&&this.moveable:this.moveable},selectable:{get:function(){return!1}},rotateable:{get:function(){return this.moveable}},flippable:{get:function(){return!this.userGroupMember&&this.moveable}},nudgeable:{get:function(){return!0}},scalable:{get:function(){var t=this;return!s.opt(this.forma,(function(e){return null==e.parent||null!=t.forma&&P.GridController.isBackgroundColoredCell(t.forma)}))}},replaceable:{get:function(){return!0}},deleteable:{get:function(){return!0}},duplicatable:{get:function(){return!1}},userGroup:{get:function(){return!1}},userGroupChild:{get:function(){var t;return!(!(t=s.opt(s.opt(s.opt(this.forma,(function(t){return t.parent})),(function(t){return t.controller})),(function(t){return t.userGroup})))&&null==t)&&t}},userGroupMember:{get:function(){return this.userGroup||this.userGroupChild}},canGroup:{get:function(){return this.selectable&&this.floating}},enableChildMove:{get:function(){return!this.userGroupMember||this.forma.page.document.controller.enableMoveableChildren}},userGroupRoot:{get:function(){var t;if(!this.userGroupChild)return null;for(var e=this.forma;((t=s.opt(s.opt(s.opt(e,(function(t){return t.parent})),(function(t){return t.controller})),(function(t){return t.userGroupChild})))||null!=t)&&t;)e=s.opt(e,(function(t){return t.parent}));return s.as(s.opt(e,(function(t){return t.parent})),G.GroupForma)}},copyTo:function(t){return void 0===t&&(t=null),p.CorePromise.resolve(null)},duplicate:function(){return this.copyTo()},opacityChangeable:{get:function(){return this.moveable}},maintainAspectRatio:{get:function(){return!1}},selectionHandlePositions:{get:function(){return m.CoreAssert.isTrue(this.selectable,"this forma isn't selectable. why get the handle positions?","FormaController","FormaController.swift",194),[new Z.TheoPoint(0,0),new Z.TheoPoint(0,1),new Z.TheoPoint(1,0),new Z.TheoPoint(1,1)]}},showHandle:function(t){var e,n;return(e=this.forma)&&null!=(n=s.opt(s.opt(e.parent,(function(t){return t.controller})),(function(n){return n.showChildHandle(e,t)})))?n:this.selectionHandlePositions.includes(t)},visibleSelectionHandlePositions:{get:function(){for(var t=[],e=s.iter(this.selectionHandlePositions);!e.done;e.next()){var n=e.value;this.showHandle(n)&&t.push(n)}return t}},showChildHandle:function(t,e){var n,r;if((n=t.finalFrame)&&(r=s.opt(t.root,(function(t){return t.finalFrame})))){var o=n.eval(e);return o.x>=5&&o.y>=5&&o.x<=r.maxX-5&&o.y<=r.maxY-5}return!1},alignmentDetector:{get:function(){return null==this.alignmentDetector_&&(this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_)),this.alignmentDetector_},set:function(t){this.alignmentDetector_=t}},getAlignments:function(t){var e,n,r,o;if(void 0===t&&(t=!1),(r=this.forma_)&&(o=r.bounds)){m.CoreAssert.isFalse(isNaN(o.origin.x)||isNaN(o.origin.y),"forma "+r.kind+" "+(null!=r.controller?r.controller.kind:"")+" has Nan origin pt","FormaController.getAlignments","FormaController.swift",245),m.CoreAssert.isFalse(isNaN(o.size.width),"forma "+r.kind+" "+((e=s.opt(r.controller,(function(t){return t.kind})))||null!=e?e:"")+" has Nan width","FormaController.getAlignments","FormaController.swift",246),m.CoreAssert.isFalse(isNaN(o.size.height),"forma "+r.kind+" "+((n=s.opt(r.controller,(function(t){return t.kind})))||null!=n?n:"")+" has Nan height","FormaController.getAlignments","FormaController.swift",247);var i=r.kind==X.RootForma.KIND||r.isGridCell()?c.AlignmentDetector.ALIGNMENT_ROOT:c.AlignmentDetector.ALIGNMENT_FORMA,a=r.kind==X.RootForma.KIND||r.isGridCell()?c.AlignmentLocation.Root:c.AlignmentLocation.Forma,l=r.visit(y.FormaTraversal.FurthestAncestor,(function(t,e,n){return!0})),u=r.totalPlacement;return[new c.AlignmentLine(c.AlignmentType.Left,a,i,o.verticalLine(0).transform(u),!1,l),new c.AlignmentLine(c.AlignmentType.CenterX,a,i,o.verticalLine(.5).transform(u),!1,l),new c.AlignmentLine(c.AlignmentType.Right,a,i,o.verticalLine(1).transform(u),!1,l),new c.AlignmentLine(c.AlignmentType.Top,a,i,o.horizontalLine(0).transform(u),!1,l),new c.AlignmentLine(c.AlignmentType.CenterY,a,i,o.horizontalLine(.5).transform(u),!1,l),new c.AlignmentLine(c.AlignmentType.Bottom,a,i,o.horizontalLine(1).transform(u),!1,l)]}return[]},addForma:function(t,e,n){var r;return(r=s.as(t.root,X.RootForma))?(e.controller.fit(r.frame.insetRel(.25,.25,.25,.25)),r.appendChild(e),p.CorePromise.resolve(null)):p.CorePromise.reject("page has no root?")},getUserPerceivedFrame:function(){for(var t,e,n,r,o=s.clone(this.getAlignments()),i=s.iter(o);!i.done;i.next()){var a=i.value;if(a.location==c.AlignmentLocation.Forma)switch(a.type){case 0:t=a.line;break;case 2:e=a.line;break;case 3:n=a.line;break;case 5:r=a.line}}var l=s.opt(this.forma,(function(t){return t.finalFrame}));if(null!=l&&(null==t&&(t=l.verticalLine(0)),null==e&&(e=l.verticalLine(1)),null==n&&(n=l.horizontalLine(0)),null==r&&(r=l.horizontalLine(1))),null!=t&&null!=e&&null!=n&&null!=r){var u=t.intersection(n),h=n.intersection(e),m=r.intersection(e),f=r.intersection(t);if(null!=u&&null!=h&&null!=m&&null!=f)return J.TheoRect.boundsOfPoints([u,h,m,f])}return s.opt(this.forma,(function(t){return t.finalFrame}))},canMultiSelect:{get:function(){return this.selectable&&this.floating}},move:function(t){var e;(e=this.forma_)&&(e.placement=e.placement.concat(t),this.updateParentGroup())},place:function(t){var e;(e=this.forma_)&&(e.placement=t,this.updateParentGroup())},flip:function(t){var e;void 0===t&&(t=!1),(e=this.forma_)&&(V.TransformFacade.flipForma(e,t),this.updateParentGroup())},rotate:function(t){var e;void 0===t&&(t=Math.PI/180),(e=this.forma_)&&(V.TransformFacade.rotateForma(e,t),this.updateParentGroup())},rotation:function(){var t;return(t=this.forma_)?t.rotation():0},nudge:function(t){var e;(e=this.forma_)&&(V.TransformFacade.translateForma(e,t),this.updateParentGroup())},fit:function(t){var e,n;(e=this.forma)&&(e.placement=N.Matrix2D.Identity,e.bounds=J.TheoRect.fromSize(t.size),(n=e.frame)&&(e.move(N.Matrix2D.uniformScaling(n.aspectRatio>=1?t.width/n.width:t.height/n.height)),e.moveCenterToPoint(t.center)),this.updateParentGroup())},fitInArea:function(t){var e,n,r;if(r=this.forma){var o=t.area,i=s.opt(r.bounds,(function(t){return t.aspectRatio})),a=Math.sqrt(i*o),l=Math.sqrt(o/i),u=s.opt(r.root,(function(t){return t.bounds})),c=s.opt(u,(function(e){return e.locatePoint(t.center)}));c=new Z.TheoPoint(B.MathUtils.nearestMultiple((e=s.opt(c,(function(t){return t.x})))||null!=e?e:.5,.5),B.MathUtils.nearestMultiple((n=s.opt(c,(function(t){return t.y})))||null!=n?n:.5,.5));var h=new J.TheoRect(0,0,a,l),m=t.evalXY(c.x,c.y);h=h.moveToPoint(m,c),r.controller.fit(h)}},clone:function(t){return new b.FormaControllerFactory(this.owner).createController(this.kind,t)},match:function(t){var e,n,r,o;if((e=this.forma)&&(n=e.bounds)&&(r=t.forma)&&(o=r.bounds)&&!n.equal(o))if(this.maintainAspectRatio&&!k.ImageFacade.isPotentialBackgroundImage(e)){var i=o.fitAspectRatioWithin(n.aspectRatio);e.bounds=J.TheoRect.fromSize(i),e.moveCenterToPoint(r.frame.center)}else e.bounds=r.bounds},postMatch:function(t){},beginBlockedUpdate:function(){this.blockedUpdate_+=1},endBlockedUpdate:function(){this.blockedUpdate_-=1},blockUpdate:{get:function(){return this.blockedUpdate_>0}},styleChanged:function(){},formaWillChangeState:function(t,e){},formaDidChangeState:function(t,e){},formaWillCommitState:function(t){},formaDidCommitState:function(t){},contentID:{get:function(){return null}},settings:{get:function(){return null}},attach:function(){},detach:function(){},controllerMetadata:{get:function(){return this.controllerMetadata_},set:function(t){this.controllerMetadata_=t,s.count(t.state.allProperties)>0&&this.decodeMetadata()}},decodeMetadata:function(){},postDecode:function(){},onEvent:function(t){this.preProcessEvent(t)||this.processEvent(t)||this.postProcessEvent(t)},preProcessEvent:function(t){return!1},processEvent:function(t){return null!=this.owner&&((e=s.as(t,T.BeginPointerTrackingEvent))?e.trackingResponse=A.BeginPointerTrackingResponseEnum.TrackWithinGroup:t instanceof T.BeginFormaDragEvent?this.processBeginFormaDrag(t):t instanceof T.EndFormaDragEvent?this.processEndFormaDrag(t):t instanceof T.FormaDragEvent?this.processFormaDrag(t):t instanceof T.FormaClickEvent?this.processFormaClick(t):t instanceof T.FormaDoubleClickEvent?this.processFormaDoubleClick(t):t instanceof T.BeginFormaResizeEvent?this.processBeginFormaResize(t):t instanceof T.FormaResizeEvent?this.processFormaResize(t):t instanceof T.EndFormaResizeEvent&&this.processEndFormaResize(t),!1);var e},processFormaDoubleClick:function(t){},processBeginFormaResize:function(t){var e,n;this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_),(e=s.as(s.opt(this.forma.parent,(function(t){return t.controller})),w.GroupController))&&e.beginChildResizeEvent(t),(n=s.opt(s.opt(this.owner,(function(t){return t.document})),(function(t){return t.firstPage})))&&n.publish(new D.BeginFormaResizeMessage(n))},processFormaResize:function(t){var e,n;if(this.clearAlignmentLines(),(e=this.forma.bounds)&&(n=t.pin)){var r=this.forma.placement.transformPoint(this.forma.bounds.eval(n)),o=t.newSize.width>=0?t.newSize.width:this.forma.bounds.width,i=t.newSize.height>=0?t.newSize.height:this.forma.bounds.height,a=null!=t.pin&&(.5==t.pin.x||.5==t.pin.y),l=new q.TheoSize(o,i);a||!this.maintainAspectRatio&&t.forma.kind!=_.FrameForma.KIND||(l=this.owner.selection.inCropMode?e.size.myAspectRatioFitWithin(l):e.size.myAspectRatioClosestCorner(l));var s=this.forma.placement.extractedScale;this.forma.placement=s.matrix,this.forma.bounds=J.TheoRect.fromSize(l);var u=this.forma.placement.transformPoint(this.forma.bounds.eval(t.pin));this.forma.move(N.Matrix2D.translation(Z._minus_TheoPoint_TheoPoint(r,u))),this.updateParentGroup()}},processEndFormaResize:function(t){var e;(e=s.opt(s.opt(this.owner,(function(t){return t.document})),(function(t){return t.firstPage})))&&e.publish(new D.EndFormaResizeMessage(e));var n,r=new x.FormaAlignmentChangedEvent(this.forma_,[],null);this.forma_.beginUpdate(r),this.forma_.endUpdate(r),(n=s.as(s.opt(this.forma.parent,(function(t){return t.controller})),w.GroupController))&&n.endChildResizeEvent(t)},processBeginFormaDrag:function(t){this.clearAlignmentLines();var e=s.clone(t.dragDelegate.draggedFormae);this.alignmentDetector_=c.AlignmentDetector.init_f94b(s.clone(e));var n=this.owner.document.firstPage;n.publish(new D.BeginFormaDragMessage(n))},afterProcessBeginFormaDrag:function(t){},processEndFormaDrag:function(t){var e=s.first(t.dragDelegate.draggedFormae),n=t.drag.viewportScale,r=26/n;S.DragFacade.rescueFormaToPageBounds(e,r,24/n);var o=new x.FormaAlignmentChangedEvent(e,[],null);e.beginUpdate(o),e.endUpdate(o);var i,a,l=this.owner.document.firstPage;if(l.publish(new D.EndFormaDragMessage(l)),i=s.opt(e.root,(function(t){return t.filterWithCallback((function(t){return t instanceof G.GroupForma&&null!=t.controller}))})))for(var u=s.iter(i);!u.done;u.next()){var c,h=u.value;(c=s.as(h.controller,w.GroupController))&&c.canClaimForma(e)&&c.claimForma(e)}else L.Host.logging.error("Error: forma has not root "+e.print());(a=s.as(e.controller,j.TypeLockupController))&&a.invalidateStyleScores()},afterProcessEndFormaDrag:function(t){},containsForma:function(t){var e,n=s.clone(t.totalPlacement.transformPoints(s.clone(t.bounds.points))),r=s.clone(this.forma.totalPlacement.inverse.transformPoints(s.clone(n))),o=r.map((function(t){return t.x}),this),i=r.map((function(t){return t.y}),this),a=J.TheoRect.fromXYXY(s.min(o),s.min(i),s.max(o),s.max(i));return!!(e=s.opt(this.forma.bounds,(function(t){return t.intersectionWith(a)})))&&e.area>.8*a.area},clearAlignmentLines:function(){var t=new x.FormaAlignmentChangedEvent(this.forma,[],[]);this.forma.beginUpdate(t),this.forma.endUpdate(t)},beforeProcessFormaDrag:function(t){},afterProcessFormaDrag:function(t){},processFormaDrag:function(t){var e=this,n=t.drag,r=1==t.dragDelegate.draggedFormae.length;t.dragDelegate.forEachDraggedForma((function(t,o){return e.processOneFormaDrag(n,t,o,r)}))},processOneFormaDrag:function(t,e,n,r){if(null!=this.owner){var o=this.owner;if(m.CoreAssert.isTrue(null!=e.controller,"processFormaDrag dragged forma with nil controller, forma kind "+e.kind+" and controller kind: "+this.kind,"FormaController.processOneFormaDrag","FormaController.swift",776),null!=e.controller){var i=e.controller;if(!(!i.moveable||o.interactionMode==C.InteractionMode.SelectionFocused&&o.selection.selectedCount>0&&!o.selection.isSelected(e)))if(T=t.newDragPlacement)i.place(T);else{var a=new x.FormaTransformChangedEvent(e);e.beginUpdate(a);var l,u=s.opt(e.parent,(function(t){return t.totalPlacement.inverse}))||N.Matrix2D.Identity,c=t.freeMovement(u),h=c.movement,f=c.rise,p=c.run,g=p>0&&Math.abs(f/p),d=new Z.TheoPoint(.5,.5);switch(l=e.parent instanceof _.FrameForma?e.parent.bounds.center:N._asterisk_TheoPoint_Matrix2D(e.bounds.center,n),d=e.bounds.locatePoint(e.placement.inverse.transformPoint(l)),t.dragMode){case 1:h=t.noScale(u,l);break;case 2:h=t.noRotation(u,l)}g=t.dragMode==O.DragMode.NoScaleNoSkew,m.CoreAssert.isFalse(0==h.determinant,void 0,"FormaController.processOneFormaDrag","FormaController.swift",829),N._asterisk_Matrix2D_Matrix2D(N._asterisk_Matrix2D_Matrix2D(N.Matrix2D.translation(l),h),N.Matrix2D.translation(Z._negate_TheoPoint(l))),t.uncommitedMovement=h;var v=t.activePace()==O.DragPace.MediumPace||t.currentlySnapped;r||(v=!1),t.dragMode==O.DragMode.UniformScaleNoRotationNoSkew&&(v=!1);var S,F=s.clone(e.filterByControllerKind(P.GridController.KIND,y.FormaTraversal.NearestAncestor));(S=s.as(s.opt(s.first(F),(function(t){return t.controller})),P.GridController))&&S.isChildSwappable(e)&&(v=!1);var b,A=t.currentlySnapped;if(b=e.controller){var T=N._asterisk_Matrix2D_Matrix2D(n,h);if(b.place(T),t.currentlySnapped=!1,v)null!=b.setSnappedPlacement(g?d:null,8/t.viewportScale,!1).movement&&(t.currentlySnapped=!0),!A&&t.currentlySnapped&&t.commitDrag();else{var w=new x.FormaAlignmentChangedEvent(e,[],null);this.forma_.beginUpdate(w),this.forma_.endUpdate(w)}}t.currentlySnapped,e.endUpdate(a);var I=o.document.firstPage;I.publish(new D.FormaDragMessage(I))}}}},processFormaClick:function(t){var e,n=this;this.alignmentDetector_=c.AlignmentDetector.init_a05b(this.forma_);var r,o=t.forma,i=1==t.modifierKeys.shift||1==t.modifierKeys.command||1==t.modifierKeys.control;r=L.Host.platform.isWeb?"Web":L.Host.platform.isIOS?"iOS":L.Host.platform.isAndroid?"Android":"Unknown",i?this.owner.selection.isSelected(o)?(this.owner.selection.deselectForma(o),s.opt(L.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: yes",contextualData4:"Platform: "+r})}))):(this.owner.selection.selectForma(o),s.opt(L.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsEventClickOccured,{contextualData2:"New selected count: "+s.toString(n.owner.selection.selectedCount),contextualData3:"Did deselect: no",contextualData4:"Platform: "+r})}))):this.owner.selection.isSelected(o)?((e=s.opt(L.Host.platform,(function(t){return t.isWeb})))||null!=e)&&e||this.owner.selection.deselectForma(o):(o.controller.selectable&&this.owner.selection.replaceSelection(o),this.owner.controllerSettingsState.settings=null)},setSnappedPlacement:function(t,e,n){var r,o=this.alignmentDetector.snapped_Placement(t,e,n),i=o[0],a=o[1];(r=i)&&this.move(r);for(var u=[],c=s.iter(this.alignmentDetector.possibleAlignmentLines);!c.done;c.next())for(var h=c.value,m=s.iter(h.lines);!m.done;m.next()){var f=m.value;u.push(f)}var p=new x.FormaAlignmentChangedEvent(this.forma_,s.clone(a),null);return this.forma_.beginUpdate(p),this.forma_.endUpdate(p),new l.SnappedPlacement(i,s.clone(a.length>0?a:null))},updateParentGroup:function(){var t,e=s.opt(this.forma,(function(t){return t.parent}));(t=s.as(s.opt(e,(function(t){return t.controller})),w.GroupController))&&t.childUpdate(this.forma_)},postProcessEvent:function(t){return!1},containsPoint:function(t,e){var n;return void 0===e&&(e=0),!!(n=s.opt(this.forma,(function(t){return t.bounds})))&&(0!=e?n.outsetXY(e,e):n).containsPoint(t)},applyStyle:function(t,e){void 0===e&&(e=0),s.opt(this.forma,(function(e){return e.applyStyle(t)}))},shuffleColorAssignment:function(){if(s.opt(this.forma,(function(t){return null!=t.style}))){var t,e=this.getCurrentColors(this.forma.style).length,n=[];if(t=this.getBackgroundColor()){var r=this.forma.page.colorLibraryController,o=s.clone(r.getThemeColorKeys());if(o.length>e){var i=r.getKeyOfColorInTheme(r.getTheoColorForSolidColor(t));null!=i&&s.remove(o,i)}for(var a=[],l=s.iter(o);!l.done;l.next()){var u=l.value,c=r.getSolidColorForKey(u);null!=c&&c.contrasts(t,!1)&&a.push(u)}a.length>=e&&(o=s.clone(a)),s.shuffleInPlace(o);for(var h=0;h<e;)n.push(r.getTheoColorForKey(o[h])),h+=1}for(var m=s.iter(s.range(0,n.length,!1));!m.done;m.next()){var f,p=m.value;if(null!=(f=this.forma.page.colorLibraryController.getKeyOfColorInTheme(n[p]))){var g,d=(new E.ProfilingColorMap).overridePaletteMappingDueToContrast(f,this.forma.formaID);(g=this.forma.page.colorLibraryController.getTheoColorForKey(d))&&(n[p]=g)}}this.applyColors(s.clone(n))}},getSuggestableColors:function(){for(var t=this.forma.page.colorLibraryController,e=s.clone(t.getColorThemeAsArrayOfTheoColors()),n=[],r=s.iter(e);!r.done;r.next()){var o=r.value;o.isBrandkitColor()||n.push([o])}return n},getCurrentColors:function(t){var e,n,r=[];return this.primaryColorVisible()&&(e=t.colors.color(g.ColorRole.FieldPrimary))&&r.push(e),this.secondaryColorVisible()&&(n=t.colors.color(g.ColorRole.FieldSecondary))&&r.push(n),r},applyColors:function(t,e){var n;if(void 0===e&&(e=g.ColorRole.FieldPrimary),n=this.forma){var r=s.clone(n.page.colorLibraryController.addColorsToTheme(s.clone(t),n));r.length>0&&n.style.colors.setColorId(g.ColorRole.FieldPrimary,r[0]),r.length>1&&n.style.colors.setColorId(g.ColorRole.FieldSecondary,r[1])}this.updateParentGroup()},primaryColorVisible:function(){return!0},secondaryColorVisible:function(){return!1},applyOpacity:function(t){s.opt(s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.animation})),(function(t){return t.invalidate()})),s.opt(this.forma,(function(e){return e.style.opacity=t})),this.updateParentGroup()},currentOpacity:{get:function(){var t;return(t=s.opt(this.forma,(function(t){return t.style.opacity})))||null!=t?t:1}},preferredXAlignment:{get:function(){return null}},setAlignmentType:function(t){},currentHeightScale:{get:function(){var t,e;if((t=s.opt(this.forma,(function(t){return t.bounds})))&&(e=s.opt(this.forma,(function(t){return t.totalPlacement})))){var n=s.clone(t.evalPts([Z.TheoPoint.ZERO,new Z.TheoPoint(0,1)])),r=s.clone(e.transformPoints(s.clone(n)));return r[0].distanceTo(r[1])}return null}},getSizeHeightScales:function(){var t;return(t=s.opt(this.forma,(function(t){return t.bounds})))?[{size:t.size,scale:t.height}]:[]},setHeightScale:function(t,e,n){void 0===e&&(e=null),void 0===n&&(n=!1);var r=e||this.getPin();null!=r&&(r.targetHeight=t,this.matchPreviousPin(r,n))},getParentForPin:function(){var t;return(t=this.forma)?s.opt(s.opt(t.parent,(function(t){return t.controller})),(function(t){return t.kind==w.GroupController.KIND}))||s.opt(s.opt(t.parent,(function(t){return t.controller})),(function(t){return t.kind==h.AlignmentGroupController.KIND}))?t.parent:I.GroupDetector.getVisualParent(t):null},determinePinPosition:function(t,e,n,r,o,i,a,l){var s=i-o,u=e-t,c=Math.max(-1*(o-t)/s,0),h=Math.min(1-(i-t-u)/s,1),m=Math.max(Math.max(o,0)-t,0)/s,f=Math.max(e-i,0)/s,p=Math.max(Math.max(o,0)-n,0)/s,g=Math.max(Math.min(r,e)-i,0)/s;return this.isFrameCentered(p,g)||this.isFrameCentered(m,f)?(c+h)/2:B.MathUtils.absDouble(a-t)<25?0:B.MathUtils.absDouble(l-e)<25?1:p>g?h:c},isFrameCentered:function(t,e){var n=.1+Math.min(t,e);return B.MathUtils.absDouble(t-e)<n&&(t>=0&&e>=0||t+e<.05)},visualParent:{get:function(){return I.GroupDetector.getVisualParent(this.forma)}},visualParentExpansionFrame:{get:function(){var t=I.GroupDetector.getVisualParent(this.forma),e=this.getExpansionBounds(t);return t.totalPlacement.transformRect(e)}},getExpansionBounds:function(t){var e,n,r;if((e=this.forma)&&e.bounds&&(n=t.bounds)&&(r=this.getFrameInOtherFormaCoord(t))){for(var o=n.minX,i=n.maxX,a=n.minY,l=n.maxY,u=s.clone(e.parent.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating}))),c=s.iter(u);!c.done;c.next()){var h=c.value;if(!s.eq(y._equality_Forma_Forma,h,e)){var m=h.controller.getFrameInOtherFormaCoord(t);if(!h.isTypeLockup()&&m.intersects(r))continue;var f=Math.max(r.minX,m.minX),p=Math.min(r.maxX,m.maxX),g=Math.max(r.minY,m.minY),d=Math.min(r.maxY,m.maxY),v=B.MathUtils.absDouble(1-(p-f)/Math.min(r.width,m.width))<.2,C=B.MathUtils.absDouble(1-(d-g)/Math.min(r.height,m.height))<.2;p>f&&!C&&(m.center.y>r.center.y?l=Math.min(l,(m.minY+r.maxY)/2):a=Math.max(a,(m.maxY+r.minY)/2)),d>g&&!v&&(m.center.x>r.center.x?i=Math.min(i,(m.minX+r.maxX)/2):o=Math.max(o,(m.maxX+r.minX)/2))}}return new J.TheoRect(o,a,i,l)}return null},boundaryAlignment:function(t,e){return B.MathUtils.absDouble(t.minX-e.minX)<25||B.MathUtils.absDouble(t.maxX-e.maxX)<25||B.MathUtils.absDouble(t.minY-e.minY)<25||B.MathUtils.absDouble(t.maxY-e.maxY)<25},getPinBounds:function(t){return s.opt(this.forma,(function(t){return t.bounds}))},getPin:function(t,e){void 0===t&&(t=!0),void 0===e&&(e=!0);var n,r,o,i=this;if(!this.floating)return null;if((n=this.forma)&&(r=n.finalFrame)&&(o=s.opt(n.root,(function(t){return t.finalFrame})))){var a=this.currentHeightScale;null==a||!n.isShape()&&0!=a||(a=null);var l,u=this.getParentForPin(),h=u.finalFrame,f=h,p=W.PinBoundsType.Bounds,g=r,d=!1;s.as(this,w.GroupController)&&(l=n.childrenFinalFrame)&&(g=l,(d=this.boundaryAlignment(l,o))&&(p=W.PinBoundsType.ChildrenBounds));var v,C=this.getExpansionBounds(u),S=u.totalPlacement.transformRect(C),y=this.determinePinPosition(f.minX,f.maxX,S.minX,S.maxX,r.minX,r.maxX,g.minX,g.maxX),F=this.determinePinPosition(f.minY,f.maxY,S.minY,S.maxY,r.minY,r.maxY,g.minY,g.maxY),b=r.eval(new Z.TheoPoint(y,F)),A=this.forma.totalPlacement.inverse.transformPoint(b),T=new Z.TheoPoint(A.x/this.forma.bounds.width,A.y/this.forma.bounds.height),_=u.totalPlacement.inverse.transformPoint(b),D=u.bounds,x=new Z.TheoPoint(_.x/D.width,_.y/D.height),P=W.PinBoundsType.Bounds,I=new W.TheoPin(n,p,T,u,P,x,a,0,0),G=1;(v=s.opt(n.page.view,(function(t){return t.getViewportTransform()})))&&(G=Math.sqrt(Math.abs(v.determinant)));var L=c.AlignmentDetector.DISTANCE_THRESHOLD/G,M=Math.abs(h.center.x-r.center.x)<5;if(t&&!d&&!M){var k=s.clone(this.alignmentDetector.detectFormaAlignments(2*L,!0,!1));s.sortInPlace(k,(function(t,e){return 10*Math.abs(t.offset.length())+t.line.line.length+.1*s.toDouble(t.line.type)<10*Math.abs(e.offset.length())+e.line.line.length+.1*s.toDouble(e.line.type)}));for(var R=s.iter(k);!R.done;R.next()){var N,B,E=R.value;if((N=s.opt(this.getPinBounds(p),(function(t){return t.transform(i.forma.totalPlacement)})))&&(B=s.opt(E.forma.controller.getPinBounds(W.PinBoundsType.Bounds),(function(t){return t.transform(E.forma.totalPlacement)})))){var O=Math.max(0,-1*Math.min(N.maxY-B.minY,B.maxY-N.minY));if(E.forma.parent!=n.parent||B.area<=g.area||B.intersects(N)||!E.forma.controller.floating||O>200)continue;var X=null;if(E.line.type==c.AlignmentType.CenterX?X=.5:E.line.type==c.AlignmentType.Left?X=0:E.line.type==c.AlignmentType.Right&&(X=1),null!=X){y=X;var Y=E.forma,z=(P=W.PinBoundsType.Bounds,this.forma.controller.getPinBounds(p)),U=Y.controller.getPinBounds(P),H=Y.totalPlacement.transformPoint(U.eval(new Z.TheoPoint(.5,.5))),K=this.forma.totalPlacement.inverse.transformPoint(H);F=.5,K.y>z.maxY?F=1:K.y<z.minY&&(F=0);var V,j,J,q=new Z.TheoPoint(y,F),Q=new Z.TheoPoint(y,1-F),$=Q;if((V=Y)&&(j=V.frame)&&(J=V.bounds)){var tt=V.placement.inverse.transformPoint(j.eval(Q)),et=new Z.TheoPoint(tt.x/J.width,tt.y/J.height);et.x>-.01&&et.x<1.01&&et.y>-.01&&et.y<1.01?$=et:m.CoreAssert.fail("something went wrong when creating the pin point, defaulting back to frame point","FormaController.getPin","FormaController.swift",1606)}x=Y.totalPlacement.transformPoint(U.eval($));var nt=this.forma.totalPlacement.transformPoint(z.eval(q)),rt=Math.abs(nt.y-x.y),ot=rt/Y.controller.currentHeightScale;return new W.TheoPin(n,p,q,Y,P,$,a,rt,ot,!0)}}}}return I}return null},matchPreviousPin:function(t,e){void 0===e&&(e=!1);var n,r,o=this.forma.placement.transformValues;if((n=this.getParentForPin())&&(r=n.bounds)){for(var i,a,l,u,c,h,m=this.forma.isTypeLockup()&&!this.maintainAspectRatio?2:1,f=this.getExpansionBounds(n),p=s.iter(s.range(0,m,!1));!p.done;p.next()){var g=p.value,d=this.getFrameInOtherFormaCoord(n);d=d.scale(1.1,new Z.TheoPoint(.5,.5));var v=Math.max(d.minX-f.minX,0),C=Math.max(Math.min(f.maxX,r.maxX)-d.maxX,0),S=Math.max(d.minY-f.minY,0),y=Math.max(Math.min(f.maxY,r.maxY)-d.maxY,0);v=0==t.pinPoint.x?0:v,C=1==t.pinPoint.x?0:C,S=0==t.pinPoint.y?0:S,y=1==t.pinPoint.y?0:y,.5==t.pinPoint.x&&(v=Math.min(v,C),C=Math.min(v,C)),.5==t.pinPoint.y&&(S=Math.min(S,y),y=Math.min(S,y));var F=1+(v+C)/d.width,b=1+(S+y)/d.height,A=this.currentHeightScale,T=null!=t.targetHeight&&null!=A?t.targetHeight/A:1;if(Math.abs(T-1)<.01)break;var _=F>T,D=b>T;if(!(g>0&&Math.abs(T-1)<.05))if(this.maintainAspectRatio){var x=_&&D?T:Math.min(F,b);this.forma.bounds=s.opt(this.forma.bounds,(function(t){return t.scaleXY(x,x,new Z.TheoPoint(0,0))}))}else this.forma.bounds=_&&D?s.opt(this.forma.bounds,(function(t){return t.scaleXY(T,T,new Z.TheoPoint(0,0))})):_?s.opt(this.forma.bounds,(function(t){return t.scaleXY(T,b,new Z.TheoPoint(0,0))})):D?s.opt(this.forma.bounds,(function(t){return t.scaleXY(F,T,new Z.TheoPoint(0,0))})):s.opt(this.forma.bounds,(function(t){return t.scaleXY(F,b,new Z.TheoPoint(0,0))}))}null!=(i=t.targetHeight)&&null!=(a=this.currentHeightScale)&&(l=s.opt(this.forma,(function(t){return t.finalFrame})))&&(u=s.opt(this.forma,(function(t){return t.bounds})))&&(c=s.opt(s.opt(this.forma,(function(t){return t.root})),(function(t){return t.finalFrame})))&&(T=i/a,Math.abs(T-1)>.001&&(f=this.getExpansionBounds(n),(e||u.width*T<f.width&&u.height*T<f.height&&l.width*T<c.width&&l.height*T<c.height)&&(this.forma.placement=this.forma.placement.scaleTo(o.xscale*T,o.yscale*T)))),(h=s.as(this.forma.controller,j.TypeLockupController))&&h.snapSizeToBounds(),this.forma.move(t.offsetMatrix()),f=this.getExpansionBounds(n),this.preventOutofBounds(n,f)}},getFrameInOtherFormaCoord:function(t){var e,n;return(e=this.forma.bounds)&&(n=t.totalPlacement.inverse)?t==s.opt(this.forma,(function(t){return t.parent}))?s.opt(this.forma,(function(t){return t.frame})):this.forma.totalPlacement.concat(n).transformRect(e):null},preventOutofBounds:function(t,e,n){void 0===n&&(n=0);var r,o,i=!1;if((r=null!=e?e:t.bounds)&&(o=this.getFrameInOtherFormaCoord(t))&&!r.contains(o)){var a=r.insetXY(n,n),l=o.minX-a.minX,s=o.maxX-a.maxX,u=o.minY-a.minY,c=o.maxY-a.maxY;l<0&&(this.forma.move(N.Matrix2D.translationXY(-l,0)),i=!0),s>0&&(this.forma.move(N.Matrix2D.translationXY(-s,0)),i=!0),u<0&&(this.forma.move(N.Matrix2D.translationXY(0,-u)),i=!0),c>0&&(this.forma.move(N.Matrix2D.translationXY(0,-c)),i=!0)}return i},linkedForma:function(t){var e,n;return(e=this.forma.parent)&&(n=e.controller)?n.linkedFormaForChild(this.forma,t):[]},linkedFormaForChild:function(t,e){return[]},getZOrder:function(){var t,e=-1;return null==this.forma||null==this.forma.parent?(m.CoreAssert.isTrue(!1,void 0,"FormaController.getZOrder","FormaController.swift",1874),e):e=(t=this.forma.parent.indexOfChild(this.forma))||null!=t?t:-1},setZOrder:function(t){null!=this.forma&&null!=this.forma.parent?this.forma.parent.insertChildAt(this.forma,t):m.CoreAssert.isTrue(!1,void 0,"FormaController.setZOrder","FormaController.swift",1886)},getMinLayerIndex:function(){var t=0;if(null==this.forma||null==this.forma.parent)return m.CoreAssert.isTrue(!1,void 0,"FormaController.getMinLayerIndex","FormaController.swift",1896),t;var e=this.forma.parent;return null!=e&&(t=s.clone(e.filterWithCallback((function(t){return(t.isBackgroundImage()||t.isShape()&&!t.hasIntent(y.Forma.INTENT_TEMP_IMAGE_CROP))&&null!=t.controller&&!t.controller.floating}),y.FormaTraversal.JustChildren)).length),t},getReorderableLayerCount:function(){var t;return null==this.forma?(m.CoreAssert.isTrue(!1,void 0,"FormaController.getReorderableLayerCount","FormaController.swift",1915),0):!this.enableChildMove&&this.userGroupChild?0:s.opt(this.forma,(function(t){return t.isGridCell()}))?0:(t=s.opt(this.getSiblingFormae(),(function(t){return t.length})))||null!=t?t:0},getSiblingFormae:function(){return null==this.forma?(m.CoreAssert.isTrue(!1,void 0,"FormaController.getSiblingFormae","FormaController.swift",1934),null):s.opt(this.forma,(function(t){return t.isGridCell()}))?null:(t=s.opt(this.forma,(function(t){return t.parent})))?t.filterWithCallback((function(t){return!t.isBackgroundImage()&&!t.hasIntent(y.Forma.INTENT_TEMP_IMAGE_CROP)&&!P.GridController.isBackgroundColoredCell(t)}),y.FormaTraversal.JustChildren):null;var t},contrastCheck:function(t){var e,n,r;if(void 0===t&&(t=!0),(e=this.forma.style.colors.fieldPrimary)&&null!=(n=this.forma.style.colors.colorID(g.ColorRole.FieldPrimary))&&(r=this.getBackgroundColor())&&!e.contrasts(r,t)){var o=e.contrastWithColor(r),i=f.ColorLibraryController.getBackgroundContrastKey(n);this.forma.page.colorLibraryController.setTheoColorToLibrary(K.TheoColor.init_5344(o,null,null),i),this.forma.style.colors.setColorId(g.ColorRole.FieldPrimary,i)}},getBackingContrastRole:function(){return g.ColorRole.FieldPrimary},getBackgroundColor:function(t){void 0===t&&(t=null);var e=this;if(null==this.forma.finalFrame)return null;var n,r=null!=t?t:this.forma.finalFrame;if(n=s.as(this.forma.root,X.RootForma)){var o,i=n.style.colors.fieldPrimary,a=s.opt(n.finalFrame,(function(t){return t.intersectionWith(r)}));if(null==a)return null;r=a,(o=s.as(this,j.TypeLockupController))&&o.styleController.targetedLockupStyle!==o.lockupStyle&&o.textBacked&&!R.LockupStyle.isShadowLook(o.lockupStyle.textLook)&&(i=o.lockupStyle.colors.fieldPrimary),null==i&&(s.opt(L.Host.logging,(function(t){return t.warning("Possible error. background color is nil.")})),i=z.SolidColor.WHITE);for(var l=s.iter(n.visitAsArray(y.FormaTraversal.PreOrder));!l.done;l.next()){var u,c=l.value,h=c.finalFrame,m=c.controller;if(!(null==m||s.eq(y._equality_Forma_Forma,c,this.forma)||null==h||(u=m)&&u.kind!=Y.ShapeController.KIND&&u.kind!=F.FrameController.KIND)){for(var f=c.parent,p=!1;null!=f&&f.kind!=X.RootForma.KIND&&f!=c;){if(f==this.forma){p=!0;break}f=f.parent}if(!p){var g=r.intersectionWith(h);if(null!=g&&g.area/r.area>.5){var d,v;if(c.parent==s.opt(this.forma,(function(t){return t.parent}))&&null!=c.parent&&null!=(d=s.opt(c.parent,(function(t){return t.indexOfChild(e.forma)})))&&null!=(v=c.parent.indexOfChild(c))&&d<v)continue;if(c instanceof _.FrameForma){var C=c.controller.getAverageColor(r);null!=C?i=i.blend(C,C.alpha):(L.Host.logging.warning("Error: Couldn't find the background color"),i=new z.SolidColor(.5,.5,.5,1))}else if(c instanceof U.ShapeForma){if(!(new E.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(c.formaID,this.forma.formaID)&&!(new E.ProfilingColorMap).checkIfTwoFormaAreInSamePaletteMappingGroup(c.formaID,this.forma.formaID+E.ProfilingColorMap.backingColorKey)){var S=s.opt(s.opt(s.as(c,U.ShapeForma),(function(t){return t.contentNode})),(function(t){return t.getTag(H.TAG_SHAPE_ID)}));if(null==S||H.ShapeLibrary.FilledBackingShapes.includes(S)){var b=c.style.colors.fieldPrimary,A=s.as(c,U.ShapeForma).getAverageAlpha(r);null!=b&&null!=i&&(i=i.blend(b,c.style.opacity*A))}}}else G.GroupForma}}}}return i}return null},getBackgroundColors:function(){var t,e,n=[];if((t=this.forma.finalFrame)&&(e=this.forma.root)){var r=s.clone(e.filterWithCallback((function(e){return e.isGraphic()&&e.kind!=M.ImageForma.KIND&&e.kind!=X.RootForma.KIND&&null!=e.finalFrame&&e.finalFrame.intersects(t)})));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(t)&&null!=i)return[i]}for(var a=3;t.width/s.toDouble(a)<50&&1!=a;)a-=1;for(var l=3;t.height/s.toDouble(l)<50&&1!=l;)l-=1;for(var u=new q.TheoSize(t.width/s.toDouble(a),t.height/s.toDouble(l)),c=s.iter(s.range(0,a,!1));!c.done;c.next())for(var h=c.value,m=s.iter(s.range(0,l,!1));!m.done;m.next()){var f=m.value,p=J.TheoRect.fromXYWH(s.toDouble(h)*u.width+t.origin.x,s.toDouble(f)*u.height+t.origin.y,u.width,u.height);null==(i=this.getBackgroundColor(p))||s.containsEq(n,i,z._equality_SolidColor_SolidColor)||n.push(i)}}return n},getBackgroundColorsFullList:function(){var t,e,n=[];if((t=this.forma.finalFrame)&&(e=this.forma.root)){var r=s.clone(e.filterWithCallback((function(e){return e.isGraphic()&&e.kind!=M.ImageForma.KIND&&e.kind!=X.RootForma.KIND&&null!=e.finalFrame&&e.finalFrame.intersects(t)})));if(1==r.length&&r[0].isGridCell()&&r[0].isShape()){var o,i=r[0].style.colors.fieldPrimary;if((o=r[0].finalFrame)&&o.contains(t)&&null!=i)return[i]}for(var a=new q.TheoSize(t.width/s.toDouble(16),t.height/s.toDouble(16)),l=s.iter(s.range(0,16,!1));!l.done;l.next())for(var u=l.value,c=s.iter(s.range(0,16,!1));!c.done;c.next()){var h=c.value,m=J.TheoRect.fromXYWH(s.toDouble(u)*a.width+t.origin.x,s.toDouble(h)*a.height+t.origin.y,a.width,a.height);null!=(i=this.getBackgroundColor(m))&&n.push(i)}}return n},getAverageColor:function(t){return this.forma.style.colors.fieldPrimary}}}),i),l.SnappedPlacement=(a=function(t,e){this.movement=t,this.snapLines=s.clone(e)},s.defineClass({name:"SnappedPlacement",ctor:a,superName:"CoreObject"}),a)},JFv5:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("gXiO"),l=n("FNB+"),s=n("9Lk3"),u=n("ZK0l"),c=n("/afT"),h=n("fdtz"),m=n("K0Rh"),f=n("T6jX"),p=n("8t9B"),g=n("oKlP"),d=n("zjod");o.ResizeLayoutController=i.defineProtocol("ResizeLayoutController",{beginUpdateGroup:"() -> Void",updateGroup:"() -> Void",endUpdateGroup:"() -> Void"}),o.ResizeLayoutType=i.defineEnum("ResizeLayoutType",{Proportional:"Proportional",Pin:"Pin",Spring:"Spring"}),o.PinLayoutController=(r=function(t){this.formaToUpdate_=[],this.inferredGroups_=null,this.group_=t,a.CoreObject.call(this)},i.defineClass({name:"PinLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{beginUpdateGroup:function(){if(this.oldBounds_=this.group_.bounds,i.as(this.group_.root,m.RootForma)&&!this.group_.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)&&i.opt(this.group_.root,(function(t){return null!=t.page.root_}))&&!f.TheoDocumentUtils.enableFastHeuristicsForComplexPage(this.group_.root.page)){var t=i.clone(c.GroupDetector.createOverlapGroups(this.group_));if(t.length>0){this.inferredGroups_=[];for(var e=i.iter(t);!e.done;e.next()){var n=e.value;this.inferredGroups_.push(n)}i.opt(i.as(this.group_.controller,s.GridController),(function(t){return t.inferGridCellAssignment()}))}}this.formaToUpdate_=[];for(var r=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;if(o.kind!=h.ImageForma.KIND&&o.kind!=d.VideoForma.KIND){var a;(a=i.as(o.controller,u.GroupController))&&a.beginUpdateGroup();var p=i.opt(o.controller,(function(t){return t.getPin(!0)}));null==p||p.isRelativePin?this.formaToUpdate_.push({forma:o,pin:p}):this.formaToUpdate_.splice(0,0,{forma:o,pin:p})}}},updateGroup:function(){if(null!=this.oldBounds_){for(var t=this.oldBounds_.size,e=this.group_.bounds.size,n=new g.TheoPoint(e.width/t.width,e.height/t.height),r=i.iter(this.formaToUpdate_);!r.done;r.next()){var o;if((o=(v=r.value).forma.frame)&&o.area>0){var a=v.forma,l=a.placement.transformValues,s=Math.abs(l.rotCosine)/(Math.abs(l.rotCosine)+Math.abs(l.rotSine)),u=Math.abs(l.rotSine)/(Math.abs(l.rotCosine)+Math.abs(l.rotSine)),c=new g.TheoPoint(n.x*s+n.y*u,n.x*u+n.y*s);if((d=i.as(a.controller,p.TypeLockupController))&&d.addLineBreakConstraints(),null!=a.controller&&a.controller.maintainAspectRatio){var h=Math.min(c.x,c.y);a.bounds=i.opt(a.bounds,(function(t){return t.scaleXY(h,h,new g.TheoPoint(0,0))}))}else a.bounds=i.opt(a.bounds,(function(t){return t.scaleXY(c.x,c.y,new g.TheoPoint(0,0))}));a.moveCenterToPoint(new g.TheoPoint(o.center.x*n.x,o.center.y*n.y))}}for(var m=i.iter(this.formaToUpdate_);!m.done;m.next()){var f,d,v=m.value;(f=v.pin)&&(i.opt(v.forma.controller,(function(t){return t.matchPreviousPin(f)})),(d=i.as(v.forma.controller,p.TypeLockupController))&&d.removeLineBreakConstraints())}}},endUpdateGroup:function(){for(var t=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!t.done;t.next()){var e,n=t.value;if((e=i.as(n.controller,u.GroupController))&&e.endUpdateGroup(),n.hasIntent(l.Forma.INTENT_INFERRED_TEMP_GROUP)&&null!=this.inferredGroups_&&this.inferredGroups_.includes(n)){for(var r=i.iter(n.visitAsArray(l.FormaTraversal.JustChildren));!r.done;r.next()){var o=r.value;this.group_.appendChild(o,!0)}n.removeFromParent(),i.opt(i.as(this.group_.controller,s.GridController),(function(t){return t.inferGridCellAssignment()})),i.remove(this.inferredGroups_,n)}}}}}),r)},XmBt:function(t,e,n){var r,o,i,a=e,l=n("oAGj"),s=n("cZuM"),u=n("ftr0"),c=n("SpAV"),h=n("ascj"),m=n("FNB+"),f=n("waL6"),p=n("ZK0l"),g=n("pnSN"),d=n("iCxV"),v=n("tGKA"),C=n("3DEm"),S=n("djAF"),y=n("35Q0"),F=n("JKVa"),b=n("8t9B"),A=n("oKlP"),T=n("sIWg"),_=n("1NAc");a.AlignmentGroupItemType=l.defineEnum("AlignmentGroupItemType",{DefaultContent:0,SeperatorShape:1,BackingShape:2,BulletShape:3}),a.AlignmentLayoutItem=(r=function(t,e,n,r,o,i,a,l){this.forma=t,this.type=e,this.formaPin=n,this.parentPosition=r,this.size=o,this.scale=i,this.artworkID=a,this.primaryColor=l},l.defineClass({name:"AlignmentLayoutItem",ctor:r,props:{clone:function(){return new r(this.forma,this.type,this.formaPin,this.parentPosition,this.size,this.scale,this.artworkID,this.primaryColor)}}}),r),a.AlignmentColumnLayout=(o=function(t,e,n,r,o,i,a,s,u){this.columns=l.clone(t),this.contentColumn=l.clone(e),this.contentSizes=l.clone(n),this.contentScales=l.clone(r),this.contentSpacing=l.clone(o),this.seperatorHeights=l.clone(i),this.seperatorPositions=l.clone(a),this.marginLeft=l.clone(s),this.marginRight=l.clone(u)},l.defineClass({name:"AlignmentColumnLayout",ctor:o,props:{clone:function(){return new o(this.columns,this.contentColumn,this.contentSizes,this.contentScales,this.contentSpacing,this.seperatorHeights,this.seperatorPositions,this.marginLeft,this.marginRight)}}}),o),a.AlignmentGroupController=(i=function(t,e,n){this.blockChildUpdates_=!1,this.blockAlignmentLayout_=!1,this.childrenAligned_=!1,this.iconHack_=!1,this.childScales_={},p.GroupController.call(this,t,e,n)},l.defineClass({name:"AlignmentGroupController",ctor:i,superName:"GroupController",statics:{KIND:{get:function(){return"alignment-group"}},MIN_SPACING:{get:function(){return 5}},DEFAULT_MARGINS:{get:function(){return 20}},DEFAULT_SEPERATOR_HEIGHT:{get:function(){return 5}},PROPERTY_BACKING_SHAPE_ID:"backing-shape-id"},props:{backingShapeID_:{get:function(){return l.as(this.controllerMetadata.get(i.PROPERTY_BACKING_SHAPE_ID),"String")},set:function(t){this.controllerMetadata.set(i.PROPERTY_BACKING_SHAPE_ID,t)}},selectable:{get:function(){return!0}},moveable:{get:function(){return!0}},rotateable:{get:function(){return!0}},deleteable:{get:function(){var t,e;return(t=l.opt(this.forma,(function(t){return t.finalFrame})))&&(e=l.opt(this.forma,(function(t){return t.root.finalFrame})))?!t.equal(e):p.GroupController._getters.deleteable.call(this)}},replaceable:{get:function(){return!this.moveable}},maintainAspectRatio:{get:function(){return!1}},contentID:{get:function(){var t=[];if(l.opt(this.forma,(function(e){return e.visit(m.FormaTraversal.JustChildren,(function(e,n,r){var o;return null!=(o=e.contentID)&&t.push(o),!1}))})),0==t.length)return null;l.sortInPlace(t);for(var e="",n=l.iter(t);!n.done;n.next())e+=n.value;return e}},horizontalAlignment:{get:function(){return this.alignmentGroupStyle.horizontalAlignment},set:function(t){this.alignmentGroupStyle.horizontalAlignment=t,this.updateGroup()}},alignmentGroupStyle:{get:function(){var t;return(t=l.as(l.opt(this.forma,(function(t){return t.style})),u.AlignmentGroupStyle))?t:(l.opt(this.forma,(function(t){return t.applyStyle(u.AlignmentGroupStyle.createDefault())})),l.as(l.opt(this.forma,(function(t){return t.style})),u.AlignmentGroupStyle))}},inferredSpacing:{get:function(){var t;if(null!=(t=l.opt(this.alignmentGroupStyle,(function(t){return t.spacing}))))return t;var e=l.clone(this.getSortedChildren()),n=[];if(e.length>0){for(var r=l.iter(l.range(0,e.length-1,!1));!r.done;r.next()){var o,i=r.value;null!=(o=l.opt(this.alignmentGroupStyle,(function(t){return t.topDistances[e[i].formaID]})))&&n.push(o)}return n.reduce((function(t,e){return t+e}),0)/l.toDouble(n.length)}return null}},setHorizontalAlignment:function(t,e){void 0===e&&(e=null),this.horizontalAlignment=t},applyOpacity:function(t){l.opt(this.backingShape_,(function(e){return e.style.opacity=t})),this.alignmentGroupStyle.opacity=t},setNextSpacingOption:function(){var t,e,n;(t=this.alignmentGroupStyle)&&(e=l.opt(this.forma,(function(t){return t.finalFrame})))&&(null!=(n=t.spacing)?n>e.height/5?t.spacing=0:t.spacing=n+20:t.spacing=25,this.updateGroup())},setNextPaddingOption:function(){var t,e;(t=this.alignmentGroupStyle)&&(null!=(e=t.padding)?t.padding=e>.4?-.3:e+.15:t.padding=.15,this.updateBackingShape())},setBackingShape:function(t){l.opt(this.alignmentGroupStyle,(function(e){return e.backingArtworkID=t})),this.updateBackingShape()},styleChanged:function(){this.updateBackingShape()},moveableFormae:function(){for(var t=[],e=l.iter(this.forma.visitAsArray(m.FormaTraversal.JustChildren));!e.done;e.next()){var n=e.value;null!=n.controller&&n.controller.moveable&&t.push(n)}return l.sortInPlace(t,(function(t,e){return t.finalFrame.center.distanceTo(A.TheoPoint.ZERO)<e.finalFrame.center.distanceTo(A.TheoPoint.ZERO)})),t},showLinkingButtons:{get:function(){if(this.moveableFormae().length>0)return!0;if(this.iconHack_)return!0;for(var t=l.iter(this.forma.siblingForma());!t.done;t.next()){var e=t.value;if(this.containsForma(e))return!0}return!1}},isLinked:{get:function(){var t;return!(t=this.alignmentGroupStyle)||t.layoutMode!=u.GroupLayoutMode.None}},toggleLinkChildren:function(){var t;if(t=this.alignmentGroupStyle)if(t.layoutMode==u.GroupLayoutMode.None)t.layoutMode=u.GroupLayoutMode.Flow,this.claimSiblingForma();else{t.layoutMode=u.GroupLayoutMode.None;for(var e=l.iter(this.moveableFormae());!e.done;e.next()){var n,r=e.value;(n=l.opt(this.forma,(function(t){return t.parent})))&&(this.iconHack_=!0,n.appendChild(r,!0),this.iconHack_=!1)}}},setAlignmentSortOrder:function(){var t,e;if((t=l.as(this.forma,g.GroupForma))&&(e=this.alignmentGroupStyle)){var n=l.clone(t.filterWithCallback((function(t){return null!=t.controller}),m.FormaTraversal.JustChildren)),r=[];l.sortInPlace(n,(function(e,n){return e.frame.center.distanceTo(t.bounds.origin)>n.frame.center.distanceTo(t.bounds.origin)}));for(var o=l.iter(n);!o.done;o.next()){var i=o.value;r.push(i.formaID)}e.setOrder(l.clone(r))}},getSortedChildren:function(){var t,e,n,r;if((n=l.as(this.forma,g.GroupForma))&&(r=this.alignmentGroupStyle)){var o=l.clone(n.filterWithCallback((function(t){return null!=t.controller}),m.FormaTraversal.JustChildren));return r.order.length!=o.length&&this.setAlignmentSortOrder(),l.sortInPlace(o,(function(n,o){return((t=l.indexOf(r.order,n.formaID))||null!=t?t:1e3)>((e=l.indexOf(r.order,o.formaID))||null!=e?e:1e3)})),o}return[]},getDesiredScales:function(t,e){for(var n=[],r=l.iter(t);!r.done;r.next()){var o,i=r.value;(o=i.frame)&&(null==(g=l.opt(this.alignmentGroupStyle,(function(t){return t.scales[i.formaID]})))&&(g=l.opt(i.controller,(function(t){return t.currentHeightScale}))),null!=g&&n.push({forma:i,size:o.size,scale:g}))}for(var a=1,s=!1;!s&&a>.05;){s=!0;for(var u=l.iter(n);!u.done;u.next()){var c=u.value;c.forma.isTypeLockup()&&0==l.clone(this.getSizesForScale(c.forma,c.scale*a,e)).length&&(s=!1,a*=.9)}}for(var h=l.iter(l.range(0,n.length,!1));!h.done;h.next()){var m=h.value;(g=n[m]).forma.isTypeLockup()&&(n[m]={forma:g.forma,size:g.size,scale:g.scale*a})}for(var f={},p=l.iter(n);!p.done;p.next()){var g;f[(g=p.value).forma.formaID]={size:g.size,scale:g.scale}}return f},createChildScales:function(t){var e,n=l.clone(t.controller.getSizeHeightScales());if(this.childScales_[t.formaID]=l.clone(n),e=this.childScales_[t.formaID])if(e.length!=n.length)c.CoreAssert.fail("Error. scales don't match","AlignmentGroupController.createChildScales","AlignmentGroupController.swift",476);else for(var r=l.iter(l.range(0,e.length,!1));!r.done;r.next()){var o=r.value,i=e[o].size.height/n[o].size.height;Math.abs(e[o].scale-n[o].scale*i)>1&&c.CoreAssert.fail("scale error","AlignmentGroupController.createChildScales","AlignmentGroupController.swift",483)}return n},getSizesForScale:function(t,e,n){var r=[],o=l.clone(this.childScales_[t.formaID]);null==o&&(o=l.clone(this.createChildScales(t)));for(var i=l.iter(o);!i.done;i.next()){var a=i.value,s=a.size.multiply(e/a.scale);(null==n||s.width<=n.width&&s.height<=n.height)&&r.push(s)}var u=this.forma.bounds.scaleXY(2,1).size,h=t.bounds.size;if(l.sortInPlace(r,(function(t,e){return 1*t.similarity(h)+t.similarity(u)<1*e.similarity(h)+e.similarity(u)})),null!=n)for(var m=l.iter(r);!m.done;m.next()){var f=m.value;c.CoreAssert.isTrue(f.width<=n.width+.001,void 0,"AlignmentGroupController.getSizesForScale","AlignmentGroupController.swift",530),c.CoreAssert.isTrue(f.height<=n.height+.001,void 0,"AlignmentGroupController.getSizesForScale","AlignmentGroupController.swift",531)}return r},getSeperatorPositions:function(t,e,n){var r;if(t.length>0&&(r=this.alignmentGroupStyle)){if(r.seperatorStyle==u.SeperatorStyle.None)return[];if(r.seperatorStyle==u.SeperatorStyle.FirstInner&&0==e)return[0];if(r.seperatorStyle==u.SeperatorStyle.Inner)return l.toArray(l.stride(0,t.length-1,1));if(r.seperatorStyle==u.SeperatorStyle.Outer&&0==e)return[-1,t.length-1];if(r.seperatorStyle==u.SeperatorStyle.BottomAll)return l.toArray(l.stride(0,t.length,1))}return[]},getColumnLayout:function(t,e){var n;if(n=this.alignmentGroupStyle){for(var r=l.clone(this.splitChildren(l.clone(t),e)),o=r.length,u=null!=n.marginTop?n.marginTop:i.DEFAULT_MARGINS,h=null!=n.marginBottom?n.marginBottom:i.DEFAULT_MARGINS,f=null!=n.marginLeft&&o<2?n.marginLeft:i.DEFAULT_MARGINS,p=null!=n.marginRight&&o<2?n.marginRight:i.DEFAULT_MARGINS,g=new T.TheoRect(e.minX+f,e.minY,e.maxX-p,e.maxY),v=l.clone(g.split(r.length,!0)),S=v[0],y=[],F=l.iter(t);!F.done;F.next())for(var b=F.value,A=l.iter(l.range(0,o,!1));!A.done;A.next()){var D=A.value;if(l.containsEq(r[D],b,m._equality_Forma_Forma)){y.push(D);break}}if(y.length!=t.length)return c.CoreAssert.fail("incorrect number of children in assignment","AlignmentGroupController.getColumnLayout","AlignmentGroupController.swift",606),null;for(var x=l.iter(t);!x.done;x.next())if(b=x.value,null==n.bottomDistances[b.formaID]||null==n.topDistances[b.formaID])return null;for(var P=l.repeat([],o),w=l.repeat([],o),I=l.repeat([],o),G=l.repeat(0,o),L=l.repeat(0,o),M=f/(2*l.toDouble(o)),k=p/(2*l.toDouble(o)),R=new _.TheoSize(S.width-M-k,S.height-u-h),N=l.repeat([],o),B=l.repeat([],o),E=l.clone(this.getDesiredScales(l.clone(t),R)),O=l.repeat([],o),X=l.iter(l.range(0,r.length,!1));!X.done;X.next()){for(var Y=X.value,z=l.clone(r[Y]),U=l.iter(l.range(1,z.length,!1));!U.done;U.next()){var H;D=U.value,null!=n.spacing?P[Y].push(n.spacing):null!=(H=n.bottomDistances[z[D].formaID])?P[Y].push(H):P[Y].push(0)}I[Y]=l.clone(this.getSeperatorPositions(l.clone(z),Y,o));for(var K=l.iter(I[Y]);!K.done;K.next())w[Y].push(null!=n.seperatorHeight?n.seperatorHeight:i.DEFAULT_SEPERATOR_HEIGHT);var V=null!=n.marginTop?n.marginTop:n.bottomDistances[z[0].formaID],j=null!=n.marginBottom?n.marginBottom:n.topDistances[t[z.length-1].formaID];n.verticalAlignment==s.AlignmentType.CenterY&&(j=V=Math.max(V,j)),G[Y]=V,L[Y]=j;for(var W=l.iter(z);!W.done;W.next()){var Z;if(null!=(Z=E[(b=W.value).formaID])){0==(bt=l.clone(this.getSizesForScale(b,Z.scale,R))).length&&(bt=l.clone(this.getSizesForScale(b,Z.scale,null))),B[Y].push(bt[0]),O[Y].push(Z.scale);for(var J=bt[0],q=l.iter(bt);!q.done;q.next()){var Q=q.value;Q.height<J.height&&(J=Q)}N[Y].push(J)}}}for(var $=l.toDouble(t.length-1),tt=!0,et=0;tt&&(100==et&&l.opt(d.Host.logging,(function(t){return t.warning("error")})),!(et>10));){et+=1,tt=!1;for(var nt=0,rt=l.iter(l.range(0,o,!1));!rt.done;rt.next()){var ot=P[Y=rt.value].reduce((function(t,e){return t+e}),0),it=w[Y].reduce((function(t,e){return t+e}),0);if((nt=(Dt=(_t=N[Y].reduce((function(t,e){return t+e.height}),0))+(j=L[Y])+(V=G[Y])+ot+it)-S.height)>0){var at=null==n.spacing?ot-i.MIN_SPACING*$:0,lt=null==n.marginTop&&n.verticalAlignment!=s.AlignmentType.Top?V-i.DEFAULT_MARGINS:0,st=null==n.marginBottom&&n.verticalAlignment!=s.AlignmentType.Bottom?j-i.DEFAULT_MARGINS:0;if(at+lt+st>1){for(var ut=at+lt+st,ct=Math.min(nt,ut),ht=ct*(at/ut),mt=ct*(lt/ut),ft=ct*(st/ut),pt=l.iter(l.range(0,P[Y].length,!1));!pt.done;pt.next())D=pt.value,P[Y][D]-=ht*(P[Y][D]/(ot+1e-4));G[Y]-=mt,L[Y]-=ft,tt=!0}else{mt=nt*(V/(Dt+1e-4)),ft=nt*(j/(Dt+1e-4)),ht=nt*(ot/(Dt+1e-4));for(var gt=1-nt*(_t/(Dt+1e-4))/_t,dt=l.iter(l.range(0,o,!1));!dt.done;dt.next()){for(var vt=dt.value,Ct=l.iter(l.range(0,N[vt].length,!1));!Ct.done;Ct.next())D=Ct.value,N[vt][D]=N[vt][D].multiply(gt),O[vt][D]=O[vt][D]*gt;for(var St=l.iter(l.range(0,P[vt].length,!1));!St.done;St.next())D=St.value,P[vt][D]-=ht*(P[vt][D]/(ot+1e-4)),P[vt][D]=Math.max(P[vt][D],i.MIN_SPACING);G[vt]=Math.max(G[vt]-mt,i.DEFAULT_MARGINS),L[vt]=Math.max(L[vt]-ft,i.DEFAULT_MARGINS)}tt=!0}}}}for(var yt=l.iter(l.range(0,o,!1));!yt.done;yt.next()){Y=yt.value;for(var Ft=l.iter(l.range(0,N[Y].length,!1));!Ft.done;Ft.next()){D=Ft.value;var bt,At=r[Y][D],Tt=O[Y][D];(bt=l.clone(this.getSizesForScale(At,Tt,R))).length>0&&N[Y][D].height-bt[0].height>0&&(N[Y][D]=bt[0])}ot=P[Y].reduce((function(t,e){return t+e}),0),it=w[Y].reduce((function(t,e){return t+e}),0);var _t,Dt=(_t=N[Y].reduce((function(t,e){return t+e.height}),0))+(j=L[Y])+(V=G[Y])+ot+it,xt=S.height-Dt;if(!(xt<=0)){var Pt=n.verticalAlignment!=s.AlignmentType.Top?xt:0,wt=n.verticalAlignment!=s.AlignmentType.Bottom?xt:0,It=Pt+wt;if(It>0){var Gt=C.MathUtils.minDouble(xt,It);G[Y]+=Gt*(Pt/(It+1e-4)),L[Y]+=Gt*(wt/(It+1e-4)),xt-=Gt}for(var Lt=null==n.spacing?xt:0,Mt=l.iter(l.range(0,P[Y].length,!1));!Mt.done;Mt.next())D=Mt.value,P[Y][D]+=Lt*(P[Y][D]/(ot+1e-4));xt-=Lt}}for(var kt=[],Rt=l.iter(l.range(0,o,!1));!Rt.done;Rt.next()){for(var Nt=[G[Y=Rt.value]].concat(P[Y]).concat([L[Y]]),Bt=l.iter(Nt);!Bt.done;Bt.next()){var Et=Bt.value;c.CoreAssert.isFalse(isNaN(Et),"not expecting NaN","AlignmentGroupController.getColumnLayout","AlignmentGroupController.swift",911)}kt.push(l.clone(Nt))}var Ot=l.repeat(M,o),Xt=l.repeat(k,o);return new a.AlignmentColumnLayout(l.clone(v),l.clone(y),l.clone(N),l.clone(O),l.clone(kt),l.clone(w),l.clone(I),l.clone(Ot),l.clone(Xt))}return null},splitChildren:function(t,e){var n,r=1;if(null!=(n=l.opt(this.alignmentGroupStyle,(function(t){return t.numColumns})))?r=n:t.length>1&&(r=Math.max(1,Math.min(t.length,l.toInt(e.aspectRatio-1)))),1==r)return[t];for(var o=l.toDouble(t.length)/l.toDouble(r),i=[],a=0,s=l.iter(l.range(0,r,!1));!s.done;s.next()){for(var u=s.value,h=[];l.toDouble(a)<l.toDouble(u+1)*o&&a<t.length;)h.push(t[a]),a+=1;i.push(l.clone(h))}return c.CoreAssert.isTrue(a==t.length,void 0,"AlignmentGroupController.splitChildren","AlignmentGroupController.swift",987),i},applyStyle:function(t,e){var n,r;(n=l.as(t,u.AlignmentGroupStyle))&&(r=this.alignmentGroupStyle)&&(r.match(n),this.setFormaDistances(l.clone(this.getSortedChildren())),this.layoutGroup())},createLayoutItemsFromColumnLayout:function(t,e){var n,r=[];if(n=this.alignmentGroupStyle){for(var o=l.iter(l.range(0,e.columns.length,!1));!o.done;o.next()){for(var i=o.value,h=e.columns[i],m=l.clone(e.contentSizes[i]),f=l.clone(e.contentScales[i]),p=l.clone(e.contentSpacing[i]),g=l.clone(e.seperatorHeights[i]),d=l.clone(e.seperatorPositions[i]),v=p[0],C=[],S=l.iter(l.range(0,t.length,!1));!S.done;S.next()){var y=S.value;e.contentColumn[y]==i&&C.push(t[y])}c.CoreAssert.isTrue(C.length==m.length,void 0,"AlignmentGroupController.createLayoutItemsFromColumnLayout","AlignmentGroupController.swift",1043);for(var F=[],b=l.iter(l.range(0,m.length,!1));!b.done;b.next()){y=b.value;var T=new A.TheoPoint(h.center.x,v),D=new A.TheoPoint(.5,0);n.horizontalAlignment==s.AlignmentType.Left?(T=new A.TheoPoint(h.minX+e.marginLeft[i],v),D=new A.TheoPoint(0,0)):n.horizontalAlignment==s.AlignmentType.Right&&(T=new A.TheoPoint(h.maxX-e.marginRight[i],v),D=new A.TheoPoint(1,0));var x=l.clone(new a.AlignmentLayoutItem(C[y],a.AlignmentGroupItemType.DefaultContent,D,T,m[y],f[y],null,null));F.push(l.clone(x)),r.push(l.clone(x)),v+=m[y].height+p[y+1]}for(var P=0,w=l.iter(l.range(0,m.length,!1));!w.done;w.next())y=w.value,P=Math.max(P,m[y].width);for(var I=l.iter(l.range(0,g.length,!1));!I.done;I.next()){var G=d[y=I.value];x=null,x=-1==G?l.clone(F[0]):G>=F.length?l.clone(F[F.length-1]):l.clone(F[G]);var L=new _.TheoSize(.75*P,g[y]),M=null;if(n.seperatorStyle==u.SeperatorStyle.FirstInner||n.seperatorStyle==u.SeperatorStyle.BottomAll)M=new A.TheoPoint(x.parentPosition.x,x.parentPosition.y+x.size.height);else if(n.seperatorStyle==u.SeperatorStyle.Outer)L=new _.TheoSize(.75*P,g[y]),M=-1==G?new A.TheoPoint(x.parentPosition.x,x.parentPosition.y-L.height):new A.TheoPoint(x.parentPosition.x,x.parentPosition.y+x.size.height);else if(n.seperatorStyle==u.SeperatorStyle.Inner){var k=l.clone(F[G+1]);M=new A.TheoPoint(x.parentPosition.x,(x.parentPosition.y+x.size.height+k.parentPosition.y)/2)}r.push(l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.SeperatorShape,x.formaPin,M,L,null,n.seperatorArtworkID,n.colors.fieldSecondary)))}}null!=n.backingArtworkID&&r.push(l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.BackingShape,A.TheoPoint.ZERO,A.TheoPoint.ZERO,this.forma.bounds.size,null,n.backingArtworkID,n.colors.fieldPrimary)))}return r},applyColors:function(t,e){void 0===e&&(e=h.ColorRole.FieldPrimary),p.GroupController.prototype.applyColors.call(this,l.clone(t),e),this.updateBackingShape()},conformFormaToLayoutItems:function(t,e){for(var n=this,r=l.clone(this.forma.filterWithCallback((function(t){return null==t.controller&&t.kind==S.ShapeForma.KIND&&t!=n.backingShape_}),m.FormaTraversal.JustChildren)),o=l.iter(e);!o.done;o.next()){var i=o.value;if(i.type==a.AlignmentGroupItemType.DefaultContent&&null!=i.forma){var s=i.forma.placement.transformValues;l.opt(i.forma.controller,(function(t){return t.fit(T.TheoRect.fromSize(i.size))})),i.forma.move(v.Matrix2D.scalingXY(s.xscale,s.yscale)),i.forma.move(v.Matrix2D.rotation(s.rotCosine,s.rotSine)),i.forma.movePinToPoint(i.formaPin,i.parentPosition),l.opt(i.forma.controller,(function(t){return t.setAlignmentType(n.alignmentGroupStyle.horizontalAlignment)}))}else if(i.type!=a.AlignmentGroupItemType.SeperatorShape&&i.type!=a.AlignmentGroupItemType.BulletShape||null==i.artworkID){if(i.type==a.AlignmentGroupItemType.BackingShape&&null!=i.artworkID){if(null==this.backingShape_){for(var u=l.iter(this.forma.visitAsArray(m.FormaTraversal.JustChildren));!u.done;u.next()){var c=u.value;c.formaID==this.backingShapeID_&&c instanceof S.ShapeForma&&(this.backingShape_=l.as(c,S.ShapeForma),r.includes(this.backingShape_)&&l.remove(r,this.backingShape_))}null==this.backingShape_&&(this.backingShape_=l.as(this.forma.page.createForma(S.ShapeForma.KIND),S.ShapeForma),this.backingShapeID_=this.backingShape_.formaID,(C=this.forma).insertChildAt(this.backingShape_,0))}if(null!=this.backingShape_){y.ShapeLibrary.applyToShapeForma(this.backingShape_,i.artworkID),this.backingShape_.style.opacity=this.alignmentGroupStyle.opacity,(A=i.primaryColor)&&(this.backingShape_.style.colors.fieldPrimary=A);var h,f=T.TheoRect.fromSize(i.size);null!=(h=l.opt(this.alignmentGroupStyle,(function(t){return t.padding})))&&(f=f.outsetXY(h*f.width*.5,h*f.height*.5));var p=new F.SVGBackgroundDecorationStrategy(i.artworkID).calcSVGFrame(f),g=p.frame,d=p.preScale;this.backingShape_.preScale=d,this.backingShape_.size=g.size,this.backingShape_.movePinToPoint(i.formaPin,i.parentPosition),this.backingShape_.move(v.Matrix2D.translationXY(g.minX,g.minY))}}}else{var C,b,A,_=null;0==r.length?(_=l.as(this.forma.page.createForma(S.ShapeForma.KIND),S.ShapeForma),(C=this.forma).insertChildAt(_,C.childCount-1)):_=r.pop(),(b=_)&&(y.ShapeLibrary.applyToShapeForma(b,i.artworkID),(A=i.primaryColor)&&(b.style.colors.fieldPrimary=A),b.size=i.size,b.movePinToPoint(i.formaPin,i.parentPosition))}}for(var D=l.iter(r);!D.done;D.next())D.value.removeFromParent();l.opt(this.alignmentGroupStyle,(function(t){return null==t.backingArtworkID}))&&(l.opt(this.backingShape_,(function(t){return t.removeFromParent()})),this.backingShapeID_=null,this.backingShape_=null)},updateBackingShape:function(){var t;if(t=this.alignmentGroupStyle){var e=l.clone(this.getSortedChildren());if(null!=t.backingArtworkID){var n=l.clone(new a.AlignmentLayoutItem(null,a.AlignmentGroupItemType.BackingShape,A.TheoPoint.ZERO,A.TheoPoint.ZERO,this.forma.bounds.size,null,t.backingArtworkID,t.colors.fieldPrimary));this.conformFormaToLayoutItems(l.clone(e),[n])}}},layoutGroup:function(){var t,e,n=l.clone(this.getSortedChildren());if(n.length<1||this.blockAlignmentLayout_)this.updateBackingShape();else if((t=this.forma.bounds)&&(e=this.getColumnLayout(l.clone(n),t))){var r=l.clone(this.createLayoutItemsFromColumnLayout(l.clone(n),l.clone(e)));this.conformFormaToLayoutItems(l.clone(n),l.clone(r))}},fit:function(t){var e;(e=this.forma)&&(this.blockAlignmentLayout_=null==this.getChildrenAlignment(),e.bounds=T.TheoRect.fromSize(t.size),e.placement=v.Matrix2D.translation(t.origin),this.updateParentGroup(),this.blockAlignmentLayout_=!1)},updateChildren:function(){var t,e,n;if((t=this.oldBounds)&&(e=l.opt(this.forma,(function(t){return t.bounds})))&&(n=this.alignmentGroupStyle))for(var r=e.height/t.height,o=l.keys(n.bottomDistances),i=l.iter(o);!i.done;i.next()){var a=i.value;n.setBottomDistance(a,n.bottomDistances[a]*r),n.setTopDistance(a,n.topDistances[a]*r)}},match:function(t){this.blockAlignmentLayout_=!0,p.GroupController.prototype.match.call(this,t),this.blockAlignmentLayout_=!1},updateGroup:function(){this.blockUpdate||this.blockChildUpdates_||(this.blockChildUpdates_=!0,p.GroupController.prototype.updateGroup.call(this),this.updateChildren(),this.layoutGroup(),this.blockChildUpdates_=!1)},setFormaDistances:function(t){var e={},n={};if(!(t.length<1)){for(var r,o=l.clone(this.splitChildren(l.clone(t),this.forma.bounds)),i=l.iter(o);!i.done;i.next())for(var a=i.value,s=l.iter(l.range(0,a.length,!1));!s.done;s.next()){var u=s.value,c=0,h=0,m=a[u];l.opt(d.Host.logging,(function(t){return t.info("child frame "+m.finalFrame)})),c=u<a.length-1?this.getFormaFrame(a[u+1]).minY-this.getFormaFrame(m).maxY:Math.max(this.forma.bounds.maxY-this.getFormaFrame(m).maxY,0),((h=u>0?this.getFormaFrame(m).minY-this.getFormaFrame(a[u-1]).maxY:Math.max(this.getFormaFrame(m).minY-this.forma.bounds.minY,0))<0||c<0)&&l.opt(d.Host.logging,(function(t){return t.info("possible error with negative distances")})),n[m.formaID]=h,e[m.formaID]=c,l.opt(d.Host.logging,(function(t){return t.info("forma "+m.formaID+" has bottom distance: "+h+" top distance: "+c)}))}if(r=this.alignmentGroupStyle)for(var f=l.iter(l.keys(e));!f.done;f.next()){var p=f.value;r.setTopDistance(p,e[p]),r.setBottomDistance(p,n[p])}}},getFormaFrame:function(t,e){void 0===e&&(e=!1);var n,r=e?t.finalFrame:t.frame;if(n=l.as(t.controller,b.TypeLockupController)){var o=n.textFinalFrame,i=n.textFrame;null!=o&&null!=i?r=e?o:i:l.opt(d.Host.logging,(function(t){return t.error("text frame nil")}))}return r},addFormaToGroup:function(t){var e;if(e=l.as(this.forma,g.GroupForma)){if(null!=e.indexOfChild(t))return void c.CoreAssert.fail("can't add an existing child","AlignmentGroupController.addFormaToGroup","AlignmentGroupController.swift",1498);e.appendChild(t,!0),this.setAlignmentSortOrder(),this.setFormaDistances(l.clone(this.getSortedChildren()))}},insertForma:function(t,e,n){var r,o;if(void 0===e&&(e=null),void 0===n&&(n=!0),(r=l.as(this.forma,g.GroupForma))&&(o=this.alignmentGroupStyle)){if(null!=r.indexOfChild(t))return void c.CoreAssert.fail("can't insert an existing child","AlignmentGroupController.insertForma","AlignmentGroupController.swift",1519);var i=l.clone(this.getSortedChildren());if(null!=e&&(e<0||e>i.length))return void c.CoreAssert.fail("index not valid ","AlignmentGroupController.insertForma","AlignmentGroupController.swift",1527);var a=this.getFormaFrame(t),s=null!=e?e:0;if(null==e)for(var u=l.iter(l.range(0,i.length,!1));!u.done;u.next()){var h=u.value;a.minY>this.getFormaFrame(i[h]).minY&&(s=h+1)}0==s?(o.setBottomDistance(t.formaID,o.bottomDistances[i[0].formaID]),o.setTopDistance(t.formaID,o.topDistances[i[0].formaID]),o.setBottomDistance(i[0].formaID,o.topDistances[t.formaID])):s==i.length?(o.setBottomDistance(t.formaID,o.bottomDistances[i[s-1].formaID]),o.setTopDistance(t.formaID,o.topDistances[i[s-1].formaID]),o.setTopDistance(i[s-1].formaID,o.bottomDistances[t.formaID])):(o.setBottomDistance(t.formaID,o.topDistances[i[s-1].formaID]),o.setTopDistance(t.formaID,o.topDistances[i[s-1].formaID]));var m=l.clone(o.order);m.splice(s,0,t.formaID),o.setOrder(l.clone(m)),null!=o.topDistances[t.formaID]&&null!=o.bottomDistances[t.formaID]||c.CoreAssert.fail("missing distances","AlignmentGroupController.insertForma","AlignmentGroupController.swift",1624),r.appendChild(t,!0),this.layoutGroup()}},removeFormaFromGroup:function(t){var e;p.GroupController.prototype.removeFormaFromGroup.call(this,t),(e=this.alignmentGroupStyle)&&(e.removeChild(t.formaID),this.inferStyleProperties())},handleRemoval:function(){for(var t=l.iter(this.getSortedChildren());!t.done;t.next()){var e=t.value;l.opt(l.opt(this.forma,(function(t){return t.parent})),(function(t){return t.appendChild(e,!0)}))}},scaleChildren:function(t){},beginChildResizeEvent:function(t){this.updatedChild=t.forma},endChildResizeEvent:function(t){this.updatedChild=null,l.removeKey(this.childScales_,t.forma.formaID)},childUpdate:function(t){void 0===t&&(t=null)},processBeginFormaDrag:function(t){p.GroupController.prototype.processBeginFormaDrag.call(this,t)},processEndFormaDrag:function(t){p.GroupController.prototype.processEndFormaDrag.call(this,t),this.containsForma(t.forma)||(l.opt(l.opt(this.forma,(function(t){return t.parent})),(function(e){return e.appendChild(t.forma,!0)})),l.opt(this.alignmentGroupStyle,(function(e){return e.removeChild(t.forma.formaID)}))),this.inferStyleProperties(),this.claimSiblingForma()},afterProcessEndFormaDrag:function(t){this.containsForma(t.forma)||(l.opt(l.opt(this.forma,(function(t){return t.parent})),(function(e){return e.appendChild(t.forma,!0)})),l.opt(this.alignmentGroupStyle,(function(e){return e.removeChild(t.forma.formaID)}))),this.inferStyleProperties(),this.claimSiblingForma()},processFormaDrag:function(t){p.GroupController.prototype.processFormaDrag.call(this,t)},inferStyleProperties:function(){var t;if(t=this.alignmentGroupStyle){this.setAlignmentSortOrder();var e,n,r=l.clone(this.getSortedChildren());this.setFormaDistances(l.clone(r)),t.spacing=null,r.length>0&&null!=(e=t.bottomDistances[r[0].formaID])&&null!=(n=t.topDistances[r[r.length-1].formaID])&&(t.verticalAlignment=e>2*n&&e>50?s.AlignmentType.Bottom:n>2*e&&n>50?s.AlignmentType.Top:s.AlignmentType.CenterY);var o=this.getChildrenAlignment();null!=o&&(this.alignmentGroupStyle.horizontalAlignment=o),this.childrenAligned_=null!=o||r.length<=1}},canClaimForma:function(t){var e,n,r=t.finalFrame,o=l.opt(this.forma,(function(t){return t.finalFrame}));if(null!=r&&null!=o&&(e=l.opt(this.forma,(function(t){return t.parent})))&&(n=this.alignmentGroupStyle)){if(n.layoutMode==u.GroupLayoutMode.None)return!1;var i,a;if(t.parent==e&&null!=(i=e.indexOfChild(this.forma))&&null!=(a=e.indexOfChild(t))&&i>a)return!1;if(this.containsForma(t))return!0}return!1},claimForma:function(t){p.GroupController.prototype.claimForma.call(this,t),this.forma!=t.parent&&!l.eq(m._equality_Forma_Forma,this.forma,t)&&this.canClaimForma(t)&&this.inferStyleProperties()},claimSiblingForma:function(){for(var t=l.iter(this.forma.siblingForma());!t.done;t.next()){var e=t.value;this.claimForma(e)}},getChildrenAlignment:function(){var t=l.clone(this.moveableFormae());if(0==t.length)return null;var e,n=1,r=l.first(t);(e=l.opt(l.opt(r,(function(t){return t.page.view})),(function(t){return t.getViewportTransform()})))&&(n=Math.sqrt(Math.abs(e.determinant)));for(var o,i=s.AlignmentDetector.DISTANCE_THRESHOLD/n,a=l.iter(t);!a.done;a.next()){var u=a.value;if(u.placement.transformValues.rotCosine<.99)return null;for(var c,h=0,f={},p=l.clone(s.AlignmentDetector.init_a05b(u).detectFormaAlignments(2*i)),g=l.iter(t);!g.done;g.next()){var d=g.value;if(!l.eq(m._equality_Forma_Forma,u,d)&&u.finalFrame.xDistance(d.finalFrame)<=0){h+=1;for(var v=l.iter(p);!v.done;v.next()){var C,S=v.value;l.eq(m._equality_Forma_Forma,S.forma,d)&&(null!=(C=f[S.line.type])?f[S.line.type]=C+1:f[S.line.type]=1)}}}for(var y=l.iter(f,!0);!y.done;y.next()){var F=y.key;y.value==h&&(c=s.AlignmentType.toCaseValue(F))}if(0==h)c=l.opt(u.controller,(function(t){return t.preferredXAlignment}));else if(null==c)return null;o=c}return o},preferredXAlignment:{get:function(){return l.opt(this.alignmentGroupStyle,(function(t){return t.horizontalAlignment}))}},setupWithFormae:function(t,e,n){if(void 0===e&&(e=null),void 0===n&&(n=null),0!=t.length){var r=n;null==r&&(r=t[0]);var o,i=e;null==i&&(i=null!=(o=l.opt(r.controller,(function(t){return t.preferredXAlignment})))?o:s.AlignmentType.CenterX),this.setHorizontalAlignment(i,n);for(var a,u=null,c=l.iter(t);!c.done;c.next()){var h=c.value;u=T.TheoRect.unionOf(u,this.getFormaFrame(h,!0))}(a=u)&&l.opt(this.forma,(function(t){return t.placement}))&&(l.opt(this.forma,(function(t){return t.bounds=T.TheoRect.fromSize(a.size)})),l.opt(this.forma,(function(t){return t.placement=v.Matrix2D.translationXY(a.minX,a.minY)})));for(var m=l.iter(t);!m.done;m.next())h=m.value,p.GroupController.prototype.addFormaToGroup.call(this,h);this.setFormaDistances(l.clone(this.getSortedChildren()))}},processBeginFormaResize:function(t){p.GroupController.prototype.processBeginFormaResize.call(this,t),this.childrenAligned_=null!=this.getChildrenAlignment()},processFormaResize:function(t){this.blockAlignmentLayout_=!0;var e,n,r=null;if((n=t.pin)&&(r=this.forma.totalPlacement.transformPoint(this.forma.bounds.eval(n))),this.forma.placement=this.forma.placement.scaleTo(1,1),this.forma.bounds=T.TheoRect.fromSize(t.newSize),(e=r)&&(n=t.pin)){var o=this.forma.totalPlacement.transformPoint(this.forma.bounds.eval(n));this.forma.move(v.Matrix2D.translation(e.subtract(o)))}this.updateParentGroup()},processEndFormaResize:function(t){p.GroupController.prototype.processEndFormaResize.call(this,t),this.blockAlignmentLayout_=!1,this.claimSiblingForma()},dispose:function(){},clone:function(t){return new f.FormaControllerFactory(this.owner).createController(this.kind,t)}}}),i)},"aen+":function(t,e,n){var r,o=e,i=n("oAGj"),a=n("H9Ol");o.AbsolutePositionController=(r=function(t,e,n){a.FormaController.call(this,t,e,n)},i.defineClass({name:"AbsolutePositionController",ctor:r,superName:"FormaController",statics:{KIND:{get:function(){return"AbsolutePositionController"}}}}),r)},dHJt:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("SpAV"),l=n("16hp"),s=n("6Rk9"),u=n("tGKA"),c=n("oKlP");o.BadgeLayoutController=(r=function(t,e){void 0===e&&(e=!0),this._formae=i.clone(t),this._usePerceivedBounds=e},i.defineClass({name:"BadgeLayoutController",ctor:r,props:{update:function(){if(0!=this._formae.length){var t=this._formae[0],e=t.page.root,n=s.GeometryFacade.getFormaeBounds(i.clone(this._formae),this._usePerceivedBounds),r=new l.FormaPlacementSuggester(t,e),o=i.clone(r.createPlacementSuggestions(!0,n.aspectRatio));if(0==!o.length)for(var h=o[0].location,m=h.height/n.height,f=u.Matrix2D.translation(h.origin),p=i.iter(this._formae);!p.done;p.next()){var g=p.value;g.bounds=g.bounds.scale(m,c.TheoPoint.ZERO);var d=g.totalPlacement,v=(d.tx-n.minX)*m,C=(d.ty-n.minY)*m;g.placement=new u.Matrix2D(d.a,d.b,d.c,d.d,v,C).concat(f)}else a.CoreAssert.warning("Did not find a placement suggestion for badge.")}}}}),r)},k7ZV:function(t,e,n){n("oAGj")},lgJd:function(t,e,n){n("oAGj")},voLh:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("gXiO"),l=n("FNB+"),s=n("P83h"),u=n("fdtz"),c=n("oKlP"),h=n("zjod");o.ProportionalLayoutController=(r=function(t){this.group_=t,this.oldBounds_={},a.CoreObject.call(this)},i.defineClass({name:"ProportionalLayoutController",ctor:r,superName:"CoreObject",statics:{_implements:function(t){return"ResizeLayoutController"==t}},props:{setInitBounds:function(){this.oldBounds_[this.group_.formaID]=this.group_.bounds},beginUpdateGroup:function(){this.startBounds_=this.group_.bounds,null==this.oldBounds_[this.group_.formaID]&&(this.oldBounds_[this.group_.formaID]=this.group_.bounds);for(var t=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!t.done;t.next()){var e=t.value;null==this.oldBounds_[e.formaID]&&(this.oldBounds_[e.formaID]=e.bounds)}},updateGroup:function(){if(null!=this.startBounds_){var t=this.startBounds_.size,e=this.group_.bounds.size,n=new c.TheoPoint(e.width/t.width,e.height/t.height),r=new s.FormaAnimationTransactionEvent(this.group_);this.group_.beginUpdate(r);for(var o=i.iter(this.group_.visitAsArray(l.FormaTraversal.JustChildren));!o.done;o.next()){var a,m,f,p=o.value;if(p.kind!=u.ImageForma.KIND&&p.kind!=h.VideoForma.KIND&&(a=p.frame)&&(m=this.oldBounds_[p.formaID])&&(f=this.oldBounds_[this.group_.formaID])&&a.area>0){var g=p.placement.transformValues,d=Math.abs(g.rotCosine)/(Math.abs(g.rotCosine)+Math.abs(g.rotSine)),v=Math.abs(g.rotSine)/(Math.abs(g.rotCosine)+Math.abs(g.rotSine)),C=new c.TheoPoint(n.x*d+n.y*v,n.x*v+n.y*d);if(null!=p.controller&&p.controller.maintainAspectRatio){var S=new c.TheoPoint(e.width/f.size.width,e.height/f.size.height),y=new c.TheoPoint(S.x*d+S.y*v,S.x*v+S.y*d),F=Math.min(y.x,y.y);p.bounds=m.scaleXY(F,F,new c.TheoPoint(0,0))}else p.bounds=i.opt(p.bounds,(function(t){return t.scaleXY(C.x,C.y,new c.TheoPoint(0,0))}));p.moveCenterToPoint(new c.TheoPoint(a.center.x*n.x,a.center.y*n.y))}}this.group_.endUpdate(r)}},endUpdateGroup:function(){}}}),r)},waL6:function(t,e,n){var r,o=e,i=n("oAGj"),a=n("XmBt"),l=n("SpAV"),s=n("gXiO"),u=n("6ZWm"),c=n("9Lk3"),h=n("ZK0l"),m=n("NkBu"),f=n("uxH+"),p=n("JO5d"),g=n("8t9B"),d=n("fGVU");o.FormaControllerFactory=(r=function(t){this.constructors_={},this.owner_=t,s.CoreObject.call(this),this.setConstructors()},i.defineClass({name:"FormaControllerFactory",ctor:r,superName:"CoreObject",props:{owner:{get:function(){return this.owner_},set:function(t){this.owner_=t,this.setConstructors()}},setConstructors:function(){var t=this;this.constructors_[h.GroupController.KIND]=function(e,n,r){return new h.GroupController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[f.RootController.KIND]=function(e,n,r){return new f.RootController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[u.FrameController.KIND]=function(e,n,r){return new u.FrameController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[m.ImageController.KIND]=function(e,n,r){return new m.ImageController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[d.VideoController.KIND]=function(e,n,r){return new d.VideoController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[p.ShapeController.KIND]=function(e,n,r){return new p.ShapeController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[g.TypeLockupController.KIND]=function(e,n,r){return new g.TypeLockupController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[a.AlignmentGroupController.KIND]=function(e,n,r){return new a.AlignmentGroupController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_[c.GridController.KIND]=function(e,n,r){return new c.GridController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_.AbsolutePositionController=function(e,n,r){return new f.RootController(e,n,i.opt(t,(function(t){return t.owner_})))},this.constructors_.responsive=function(e,n,r){return new h.GroupController(e,n,i.opt(t,(function(t){return t.owner_})))}},createController:function(t,e){var n=this.constructors_[t];return null==n?(l.CoreAssert.warning("createController: No constructor for kind "+t+" available."),null):n(t,e,this.owner_)}}}),r)}}]);
//# sourceMappingURL=vendors_npm_spark_fc608f14-d220d9ac.js.map
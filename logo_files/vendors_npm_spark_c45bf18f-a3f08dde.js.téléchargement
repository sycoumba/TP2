(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[27],{"+nk0":function(e,t,n){var o,r=t,i=n("oAGj"),a=n("gXiO");r.ControllerEvent=(o=function(e){this.type=e,a.CoreObject.call(this)},i.defineClass({name:"ControllerEvent",ctor:o,superName:"CoreObject"}),o)},"1HsO":function(e,t,n){var o,r,i,a,l,s,u,c,m,d,h=t,f=n("oAGj"),p=n("gXiO");h.BaseHandle=(o=function(){p.CoreObject.call(this)},f.defineClass({name:"BaseHandle",ctor:o,superName:"CoreObject"}),o),h.TransformType=f.defineEnum("TransformType",{None:0,RotateAboutCenter:1,Translate:2,ProportionalScaleAboutCenter:3,TopLeftCornerTranslate:4,TopRightCornerTranslate:5,BottomLeftCornerTranslate:6,BottomRightCornerTranslate:7,LeftSideTranslate:8,RightSideTranslate:9,TopSideTranslate:10,BottomSideTranslate:11,LetterSpacing:12,LineSpacing:13}),h.BoxReference=(r=function(e,t){this.placement=e,this.bounds=t},f.defineClass({name:"BoxReference",ctor:r,superName:"CoreObject"}),r),h.BoxHandleDisplayHint=f.defineEnum("BoxHandleDisplayHint",{ThinOutline:0,TextFrame:1,SuppressRotationHandle:2,SuppressTranslationHandle:3,SuppressResizeAnimation:4,WideOutline:5,GroupOutlineColor:6,CropMode:7}),h.BoxTransformHandles=(i=function(e,t,n,o,r){this.reference=e,this.allowedTransforms=f.clone(t),this.displayHints=f.clone(n),this.activeTransform=o,this.handlesTarget=r},f.defineClass({name:"BoxTransformHandles",ctor:i,superName:"BaseHandle"}),i),h.BoxTransformMultipleFormae=(a=function(e,t,n,o,r,i){this.formaIDs=f.clone(i),h.BoxTransformHandles.call(this,e,f.clone(t),f.clone(n),o,r)},f.defineClass({name:"BoxTransformMultipleFormae",ctor:a,superName:"BoxTransformHandles"}),a),h.HandleTransformStage=f.defineEnum("HandleTransformStage",{Begin:0,Update:1,End:2}),h.HandleTransformEvent=(l=function(e,t){this.viewportScale=1,this.handle=e,this.stage=t},f.defineClass({name:"HandleTransformEvent",ctor:l,superName:"CoreObject"}),l),h.TranslateTransformEvent=(s=function(e,t,n){this.event=n,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"TranslateTransformEvent",ctor:s,superName:"HandleTransformEvent"}),s),h.MoveTransformEvent=(u=function(e,t,n){this.totalDelta=n,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"MoveTransformEvent",ctor:u,superName:"HandleTransformEvent"}),u),h.RotateAboutCenterTransformEvent=(c=function(e,t,n){this.totalDeltaRadians=n,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"RotateAboutCenterTransformEvent",ctor:c,superName:"HandleTransformEvent"}),c),h.CornerTranslateTransformEvent=(m=function(e,t,n,o){this.transformType=n,this.position=o,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"CornerTranslateTransformEvent",ctor:m,superName:"HandleTransformEvent"}),m),h.SideTranslateTransformEvent=(d=function(e,t,n,o){this.transformType=n,this.position=o,h.HandleTransformEvent.call(this,e,t)},f.defineClass({name:"SideTranslateTransformEvent",ctor:d,superName:"HandleTransformEvent"}),d)},"6NRR":function(e,t,n){var o,r,i,a=t,l=n("oAGj"),s=n("VQVe"),u=n("SpAV"),c=n("gXiO"),m=n("ascj"),d=n("FNB+"),h=n("URxh"),f=n("6ZWm"),p=n("cmoc"),g=n("P83h"),y=n("pnSN"),T=n("SDdr"),C=n("lmwz"),S=n("c+uM"),v=n("tGKA"),F=n("K17h"),_=n("djAF"),A=n("enh0"),w=n("8t9B"),E=n("90dd"),b=n("RkYL"),D=n("xm77"),I=n("zjod");a.KeyFrameSet=(o=function(){},l.defineClass({name:"KeyFrameSet",ctor:o}),o),a.AnimationRequestStopMessage=(r=function e(t){E.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"AnimationRequestStopMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"AnimationRequestStopMessage"}}}}),r),a.AnimationController=(i=function(e){this.staticStateTransaction_=null,this.document_=e,this.staticState_={},this.playing_=!1,this.postAnimationCallbacks_=null,c.CoreObject.call(this)},l.defineClass({name:"AnimationController",ctor:i,superName:"CoreObject",props:{playing:{get:function(){return this.playing_},set:function(e){this.playing_=e}},hasVideos:{get:function(){var e;return!!(e=this.document_)&&e.firstPage.root.filterWithCallback((function(e){return e instanceof I.VideoForma})).length>0}},hasTrueVideos:{get:function(){var e;return!!(e=this.document_)&&e.firstPage.root.filterWithCallback((function(e){var t;return!!(t=l.as(e,I.VideoForma))&&!t.isSticker()})).length>0}},hasAnimation:{get:function(){return this.hasVideos||this.hasAnimatedFormae}},hasAnimatedFormae:{get:function(){return null!=this.animationStyle&&!this.animationStyle.isNoStyle()&&0==!l.clone(this.document_.firstPage.root.filterWithCallback((function(e){return null!=e.animation||e.isVideo()}))).length}},gifStartTimeIndex:{get:function(){var e;if(e=this.animationStyle){var t=l.clone(this.document_.firstPage.root.filterWithCallback((function(e){return e instanceof I.VideoForma&&e.videoContentNode.isGIF})));if(0==t.length)return 0;for(var n=e.startTime.seconds,o=l.iter(t);!o.done;o.next()){var r,i=o.value;(r=l.opt(i.animation,(function(e){return e.keyFrames})))&&r.length>1&&(n=Math.max(n,r[1].time.seconds))}for(var a=l.clone(this.times),s=l.iter(l.range(0,a.length-1,!1));!s.done;s.next()){var u=s.value;if(n>=a[u].seconds&&n<a[u+1].seconds)return u}}return 0}},animationStyle:{get:function(){return F.MotionUtils.getCurrentAnimationStyle(this.document_)},set:function(e){var t,n=e;if(null==n&&(n=s.AnimationStyle.init_b946(s.AnimationStyle.NAME_NO_STYLE)),t=this.document_){var o=new g.AnimationStyleChangedEvent(t.firstPage.root);t.firstPage.root.beginUpdate(o),t.firstPage.animationLibrary.modifyModelForAnimation(n,t.firstPage.root),t.firstPage.root.endUpdate(o)}}},isCurrentAnimationValid:{get:function(){return F.MotionUtils.isCurrentAnimationValid(this.document_)}},duration:{get:function(){return l.last(this.times)||b.TheoTime.Zero}},times:{get:function(){var e;if(e=this.animationStyle){for(var t=[],n=e.endTime.value,o=l.toInt(e.endTime.timescale/s.AnimationStyle.DEFAULT_TIMESCALE),r=l.iter(l.stride(0,n,o));!r.done;r.next()){var i=r.value;t.push(new b.TheoTime(i,e.endTime.timescale))}return 0==t.length&&this.document_.firstPage.root.visitAll(d.FormaTraversal.PreOrder,(function(e){var n,o;(n=l.as(e,I.VideoForma))&&(o=l.opt(n.videoContentNode,(function(e){return e.times})))&&(t=l.clone(o))})),t}return[]}},preAnimation:function(){u.CoreAssert.isTrue(null==this.staticStateTransaction_,"preAnimation called with outstanding animation transaction","AnimationController.preAnimation","AnimationController.swift",193),this.staticStateTransaction_=this.document_.beginTransaction("Animation")},postAnimation:function(){l.opt(this.staticStateTransaction_,(function(e){return e.rollback()})),this.staticStateTransaction_=null},processStopAnimationCallbacks:function(){var e;if(e=this.postAnimationCallbacks_){for(var t=l.iter(e);!t.done;t.next())(0,t.value)();this.postAnimationCallbacks_=null}},saveStaticState:function(){var e=this;this.staticState_={},this.document_.firstPage.root.visitAll(d.FormaTraversal.PreOrder,(function(t){if(null!=t.animation){var n=t.style.clone(),o=new h.KeyFrame(b.TheoTime.Zero,D.TimingFunctionType.Linear,t.placement,t.bounds,n);null!=n&&t.kind==I.VideoForma.KIND&&0==n.opacity&&l.info("opacity is 0?"),e.staticState_[t.formaID]=o}}))},revertToStaticState:function(){var e;if(null!=this.document_){if(e=this.staticState_)for(var t=l.iter(e);!t.done;t.next()){var n,o,r=t.key,i=t.value;if((n=l.opt(this.document_,(function(e){return e.firstPage.root.formaByID(r)})))&&i.style&&(o=l.as(n,A.TextForma))){var a=new g.FormaStyleChangedEvent(o);o.beginUpdate(a),o.renderRuns.clear(),o.endUpdate(a)}}}else u.CoreAssert.fail("no document. really?","AnimationController.revertToStaticState","AnimationController.swift",238)},determineKeyFrameSetForTime:function(e,t){var n=new a.KeyFrameSet,o=e.keyFrames.length;if(o>0){for(var r=t.seconds,i=l.iter(l.toSequence(e.keyFrames));!i.done;i.next()){var s=i.value,u=s.offset,c=s.element;if(c.time.seconds>=r){n.kfB=c,u>0&&(n.kfA=e.keyFrames[u-1]);break}}null==n.kfB&&(n.kfA=e.keyFrames[o-1])}return n},determineAlpha:function(e,t){var n=1;if(null!=e.kfB&&null!=e.kfA){var o=new D.TheoTimingFunction(e.kfB.timingFunction),r=(t.seconds-e.kfA.time.seconds)/(e.kfB.time.seconds-e.kfA.time.seconds);n=o.evalX(r)}return n},determinePlacementShift:function(e,t){var n,o,r=v.Matrix2D.Identity;return(n=l.opt(e.kfA,(function(e){return e.placement})))?r=(o=l.opt(e.kfB,(function(e){return e.placement})))?n.interpolateWith(o,t):n:(o=l.opt(e.kfB,(function(e){return e.placement})))&&(r=o),r},moveToTime:function(e){var t=this;if(null==this.document_)return u.CoreAssert.fail("no document. really?","AnimationController.moveToTime","AnimationController.swift",321),!1;if(null==this.staticState_)return u.CoreAssert.fail("no static state defined","AnimationController.moveToTime","AnimationController.swift",326),!1;var n,o=!1,r=new g.FormaStyleChangedEvent(this.document_.firstPage.root);if(l.opt(this.document_,(function(e){return e.firstPage.beginUpdate(r)})),l.opt(this.document_,(function(n){return n.firstPage.root.visitAll(d.FormaTraversal.PreOrder,(function(n){var r,i;if((r=n.animation)&&(i=t.staticState_[n.formaID])){var a=t.determineKeyFrameSetForTime(r,e);if(null!=a.kfA||null!=a.kfB){o=!0;var u,c,m,h=t.determineAlpha(a,e),v=i.placement,F=t.determinePlacementShift(a,h);n.placement=v.concat(F),(u=l.opt(a.kfA,(function(e){return e.bounds})))&&(c=l.opt(a.kfB,(function(e){return e.bounds})))&&(u.equalWithAccuracy(c,.01)||(n.bounds=u.interpolateWith(c,h),(m=l.as(n.controller,f.FrameController))&&m.fitChildrenToFrame()));var E=l.opt(a.kfA,(function(e){return e.style})),b=l.opt(a.kfB,(function(e){return e.style}));if(null==E&&null==b)return;null==E?E=b:null==b&&(b=E);var D,I,R,k=new g.FormaStyleChangedEvent(n);if(n.beginUpdate(k),t.setBlendedRoles(n.style.colors,E.colors,b.colors,h),(D=l.as(E,S.LockupStyle))&&(I=l.as(b,S.LockupStyle))&&(R=l.as(n.style,S.LockupStyle)))for(var L=l.keys(R.characterStyles),x=l.iter(L);!x.done;x.next()){var P,M,G,K=x.value;(P=D.characterStyles[K])&&(M=I.characterStyles[K])&&(G=R.characterStyles[K])&&t.setBlendedRoles(G.colors,P.colors,M.colors,h)}var O,N=(1-h)*E.opacity+h*b.opacity,B=l.as(l.opt(l.opt(l.as(n,A.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),w.TypeLockupController);if(n.isTypeLockup()||null!=B){var z,U,Y,H=N,V=N;if((z=l.as(E,S.LockupStyle))&&(U=l.as(b,S.LockupStyle))&&(H=(1-h)*z.textOpacity+h*U.textOpacity,V=(1-h)*z.backingOpacity+h*U.backingOpacity),n.kind==_.ShapeForma.KIND)l.opt(n.parent,(function(e){return e.style.opacity=V}));else if(Y=l.as(n,A.TextForma))if(r.animationStyle.modifiesFormaTree){n.style.opacity=H;var W=(a.kfB||a.kfA).renderRuns;null!=a.kfB&&null!=a.kfA&&a.kfA.renderRuns.fillColors.runArrays.length>1&&0==W.fillColors.runArrays.length?Y.renderRuns.setAlphaFromAnimation(a.kfA.renderRuns,W,h):Y.renderRuns=W.clone()}else n.style.opacity=H;else n.kind==y.GroupForma.KIND&&n.visitAll(d.FormaTraversal.PreOrder,(function(e){e instanceof A.TextForma&&l.opt(e.parent,(function(e){return e.style.opacity=H})),e instanceof _.ShapeForma&&l.opt(e.parent,(function(e){return e.style.opacity=V}))}))}else if(n.kind==p.FrameForma.KIND){var q;(q=C.ImageFacade.getImageFormaForForma(n))&&(q.style.opacity=N)}else n.style.opacity=N;if(null!=E.filter&&null!=b.filter)if(r.animationStyle.name==s.AnimationStyle.NAME_BLUR){if(O=E.clone()){O.colorLibrary=E.colorLibrary;var j=E.filter.blurRadius,X=b.filter.blurRadius;O.filter.blurRadius=(1-h)*j+h*X,n.applyStyle(O)}}else if(!l.opt(E.filter,(function(e){return e.equals(b.filter)}))){var Z=T.AlphaBlendFilter.init_fa22(void 0,h,E.filter,b.filter);Z.style=n.style,n.style.filter=Z}n.endUpdate(k)}}}))})),n=l.opt(this.document_,(function(e){return e.firstPage.root}))){var i=new g.AnimationTimeChangedEvent(n,e);n.beginUpdate(i),n.endUpdate(i)}return l.opt(this.document_,(function(e){return e.firstPage.endUpdate(r)})),o},setBlendedRoles:function(e,t,n,o){var r,i;(r=t.fieldPrimary)&&(i=n.fieldPrimary)&&e.setBlendedColor(m.ColorRole.FieldPrimary,r,i,o),(r=t.fieldSecondary)&&(i=n.fieldSecondary)&&e.setBlendedColor(m.ColorRole.FieldSecondary,r,i,o)},stopWithCallback:function(e){var t;if(this.playing_){if(null==this.postAnimationCallbacks_?this.postAnimationCallbacks_=[e]:this.postAnimationCallbacks_.push(e),t=l.opt(this.document_,(function(e){return e.firstPage}))){var n=new a.AnimationRequestStopMessage(t);t.publish(n)}}else e()}}}),i)},AVHO:function(e,t,n){var o,r,i,a,l,s=t,u=n("oAGj"),c=n("gXiO");s.ControllerSettings=(o=function(e){this.type=e,c.CoreObject.call(this)},u.defineClass({name:"ControllerSettings",ctor:o,superName:"CoreObject"}),o),s.TypeLockupControllerSettings=(r=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"TypeLockupControllerSettings",ctor:r,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"TypeLockupControllerSettings"}}}}),r),s.ImageControllerSettings=(i=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ImageControllerSettings",ctor:i,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ImageControllerSettings"}}}}),i),s.RootControllerSettings=(a=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"RootControllerSettings",ctor:a,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"RootControllerSettings"}}}}),a),s.ShapeControllerSettings=(l=function e(t){this.controller=t,s.ControllerSettings.call(this,e.TYPE)},u.defineClass({name:"ShapeControllerSettings",ctor:l,superName:"ControllerSettings",statics:{TYPE:{get:function(){return"ShapeControllerSettings"}}}}),l)},AnBp:function(e,t,n){var o,r,i,a,l,s,u=t,c=n("oAGj"),m=n("umUn");u.IEditorAttribute=c.defineProtocol("IEditorAttribute",{key:"String",isEqualTo:"(IEditorAttribute) -> Boolean"}),u.EditorAttributeBase=(o=function(e){this._key=e},c.defineClass({name:"EditorAttributeBase",ctor:o,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),o),u.ColorAttribute=(r=function e(t){this.colors=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ColorAttribute",ctor:r,superName:"EditorAttributeBase",statics:{KEY:"color",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,r)){if(this.colors.length!=t.colors.length)return!1;for(var n=c.iter(c.range(0,this.colors.length,!1));!n.done;n.next()){var o=n.value;if(!c.eq(m._equality_TheoColor_TheoColor,this.colors[o],t.colors[o]))return!1}return!0}return!1}}}),r),u.OpacityAttribute=(i=function e(t){this.opacities=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"OpacityAttribute",ctor:i,superName:"EditorAttributeBase",statics:{KEY:"opacity",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,i)){if(this.opacities.length!=t.opacities.length)return!1;for(var n=c.iter(c.range(0,this.opacities.length,!1));!n.done;n.next()){var o=n.value;if(this.opacities[o]!=t.opacities[o])return!1}return!0}return!1}}}),i),u.MediaMetadataAttribute=(a=function e(t){this.mmds=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"MediaMetadataAttribute",ctor:a,superName:"EditorAttributeBase",statics:{KEY:"mediaMetadata",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,a)){if(this.mmds.length!=t.mmds.length)return!1;for(var n=c.iter(c.range(0,this.mmds.length,!1));!n.done;n.next()){var o=n.value;if(!this.mmds[o].isEqualTo(t.mmds[o]))return!1}return!0}return!1}}}),a),u.ControllerSettingAttribute=(l=function e(t){this.settings=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ControllerSettingAttribute",ctor:l,superName:"EditorAttributeBase",statics:{KEY:"controllerSetting",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,l)){if(this.settings.length!=t.settings.length)return!1;for(var n=c.iter(c.range(0,this.settings.length,!1));!n.done;n.next()){var o=n.value;if(this.settings[o].type!=t.settings[o].type)return!1}return!0}return!1}}}),l),u.ImageAttribute=(s=function e(t){this.styles=c.clone(t),u.EditorAttributeBase.call(this,e.KEY)},c.defineClass({name:"ImageAttribute",ctor:s,superName:"EditorAttributeBase",statics:{KEY:"imageAttr",_implements:function(e){return"IEditorAttribute"==e}},props:{isEqualTo:function(e){var t;if(t=c.as(e,s)){if(this.styles.length!=t.styles.length)return!1;for(var n=c.iter(c.range(0,this.styles.length,!1));!n.done;n.next()){var o=n.value;if(!this.styles[o].equals(t.styles[o]))return!1}return!0}return!1}}}),s)},Bpjk:function(e,t,n){var o,r,i,a=t,l=n("oAGj"),s=n("gXiO");a.CropRatioPreset=(o=function(e,t,n,o,r){this.label=e,this.secondaryLabel=t,this.id=n,this.iconId=o,this.aspectRatio=r},l.defineClass({name:"CropRatioPreset",ctor:o,superName:"CoreObject"}),o),a.CropRatioPresetLibrary=(r=function(){s.CoreObject.call(this)},i={},l.defineClass({name:"CropRatioPresetLibrary",ctor:r,superName:"CoreObject",statics:{FREEFORM_ID:"Free",ORIGINAL_ID:"Original",NONE_ID:"None",FREECROP_PRESET:{get:function(){return void 0===i.FREECROP_PRESET&&(i.FREECROP_PRESET=new a.CropRatioPreset("k_Crop_Freeform","",r.FREEFORM_ID,"CropPaneFreeform",1)),i.FREECROP_PRESET}},ORIGINAL_SIZE_PRESET:{get:function(){return void 0===i.ORIGINAL_SIZE_PRESET&&(i.ORIGINAL_SIZE_PRESET=new a.CropRatioPreset("k_Crop_Original","",r.ORIGINAL_ID,"",0)),i.ORIGINAL_SIZE_PRESET}},ratios:{get:function(){return void 0===i.ratios&&(i.ratios=[new a.CropRatioPreset("k_Crop_Square","k_1_1_label","1:1","",1),new a.CropRatioPreset("","k_4_3_label","4:3","",1.33333333333),new a.CropRatioPreset("","k_3_4_label","3:4","",.75),new a.CropRatioPreset("","k_16_9_label","16:9","",1.77777777778),new a.CropRatioPreset("","k_9_16_label","9:16","",.5625)]),i.ratios}},getListOfRatios:function(){return r.ratios},getIdForRatio:function(e){var t=r.ratios.filter((function(t){return t.aspectRatio==e}),this);return 0==t.length?null:t[0].id}}}),r)},"G/OM":function(e,t,n){var o,r,i,a,l,s,u,c=t,m=n("oAGj");c.IFeatureSet=m.defineProtocol("IFeatureSet",{key:"String",isEqualTo:"(IFeatureSet) -> Boolean"}),c.FeatureSetBase=(o=function(e){this._key=e},m.defineClass({name:"FeatureSetBase",ctor:o,superName:"CoreObject",props:{key:{get:function(){return this._key}}}}),o),c.TextFrameAttributesFeature=(r=function e(){c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"TextFrameAttributesFeature",ctor:r,superName:"FeatureSetBase",statics:{KEY:"TextFrameAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof r}}}),r),c.AlignSpacingAttributesFeature=(i=function e(t,n,o,r){this.canAlign=t,this.canDistribute=n,this.canDoRow=o,this.canDoColumn=r,c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"AlignSpacingAttributesFeature",ctor:i,superName:"FeatureSetBase",statics:{KEY:"AlignSpacingAttributesFeature",find:function(e){return m.as(e.find(i.KEY),i)},_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=m.as(e,i))&&t.canAlign==this.canAlign&&t.canDistribute==this.canDistribute&&t.canDoRow==this.canDoRow&&t.canDoColumn==this.canDoColumn}}}),i),c.FormaEditFeature=(a=function e(t,n,o,r,i,a,l,s){this.canMultiselect=t,this.canDuplicate=n,this.canGroup=o,this.canUngroup=r,this.canRecolor=i,this.canDelete=a,this.canEditSettings=l,this.supportsMultiStyle=s,c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"FormaEditFeature",ctor:a,superName:"FeatureSetBase",statics:{KEY:"FormaEditFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=m.as(e,a))&&t.canMultiselect==this.canMultiselect&&t.canDuplicate==this.canDuplicate&&t.canGroup==this.canGroup&&t.canUngroup==this.canUngroup&&t.canRecolor==this.canRecolor&&t.canDelete==this.canDelete&&t.canEditSettings==this.canEditSettings&&t.supportsMultiStyle==this.supportsMultiStyle}}}),a),c.OpacityAttributesFeature=(l=function e(){c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"OpacityAttributesFeature",ctor:l,superName:"FeatureSetBase",statics:{KEY:"OpacityAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof l}}}),l),c.ImageFeature=(s=function e(t,n,o,r,i,a,l,s){this.canApplyFilter=t,this.canReplace=n,this.hasLicense=o,this.canCrop=r,this.canSetBackground=i,this.canSetFloating=a,this.canApplyBackgroundColor=l,this.canApplyCutout=s,c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"ImageFeature",ctor:s,superName:"FeatureSetBase",statics:{KEY:"ImageFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){var t;return!!(t=m.as(e,s))&&t.canApplyFilter==this.canApplyFilter&&t.canReplace==this.canReplace&&t.hasLicense==this.hasLicense&&t.canCrop==this.canCrop&&t.canSetBackground==this.canSetBackground&&t.canSetFloating==this.canSetFloating&&t.canApplyBackgroundColor==this.canApplyBackgroundColor&&t.canApplyCutout==this.canApplyCutout}}}),s),c.VideoAttributesFeature=(u=function e(){c.FeatureSetBase.call(this,e.KEY)},m.defineClass({name:"VideoAttributesFeature",ctor:u,superName:"FeatureSetBase",statics:{KEY:"VideoAttributesFeature",_implements:function(e){return"IFeatureSet"==e}},props:{isEqualTo:function(e){return e instanceof u}}}),u)},KSe6:function(e,t,n){var o,r,i=t,a=n("oAGj"),l=n("VQVe"),s=n("SpAV"),u=n("gXiO"),c=n("C42b"),m=n("ascj"),d=n("N5RB"),h=n("FNB+"),f=n("URxh"),p=n("6ZWm"),g=n("cmoc"),y=n("P83h"),T=n("9Lk3"),C=n("ZhwN"),S=n("iCxV"),v=n("NkBu"),F=n("fdtz"),_=n("SDdr"),A=n("lmwz"),w=n("uWOl"),E=n("c+uM"),b=n("tGKA"),D=n("pmb0"),I=n("K17h"),R=n("K0Rh"),k=n("Zifs"),L=n("djAF"),x=n("a9ow"),P=n("enh0"),M=n("8t9B"),G=n("3UhB"),K=n("oKlP"),O=n("uUew"),N=n("RkYL"),B=n("xm77"),z=n("zjod"),U=n("mxdD");i.AnimationLibrary=(o=function e(){u.CoreObject.call(this);for(var t=a.clone(D.MotionFacade.createAllAnimationStyles()),n=a.iter(t);!n.done;n.next()){var o=n.value;e.animationStyles.push(o)}},r={},a.defineClass({name:"AnimationLibrary",ctor:o,superName:"CoreObject",statics:{animationStyles:{get:function(){return void 0===r.animationStyles&&(r.animationStyles=[l.AnimationStyle.init_b946(l.AnimationStyle.NAME_NO_STYLE),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_TYPE,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_DYNAMIC,0,4,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FLICKER,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLORSWAP,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FADE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_SLIDE,0,3,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_GROW,0,2,l.AnimationStyleCategory.Text),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_ZOOM,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_PAN,0,2,l.AnimationStyleCategory.Image),l.AnimationStyle.init_b946(l.AnimationStyle.NAME_GRAYSCALE,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_BLUR,0,1,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_COLOR,0,5,l.AnimationStyleCategory.Image),l.AnimationStyle.init_e14f(l.AnimationStyle.NAME_FILL,0,5,l.AnimationStyleCategory.Image)]),r.animationStyles},set:function(e){r.animationStyles=e}},determineAnalyticName:function(e){var t="";if(e=e){switch(e.name){case"Type":t="Typewriter";break;case"ColorSwap":t="ColorShuffle";break;default:t=e.name}t=(t+e.variant).toLowerCase()}else t=(l.AnimationStyle.NAME_NO_STYLE+0).toLowerCase();return t},getDisplayableAnimationStyles:function(e){var t=!1,n=!1,r=!1,i=!1,s=!1,u=!1,c=!1,m=!1,d=!1;e.visitAll(h.FormaTraversal.PreOrder,(function(e){var o,l,h;a.as(e.controller,p.FrameController)&&(s=s||!e.isLogo()&&!e.isSticker()),null!=U.VideoFacade.getTrueVideoFormaForForma(e)&&(u=!0),T.GridController.isBackgroundColoredCell(e)&&(c=!0),m||(m=T.GridController.hasLayoutPadding(e)),e.kind==P.TextForma.KIND&&(t=!0),(o=A.ImageFacade.getImageFormaForForma(e))&&(l=a.as(o.style,w.ImageStyle))&&l.isColorizedFilter&&(d=!0),(h=a.as(e.style,E.LockupStyle))&&(h.backing==E.LockupBacking.Knockout&&(r=!0),!S.Host.textModelUtils.usePGMRenderer()&&E.LockupStyle.isKnockoutLook(h.textLook)||(i=!0),E.LockupStyle.isPath(h.layout)&&(n=!0))}));for(var f=[],g=a.iter(o.animationStyles);!g.done;g.next()){var y=g.value;if((t||y.name!=l.AnimationStyle.NAME_FLICKER&&y.name!=l.AnimationStyle.NAME_DYNAMIC&&y.name!=l.AnimationStyle.NAME_TYPE)&&(!y.imageStyle||s&&!u)&&(t||!y.textStyle)&&(y.name!=l.AnimationStyle.NAME_DYNAMIC||!n)){var C=y.clone();y.name==l.AnimationStyle.NAME_GROW&&r?C.variantCount=3:y.name==l.AnimationStyle.NAME_GROW&&!i||y.name==l.AnimationStyle.NAME_SLIDE&&!i?C.variantCount=1:y.name!=l.AnimationStyle.NAME_DYNAMIC||i?y.name!=l.AnimationStyle.NAME_COLORSWAP||c||d||m||(C.variantCount=2):C.variantCount=3,f.push(C)}}return f},isPremiumAnimationStyle:function(e){return e.name==l.AnimationStyle.NAME_TYPE&&2==e.variant||e.name==l.AnimationStyle.NAME_FLICKER&&2==e.variant||e.name==l.AnimationStyle.NAME_DYNAMIC&&0==e.variant},isAnimationStyleApplicable:function(e,t){var n,r=!1;if(n=a.as(t.firstPage.root,R.RootForma))for(var i=a.clone(o.getDisplayableAnimationStyles(n)),l=a.iter(i);!l.done;l.next())if(l.value.name==e.name){r=!0;break}return r},extendToIntegralCount:function(e,t,n){s.CoreAssert.isTrue(0!=t,void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2748),s.CoreAssert.isTrue(0!=n,void 0,"AnimationLibrary.extendToIntegralCount","AnimationLibrary.swift",2749);var o=e/t,r=Math.ceil(o),i=Math.floor(o);return o-i<1/a.toDouble(n)&&(r=i),N.TheoTime.fromSeconds(r*t,n)},updateCurrentStyle:function(e,t){var n,r,i;void 0===t&&(t=!1),(n=I.MotionUtils.getCurrentAnimationStyle(e))&&(n.isNoStyle()&&!t||((r=a.as(e.firstPage.root,R.RootForma))?(i=o.isAnimationStyleApplicable(n,e)?n:e.firstPage.animationLibrary.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE))&&e.firstPage.animationLibrary.setRootAnimationStyle(i,r):a.opt(S.Host.logging,(function(e){return e.warning("Missing root")}))))}},props:{getAnimationStyle:function(e){for(var t,n=a.iter(o.animationStyles);!n.done;n.next()){var r=n.value;if(e==r.name){t=r;break}}return t},getNextAnimationStyleOfSameType:function(e){var t=e.clone();return t.variantCount>0&&(t.variant=(t.variant+1)%t.variantCount),t},getNoneStyle:function(){return this.getAnimationStyle(l.AnimationStyle.NAME_NO_STYLE)},getAllAnimationStyles:function(){return o.animationStyles},setStillAnimation:function(e,t,n,o){void 0===n&&(n=null),void 0===o&&(o=null);var r=n||t.startTime,i=o||t.endTime,a=[];a.push(new f.KeyFrame(r,B.TimingFunctionType.Linear)),a.push(new f.KeyFrame(i,B.TimingFunctionType.Linear)),e.animation=f.FormaAnimation.init_9e82(t,r,i,a.concat())},setScaleForma:function(e,t,n,o,r,i,l){var s,u=new K.TheoPoint(1,1),c=e.style.clone(),m=e.style.clone();(s=a.as(e.style,E.LockupStyle))&&s.backing==E.LockupBacking.Knockout&&2==t.variant?(m=I.MotionUtils.createOpacityStyle(e,0),u=new K.TheoPoint(20,20)):c=I.MotionUtils.createOpacityStyle(e,0);var d=e.frame,h=e.placement.inverse.transformPoint(d.eval(o)),p=b.Matrix2D.scaling(n),g=e.placement.concat(p).transformPoint(h),y=d.center.subtract(g),T=b.Matrix2D.scaling(u),C=e.placement.concat(T).transformPoint(h),S=d.center.subtract(C),v=[],F=b.Matrix2D.scaling(n).translate(y),_=b.Matrix2D.scaling(u).translate(S),A=i,w=l;if(2==t.variant){v.push(new f.KeyFrame(i,r,F,null,c));var D=new N.TheoTime(t.endTime.timescale,t.endTime.timescale);A=i.add(D),w=l.add(D)}v.push(new f.KeyFrame(A,r,F,null,c)),v.push(new f.KeyFrame(w,r,_,null,m)),e.animation=f.FormaAnimation.init_9e82(t,i,w,v.concat())},setGrowAnimation:function(e,t,n){if(1==t.variant||1==t.variantCount){var o=t.endTime.multiply(2/3);this.setScaleForma(e,t,new K.TheoPoint(.8,.8),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,o)}else if(0==t.variant){var r=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);a.containsEq(n,e,h._equality_Forma_Forma)?this.setScaleForma(e,t,new K.TheoPoint(.75,.75),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,r):this.setFormaFade(e,t,t.startTime,t.endTime,r)}else 2==t.variant&&this.setScaleForma(e,t,new K.TheoPoint(1,1),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,t.endTime)},getCenteredTransform:function(e,t,n){var o=e.parent.frame.center.subtract(new K.TheoPoint(e.parent.frame.minX,e.parent.frame.minY)),r=e.placement.inverse.transformPoint(o),i=b.Matrix2D.scalingXY(t,t),a=e.placement.concat(i).transformPoint(r),l=o.subtract(a);return b.Matrix2D.scalingXY(t,t).translate(l.add(n))},setImageAnimation:function(e,t,n,o,r){var i=A.ImageFacade.getFrameFormaForForma(e);if(!e.isLogo()&&!e.isSticker()){for(var l=1,s=e.placement,u=a.iter(o);!u.done;u.next()){var c=u.value,m=c[1],d=c[2],h=this.getCenteredTransform(e,d,m);e.placement=s,e.move(h);var g,y=e.placement;(g=a.as(a.opt(i,(function(e){return e.controller})),p.FrameController))&&g.fitChildrenToFrame();var T=e.placement.transformValues.xscale-y.transformValues.xscale,C=new K.TheoPoint(e.placement.tx-y.tx,e.placement.ty-y.ty);if(e.placement=s,r&&(C.length()>1||T>0)){var S=e.frame;l=Math.max(l,1+T+3*Math.max(Math.abs(C.x)/S.width,Math.abs(C.x)/S.height))}for(var v=[],F=a.iter(o);!F.done;F.next()){var _=F.value,w=_[0],E=(m=_[1],d=_[2],this.getCenteredTransform(e,d*l,m));v.push(new f.KeyFrame(w,n,E,null,null))}e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,v.concat())}v=[];for(var b=a.iter(o);!b.done;b.next()){var D=b.value;w=D[0],m=D[1],d=D[2],E=this.getCenteredTransform(e,d*l,m),v.push(new f.KeyFrame(w,n,E,null,null))}e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,v.concat())}},applyLineFadeIn:function(e,t,n,o,r){var i,l=o.subtract(n),s=r;s.seconds*a.toDouble(e.length)>l.seconds/2&&(s=l.multiply(1/a.toDouble(2*e.length)));for(var u=l.subtract(s.multiply(a.toDouble(e.length))),c=n,m=a.iter(e);!m.done;m.next()){var d=m.value,h=(c=c.add(s)).add(u);this.setFormaAnimations(a.clone(d),t,0,(i=a.opt(a.first(d),(function(e){return e.style.opacity})))||null!=i?i:1,b.Matrix2D.Identity,B.TimingFunctionType.EaseInOut,n,c,h)}},setFadeAnimationTopDown:function(e,t){for(var n=[],o=a.iter(e);!o.done;o.next()){var r=o.value;r.isTypeLockup()&&n.push(r)}if(0==!n.length){for(var i=a.clone(I.MotionUtils.getTitleLockups(a.clone(n))),s=a.clone(i[0]),u=a.clone(i[1]),c=[],m=[],d=a.iter(s);!d.done;d.next()){var h=d.value,f=a.clone(I.MotionUtils.findTextLines2(h));if(0==!f.length)for(var p=a.iter(f);!p.done;p.next()){var g=p.value;m.push(g)}}m=a.clone(I.MotionUtils.sortTextLines(a.clone(m)));for(var y=a.iter(m);!y.done;y.next())g=y.value,c.push(a.clone(g.words));var T=new N.TheoTime(a.toInt(.25*a.toDouble(t.endTime.timescale)),t.endTime.timescale);this.applyLineFadeIn(a.clone(c),t,t.startTime,t.endTime,T);for(var C=t.endTime.subtract(l.AnimationStyle.FADE_DURATION),S=a.iter(u);!S.done;S.next()){var v=S.value;this.setFormaFade(v,t,t.startTime,t.endTime,C)}}},setFadeAnimation:function(e,t,n){var o;if(2==t.variant||1==t.variantCount){var r=[];e.visitAll(h.FormaTraversal.PreOrder,(function(e){(e instanceof P.TextForma||e instanceof L.ShapeForma)&&r.push(e)})),e.isImage()&&(r=[e]),this.setFormaAnimations(a.clone(r),t,.05,e.style.opacity,b.Matrix2D.Identity,B.TimingFunctionType.EaseOut,t.startTime,t.startTime,t.endTime),e.isTypeLockup()&&this.setStillAnimation(e,t)}else{var i=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);if(a.containsEq(n,e,h._equality_Forma_Forma)){var u,c=!1;if(S.Host.textModelUtils.usePGMRenderer()||(u=a.as(e.controller,M.TypeLockupController))&&a.opt(u.lockupStyle,(function(e){return e.textLook==E.LockupTextLook.KnockoutOnly}))&&(c=!0),0==t.variant)c&&(u=a.as(e.controller,M.TypeLockupController))&&this.modifyLockupForAnimation(u,c),this.setLineAnimation(e,t,b.Matrix2D.Identity,B.TimingFunctionType.EaseInOut,t.startTime,t.endTime,new N.TheoTime(a.toInt(.25*a.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t);if(1==t.variant&&(u=a.as(e.controller,M.TypeLockupController))){this.modifyLockupForAnimation(u,c);for(var m=[],d=a.iter(e.visitAsArray(h.FormaTraversal.PreOrder));!d.done;d.next()){var p,g=d.value;(p=a.as(g,P.TextForma))&&m.push(p)}for(var y=e.finalFrame,T=a.iter(m);!T.done;T.next()){var C=T.value,v=.8*(C.finalFrame.center.x-y.minX)/y.width+.1;s.CoreAssert.isTrue(v<=1,void 0,"AnimationLibrary.setFadeAnimation","AnimationLibrary.swift",673);var F=I.MotionUtils.createOpacityStyle(C,0),_=C.style;if(c){var A=(o=a.opt(a.as(a.opt(C.lockupForma,(function(e){return e.style})),E.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:C.style.opacity;_=I.MotionUtils.createOpacityStyle(C,A)}var w=[],D=i.subtract(t.startTime).seconds*v,R=t.startTime.addSeconds(D),k=R.addSeconds(1);c?(w.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,_)),w.push(new f.KeyFrame(R,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,_)),w.push(new f.KeyFrame(k,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,F))):(w.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,F)),w.push(new f.KeyFrame(R,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,F)),w.push(new f.KeyFrame(k,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,_))),C.animation=f.FormaAnimation.init_9e82(t,t.startTime,k,w.concat())}this.setStillAnimation(e,t,null,i)}}else this.setFormaFade(e,t,t.startTime,t.endTime,i)}},setLineAnimation:function(e,t,n,o,r,i,l){var s,u,c=(s=a.opt(a.as(e.style,E.LockupStyle),(function(e){return e.textLook})))||null!=s?s:E.LockupTextLook.Fill,m=!S.Host.textModelUtils.usePGMRenderer()&&c==E.LockupTextLook.KnockoutOnly,d=E.LockupStyle.isKnockoutLook(c)&&!m&&!S.Host.textModelUtils.usePGMRenderer(),h=a.clone(I.MotionUtils.findTextLines(e)),f=i.subtract(r),p=l;p.seconds*a.toDouble(h.length)>f.seconds/2&&(p=f.multiply(1/a.toDouble(2*h.length)));var g=f.subtract(p.multiply(a.toDouble(h.length))),y=0,T=m?0:e.style.opacity;m&&(y=(u=a.opt(a.as(e.style,E.LockupStyle),(function(e){return e.backingOpacity})))||null!=u?u:e.style.opacity);var C=r;if(!d)for(var v=a.iter(h);!v.done;v.next()){var F=v.value,_=(C=C.add(p)).add(g);this.setFormaAnimations(a.clone(F),t,y,T,n,o,r,C,_)}var A=i.multiply(.5),w=a.clone(e.filterWithCallback((function(e){return e instanceof L.ShapeForma||e instanceof P.TextForma&&d})));m||this.setFormaAnimations(a.clone(w),t,y,T,b.Matrix2D.Identity,o,r,r,A)},setColorSwapAnimation:function(e,t,n){var o,r,i,u;if(void 0===n&&(n=null),0!=e.length){var d=e[0].page,h=new y.FormaStyleChangedEvent(d.root);d.beginUpdate(h);for(var g=0==t.variant||1==t.variant,C=[],_=a.iter(e);!_.done;_.next()){var E,D,I,x=_.value;s.CoreAssert.isFalse(x instanceof P.TextForma,void 0,"AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",792),null!=x.controller&&x.kind!=R.RootForma.KIND&&((E=a.as(x.controller,T.GridController))?E.isBackgroundVisible()&&!g&&C.push(x.root):g&&!x.controller.moveable||((D=A.ImageFacade.getImageFormaForForma(x))?((I=a.as(D.style,w.ImageStyle))&&I.isColorizedFilter&&C.push(D),((o=a.opt(a.as(x.controller,p.FrameController),(function(e){return e.hasBackgroundColor})))||null!=o)&&o&&C.push(x)):C.push(x)))}C=a.sort(C,(function(e,t){return!(!(r=a.opt(e.controller,(function(e){return e.moveable})))&&null==r||!r)&&null!=(n=a.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(o=a.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&n<o;var n,o})),t.endTime=n||l.AnimationStyle.COLOR_SWAP_DURATION;for(var G=0==t.variant||2==t.variant?B.TimingFunctionType.Step1:B.TimingFunctionType.Linear,K=1==t.variant?.75:.5,O=a.toInt(a.toDouble(t.endTime.timescale)*K),z=a.toInt(a.toInt(t.endTime.value/O)),U={},Y=t.startTime.value,H={},V={},W=[],q=a.iter(C);!q.done;q.next()){if(x=q.value,(We=[]).push(new f.KeyFrame(t.startTime,G,b.Matrix2D.Identity,null,x.style)),U[x.formaID]=We,x.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer()){for(var j=a.clone(x.filterByKind(P.TextForma.KIND)),X=a.clone(x.filterByKind(L.ShapeForma.KIND)),Z=a.iter(j);!Z.done;Z.next()){var Q=Z.value;(je=[]).push(new f.KeyFrame(t.startTime,G,b.Matrix2D.Identity,null,Q.style)),U[Q.formaID]=je}for(var J=a.iter(X);!J.done;J.next()){var $=J.value;(Ze=[]).push(new f.KeyFrame(t.startTime,G,b.Matrix2D.Identity,null,$.style)),U[$.formaID]=Ze}}if(x.kind!=F.ImageForma.KIND){for(var ee=x.style.colors.colorID(m.ColorRole.FieldPrimary),te=a.iter(x.page.colorLibraryController.getThemeColorKeys());!te.done;te.next()){var ne,oe=te.value;(ne=x.style.colors.fieldPrimary)&&(le=x.page.colorLibraryController.getSolidColorForKey(oe))&&ne.distanceTo(le)<2&&(ee=oe)}null==H[ee=(i=ee)||null!=i?i:"missing"+a.toString(W.length)]&&(H[ee]=[],W.includes(ee)||W.push(ee)),H[ee].push(x);for(var re=x.style.colors.colorID(m.ColorRole.FieldSecondary),ie=a.iter(x.page.colorLibraryController.getThemeColorKeys());!ie.done;ie.next()){var ae,le;oe=ie.value,(ae=x.style.colors.fieldSecondary)&&(le=x.page.colorLibraryController.getSolidColorForKey(oe))&&ae.distanceTo(le)<2&&(re=oe)}null==V[re=(u=re)||null!=u?u:"missing"+a.toString(W.length)]&&(V[re]=[],W.includes(re)||W.push(re)),V[re].push(x)}}var se=a.clone(a.shuffle(d.colorLibraryController.getThemeColorKeys())),ue=[];if(C.length>0){for(var ce=e[0].database.beginTransaction("revert_transaction",null),me=a.iter(a.range(0,z,!1));!me.done;me.next()){for(var de={},he=a.iter(C);!he.done;he.next()){var fe,pe;(fe=(Oe=he.value).style.colors.fieldPrimary)&&(de[Oe.formaID+"primary"]=fe.asString),(pe=Oe.style.colors.fieldSecondary)&&(de[Oe.formaID+"secondary"]=pe.asString)}for(var ge=c.CoreRandom.nextIntUniform(se.length);ue.length>0&&se.length>1&&ge==ue[ue.length-1];)ge=c.CoreRandom.nextIntUniform(se.length);ue.push(ge);for(var ye=a.iter(a.range(0,2,!1));!ye.done;ye.next())for(var Te=1==ye.value,Ce=a.clone(Te?H:V),Se=a.iter(W);!Se.done;Se.next()){var ve,Fe,_e=Se.value;if((ve=Ce[_e])&&null!=(Fe=a.indexOf(W,_e)))for(var Ae=a.iter(ve);!Ae.done;Ae.next())if((Oe=Ae.value).kind!=F.ImageForma.KIND)for(var we=!1,Ee=0;!we&&Ee<se.length;){var be=se[(Fe+ge+Ee)%se.length];Ee+=1,we=!0;var De,Ie,Re=Te?m.ColorRole.FieldPrimary:m.ColorRole.FieldSecondary;if(Oe.style.colorTableSupportsRole(Re))if(Oe.style.colors.setColorId(Re,be),(De=Oe.style.colors.color(Re))&&null!=(Ie=de[Oe.formaID+(Re==m.ColorRole.FieldPrimary?"primary":"secondary")])&&Ie==De.asString&&(we=!1),null!=Oe.controller&&Oe.controller.moveable){var ke,Le=a.opt(Oe.controller,(function(e){return e.getBackingContrastRole()}));if(ke=Oe.style.colors.color(Re)){var xe=Re==m.ColorRole.FieldPrimary&&Le==m.ColorRole.FieldSecondary?Oe.style.colors.fieldSecondary:a.opt(Oe.controller,(function(e){return e.getBackgroundColor()})),Pe=Oe.isTypeLockup()?10:5,Me=new k.SolidColor(ke.red,ke.green,ke.blue,Oe.style.opacity);null!=xe&&Me.lightnessDifference(xe)<Pe&&(we=!1)}}}}for(var Ge=a.iter(C);!Ge.done;Ge.next()){var Ke,Oe=Ge.value;(Ke=a.as(Oe.controller,M.TypeLockupController))&&Ke.styleController.shuffleMultiStyleLockupColors()}Y+=O;for(var Ne=new N.TheoTime(Y,t.endTime.timescale),Be=a.iter(C);!Be.done;Be.next())if((x=Be.value).isImage()&&a.opt(a.as(x.controller,v.ImageController),(function(e){return e.shuffleColorAssignmentForAnimation()})),(x.isShape()||x.isTypeLockup())&&null==x.style.colors.color(m.ColorRole.FieldPrimary)&&s.CoreAssert.fail("error, can't be setting a nil colors","AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1056),a.opt(U[x.formaID],(function(e){return e.push(new f.KeyFrame(Ne,G,b.Matrix2D.Identity,null,x.style))})),x.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer()){j=a.clone(x.filterByKind(P.TextForma.KIND)),X=a.clone(x.filterByKind(L.ShapeForma.KIND));for(var ze=a.iter(j);!ze.done;ze.next()){var Ue;Q=ze.value,(Ue=Q.style.clone())?(Ue.colors.owner=null,Ue.colors.setColor(m.ColorRole.FieldPrimary,Q.textModel.fontColor.value),Ue.colors.setColor(m.ColorRole.FieldSecondary,Q.textModel.fontStrokeColor.value),a.opt(U[Q.formaID],(function(e){return e.push(new f.KeyFrame(Ne,G,b.Matrix2D.Identity,null,Ue))}))):s.CoreAssert.fail("fail to generate keyframe for color shuffle: missing style in text forma","AnimationLibrary.setColorSwapAnimation","AnimationLibrary.swift",1075)}for(var Ye=a.iter(X);!Ye.done;Ye.next())$=Ye.value,a.opt(U[$.formaID],(function(e){return e.push(new f.KeyFrame(Ne,G,b.Matrix2D.Identity,null,$.style))}))}}ce.rollback()}for(var He=e.concat(C),Ve=a.iter(this.uniqueFormae(a.clone(He)));!Ve.done;Ve.next()){var We;if(We=U[(x=Ve.value).formaID]){if(x.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,We.concat()),x.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer()){j=a.clone(x.filterByKind(P.TextForma.KIND)),X=a.clone(x.filterByKind(L.ShapeForma.KIND));for(var qe=a.iter(j);!qe.done;qe.next()){var je;(je=U[(Q=qe.value).formaID])&&(Q.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,je.concat()))}for(var Xe=a.iter(X);!Xe.done;Xe.next()){var Ze;(Ze=U[($=Xe.value).formaID])&&($.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Ze.concat()))}}}else x.kind==R.RootForma.KIND?this.setStillAnimation(e[0].root,t):x.animation=null}d.endUpdate(h)}},setFlickerAnimation:function(e,t){var n,o,r,i,u,c,m;if(0!=e.length){for(var d=[],p=a.iter(e);!p.done;p.next()){var g;null!=(_=p.value).controller&&_.controller.moveable&&!_.isGridCell()&&null==a.as(_,F.ImageForma)&&this.shouldAnimateShape(_)&&((g=A.ImageFacade.getImageFormaForForma(_))?d.push(g):d.push(_))}var y=a.clone(this.getTitleLockups(e[0].root));if(0!=y.length){for(var T=1==t.variant,C=2!=t.variant&&!S.Host.textModelUtils.usePGMRenderer(),v=a.iter(y);!v.done;v.next()){var _=v.value;a.remove(d,_),(x=a.as(_.controller,M.TypeLockupController))&&a.opt(x.lockupStyle,(function(e){return e.textLook!=E.LockupTextLook.KnockoutOnly}))&&(C=!1)}for(var w=[],D=[],R=a.iter(y);!R.done;R.next()){var x,K=R.value;if(x=a.as(K.controller,M.TypeLockupController)){this.modifyLockupForAnimation(x,C);for(var z=[],U=a.iter(K.visitAsArray(h.FormaTraversal.PreOrder));!U.done;U.next()){var Y,H=U.value;(Y=a.as(H,P.TextForma))&&z.push(Y)}for(var V=a.iter(z);!V.done;V.next())_=V.value,w.push([_]);T&&(z=a.clone(G.TypeLockupUtils.sortTextFormae(a.clone(z))),z=a.clone(G.TypeLockupUtils.padTextFormaeForLetterAnimation(a.clone(z),!1)));for(var W=a.iter(z);!W.done;W.next())_=W.value,D.push([_])}}2==t.variant&&(D=[y]);var q=a.toInt(2*a.toDouble(t.endTime.timescale)),j=new N.TheoTime(q+1,t.endTime.timescale),X=j.add(l.AnimationStyle.FADE_DURATION),Z=B.TimingFunctionType.EaseOut,Q=B.TimingFunctionType.Step,J=a.toInt(.15*a.toDouble(t.endTime.timescale)),$=a.toInt(a.toInt(q/J)),ee={},te=t.startTime.value;s.CoreAssert.isTrue(X.value>j.value,void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1233);for(var ne=a.iter(w);!ne.done;ne.next()){e=ne.value;for(var oe=a.iter(e);!oe.done;oe.next())_=oe.value,(ot=[]).push(new f.KeyFrame(t.startTime,Q,b.Matrix2D.Identity,null,_.style)),ee[_.formaID]=ot}for(var re={},ie=a.iter(a.range(0,$,!1));!ie.done;ie.next()){te+=J;for(var ae=new N.TheoTime(te,t.endTime.timescale),le=0,se=null,ue=a.iter(a.toSequence(D));!ue.done;ue.next()){for(var ce=ue.value,me=ce.offset,de=(e=ce.element,(n=a.opt(e[0].controller,(function(e){return e.currentOpacity})))||null!=n?n:e[0].style.opacity),he=2*(this.randomDbl()-.5)*de,fe=0,pe=!1;fe<5&&!pe;){fe+=1;for(var ge=a.iter(e);!ge.done;ge.next()){_=ge.value;var ye=(o=a.opt(_.controller,(function(e){return e.currentOpacity})))||null!=o?o:_.style.opacity,Te=(r=re[_.formaID])||null!=r?r:ye,Ce=_.isTypeLockup()?ye:1;Math.abs(Te-Math.min(Math.max(Te+he,0),Ce))<.1?he=2*(this.randomDbl()-.5):pe=!0}}for(var Se=a.iter(e);!Se.done;Se.next()){_=Se.value,ye=(i=a.opt(_.controller,(function(e){return e.currentOpacity})))||null!=i?i:_.style.opacity,Ce=_.isTypeLockup()?ye:1;var ve=Math.min(Math.max(ye+he,0),Ce);if(re[_.formaID]=ve,T){if(Ye=a.as(_,P.TextForma)){var Fe,_e,Ae=Ye.textModel.text.length,we=!1,Ee=Ye.textModel.fontColor.value,be=new k.SolidColor(Ee.red,Ee.green,Ee.blue,ve),De=Ye.textModel.fontStrokeColor.value,Ie=new k.SolidColor(De.red,De.green,De.blue,ve);if(me-1>=0&&(Fe=a.as(a.opt(Ye.lockupForma,(function(e){return e.style})),E.LockupStyle))&&(_e=a.as(a.first(D[me-1]),P.TextForma))&&E.LockupStyle.isDuplicateFormaLook(Fe.textLook)&&Ye.lockupForma==_e.lockupForma&&_e.rangeInLockup.start==Ye.rangeInLockup.start&&_e.formaID==a.opt(se,(function(e){return e.formaID}))&&_.formaID!=a.opt(se,(function(e){return e.formaID}))&&(we=!0,be=new k.SolidColor(Ee.red,Ee.green,Ee.blue,(u=re[_e.formaID])||null!=u?u:ve),Ie=new k.SolidColor(De.red,De.green,De.blue,(c=re[_e.formaID])||null!=c?c:ve)),we||(_===se?le+=1:le=0,se=_),le<Ae)if(0==le){s.CoreAssert.isTrue(ye==_.style.opacity,void 0,"AnimationLibrary.setFlickerAnimation","AnimationLibrary.swift",1327);var Re=new f.KeyFrame(ae,Q,b.Matrix2D.Identity,null,_.style);Re.renderRuns.applyColors(be,Ie,new O.TextRange(le,le+1)),a.opt(ee[_.formaID],(function(e){return e.push(Re)}))}else{var ke=(m=a.opt(ee[_.formaID],(function(e){return e.length})))||null!=m?m:0;ke>0&&ee[_.formaID][ke-1].renderRuns.applyColors(be,Ie,new O.TextRange(le,le+1))}}}else{var Le=I.MotionUtils.createOpacityStyle(_,ve),xe=new f.KeyFrame(ae,Q,b.Matrix2D.Identity,null,Le);a.opt(ee[_.formaID],(function(e){return e.push(xe)}))}}}}for(var Pe=a.iter(w);!Pe.done;Pe.next()){e=Pe.value;for(var Me=a.iter(e);!Me.done;Me.next()){_=Me.value;var Ge=C?I.MotionUtils.createOpacityStyle(_,0):_.style;ee[_.formaID].push(new f.KeyFrame(X,Z,b.Matrix2D.Identity,null,Ge))}}for(var Ke=a.iter(d);!Ke.done;Ke.next()){_=Ke.value;var Oe=I.MotionUtils.createOpacityStyle(_,0),Ne=_.style;if(null==ee[_.formaID]&&(ee[_.formaID]=[],ee[_.formaID].push(new f.KeyFrame(t.startTime,Z,b.Matrix2D.Identity,null,Oe)),ee[_.formaID].push(new f.KeyFrame(j,Z,b.Matrix2D.Identity,null,Oe)),ee[_.formaID].push(new f.KeyFrame(X,Z,b.Matrix2D.Identity,null,Ne)),X.value<t.endTime.value&&ee[_.formaID].push(new f.KeyFrame(t.endTime,Z,b.Matrix2D.Identity,null,Ne)),_.isTypeLockup()&&S.Host.textModelUtils.usePGMRenderer())){for(var Be=a.clone(_.filterByKind(P.TextForma.KIND)),ze=a.clone(_.filterByKind(L.ShapeForma.KIND)),Ue=a.iter(Be);!Ue.done;Ue.next()){var Ye=Ue.value,He=I.MotionUtils.createOpacityStyle(Ye,0),Ve=Ye.style,We=[];We.push(new f.KeyFrame(t.startTime,Z,b.Matrix2D.Identity,null,He)),We.push(new f.KeyFrame(j,Z,b.Matrix2D.Identity,null,He)),We.push(new f.KeyFrame(X,Z,b.Matrix2D.Identity,null,Ve)),X.value<t.endTime.value&&We.push(new f.KeyFrame(t.endTime,Z,b.Matrix2D.Identity,null,Ve)),Ye.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,We.concat())}for(var qe=a.iter(ze);!qe.done;qe.next()){var je=qe.value,Xe=I.MotionUtils.createOpacityStyle(je,0),Ze=je.style,Qe=[];Qe.push(new f.KeyFrame(t.startTime,Z,b.Matrix2D.Identity,null,Xe)),Qe.push(new f.KeyFrame(j,Z,b.Matrix2D.Identity,null,Xe)),Qe.push(new f.KeyFrame(X,Z,b.Matrix2D.Identity,null,Ze)),X.value<t.endTime.value&&Qe.push(new f.KeyFrame(t.endTime,Z,b.Matrix2D.Identity,null,Ze)),je.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,Qe.concat())}}}for(var Je=[],$e=a.iter(D);!$e.done;$e.next()){e=$e.value;for(var et=a.iter(e);!et.done;et.next())H=et.value,Je.push(H)}for(var tt=e.concat(Je),nt=a.iter(this.uniqueFormae(a.clone(tt)));!nt.done;nt.next()){var ot,rt;if(ot=ee[(_=nt.value).formaID])_.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,ot.concat()),_.kind==P.TextForma.KIND&&(rt=a.opt(a.opt(_.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&rt.isTypeLockup()&&null==rt.animation&&this.setStillAnimation(rt,t),this.validateKeyFrames(ot.concat(),"flicker/setStillAnimation");else _.animation=null}}}},shouldAnimateShape:function(e){return!e.isShape()||(e.isGridCell()||null!=e.controller&&e.controller.moveable,!1)},modifyLockupForAnimation:function(e,t){var n,o;if(t){var r=(n=a.opt(e.lockupStyle,(function(e){return e.textLook})))||null!=n?n:E.LockupTextLook.Fill,i=a.opt(e.lockupStyle,(function(e){return e.colors.colorID(m.ColorRole.FieldPrimary)}));if(E.LockupStyle.isKnockoutLook(r)&&t){e.beginBlockedUpdate(),a.opt(e.lockupStyle,(function(e){return e.textLook=E.LockupTextLook.KnockoutAndFill}));var l=a.opt(e.lockupStyle,(function(e){return e.colors.colorID(m.ColorRole.FieldSecondary)}));a.opt(e.lockupStyle,(function(e){return e.colors.setColorId(m.ColorRole.FieldPrimary,l)})),e.endBlockedUpdate()}s.CoreAssert.isTrue(0==e.forceLetterFormaMode,void 0,"AnimationLibrary.modifyLockupForAnimation","AnimationLibrary.swift",1524),e.updateGroup(),E.LockupStyle.isKnockoutLook(r)&&t&&(a.opt(e.forma,(function(t){return t.visitAll(h.FormaTraversal.PreOrder,(function(t){t.kind==P.TextForma.KIND&&(t.style.opacity=(o=a.opt(e.lockupStyle,(function(e){return e.backingOpacity})))||null!=o?o:t.style.opacity)}))})),e.beginBlockedUpdate(),a.opt(e.lockupStyle,(function(e){return e.textLook=r})),a.opt(e.lockupStyle,(function(e){return e.colors.setColorId(m.ColorRole.FieldPrimary,i)})),e.endBlockedUpdate())}},useKnockoutAnimation:function(e,t){var n;return!(S.Host.textModelUtils.usePGMRenderer()||!(n=e.lockupStyle)||!(n.textLook==E.LockupTextLook.KnockoutOnly||E.LockupStyle.isKnockoutLook(n.textLook)&&t==l.AnimationStyle.WORD_CENTERED_VARIANT))},getRandomLetterAppearKeyFrames:function(e,t,n,o,r,i,s,u){for(var c,m,d,h,p=s,g=a.iter(e);!g.done;g.next())for(var y=g.value,T=a.iter(y);!T.done;T.next()){var C=T.value,S=[],v=I.MotionUtils.createOpacityStyle(C,0),F=!1;if((B=a.as(a.opt(a.opt(a.as(C,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(F=this.useKnockoutAnimation(B,t)),F){var _=(c=a.opt(a.as(a.opt(a.opt(a.as(C,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),E.LockupStyle),(function(e){return e.backingOpacity})))||null!=c?c:C.style.opacity;v=I.MotionUtils.createOpacityStyle(C,_)}S.push(new f.KeyFrame(n.startTime,o,b.Matrix2D.Identity,null,v)),r[C.formaID]=S}for(var A=a.iter(i);!A.done;A.next()){var w=A.value,D=w.key,R=new N.TheoTime(a.toInt(Math.max(p-1,0)),n.endTime.timescale);R.value<=n.startTime.value&&(R=new N.TheoTime(a.toInt(n.startTime.value+1),n.endTime.timescale));var L=new N.TheoTime(a.toInt(p),n.endTime.timescale);L.value<=R.value&&(L=new N.TheoTime(R.value+1,n.endTime.timescale));for(var K=a.iter(w.value);!K.done;K.next()){var B,z=K.value,U=z.style,Y=!1;(B=a.as(a.opt(z.lockupForma,(function(e){return e.controller})),M.TypeLockupController))&&(Y=this.useKnockoutAnimation(B,t)),v=I.MotionUtils.createOpacityStyle(z,0),Y&&t!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(_=(m=a.opt(a.as(a.opt(z.lockupForma,(function(e){return e.style})),E.LockupStyle),(function(e){return e.backingOpacity})))||null!=m?m:z.style.opacity,v=I.MotionUtils.createOpacityStyle(z,_));var H=z.textModel.text.length,V=a.opt(a.as(z.textModel.attributeAtIndex(x.FontColorAttribute.NAME,0).attr,x.FontColorAttribute),(function(e){return e.value}))||k.SolidColor.BLACK,W=a.opt(a.as(z.textModel.attributeAtIndex(x.FontStrokeColorAttribute.NAME,0).attr,x.FontStrokeColorAttribute),(function(e){return e.value}))||k.SolidColor.BLACK,q=k.SolidColor.fromAlphaOverride(V,0),j=k.SolidColor.fromAlphaOverride(W,0);Y&&(q=V,V=k.SolidColor.fromAlphaOverride(V,0),j=W,W=k.SolidColor.fromAlphaOverride(W,0));var X=new f.KeyFrame(R,o,b.Matrix2D.Identity,null,v),Z=new f.KeyFrame(L,o,b.Matrix2D.Identity,null,U),Q=(d=a.opt(r[z.formaID],(function(e){return e.length})))||null!=d?d:0;if(Q>0){for(var J=r[z.formaID][Q-1].renderRuns.fillColors,$=a.iter(J.runArrays);!$.done;$.next()){var ee=$.value;Z.renderRuns.fillColors.apply(ee.attr,ee.range)}for(var te=r[z.formaID][Q-1].renderRuns.strokeColors,ne=a.iter(te.runArrays);!ne.done;ne.next())ee=ne.value,Z.renderRuns.strokeColors.apply(ee.attr,ee.range)}var oe=new O.TextRange(0,H);1==Q&&(Z.renderRuns.applyColors(q,j,oe),a.opt(r[z.formaID],(function(e){return e.push(X)}))),Z.renderRuns.applyColors(V,W,D);for(var re=[],ie=a.iter(Z.renderRuns.fillColors.runArrays);!ie.done;ie.next())ee=ie.value,a.eq(k._equality_SolidColor_SolidColor,ee.attr,V)&&re.push(ee.range);a.sortInPlace(re,(function(e,t){return e.start<t.start}));var ae=a.clone(G.TypeLockupUtils.cleanupAndMerge(a.clone(re)));Z.renderRuns.clear();var le=[oe];1==q.alpha&&(le=a.clone(G.TypeLockupUtils.invertRanges(a.clone(ae),oe.end)));for(var se=a.iter(le);!se.done;se.next()){var ue=se.value;Z.renderRuns.applyColors(q,j,ue)}for(var ce=a.iter(ae);!ce.done;ce.next()){var me=ce.value;Z.renderRuns.applyColors(V,W,me)}if(Y&&((h=a.opt(a.first(ae),(function(e){return e.length})))||null!=h?h:0)>=H){var de=I.MotionUtils.createOpacityStyle(z,0),he=new f.KeyFrame(L,o,b.Matrix2D.Identity,null,de);a.opt(r[z.formaID],(function(e){return e.push(he)}))}else a.opt(r[z.formaID],(function(e){return e.push(Z)}))}p+=u}},setDynamicWordAnimation:function(e,t){var n,o;if(0!=e.length){var r=t.variant,i=t.name==l.AnimationStyle.NAME_TYPE;i&&(r+=10);var u=a.clone(this.getTitleLockups(e[0].root));if(0!=u.length){for(var c=[],m=a.iter(e);!m.done;m.next()){var d;null!=(T=m.value).controller&&T.controller.moveable&&!T.isGridCell()&&null==a.as(T,F.ImageForma)&&this.shouldAnimateShape(T)&&((d=A.ImageFacade.getImageFormaForForma(T))?c.push(d):c.push(T))}for(var p=!1,g=!1,y=a.iter(u);!y.done;y.next()){var T=y.value;a.remove(c,T),!p&&T.controller instanceof M.TypeLockupController&&(p=this.useKnockoutAnimation(T.controller,r))}var C=[],S=[],v=0,_=0;if(p)for(var w=a.iter(u);!w.done;w.next()){var D=w.value;(dt=a.as(D.controller,M.TypeLockupController))&&(g=this.useKnockoutAnimation(dt,r),this.modifyLockupForAnimation(dt,g))}for(var R=a.iter(u);!R.done;R.next())D=R.value,g=!1,(dt=a.as(D.controller,M.TypeLockupController))&&(v+=dt.text.length,_+=dt.text.split(" ").length,g=this.useKnockoutAnimation(dt,r)),D.visitAll(h.FormaTraversal.PreOrder,(function(e){var t,n;(t=a.as(e,P.TextForma))&&C.push(t),(n=a.as(e,L.ShapeForma))&&(r==l.AnimationStyle.WORD_APPEAR_VARIANT&&!g||r==l.AnimationStyle.WORD_ZOOM_IN_VARIANT||r==l.AnimationStyle.WORD_CENTERED_VARIANT)&&S.push(n)}));a.sortInPlace(S,(function(e,t){return e.frame.width>t.frame.width})),C=a.clone(G.TypeLockupUtils.sortTextFormae(a.clone(C))),i&&r!=l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT&&(C=a.clone(G.TypeLockupUtils.padTextFormaeForLetterAnimation(a.clone(C),r==l.AnimationStyle.LETTER_APPEAR_VARIANT)));var x=[];r==l.AnimationStyle.WORD_CENTERED_VARIANT?(S.length>0&&x.push([S[0]]),c=a.clone(c.concat(a.clone(S)))):r!=l.AnimationStyle.WORD_APPEAR_VARIANT&&r!=l.AnimationStyle.WORD_ZOOM_IN_VARIANT||x.push(a.clone(S));var K=[],z=!1;if(r==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT){for(var U=[],Y=null,H=a.iter(C);!H.done;H.next())(Je=H.value).lockupForma==a.opt(Y,(function(e){return e.lockupForma}))&&Je.rangeInLockup.start==a.opt(Y,(function(e){return e.rangeInLockup.start}))&&E.LockupStyle.isDuplicateFormaLook(Je.lockupForma.style.textLook)&&U.push(Je),Y=Je;for(var V=a.iter(U);!V.done;V.next()){var W=V.value;a.remove(C,W)}for(var q=a.iter(C);!q.done;q.next()){T=q.value,x.push([T]);for(var j=null,X=a.iter(U);!X.done;X.next())W=X.value,T.lockupForma==W.lockupForma&&T.rangeInLockup.start==W.rangeInLockup.start&&(x.push([W]),j=W);for(var Z=a.iter(a.range(0,T.textModel.text.length,!1));!Z.done;Z.next()){var Q,J=Z.value,$=new O.TextRange(J,J+1),ee=[];ee.push(T),(Q=j)&&ee.push(Q),K.push({key:$,value:ee})}(Q=j)&&a.remove(U,Q)}K=a.clone(a.shuffle(K))}else for(var te=a.iter(C);!te.done;te.next())T=te.value,z||!E.LockupStyle.isDuplicateFormaLook(T.lockupForma.style.textLook)||p&&r==l.AnimationStyle.WORD_CENTERED_VARIANT||(z=!0),x.push([T]);var ne=B.TimingFunctionType.Step;r==l.AnimationStyle.WORD_ZOOM_IN_VARIANT?ne=B.TimingFunctionType.EaseOut:r==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT&&(ne=B.TimingFunctionType.Linear);var oe=B.TimingFunctionType.EaseOut,re=i?1.5:1,ie=Math.max(Math.min(a.toDouble(v)/7,2),re);!i&&_>10&&(ie+=.25*a.toDouble(_-10),ie=Math.min(15,ie));var ae=r==l.AnimationStyle.LETTER_APPEAR_VARIANT||r==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT?.15:0,le=r==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT?K.length:x.length;z&&(le=a.toInt(le/2));var se=ie/a.toDouble(le+2),ue=a.toDouble(t.endTime.timescale)*se,ce=a.toInt(a.toDouble(t.endTime.timescale)*(ie+ae)),me=new N.TheoTime(ce,t.endTime.timescale),de=me.add(i?l.AnimationStyle.FADE_DURATION:new N.TheoTime(2,t.endTime.timescale));0==c.length&&(de=new N.TheoTime(me.value+1,me.timescale)),t.endTime=de;var he=new N.TheoTime(t.endTime.timescale,t.endTime.timescale);r==l.AnimationStyle.LETTER_APPEAR_VARIANT&&(he=new N.TheoTime(0,t.endTime.timescale));var fe={},pe=a.toDouble(t.startTime.value)+ae*a.toDouble(t.endTime.timescale);if(r==l.AnimationStyle.LETTER_RANDOM_FADE_VARIANT)this.getRandomLetterAppearKeyFrames(a.clone(x),r,t,ne,fe,a.clone(K),pe,ue);else for(var ge=pe,ye=null,Te=0,Ce=1,Se=a.iter(x);!Se.done;Se.next()){e=Se.value;for(var ve=a.iter(e);!ve.done;ve.next()){var Fe;if(T=ve.value,(Oe=a.as(T,P.TextForma))&&(Y=a.as(ye,P.TextForma))&&(Fe=a.as(a.opt(Oe.lockupForma,(function(e){return e.style})),E.LockupStyle))&&Oe.lockupForma==Y.lockupForma&&Oe.rangeInLockup.start==Y.rangeInLockup.start&&E.LockupStyle.isDuplicateFormaLook(Fe.textLook)&&T!==ye){fe[T.formaID]=[];for(var _e=a.iter(fe[Y.formaID]);!_e.done;_e.next()){var Ae=_e.value,we=a.opt(Ae.style,(function(e){return e.clone()}));a.opt(we,(function(e){return e.colors.fieldPrimary=Oe.style.colors.fieldPrimary})),a.opt(we,(function(e){return 0!=e.opacity}))&&a.opt(we,(function(e){return e.opacity=Oe.style.opacity}));var Ee=new f.KeyFrame(Ae.time,Ae.timingFunction,Ae.placement,Ae.bounds,we,Ae.relativePlacement);Ee.renderRuns.copyColorAlpha(Oe.textModel,Ae.renderRuns),fe[T.formaID].push(Ee)}ge-=ue}else{i&&(T===ye?Te+=1:Te=0),ye=T;var be=new N.TheoTime(a.toInt(Math.max(ge-Ce,0)),t.endTime.timescale);ue<1&&(Ce=ue),be.value<=t.startTime.value&&(be=new N.TheoTime(a.toInt(t.startTime.value+1),t.endTime.timescale));var De=new N.TheoTime(a.toInt(ge),t.endTime.timescale);De.value<=be.value&&ue>=1&&(De=new N.TheoTime(be.value+1,t.endTime.timescale));var Ie=new N.TheoTime(a.toInt(ge+ue-1),t.endTime.timescale);Ie.value<=De.value&&(Ie=new N.TheoTime(De.value+1,t.endTime.timescale));var Re,ke,Le=new N.TheoTime(Ie.value+1,t.endTime.timescale),xe=T.style;if(g=!1,(dt=a.as(T.controller,M.TypeLockupController))&&(g=this.useKnockoutAnimation(dt,r)),(Re=a.as(a.opt(a.opt(a.as(T,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(g=this.useKnockoutAnimation(Re,r)),r==l.AnimationStyle.LETTER_APPEAR_VARIANT){var Pe=g?0:1;ke=I.MotionUtils.createOpacityStyle(T,Pe)}else{var Me=g?0:Math.min(De.seconds/he.seconds,.8);ke=I.MotionUtils.createOpacityStyle(T,Me)}var Ge=I.MotionUtils.createOpacityStyle(T,0);if(g&&r!=l.AnimationStyle.WORD_CENTERED_VARIANT){var Ke=(n=a.opt(a.as(a.opt(a.opt(a.as(T,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),E.LockupStyle),(function(e){return e.backingOpacity})))||null!=n?n:T.style.opacity;Ge=I.MotionUtils.createOpacityStyle(T,Ke);var Oe,Ne=!1;(Oe=a.as(T,P.TextForma))&&(Ne=Te>=Oe.textModel.text.length),i&&!Ne||(xe=I.MotionUtils.createOpacityStyle(T,0))}if(i&&0!=Te||(fe[T.formaID]=[],fe[T.formaID].push(new f.KeyFrame(t.startTime,ne,b.Matrix2D.Identity,null,Ge))),r==l.AnimationStyle.WORD_CENTERED_VARIANT){var Be=T.totalPlacement.inverse.transformPoint(T.root.finalFrame.center),ze=T.bounds.center;(Je=a.as(T,P.TextForma))&&(ze=Je.getBoundsCenter());var Ue=b.Matrix2D.translation(Be.subtract(ze));T.isShape()&&p?(fe[T.formaID].push(new f.KeyFrame(be,ne,b.Matrix2D.Identity,null,Ge)),fe[T.formaID].push(new f.KeyFrame(De,ne,b.Matrix2D.Identity,null,Ge))):(fe[T.formaID].push(new f.KeyFrame(be,ne,Ue,null,Ge)),fe[T.formaID].push(new f.KeyFrame(De,ne,Ue,null,xe))),T.isShape()?p?(fe[T.formaID].push(new f.KeyFrame(me.addVal(-10),oe,b.Matrix2D.Identity,null,Ge)),fe[T.formaID].push(new f.KeyFrame(me.addVal(-9),ne,b.Matrix2D.Identity,null,xe))):(fe[T.formaID].push(new f.KeyFrame(me.addVal(-10),oe,Ue,null,xe)),fe[T.formaID].push(new f.KeyFrame(me.addVal(-9),ne,Ue,null,Ge))):(fe[T.formaID].push(new f.KeyFrame(Ie,ne,Ue,null,xe)),fe[T.formaID].push(new f.KeyFrame(Le,ne,Ue,null,Ge))),T.isShape()&&p?fe[T.formaID].push(new f.KeyFrame(me,ne,b.Matrix2D.Identity,null,xe)):fe[T.formaID].push(new f.KeyFrame(me,ne,b.Matrix2D.Identity,null,Ge))}else if(r==l.AnimationStyle.WORD_ZOOM_IN_VARIANT){var Ye,He,Ve=T.isFullCanvas?1:10;if(Ue=b.Matrix2D.Identity,(Ye=a.opt(a.opt(T.root,(function(e){return e.finalFrame})),(function(e){return e.center})))&&(He=T.totalPlacement.inverse)){var We=He.transformPoint(Ye).subtract(T.bounds.center),qe=b.Matrix2D.scalingXYfromPoint(T.frame.center,Ve,Ve);Ue=qe.translate(We)}a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(be,ne,Ue,null,Ge))})),a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(De,ne,Ue,null,xe))})),a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(Ie,ne,b.Matrix2D.Identity,null,xe))}))}else if(r==l.AnimationStyle.LETTER_APPEAR_FADE_VARIANT){s.CoreAssert.fail("AnimationStyle.LETTER_APPEAR_FADE_VARIANT not updated for word forma","AnimationLibrary.setDynamicWordAnimation","AnimationLibrary.swift",2074),a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(be,ne,b.Matrix2D.Identity,null,Ge))})),a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(De,ne,b.Matrix2D.Identity,null,ke))}));var je=De.addSeconds(he.seconds),Xe=de.seconds>je.seconds?je:de.addVal(-1);a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(Xe,ne,b.Matrix2D.Identity,null,xe))}))}else{var Ze=new f.KeyFrame(be,ne,b.Matrix2D.Identity,null,Ge),Qe=new f.KeyFrame(De,ne,b.Matrix2D.Identity,null,xe);if(i){var Je;if(Je=a.as(T,P.TextForma)){var $e=Je.textModel.text.length,et=Te<$e?Te:Je.textModel.text.length,tt=Je.textModel.fontColor.value,nt=Je.textModel.fontStrokeColor.value,ot=new k.SolidColor(tt.red,tt.green,tt.blue,0);g&&r!=l.AnimationStyle.WORD_CENTERED_VARIANT&&(ot=tt,tt=new k.SolidColor(tt.red,tt.green,tt.blue,0),nt=new k.SolidColor(nt.red,nt.green,nt.blue,0)),Qe.renderRuns.applyColors(tt,nt,new O.TextRange(0,et)),Qe.renderRuns.applyColors(ot,ot,new O.TextRange(et,$e))}var rt=new f.KeyFrame(be,ne,b.Matrix2D.Identity,null,xe);rt.renderRuns=Qe.renderRuns,a.opt(fe[T.formaID],(function(e){return e.push(rt)}))}else a.opt(fe[T.formaID],(function(e){return e.push(Ze)}));a.opt(fe[T.formaID],(function(e){return e.push(Qe)}))}this.validateKeyFrames(fe[T.formaID].concat(),"variants")}}ge+=ue}for(var it=a.iter(c);!it.done;it.next())T=it.value,Ge=I.MotionUtils.createOpacityStyle(T,0),g=!1,(dt=a.as(a.opt(a.opt(a.as(T,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(g=this.useKnockoutAnimation(dt,r)),g&&T instanceof P.TextForma&&(Ke=(o=a.opt(a.as(a.opt(a.opt(a.as(T,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.style})),E.LockupStyle),(function(e){return e.backingOpacity})))||null!=o?o:T.style.opacity,Ge=I.MotionUtils.createOpacityStyle(T,Ke)),null==fe[T.formaID]&&((pt=[]).push(new f.KeyFrame(t.startTime,oe,b.Matrix2D.Identity,null,Ge)),fe[T.formaID]=pt,a.opt(fe[T.formaID],(function(e){return e.push(new f.KeyFrame(me,oe,b.Matrix2D.Identity,null,Ge))})),this.validateKeyFrames(fe[T.formaID].concat(),"createOpacityStyle"));for(var at=[],lt=a.iter(x);!lt.done;lt.next()){e=lt.value;for(var st=a.iter(e);!st.done;st.next()){var ut=st.value;at.push(ut)}}for(var ct=c.concat(at),mt=a.iter(this.uniqueFormae(a.clone(ct)));!mt.done;mt.next()){var dt;xe=(T=mt.value).style,g=!1,(dt=a.as(a.opt(a.opt(a.as(T,P.TextForma),(function(e){return e.lockupForma})),(function(e){return e.controller})),M.TypeLockupController))&&(g=this.useKnockoutAnimation(dt,r)),g&&T instanceof P.TextForma&&(xe=I.MotionUtils.createOpacityStyle(T,0)),(pt=fe[T.formaID])&&pt.length>0&&pt[pt.length-1].time.value>=de.value&&a.info("error?"),fe[T.formaID].push(new f.KeyFrame(de,oe,b.Matrix2D.Identity,null,xe)),de.value-15<t.endTime.value&&fe[T.formaID].push(new f.KeyFrame(t.endTime.addVal(15),oe,b.Matrix2D.Identity,null,xe)),this.validateKeyFrames(fe[T.formaID].concat(),"fade time checks")}for(var ht=e.concat(at).concat(c),ft=a.iter(this.uniqueFormae(a.clone(ht)));!ft.done;ft.next()){var pt,gt;if(pt=fe[(T=ft.value).formaID])T.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,pt.concat()),T.kind==P.TextForma.KIND&&(gt=a.opt(a.opt(T.parent,(function(e){return e.parent})),(function(e){return e.parent})))&&gt.isTypeLockup()&&null==gt.animation&&this.setStillAnimation(gt,t),this.validateKeyFrames(a.clone(T.animation.keyFrames),"dynamicWord/setStillAnimation");else T.animation=null}}}},uniqueFormae:function(e){for(var t=[],n=a.iter(e);!n.done;n.next()){var o=n.value;a.containsEq(t,o,h._equality_Forma_Forma)||t.push(o)}return t},getTitleLockups:function(e){var t=a.clone(e.filterWithCallback((function(e){return e.isTypeLockup()})));if(0==t.length)return[];a.sortInPlace(t,(function(e,t){return e.controller.currentHeightScale>t.controller.currentHeightScale}));for(var n=t[0],o=[n],r=a.iter(t);!r.done;r.next()){var i,l,s=r.value;if(!a.eq(h._equality_Forma_Forma,s,n)&&(i=a.as(s.controller,M.TypeLockupController))&&(l=a.as(n.controller,M.TypeLockupController))){var u=i.getCurrentFontSize(),c=l.getCurrentFontSize();Math.abs(u-c)/Math.min(u,c)<.05&&o.push(s)}}return o},setSlideAnimation:function(e,t,n){var o,r=[],i=[],s=!1,u=!1;if(S.Host.textModelUtils.usePGMRenderer()||(o=a.opt(a.as(e.controller,M.TypeLockupController),(function(e){return e.lockupStyle})))&&(E.LockupStyle.isKnockoutLook(o.textLook)&&o.backing==E.LockupBacking.Knockout&&(s=!0),u=E.LockupStyle.isKnockoutLook(o.textLook)&&o.textLook!=E.LockupTextLook.KnockoutOnly),e.isTypeLockup()?e.visitAll(h.FormaTraversal.PreOrder,(function(e){u||e instanceof L.ShapeForma?i.push(e):e instanceof P.TextForma&&r.push(e)})):r.push(e),2==t.variant||1==t.variantCount||s){var c=75;s&&(c=2==t.variant||1==t.variantCount?-75:0==t.variant?-200:200);var m=b.Matrix2D.translation(new K.TheoPoint(-c,0)),d=b.Matrix2D.translation(new K.TheoPoint(c,0)),p=t.endTime.multiply(2/3);if(this.setFormaAnimations(a.clone(r),t,0,e.style.opacity,m,B.TimingFunctionType.EaseInOut,t.startTime,t.startTime,p),this.setFormaAnimations(a.clone(i),t,0,e.style.opacity,d,B.TimingFunctionType.EaseInOut,t.startTime,t.startTime,p),e.isTypeLockup()){var g=[];g.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.Linear)),g.push(new f.KeyFrame(p,B.TimingFunctionType.Linear)),e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,g.concat()),e.animation=f.FormaAnimation.init_9e82(t,t.startTime,p,g.concat())}}else{var y=t.endTime.subtract(l.AnimationStyle.FADE_DURATION);a.containsEq(n,e,h._equality_Forma_Forma)?(m=b.Matrix2D.translation(new K.TheoPoint(0==t.variant?-200:200,0)),this.setLineAnimation(e,t,m,B.TimingFunctionType.EaseInOut,t.startTime,y,new N.TheoTime(a.toInt(.1*a.toDouble(t.endTime.timescale)),t.endTime.timescale)),this.setStillAnimation(e,t,t.startTime,y)):this.setFormaFade(e,t,t.startTime,t.endTime,y)}},setFormaFade:function(e,t,n,o,r){var i,a=e;(i=A.ImageFacade.getImageFormaForForma(e))&&(a=i);var l=a.style,s=I.MotionUtils.createOpacityStyle(a,0),u=[];u.push(new f.KeyFrame(n,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,s)),u.push(new f.KeyFrame(r,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,s)),u.push(new f.KeyFrame(o,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,l)),e.animation=f.FormaAnimation.init_9e82(t,n,o,u.concat())},getShiftingMatrix:function(e,t,n,o){var r,i=e.finalFrame,a=e.root.frame,l=e.root.placement.inverse.transformPoint(a.eval(n)),s=b.Matrix2D.scaling(t),u=e.root.placement.concat(s).transformPoint(l);return r=o?u.subtract(i.center):a.center.subtract(u),b.Matrix2D.scaling(t).translate(r)},setFormaAnimations:function(e,t,n,o,r,i,l,s,u){void 0===n&&(n=null),void 0===o&&(o=null),void 0===r&&(r=b.Matrix2D.Identity),void 0===i&&(i=B.TimingFunctionType.Linear);for(var c=a.iter(e);!c.done;c.next()){var m=c.value,d=m.style,h=null!=n?I.MotionUtils.createOpacityStyle(m,n):d,p=null!=o?I.MotionUtils.createOpacityStyle(m,o):d,g=[];l.value!=s.value&&g.push(new f.KeyFrame(l,i,r,null,h)),g.push(new f.KeyFrame(s,i,r,null,h)),g.push(new f.KeyFrame(u,i,b.Matrix2D.Identity,null,p)),m.animation=f.FormaAnimation.init_9e82(t,l,u,g.concat())}},setGreyscaleAnimation:function(e,t){var n=[],o=e.page.imageFilterLibrary.getImageStyle("Greyscale").clone();o.colorLibrary=e.style.colorLibrary;var r=e.style.clone();null==r.filter&&(r.filter=_.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),s.CoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2463),s.CoreAssert.isTrue(r.colorLibrary==e.style.colorLibrary,void 0,"AnimationLibrary.setGreyscaleAnimation","AnimationLibrary.swift",2464),o.adjustments=e.style.adjustments,r.adjustments=e.style.adjustments,n.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,o)),n.push(new f.KeyFrame(t.endTime,B.TimingFunctionType.Linear,b.Matrix2D.Identity,null,r)),e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,n.concat())},setBlurAnimation:function(e,t){t.endTime=l.AnimationStyle.DEFAULT_DURATION.subtract(new N.TheoTime(30,30));var n=[],o=e.style.clone(),r=e.style.clone();null!=o.filter&&o.filter instanceof _.CompositeFilter||((o=e.page.imageFilterLibrary.getImageStyle("Blur").clone()).colorLibrary=e.style.colorLibrary,(r=e.page.imageFilterLibrary.getImageStyle("Blur").clone()).colorLibrary=e.style.colorLibrary),s.CoreAssert.isTrue(o.colorLibrary==e.style.colorLibrary,void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2496),s.CoreAssert.isTrue(r.colorLibrary==e.style.colorLibrary,void 0,"AnimationLibrary.setBlurAnimation","AnimationLibrary.swift",2497),o.adjustments=e.style.adjustments,r.adjustments=e.style.adjustments,o.filter.blurRadius=20,r.filter.blurRadius=0,n.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.EaseOut,b.Matrix2D.Identity,null,o)),n.push(new f.KeyFrame(t.endTime,B.TimingFunctionType.EaseOut,b.Matrix2D.Identity,null,r)),e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,n.concat())},setFillAnimation:function(e,t){var n,o,r=[];if((n=e.style.clone())&&(o=e.style.clone())){n.filter=_.CompositeFilter.init_514f(void 0,"Fill",1,"normal",void 0,void 0,"none"),null==o.filter&&(o.filter=_.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),n.colorLibrary=e.style.colorLibrary,o.colorLibrary=e.style.colorLibrary,n.adjustments=e.style.adjustments,o.adjustments=e.style.adjustments;var i=a.clone(e.page.colorLibraryController.getThemeColorKeys());i.length>t.variant&&(n.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(a.as(i[t.variant],"String")),n.colors.fieldSecondary=null,a.opt(n.filter,(function(e){return e.style=n})),a.opt(o.filter,(function(e){return e.style=o})),r.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.EaseInOut,b.Matrix2D.Identity,null,n)),r.push(new f.KeyFrame(t.endTime,B.TimingFunctionType.EaseInOut,b.Matrix2D.Identity,null,o)),e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,r.concat()))}},setColorSwitchAnimation:function(e,t){var n,o,r=[];if((n=e.style.clone())&&(o=e.page.imageFilterLibrary.getImageStyle("Overlay").clone())){var i;if(null==n.filter&&(n.filter=_.CompositeFilter.init_514f(void 0,"None",0,"normal",void 0,void 0,"none")),i=a.as(o.filter,_.CompositeFilter)){var l=a.clone(e.page.colorLibraryController.getThemeColorKeys());l.length>t.variant&&(o.colors.fieldPrimary=e.page.colorLibraryController.getSolidColorForKey(a.as(l[t.variant],"String"))),i.mix=Math.max(i.mix,1)}s.CoreAssert.isTrue(n.colorLibrary==e.style.colorLibrary,void 0,"AnimationLibrary.setColorSwitchAnimation","AnimationLibrary.swift",2578),o.colorLibrary=e.style.colorLibrary,n.adjustments=e.style.adjustments,o.adjustments=e.style.adjustments,r.push(new f.KeyFrame(t.startTime,B.TimingFunctionType.EaseInOut,b.Matrix2D.Identity,null,n)),r.push(new f.KeyFrame(t.endTime,B.TimingFunctionType.EaseInOut,b.Matrix2D.Identity,null,o)),e.animation=f.FormaAnimation.init_9e82(t,t.startTime,t.endTime,r.concat())}},setZoomAnimation:function(e,t){var n=0==t.variant?.8:1.2;e instanceof g.FrameForma?this.setScaleForma(e,t,new K.TheoPoint(n,n),new K.TheoPoint(.5,.5),B.TimingFunctionType.EaseOut,t.startTime,t.endTime):this.setImageAnimation(e,t,B.TimingFunctionType.EaseOut,[[t.startTime,K.TheoPoint.ZERO,n],[t.endTime,K.TheoPoint.ZERO,1]],!0)},setPanningAnimation:function(e,t){var n,o,r,i=!(!(n=a.opt(a.as(e,F.ImageForma),(function(e){return e.hasAlpha()})))&&null==n)&&n;(o=A.ImageFacade.getFrameFormaForForma(e))&&(r=a.as(o.controller,p.FrameController))&&(i=i||r.hasCutout);var l=1==t.variant?-150:150;this.setImageAnimation(e,t,B.TimingFunctionType.EaseOut,[[t.startTime,new K.TheoPoint(l,0),1],[t.endTime,K.TheoPoint.ZERO,1]],!i)},randomDbl:function(){return a.toDouble(c.CoreRandom.nextInt)/a.toDouble(c.CoreRandom.randMax)},setAnimationStyleForFormae:function(e,t,n){if(void 0===n&&(n=null),t.name==l.AnimationStyle.NAME_COLORSWAP)this.setColorSwapAnimation(a.clone(e),t,n);else if(t.name==l.AnimationStyle.NAME_FLICKER)this.setFlickerAnimation(a.clone(e),t);else if(t.name==l.AnimationStyle.NAME_DYNAMIC||t.name==l.AnimationStyle.NAME_TYPE)this.setDynamicWordAnimation(a.clone(e),t);else if(t.name==l.AnimationStyle.NAME_FADE&&0==t.variant)this.setFadeAnimationTopDown(a.clone(e),t);else{for(var o=!1,r=a.as(a.opt(a.first(e),(function(e){return e.root})),R.RootForma),i=a.clone(null!=r?this.getTitleLockups(r):[]),s=a.iter(e);!s.done;s.next()){var u=s.value;o=o||!a.containsEq(i,u,h._equality_Forma_Forma)}t.name==l.AnimationStyle.NAME_SLIDE&&t.variantCount<2&&(t.endTime=t.endTime.addSeconds(-1));for(var c=N.TheoTime.Zero,m=a.iter(e);!m.done;m.next()){var d;if(null!=(u=m.value).controller){var f,p,y=u.hasIntent(h.Forma.INTENT_ICON)&&this.shouldAnimateShape(u),T=u.kind==g.FrameForma.KIND&&u.controller.moveable;if(y||u.isTypeLockup()||T)(p=a.as(u.controller,M.TypeLockupController))&&p.updateGroup(),t.name==l.AnimationStyle.NAME_NO_STYLE?u.animation=null:t.name==l.AnimationStyle.NAME_GROW?this.setGrowAnimation(u,t,a.clone(i)):t.name==l.AnimationStyle.NAME_FADE?this.setFadeAnimation(u,t,a.clone(i)):t.name==l.AnimationStyle.NAME_SLIDE&&this.setSlideAnimation(u,t,a.clone(i));else if(f=A.ImageFacade.getImageFormaForForma(u)){var C;if((C=a.as(u,z.VideoForma))&&C.videoContentNode.isGIF){this.setStillAnimation(f,t);continue}if(t.name==l.AnimationStyle.NAME_NO_STYLE)f.animation=null;else if(t.name==l.AnimationStyle.NAME_BLUR)this.setBlurAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_GRAYSCALE)this.setGreyscaleAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_FILL)this.setFillAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_COLOR)this.setColorSwitchAnimation(f,t);else if(t.name==l.AnimationStyle.NAME_PAN){var S=f.controller.floating?f.parent:f;this.setPanningAnimation(S,t)}else t.name==l.AnimationStyle.NAME_ZOOM&&(S=f.controller.floating?f.parent:f,this.setZoomAnimation(S,t))}}(d=u.animation)&&d.endTime.seconds>c.seconds&&(c=d.endTime)}c.seconds>0&&(t.endTime=c)}},setRootAnimationStyle:function(e,t){this.setStillAnimation(t,e),I.MotionUtils.invalidateAnimation(t.page.document)},modifyModelForAnimation:function(e,t){var n,r,i,u=this,c=a.as((e||t.page.animationLibrary.getNoneStyle()).forkToDatabase(C.GUIDUtils.makeGUID(),!1,t.database,null),l.AnimationStyle);if(s.CoreAssert.isTrue(!(!(n=a.opt(a.as(t.database,d.PostDB),(function(e){return e.transactionStackDescription.includes("revertAnimationPlay")})))&&null==n)&&n,"Don't call applyStyle outside a revertAnimationPlay transaction!","AnimationLibrary.modifyModelForAnimation","AnimationLibrary.swift",2785),i=c){var m=new y.FormaAnimationChangedEvent(t);if(t.beginUpdate(m),D.MotionFacade.canApplyStyle(i))return D.MotionFacade.applyStyle(t,i),void t.endUpdate(m);var T=i.name,S=T==l.AnimationStyle.NAME_NO_STYLE,v=T==l.AnimationStyle.NAME_COLORSWAP;i.endTime=S?l.AnimationStyle.NOOP_DURATION:l.AnimationStyle.DEFAULT_DURATION;var _=[],w=N.TheoTime.Zero,E=[],b=!1;t.visitAll(h.FormaTraversal.PreOrder,(function(e){var t,n,o;if((t=a.as(e,z.VideoForma))&&(n=a.opt(t.parent,(function(e){return e.controller})))){var i=U.VideoFacade.getDurationForVideo(t);i.isZero||(n.moveable?E.push(t):w.seconds<i.seconds&&(w=i))}if(e.animation=null,o=e.controller){if(o.userGroup)return;o.moveable&&!e.isVideo()&&(b=!0);var l=o.moveable&&e.isImage()&&!e.isSticker(),s=v&&l&&!(!(r=a.opt(a.as(o,p.FrameController),(function(e){return e.hasBackgroundColor})))&&null==r)&&r;l&&!s||e.isLogo()||_.push(e)}}));for(var R=a.iter(E);!R.done;R.next()){var k,L=R.value;a.remove(_,L),(k=L.parent)&&a.remove(_,k)}b||(i.endTime=l.AnimationStyle.NOOP_DURATION);var x=i.endTime.timescale,P=null;if(v&&!w.isZero){var M=w.seconds,G=l.AnimationStyle.COLOR_SWAP_DURATION.seconds;P=o.extendToIntegralCount(G,M,x)}this.setAnimationStyleForFormae(a.clone(_),i,P);var K=i.endTime,O=K,Y=N.TheoTime.fromTimeInTimescale(l.AnimationStyle.STILL_DURATION,x);if(E.length>0||!w.isZero){for(var H=l.AnimationStyle.GIF_DURATION,V=N.TheoTime.Zero,W=a.iter(E);!W.done;W.next()){var q=W.value,j=U.VideoFacade.getDurationForVideo(q);j.laterThan(V)&&(V=j)}if(w.isZero){if(!v){var X=V.seconds,Z=Math.max(X,H.seconds),Q=o.extendToIntegralCount(Z,X,x);O=K.add(Q)}}else{var J=K.seconds;if(!v){var $=w.safeSubtract(K);!S&&$.earlierThan(Y)&&($=Y),$.earlierThan(V)&&($=V),S&&E.length>0&&$.earlierThan(H)&&($=H),J+=$.seconds}M=w.seconds,O=o.extendToIntegralCount(J,M,x)}for(var ee=v?i.startTime:i.endTime,te=a.iter(E);!te.done;te.next()){q=te.value;var ne=I.MotionUtils.createOpacityStyle(q,0),oe=q.style,re=[];S||v?re.push(f.KeyFrame.makeFromTimeAndStyle(ee,oe)):(re.push(f.KeyFrame.makeFromTimeAndStyle(i.startTime,ne)),re.push(f.KeyFrame.makeFromTimeAndStyle(ee,ne)),re.push(f.KeyFrame.makeFromTimeAndStyle(ee.addSeconds(.5),oe))),re.push(f.KeyFrame.makeFromTimeAndStyle(O,oe)),q.animation=f.FormaAnimation.init_9e82(i,ee,O,re.concat())}}else v||(O=O.add(Y));i.endTime=O;for(var ie=a.iter(_);!ie.done;ie.next()){var ae,le,se=ie.value;(ae=a.as(se,z.VideoForma))&&(le=a.opt(ae.parent,(function(e){return e.controller})))&&!le.moveable&&S&&this.setStillAnimation(se,i)}!v&&i.endTime.value>0&&this.setStillAnimation(t,i),t.visitAll(h.FormaTraversal.PreOrder,(function(e){var t;if(t=e.animation){var n;if(e.kind==g.FrameForma.KIND&&(n=A.ImageFacade.getImageFormaForForma(e))&&null==n.animation&&u.setStillAnimation(n,i),e.kind==F.ImageForma.KIND&&t.endTime.earlierThan(i.endTime)){var o=a.clone(t.keyFrames);if(o.length>0){var r=o[o.length-1];o.push(new f.KeyFrame(i.endTime,B.TimingFunctionType.Step1,r.placement,r.bounds,r.style,r.relativePlacement)),a.opt(e.animation,(function(e){return e.keyFrames=a.clone(o)}))}}u.validateKeyFrames(a.clone(t.keyFrames),"applyStyle/setStillAnimation")}})),t.endUpdate(m)}else s.CoreAssert.fail("Unable to fall back on 'None' style while applying animation?!?","AnimationLibrary.modifyModelForAnimation","AnimationLibrary.swift",3054),t.animation=null},validateKeyFrames:function(e,t){var n=e.length;if(!(n<=1))for(var o=a.iter(a.range(0,n-1,!1));!o.done;o.next()){var r=o.value,i=e[r],l=e[r+1];i.time.value>l.time.value&&l.time.value>0&&a.opt(S.Host.logging,(function(e){return e.error("keyframe time error on frames "+r+"/"+(r+1)+" with context "+t)}))}}}}),o)},aO0D:function(e,t,n){var o,r,i,a,l,s=t,u=n("oAGj"),c=n("gXiO");s.CropAsset=(o=function(e,t){this.id=e,this.iconId=t},u.defineClass({name:"CropAsset",ctor:o,superName:"CoreObject"}),o),s.CropShape=(r=function(e,t,n){this.fixAspectRatio=n,s.CropAsset.call(this,e,t)},u.defineClass({name:"CropShape",ctor:r,superName:"CropAsset"}),r),s.RasterMask=(i=function(e,t,n,o,r){void 0===r&&(r="image/png"),this.width=n,this.height=o,this.mimeType=r,s.CropAsset.call(this,e,t)},u.defineClass({name:"RasterMask",ctor:i,superName:"CropAsset"}),i),s.CropAssetLibrary=(a=function(){c.CoreObject.call(this)},l={},u.defineClass({name:"CropAssetLibrary",ctor:a,superName:"CoreObject",statics:{shapes:{get:function(){return void 0===l.shapes&&(l.shapes=[new s.CropShape("circle","crop_shape_circle",!0),new s.CropShape("roundedRectangle","crop_shape_roundedRectangle",!1),new s.CropShape("equilateralTriangle","crop_shape_equilateralTriangle",!1),new s.CropShape("rightTriangle","crop_shape_rightTriangle",!1),new s.CropShape("oval","crop_shape_oval",!1),new s.CropShape("halfCircle","crop_shape_halfCircle",!0),new s.CropShape("diamond","crop_shape_diamond",!1),new s.CropShape("hexagon","crop_shape_hexagon",!1),new s.CropShape("parallelogram","crop_shape_parallelogram",!1),new s.CropShape("pentagon","crop_shape_pentagon",!1),new s.CropShape("heart","crop_shape_heart",!0),new s.CropShape("star","crop_shape_star",!0)]),l.shapes}},rasterMasks:{get:function(){return void 0===l.rasterMasks&&(l.rasterMasks=[new s.RasterMask("raster-01","raster-01",1418,1050),new s.RasterMask("raster-Brush-Frame-1","raster-Brush-Frame-1",1126,1050),new s.RasterMask("raster-Brush-Frame-2","raster-Brush-Frame-2",1126,1050),new s.RasterMask("raster-Brush-Frame-3","raster-Brush-Frame-3",1126,1050),new s.RasterMask("raster-Torn-Edge-1","raster-Torn-Edge-1",956,1050),new s.RasterMask("raster-Torn-Edge-2","raster-Torn-Edge-2",755,1050),new s.RasterMask("raster-Torn-Edge-3","raster-Torn-Edge-3",1400,2161),new s.RasterMask("raster-Torn-Edge-4","raster-Torn-Edge-4",956,1050),new s.RasterMask("raster-film-frame-2","raster-film-frame-2",616,1050),new s.RasterMask("raster-film-strip-frame-1","raster-film-strip-frame-1",850,782)]),l.rasterMasks}},getListOfShapes:function(){return a.shapes},getListOfRasterMasks:function(){return a.rasterMasks},getCropShapeFromID:function(e){return a.shapes.find((function(t){return t.id==e}),this)},getRasterMaskFromID:function(e){return a.rasterMasks.find((function(t){return t.id==e}),this)}}}),a)},h67N:function(e,t,n){var o,r=t,i=n("oAGj"),a=n("SpAV"),l=n("gXiO"),s=n("6ZWm"),u=n("tQF8"),c=n("4mVB"),m=n("iCxV"),d=n("fdtz"),h=n("3v9D"),f=n("sIWg");r.GridLibrary=(o=function(){this.gridStyles=[c.GridStyle.init_bf40("Single","Simple",[new u.GridCell(new f.TheoRect(0,0,1,1))],void 0,void 0,void 0,s.CropType.PreserveFocus),c.GridStyle.init_bf40("Single-Overlap","Banner",[new u.GridCell(new f.TheoRect(0,0,1,1)),new u.GridCell(new f.TheoRect(.25,0,.75,1),null,.75)]),c.GridStyle.init_bf40("Single-Center-Overlap","Banner",[new u.GridCell(new f.TheoRect(0,0,1,1)),new u.GridCell(new f.TheoRect(.25,.25,.75,.75),null,.75)]),c.GridStyle.init_bf40("Half-2",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,1,1))]),c.GridStyle.init_bf40("Third-2",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,1,1))]),c.GridStyle.init_bf40("Half-2-1",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,.5001)),new u.GridCell(new f.TheoRect(0,.5001,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,1,1))]),c.GridStyle.init_bf40("Third-2-1",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,1,.5001)),new u.GridCell(new f.TheoRect(1/3,.5001,1,1))]),c.GridStyle.init_bf40("Third-3",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1))]),c.GridStyle.init_bf40("Half-2-2",void 0,[new u.GridCell(new f.TheoRect(0,0,.5,.5)),new u.GridCell(new f.TheoRect(0,.5,.5,1)),new u.GridCell(new f.TheoRect(.5,0,1,.5)),new u.GridCell(new f.TheoRect(.5,.5,1,1))]),c.GridStyle.init_bf40("Half-3-1",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1/3)),new u.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,1,1))]),c.GridStyle.init_bf40("Half-1-3",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,1,1/3)),new u.GridCell(new f.TheoRect(.5001,1/3,1,2/3)),new u.GridCell(new f.TheoRect(.5001,2/3,1,1))]),c.GridStyle.init_bf40("Third-1-2-1",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,.5001)),new u.GridCell(new f.TheoRect(1/3,.5001,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1))]),c.GridStyle.init_bf40("Half-2-2-Offset",void 0,[new u.GridCell(new f.TheoRect(.5,0,1,.35)),new u.GridCell(new f.TheoRect(0,.65,.5,1)),new u.GridCell(new f.TheoRect(0,0,.5,.65)),new u.GridCell(new f.TheoRect(.5,.35,1,1))]),c.GridStyle.init_bf40("Fourth-1",void 0,[new u.GridCell(new f.TheoRect(0,0,.25,1)),new u.GridCell(new f.TheoRect(.25,0,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,.75,1)),new u.GridCell(new f.TheoRect(.75,0,1,1))]),c.GridStyle.init_bf40("Half-2-3",void 0,[new u.GridCell(new f.TheoRect(0,0,1,.5001)),new u.GridCell(new f.TheoRect(0,.5001,.5001,1)),new u.GridCell(new f.TheoRect(.5001,.5001,1,.75)),new u.GridCell(new f.TheoRect(.5001,.75,1,1))]),c.GridStyle.init_bf40("Half-1-3",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,.75,.5001)),new u.GridCell(new f.TheoRect(.75,0,1,.5001)),new u.GridCell(new f.TheoRect(.5001,.5001,1,1))]),c.GridStyle.init_bf40("Third-2-3-2",void 0,[new u.GridCell(new f.TheoRect(0,0,.75,.25)),new u.GridCell(new f.TheoRect(.75,0,1,.75)),new u.GridCell(new f.TheoRect(.25,.25,.75,.75)),new u.GridCell(new f.TheoRect(0,.25,.25,1)),new u.GridCell(new f.TheoRect(.25,.75,1,1))]),c.GridStyle.init_bf40("Third-1-3-1",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new u.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1))]),c.GridStyle.init_bf40("Fifth-5",void 0,[new u.GridCell(new f.TheoRect(0,0,.2,1)),new u.GridCell(new f.TheoRect(.2,0,.4,1)),new u.GridCell(new f.TheoRect(.4,0,.6,1)),new u.GridCell(new f.TheoRect(.6,0,.8,1)),new u.GridCell(new f.TheoRect(.8,0,1,1))]),c.GridStyle.init_bf40("Third-2-1-2",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1/3)),new u.GridCell(new f.TheoRect(2/3,1/3,1,1))]),c.GridStyle.init_bf40("Third-1-1-4",void 0,[new u.GridCell(new f.TheoRect(0,0,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,.25)),new u.GridCell(new f.TheoRect(2/3,.25,1,.5001)),new u.GridCell(new f.TheoRect(2/3,.5001,1,.75)),new u.GridCell(new f.TheoRect(2/3,.75,1,1))]),c.GridStyle.init_bf40("Split-3-2",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,.5001)),new u.GridCell(new f.TheoRect(0,.5001,.5001,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,.5001)),new u.GridCell(new f.TheoRect(2/3,0,1,.5001)),new u.GridCell(new f.TheoRect(.5001,.5001,1,1))]),c.GridStyle.init_bf40("Split-2-3",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,.5001)),new u.GridCell(new f.TheoRect(0,.5001,1/3,1)),new u.GridCell(new f.TheoRect(.5001,0,1,.5001)),new u.GridCell(new f.TheoRect(1/3,.5001,2/3,1)),new u.GridCell(new f.TheoRect(2/3,.5001,1,1))]),c.GridStyle.init_bf40("Half-3-3",void 0,[new u.GridCell(new f.TheoRect(0,0,.5,1/3)),new u.GridCell(new f.TheoRect(0,1/3,.5,2/3)),new u.GridCell(new f.TheoRect(0,2/3,.5,1)),new u.GridCell(new f.TheoRect(.5,0,1,1/3)),new u.GridCell(new f.TheoRect(.5,1/3,1,2/3)),new u.GridCell(new f.TheoRect(.5,2/3,1,1))]),c.GridStyle.init_bf40("Split-2-2-2",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,.5001)),new u.GridCell(new f.TheoRect(1/3,.5001,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1/3)),new u.GridCell(new f.TheoRect(2/3,1/3,1,1))]),c.GridStyle.init_bf40("Quarter-2-2-2-2",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,2/3)),new u.GridCell(new f.TheoRect(0,2/3,.25,1)),new u.GridCell(new f.TheoRect(.25,2/3,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,.75,1/3)),new u.GridCell(new f.TheoRect(.75,0,1,1/3)),new u.GridCell(new f.TheoRect(.5001,1/3,1,1))]),c.GridStyle.init_bf40("Third-2-2-3",void 0,[new u.GridCell(new f.TheoRect(0,0,2/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1/3)),new u.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new u.GridCell(new f.TheoRect(2/3,2/3,1,1))]),c.GridStyle.init_bf40("Third-3-2-2",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1/3)),new u.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,1,2/3)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,2/3,1,1))]),c.GridStyle.init_bf40("Split-3-1-3",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1/3)),new u.GridCell(new f.TheoRect(0,1/3,1,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1/3)),new u.GridCell(new f.TheoRect(2/3,2/3,1,1))]),c.GridStyle.init_bf40("Split-2-3-2",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,1/3)),new u.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,.5001,1)),new u.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new u.GridCell(new f.TheoRect(.5001,0,1,1/3)),new u.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new u.GridCell(new f.TheoRect(.5001,2/3,1,1))]),c.GridStyle.init_bf40("Half-4-4",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,.25)),new u.GridCell(new f.TheoRect(0,.25,.5001,.5001)),new u.GridCell(new f.TheoRect(0,.5001,.5001,.75)),new u.GridCell(new f.TheoRect(0,.75,.5001,1)),new u.GridCell(new f.TheoRect(.5001,0,1,.25)),new u.GridCell(new f.TheoRect(.5001,.25,1,.5001)),new u.GridCell(new f.TheoRect(.5001,.5001,1,.75)),new u.GridCell(new f.TheoRect(.5001,.75,1,1))]),c.GridStyle.init_bf40("Split-3-2-3",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1/3)),new u.GridCell(new f.TheoRect(0,1/3,.5001,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1/3)),new u.GridCell(new f.TheoRect(.5001,1/3,1,2/3)),new u.GridCell(new f.TheoRect(2/3,2/3,1,1))]),c.GridStyle.init_bf40("Third-3-3-3",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,1/3)),new u.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new u.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,1/3)),new u.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new u.GridCell(new f.TheoRect(2/3,2/3,1,1))]),c.GridStyle.init_bf40("Third-4-1-4",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,.25)),new u.GridCell(new f.TheoRect(0,.25,1/3,.5001)),new u.GridCell(new f.TheoRect(0,.5001,1/3,.75)),new u.GridCell(new f.TheoRect(0,.75,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,.25)),new u.GridCell(new f.TheoRect(2/3,.25,1,.5001)),new u.GridCell(new f.TheoRect(2/3,.5001,1,.75)),new u.GridCell(new f.TheoRect(2/3,.75,1,1))]),c.GridStyle.init_bf40("Third-4-3-2",void 0,[new u.GridCell(new f.TheoRect(0,0,1/3,.25)),new u.GridCell(new f.TheoRect(0,.25,1/3,.5001)),new u.GridCell(new f.TheoRect(0,.5001,1/3,.75)),new u.GridCell(new f.TheoRect(0,.75,1/3,1)),new u.GridCell(new f.TheoRect(1/3,0,2/3,1/3)),new u.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new u.GridCell(new f.TheoRect(1/3,2/3,2/3,1)),new u.GridCell(new f.TheoRect(2/3,0,1,.5001)),new u.GridCell(new f.TheoRect(2/3,.5001,1,1))]),c.GridStyle.init_bf40("Split-2-3-4",void 0,[new u.GridCell(new f.TheoRect(0,0,.5001,1/3)),new u.GridCell(new f.TheoRect(0,1/3,1/3,2/3)),new u.GridCell(new f.TheoRect(0,2/3,.25,1)),new u.GridCell(new f.TheoRect(.5001,0,1,1/3)),new u.GridCell(new f.TheoRect(1/3,1/3,2/3,2/3)),new u.GridCell(new f.TheoRect(.25,2/3,.5001,1)),new u.GridCell(new f.TheoRect(2/3,1/3,1,2/3)),new u.GridCell(new f.TheoRect(.5001,2/3,.75,1)),new u.GridCell(new f.TheoRect(.75,2/3,1,1))])],l.CoreObject.call(this)},i.defineClass({name:"GridLibrary",ctor:o,superName:"CoreObject",props:{layoutSuggestionModel:{get:function(){return null==this.layoutSuggestionModel_&&(this.layoutSuggestionModel_=i.opt(m.Host.learning,(function(e){return e.loadLayoutSuggestionModel()}))),this.layoutSuggestionModel_},set:function(e){this.layoutSuggestionModel_=e}},canFlipStyle:function(e){return!["Single","Single-Center-Overlap","Half-2-2","Third-2-3-2","Third-2-3-2-Spaced","Third-3-3-3","Third-2-2-3","Half-2-3","Third-4-3-2","Half-1-3","Third-3-2-2","Split-2-3-4"].includes(e.name)},basicFullDesignGridStyle:function(){var e=this.getGridStyle("Single");return e.moveableShift=!1,e},getAllGrids:function(){for(var e=[],t=i.iter(this.gridStyles);!t.done;t.next()){var n=t.value;e.push(n),this.canFlipStyle(n)&&e.push(n.flipRegion())}return e},getLayoutsForRoot:function(e,t){void 0===t&&(t=null);var n,o=[],r=[];if(!(n=e.controller.getGridController()))return a.CoreAssert.fail("should always have a grid at this point","GridLibrary.getLayoutsForRoot","GridLibrary.swift",558),[];for(var l=h.LayoutSuggester.init_abc1(n.forma,i.clone(t)),s=i.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),u=i.clone(e.filterWithCallback((function(e){return null!=e.parent&&e.parent.isBackgroundImage()}))),c=u.length,m=!0,f=i.iter(u);!f.done;f.next()){var p=f.value;if(i.opt(i.opt(i.as(p,d.ImageForma),(function(e){return e.contentNode})),(function(e){return null==e.focusRegion}))){m=!1;break}}var g=[],y=1,T=m&&c>1?1:0,C=m?1:2,S=m?1:0;c>5&&(m?(y=0==s.length?2:1,T=0==s.length?2:1,C=0==s.length?0:1,S=0==s.length?0:1):(y=0==s.length?4:2,C=0==s.length?0:2));var v,F=i.clone(l.createSuggestions(!0,!1,!1,!1,y));(r=i.clone(l.createEqualSizeSuggestions(!1,10)),i.append(F,r),F.length>0&&i.append(g,F.slice(0,Math.min(y,F.length))),m&&(F=i.clone(l.createSuggestions(!0,!1,!1,!0,T))).length>0&&i.append(g,F.slice(0,Math.min(T,F.length))),0==!s.length)&&((v=i.clone(l.createSuggestions(!0,!1,!0,!1,C))).length>0&&i.append(g,v.slice(0,Math.min(C,v.length))),m&&(v=i.clone(l.createSuggestions(!0,!1,!0,!0,S))).length>0&&i.append(g,v.slice(0,Math.min(S,v.length))),i.append(r,l.createEqualSizeSuggestions(!0,10)));for(var _=i.iter(i.range(0,g.length,!1));!_.done;_.next())(P=g[x=_.value]).gridStyle.name="ContentAwareGrid-"+i.toString(x),P.gridStyle.category="Suggested",P.gridStyle.forma=n.forma,o.push(P.gridStyle);for(var A=i.clone(l.predictLayoutIds(3,i.clone(o))),w=i.iter(A);!w.done;w.next()){var E=w.value;if(k=this.getGridStyle(E)){var b=k.clone();b.category="Suggested",o.push(b)}}for(var D=e.filterWithCallback((function(e){return e.isBackgroundImage()})).length,I=[],R=i.iter(this.gridStyles);!R.done;R.next()){var k;(k=R.value).nonOverlappingCells().length>=D&&(o.push(k),I.push(k),this.canFlipStyle(k)&&(o.push(k.flipRegion()),I.push(k.flipRegion())))}for(var L=i.iter(i.range(0,r.length,!1));!L.done;L.next()){for(var x,P,M=(P=r[x=L.value]).gridStyle,G=!1,K=i.iter(I);!K.done;K.next())if(K.value.geometricEquals(M)){G=!0;break}G||o.push(M)}return o},getGridsByCellNumber:function(e,t){if(void 0===t&&(t=!0),1==e&&0==t)return[this.getGridStyle("Single")];for(var n=[],o=i.iter(this.gridStyles);!o.done;o.next()){var r=o.value,l=r.nonOverlappingCells().length;(t?l>=e:l==e)&&!r.anyOverlap&&(n.push(r),this.canFlipStyle(r)&&n.push(r.flipRegion()))}return 0==n.length&&a.CoreAssert.fail("No matching grids in the library. Need to implement a generic grid creator.","GridLibrary.getGridsByCellNumber","GridLibrary.swift",623),n},getGridStyle:function(e){for(var t,n=i.iter(this.gridStyles);!n.done;n.next()){var o=n.value;if(e==o.name){t=o;break}if(this.canFlipStyle(o)){var r=o.flipRegion();if(e==r.name){t=r;break}}}return t},getCategoryForStyle:function(e){var t;return null!=(t=e.category)?t:"Single"==e.name?"Simple":e.name.includes("Overlap")?"Banner":e.name.includes("ContentAwareGrid")?"Suggested":"Grid"}}}),o)},lqhW:function(e,t,n){var o,r,i,a,l=t,s=n("oAGj"),u=n("gXiO"),c=n("ylxa"),m=n("1NAc");l.DesignSize=(o=function(e,t,n,o,r,i,a){this.label=e,this.subLabel=t,this.id=n,this.iconId=o,this.category=r,this.aspectRatio=i,this.exportData=a},s.defineClass({name:"DesignSize",ctor:o,superName:"CoreObject"}),o),l.DesignSizeCategory=(r=function(e,t){this.id=e,this.label=t},s.defineClass({name:"DesignSizeCategory",ctor:r,superName:"CoreObject"}),r),l.DesignSizeCategories=(i=function(){u.CoreObject.call(this)},a={},s.defineClass({name:"DesignSizeCategories",ctor:i,superName:"CoreObject",statics:{SocialPost:{get:function(){return void 0===a.SocialPost&&(a.SocialPost=new l.DesignSizeCategory("socialPost","SOCIAL POST")),a.SocialPost}},Print:{get:function(){return void 0===a.Print&&(a.Print=new l.DesignSizeCategory("print","PRINT")),a.Print}},SocialProfile:{get:function(){return void 0===a.SocialProfile&&(a.SocialProfile=new l.DesignSizeCategory("socialProfile","SOCIAL PROFILE")),a.SocialProfile}},Standard:{get:function(){return void 0===a.Standard&&(a.Standard=new l.DesignSizeCategory("standard","STANDARD")),a.Standard}},Custom:{get:function(){return void 0===a.Custom&&(a.Custom=new l.DesignSizeCategory("Custom","Custom")),a.Custom}},Default:{get:function(){return void 0===a.Default&&(a.Default=new l.DesignSizeCategory("Default","Default")),a.Default}},getCategories:function(){return[i.SocialPost,i.Print,i.SocialProfile,i.Standard]}}}),i),l.DesignSizeLibrary=function(){var e=function(){u.CoreObject.call(this)},t={};return s.defineClass({name:"DesignSizeLibrary",ctor:e,superName:"CoreObject",statics:{MAX_EDGE:2560,designSizes:{get:function(){return void 0===t.designSizes&&(t.designSizes=[new l.DesignSize("k_Instagram_label","k_Instagram_subLabel","Instagram","instagram_icon",l.DesignSizeCategories.SocialPost,1,new c.FormaPageExportData(new m.TheoSize(1080,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramStory_label","k_InstagramStory_subLabel","InstagramStory","instagram_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new m.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramPortrait_label","k_InstagramPortrait_subLabel","InstagramPortrait","instagram_icon",l.DesignSizeCategories.SocialPost,.8,new c.FormaPageExportData(new m.TheoSize(1080,1350),c.PageExportFormat.PIXELS)),new l.DesignSize("k_InstagramLandscape_label","k_InstagramLandscape_subLabel","InstagramLandscape","instagram_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new m.TheoSize(1080,566),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Facebook_label","k_Facebook_subLabel","Facebook","facebook_icon",l.DesignSizeCategories.SocialPost,1.91,new c.FormaPageExportData(new m.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Pinterest_label","k_Pinterest_subLabel","Pinterest","pinterest_icon",l.DesignSizeCategories.SocialPost,.666969147,new c.FormaPageExportData(new m.TheoSize(735,1102),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeThumbnail_label","k_YouTubeThumbnail_subLabel","YouTubeThumbnail","youtube_icon",l.DesignSizeCategories.SocialPost,1.77777777778,new c.FormaPageExportData(new m.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInBlogPost_label","k_LinkedInBlogPost_subLabel","LinkedInBlogPost","linkedin_icon",l.DesignSizeCategories.SocialPost,1.91082803,new c.FormaPageExportData(new m.TheoSize(1200,628),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SnapchatStory_label","k_SnapchatStory_subLabel","SnapchatStory","snapchat_icon",l.DesignSizeCategories.SocialPost,.5625,new c.FormaPageExportData(new m.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Twitter_label","k_Twitter_subLabel","Twitter","twitter_icon",l.DesignSizeCategories.SocialPost,1.79104477612,new c.FormaPageExportData(new m.TheoSize(1200,670),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Letter_label","k_Letter_subLabel","Letter","",l.DesignSizeCategories.Print,.772727,new c.FormaPageExportData(new m.TheoSize(8.5,11),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Poster_label","k_Poster_subLabel","Poster","",l.DesignSizeCategories.Print,.647,new c.FormaPageExportData(new m.TheoSize(11,17),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_Card_label","k_Card_subLabel","Card","",l.DesignSizeCategories.Print,.71428571,new c.FormaPageExportData(new m.TheoSize(5,7),c.PageExportFormat.INCHES,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A5_label","k_A5_subLabel","A5","",l.DesignSizeCategories.Print,.70483871,new c.FormaPageExportData(new m.TheoSize(148,210),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A4_label","k_A4_subLabel","A4","",l.DesignSizeCategories.Print,.70695553,new c.FormaPageExportData(new m.TheoSize(210,297),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_A3_label","k_A3_subLabel","A3","",l.DesignSizeCategories.Print,.7071155,new c.FormaPageExportData(new m.TheoSize(297,420),c.PageExportFormat.MILLIMETERS,c.FormaPageExportData.DEFAULT_PPI)),new l.DesignSize("k_FacebookProfileCover_label","k_FacebookProfileCover_subLabel","FacebookProfileCover","facebook_icon",l.DesignSizeCategories.SocialProfile,2.62820513,new c.FormaPageExportData(new m.TheoSize(1640,624),c.PageExportFormat.PIXELS)),new l.DesignSize("k_PageCover_label","k_PageCover_subLabel","FacebookPageCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new m.TheoSize(1200,675),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventCover_label","k_EventCover_subLabel","FacebookEventCover","facebook_icon",l.DesignSizeCategories.SocialProfile,1.91,new c.FormaPageExportData(new m.TheoSize(1920,1005),c.PageExportFormat.PIXELS)),new l.DesignSize("k_YouTubeChannelArt_label","k_YouTubeChannelArt_subLabel","YouTubeChannelArt","youtube_icon",l.DesignSizeCategories.SocialProfile,1.77777777778,new c.FormaPageExportData(new m.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitchBanner_label","k_TwitchBanner_subLabel","TwitchBanner","twitch_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new m.TheoSize(1920,480),c.PageExportFormat.PIXELS)),new l.DesignSize("k_TwitterHeader_label","k_TwitterHeader_subLabel","TwitterHeader","twitter_icon",l.DesignSizeCategories.SocialProfile,3,new c.FormaPageExportData(new m.TheoSize(1500,500),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EtsyCover_label","k_EtsyCover_subLabel","EtsyCover","etsy_icon",l.DesignSizeCategories.SocialProfile,4,new c.FormaPageExportData(new m.TheoSize(3360,840),c.PageExportFormat.PIXELS)),new l.DesignSize("k_LinkedInProfileCover_label","k_LinkedInProfileCover_subLabel","LinkedInProfileCover","linkedin_icon",l.DesignSizeCategories.SocialProfile,3.878787878787879,new c.FormaPageExportData(new m.TheoSize(1536,396),c.PageExportFormat.PIXELS)),new l.DesignSize("k_EventbriteEventImage_label","k_EventbriteEventImage_subLabel","EventbriteEventImage","eventbrite_icon",l.DesignSizeCategories.SocialProfile,2,new c.FormaPageExportData(new m.TheoSize(2160,1080),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Phone_label","k_Phone_subLabel","iPhone","phone_icon",l.DesignSizeCategories.Standard,.5625,new c.FormaPageExportData(new m.TheoSize(1080,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Square_label","k_Square_subLabel","Square","",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new m.TheoSize(2560,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Landscape_label","k_Landscape_subLabel","3:2","",l.DesignSizeCategories.Standard,1.5,new c.FormaPageExportData(new m.TheoSize(2550,1700),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Slide_label","k_Slide_subLabel","4:3","",l.DesignSizeCategories.Standard,1.33333333333,new c.FormaPageExportData(new m.TheoSize(2560,1920),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Widescreen_label","k_Widescreen_subLabel","16:9","",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new m.TheoSize(2560,1440),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Portrait_label","k_Portrait_subLabel","2:3","",l.DesignSizeCategories.Standard,.66666666666,new c.FormaPageExportData(new m.TheoSize(1700,2550),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Banner_label","k_Banner_subLabel","3:1","",l.DesignSizeCategories.Standard,3,new c.FormaPageExportData(new m.TheoSize(2559,853),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Wide_label","k_Wide_subLabel","2:1","",l.DesignSizeCategories.Standard,2,new c.FormaPageExportData(new m.TheoSize(2560,1280),c.PageExportFormat.PIXELS)),new l.DesignSize("k_Tall_label","k_Tall_subLabel","1:2","",l.DesignSizeCategories.Standard,.5,new c.FormaPageExportData(new m.TheoSize(1280,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlide_label","k_SparkVideoSlide_subLabel","SparkVideoSlide","sparkvideo_icon",l.DesignSizeCategories.Standard,1.77777777778,new c.FormaPageExportData(new m.TheoSize(1280,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_SparkVideoSlideSquare_label","k_SparkVideoSlideSquare_subLabel","SparkVideoSlideSquare","sparkvideo_icon",l.DesignSizeCategories.Standard,1,new c.FormaPageExportData(new m.TheoSize(720,720),c.PageExportFormat.PIXELS)),new l.DesignSize("k_KindleCover_label","k_KindleCover_subLabel","KindleCover","kindle_icon",l.DesignSizeCategories.Standard,.625,new c.FormaPageExportData(new m.TheoSize(1600,2560),c.PageExportFormat.PIXELS)),new l.DesignSize("k_BlogPost_label","k_BlogPost_subLabel","BlogPost","blog_icon",l.DesignSizeCategories.Standard,1.78,new c.FormaPageExportData(new m.TheoSize(712,400),c.PageExportFormat.PIXELS))]),t.designSizes}},getListOfResizeShapes:function(){return e.designSizes},getById:function(t){for(var n=s.iter(e.designSizes);!n.done;n.next()){var o=n.value;if(o.id==t)return o}return null},getCustomSize:function(e,t,n,o){return new l.DesignSize("k_Custom_label","k_Custom_subLabel","Custom","custom_icon",l.DesignSizeCategories.Custom,e/t,new c.FormaPageExportData(new m.TheoSize(e,t),n,n==c.PageExportFormat.PIXELS?null:o))},getOriginalSize:function(e,t){return new l.DesignSize("k_OriginalSize_label","","Original","",l.DesignSizeCategories.Default,e/t,new c.FormaPageExportData(new m.TheoSize(e,t),c.PageExportFormat.PIXELS))},getByCategory:function(t){return e.designSizes.filter((function(e){return e.category.id==t}),this)}}}),e}()},oknb:function(e,t,n){var o,r,i=t,a=n("oAGj"),l=n("90dd"),s=n("ZoS2");i.ControllerSettingsState=(o=function(){s.TheoPublishingObject.call(this)},a.defineClass({name:"ControllerSettingsState",ctor:o,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessagePublisher"==e}},props:{settings:{get:function(){return this.settings_},set:function(e){this.settings_=e,this.publish(new i.ControllerSettingsStateChangeMessage(this,this.settings))}}}}),o),i.ControllerSettingsStateChangeMessage=(r=function e(t,n){this.settings=n,l.TheoMessage.call(this,e.TYPE,t)},a.defineClass({name:"ControllerSettingsStateChangeMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ControllerSettingsStateChangeMessage"}}}}),r)},quOg:function(e,t,n){var o,r,i,a,l=t,s=n("oAGj"),u=n("0wFF"),c=n("SpAV"),m=n("oknb"),d=n("qUXk"),h=n("7S/6"),f=n("7siz"),p=n("waL6"),g=n("yHU1"),y=n("Pil/"),T=n("OdB2"),C=n("P83h"),S=n("iCxV"),v=n("g8Fi"),F=n("KIfs"),_=n("i5Hy"),A=n("n/CE"),w=n("9YN4"),E=n("90dd"),b=n("ZoS2"),D=n("rrhp");l.InteractionMode=s.defineEnum("InteractionMode",{DefaultInteraction:0,SelectionFocused:1,AutomaticGrid:2}),l.ClickMessage=(o=function e(t,n){this.state=t,E.TheoMessage.call(this,e.TYPE,n)},s.defineClass({name:"ClickMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:{get:function(){return"ClickMessage"}}}}),o),l.DoubleClickMessage=(r=function e(t,n){this.state=t,E.TheoMessage.call(this,e.TYPE,n)},s.defineClass({name:"DoubleClickMessage",ctor:r,superName:"TheoMessage",statics:{TYPE:{get:function(){return"DoubleClickMessage"}}}}),r),l.DesignControllerPSMDelegate=(i=function(e){this.dc=e},s.defineClass({name:"DesignControllerPSMDelegate",ctor:i,statics:{_implements:function(e){return"IPSMDelegate"==e}},props:{handleEvent:function(e){var t,n,o,r;(t=s.as(e,y.PSMFormaDragControllerEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.handles.handleFormaDragEvents(t):t.dragDelegate.dragController.onEvent(t):(n=s.as(e,y.BeginPointerTrackingEvent))?s.opt(n.forma.controller,(function(e){return e.onEvent(n)})):(o=s.as(e,y.FormaClickEvent))?this.dc.designControllerHandlesPointers?this.dc.designController.click.handleClick(o):s.opt(o.forma.controller,(function(e){return e.onEvent(o)})):(r=s.as(e,y.FormaDoubleClickEvent))&&(this.dc.designControllerHandlesPointers?this.dc.designController.click.handleDoubleClick(r):s.opt(r.forma.controller,(function(e){return e.onEvent(r)})))}}}),i),l.DocumentController=(a=function(){var e;this.blockNonSelectedUpdates_=!1,this.interactionMode_=l.InteractionMode.DefaultInteraction,this.pointerStateMachine_=null,this.viewScale_=1,this.designControllerHandlesPointers=!1,this.designControllerHandlesSwap=!0,this.enableMoveableChildren=!1,this.formaEventStackCounter=0,this.currentGestureActionsLogged=[],this.currentGestureScope="",this.controllerFactory_=new p.FormaControllerFactory(null),this.pointers_=new v.PointersState,this.selection_=new A.SelectionState,this.editorModel_=new f.EditorModel,this.designControllerFactory_=new h.DesignControllerFactory,this.controllerSettingsState_=new m.ControllerSettingsState,this.undoRedoMgr_=new D.UndoRedoManager(((e=s.opt(S.Host.platform,(function(e){return e.isMobile})))||null!=e)&&e?D.UndoRedoSelectionPolicyEnum.PreserveSelection:D.UndoRedoSelectionPolicyEnum.RestoreSelection),this.designController_=d.DesignController.NullController,this.saveMgr_=new _.SaveManager,b.TheoPublishingObject.call(this),this.controllerFactory_.owner=this,this.pointers_.owner=this,this.selection_.owner=this,this.editorModel_.owner=this,this.designControllerFactory_.owner=this,this.controllerSettingsState_.owner=this,this.undoRedoMgr_.owner=this,this.saveMgr_.owner=this,this.updateEditorModel(),this.selection_.subscribe(this,A.SelectionStateChangedMessage.TYPE),this.selection_.subscribe(this,A.SelectionStateModeChangedMessage.TYPE),this.pointers_.subscribe(this,v.PointersStateChangeMessage.TYPE),c.CoreAssert.creatingDocumentSingleton(this)},s.defineClass({name:"DocumentController",ctor:a,superName:"TheoPublishingObject",statics:{_implements:function(e){return"TheoMessageSubscriber"==e||"TheoMessagePublisher"==e}},props:{controllerFactory:{get:function(){return this.controllerFactory_}},document:{get:function(){return this.doc_}},selection:{get:function(){return this.selection_}},model:{get:function(){return this.editorModel_}},designController:{get:function(){return this.designController_}},controllerSettingsState:{get:function(){return this.controllerSettingsState_}},pointers:{get:function(){return this.pointers_}},pointerStateMachine:{get:function(){return this.pointerStateMachine_}},undoRedoMgr:{get:function(){return this.undoRedoMgr_}},saveMgr:{get:function(){return this.saveMgr_}},updateEditorModel:function(){var e=this;this.designController_=this.designControllerFactory_.getNewDesignController(this.editorModel_),this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.configureEditorModel(e.editorModel_)})),this.editorModel_.updatesComplete()},onMessage:function(e){var t,n,o,r;if(e instanceof A.SelectionStateChangedMessage)this.formaEventStackCounter=0,this.updateEditorModel();else if(e instanceof A.SelectionStateModeChangedMessage)this.updateEditorModel();else if(t=s.as(e,v.PointersStateChangeMessage))null==this.pointerStateMachine_&&t.changeType==v.PointersStateChangeTypeEnum.PointersDown?(this.pointerStateMachine_=new F.PointerStateMachine(new g.FormaPagePointerStateMachineDelegate(new l.DesignControllerPSMDelegate(this))),this.pointerStateMachine_.attach(this,this.pointers),this.pointerStateMachine_.onMessage(t)):null!=this.pointerStateMachine_&&0==this.pointers.pointerDownCount()&&(this.pointerStateMachine_.onMessage(t),this.pointerStateMachine_.detach(),this.pointerStateMachine_=null);else if(n=s.as(e,T.FormaBeginUpdateMessage))this.selection.isSelected(n.event.forma)&&(this.formaEventStackCounter+=1);else if(o=s.as(e,T.FormaEndUpdateMessage))(o.event instanceof C.FormaGroupEvent||o.event instanceof C.FormaUngroupEvent)&&this.updateEditorModel(),this.selection.isSelected(o.event.forma)&&this.formaEventStackCounter>0&&(this.formaEventStackCounter-=1,0==this.formaEventStackCounter&&this.updateHandles());else if(r=s.as(e,w.TheoDocumentDidDecodeMessage)){var i;(i=s.opt(r.document,(function(e){return e.firstPage})))&&this.subscribeToPage(i),this.updateEditorModel()}else e instanceof T.BeginFormaResizeMessage?s.opt(this.formaPageView,(function(e){return e.beginUserResize()})):e instanceof T.EndFormaResizeMessage&&s.opt(this.formaPageView,(function(e){return e.endUserResize()}))},notifyClick:function(e){this.publish(new l.ClickMessage(e,this))},notifyDoubleClick:function(e){this.publish(new l.DoubleClickMessage(e,this))},formaUpdateSubscription:{get:function(){return this.formaUpdateSubscription_},set:function(e){var t;(t=this.formaUpdateSubscription_)&&t.unsubscribe(),this.formaUpdateSubscription_=e}},beginFormaResizeSubscription:{get:function(){return this.beginFormaResizeSubscription_},set:function(e){s.opt(this.beginFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.beginFormaResizeSubscription_=e}},endFormaResizeSubscription:{get:function(){return this.endFormaResizeSubscription_},set:function(e){s.opt(this.endFormaResizeSubscription_,(function(e){return e.unsubscribe()})),this.endFormaResizeSubscription_=e}},subscribeToPage:function(e){this.formaUpdateSubscription=e.subscribe(this,T.FormaEndUpdateMessage.TYPE),e.subscribe(this,T.FormaBeginUpdateMessage.TYPE),this.beginFormaResizeSubscription=e.subscribe(this,T.BeginFormaResizeMessage.TYPE),this.endFormaResizeSubscription=e.subscribe(this,T.EndFormaResizeMessage.TYPE)},attach:function(e){var t,n=this;this.doc_=e,this.updateEditorModel(),(t=s.opt(this.doc_,(function(e){return e.firstPage})))&&this.subscribeToPage(t),s.opt(e,(function(e){return e.subscribe(n,w.TheoDocumentDidDecodeMessage.TYPE)})),this.undoRedoMgr_.setup()},canDoAction:function(e){return this.designController.actions.canDoAction(e)},doAction:function(e){var t=!1;this.doActionWithCompletion(e,(function(e,n){t=!0})),t||c.CoreAssert.warning("You've called doAction() which may presume the action is synchronous, but it's not. Consider using doActionWithCompletion instead.")},doActionWithCompletion:function(e,t){var n=null!=this.undoRedoMgr_.gestureScope,o=!1;if(n&&(this.undoRedoMgr_.gestureScope!=this.currentGestureScope&&(this.currentGestureActionsLogged=[],this.currentGestureScope=this.undoRedoMgr_.gestureScope),(o=null!=s.indexOf(this.currentGestureActionsLogged,e.type))||this.currentGestureActionsLogged.push(e.type)),!n||n&&!o){var r=this.selection.asFormaArray().map((function(e){return e.kind}),this);s.opt(S.Host.logging,(function(t){return t.logToAnalytics(u.AnalyticsConstants.kAnalyticsDataActionPerformed,{contextualData2:e.type,contextualData3:"Formae Selected: ["+r.join(",")+"]"})}))}this.designController.actions.doActionWithCallback(e,t)},allowSelectionChanges:{get:function(){return this.interactionMode_!=l.InteractionMode.SelectionFocused}},undoWithCompletion:function(e){this.undoRedoMgr.undo(e)},redoWithCompletion:function(e){this.undoRedoMgr.redo(e)},setSelectionFocusedInteraction:function(){this.interactionMode_=l.InteractionMode.SelectionFocused},inSelectionFocusedInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.SelectionFocused}},setAutomaticLayoutInteractionMode:function(){this.interactionMode_=l.InteractionMode.AutomaticGrid},inAutomaticLayoutInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.AutomaticGrid}},setDefaultInteractionMode:function(){this.interactionMode_=l.InteractionMode.DefaultInteraction},inDefaultInteractionMode:{get:function(){return this.interactionMode_==l.InteractionMode.DefaultInteraction}},interactionMode:{get:function(){return this.interactionMode_},set:function(e){this.interactionMode_=e}},viewScale:{get:function(){return this.viewScale_},set:function(e){this.viewScale_=e}},formaPageView:{get:function(){return s.opt(this.doc_,(function(e){return e.firstPage.view}))}},updateHandles:function(){var e=this;this.editorModel_.beginUpdates(),s.opt(this.designController_,(function(t){return t.handles.updateHandles(e.editorModel_.mutable.handles)})),this.editorModel_.updatesComplete()}}}),a)},yhkb:function(e,t,n){var o,r,i=t,a=n("oAGj"),l=n("kYI4"),s=n("SpAV"),u=n("9WSY"),c=n("gXiO"),m=n("C42b"),d=n("ascj"),h=n("dJuF"),f=n("FNB+"),p=n("9Lk3"),g=n("m404"),y=n("fdtz"),T=n("c+uM"),C=n("jcfx"),S=n("Zifs"),v=n("aN2p"),F=n("umUn");i.ColorLibraryController=(o=function(e,t){this._themeKeys=null,this.DERIVED_LIGHT_BRIGHTNESS=.98,this.DERIVED_LIGHT_SATURATION=.03,this.DERIVED_DARK_BRIGHTNESS=.05;var n=this;c.CoreObject.call(this),this.library=e,this.document=t,this.librarySubscription_=a.opt(this.library,(function(e){return e.subscribe(n,u.ColorLibraryChangedMessage.TYPE)})),this.library.setColors({black:F.TheoColor.init_5344(S.SolidColor.BLACK,null,null),white:F.TheoColor.init_5344(S.SolidColor.WHITE,null,null)})},r={},a.defineClass({name:"ColorLibraryController",ctor:o,superName:"CoreObject",statics:{kDefaultNumThemeColors:5,BLACK_KEY:"black",WHITE_KEY:"white",USER_KEY_PREFIX:"userColor",BW_KEYS:{get:function(){return void 0===r.BW_KEYS&&(r.BW_KEYS=[o.BLACK_KEY,o.WHITE_KEY]),r.BW_KEYS}},THEME_DERIVED_BW_KEYS:["themeDerivedLight","themeDerivedDark"],THEME_PROFILING_DERIVED_COLORS:["theme0Light","theme0Dark","theme1Light","theme1Dark","theme2Light","theme2Dark","theme3Light","theme3Dark","theme4Light","theme4Dark"],DERIVED_BASE_KEYS:["filterBase1","filterBase2","filterBase3"],FILTER_MULTIPLY_KEYS:["filterMultiply1","filterMultiply2","filterMultiply3"],FILTER_OVERLAY_KEYS:["filterOverlay1","filterOverlay2","filterOverlay3"],FILTER_BLEND_KEYS:["filterBlend1","filterBlend2","filterBlend3"],FILTER_SCREEN_KEYS:["filterScreen1","filterScreen2","filterScreen3"],FILTER_DUOTONE_LOW_KEYS:["filterDuotoneLow1","filterDuotoneLow2","filterDuotoneLow3"],FILTER_DUOTONE_HIGH_KEYS:["filterDuotoneHigh1","filterDuotoneHigh2","filterDuotoneHigh3"],IMAGE_KEYS:["imageColor0","imageColor1","imageColor2","imageColor3","imageColor4","imageColor5","imageColor6","imageColor7","imageColor8","imageColor9"],IMAGE_DERIVED_KEYS:["imageDerivedDominant","imageDerivedInteresting"],getLightnessContrastKey:function(e){return e+"LightnessContrast"},getBackgroundContrastKey:function(e){return e+"BackgroundContrast"},DERIVED_KEY_MAP:{filterOverlay1:"filterBase1",filterOverlay2:"filterBase2",filterOverlay3:"filterBase3",filterMultiply1:"filterBase1",filterMultiply2:"filterBase2",filterMultiply3:"filterBase3",filterScreen1:"filterBase1",filterScreen2:"filterBase2",filterScreen3:"filterBase3",filterBlend1:"filterBase1",filterBlend2:"filterBase2",filterBlend3:"filterBase3",filterDuotoneLow1:"filterBase1",filterDuotoneLow2:"filterBase2",filterDuotoneLow3:"filterBase3",filterDuotoneHigh1:"filterBase1",filterDuotoneHigh2:"filterBase2",filterDuotoneHigh3:"filterBase3"},ALL_DERIVED_KEYS:{get:function(){return void 0===r.ALL_DERIVED_KEYS&&(r.ALL_DERIVED_KEYS=o.makeAllKeys()),r.ALL_DERIVED_KEYS}},makeAllKeys:function(){var e=a.clone(o.THEME_DERIVED_BW_KEYS);return a.append(e,o.THEME_PROFILING_DERIVED_COLORS),a.append(e,o.DERIVED_BASE_KEYS),a.append(e,o.FILTER_MULTIPLY_KEYS),a.append(e,o.FILTER_OVERLAY_KEYS),a.append(e,o.FILTER_BLEND_KEYS),a.append(e,o.FILTER_SCREEN_KEYS),a.append(e,o.FILTER_DUOTONE_LOW_KEYS),a.append(e,o.FILTER_DUOTONE_HIGH_KEYS),a.append(e,o.THEME_PROFILING_DERIVED_COLORS),e},getNextKeyInSet:function(e){var t,n=e.substr(e.length-1,1);if(n>="0"&&n<="9"&&null!=(t=a.toInt(n))){var r=e.substr(0,e.length-1),i=r+a.toString(t+1);if(o.ALL_DERIVED_KEYS.includes(i))return[i,!1];if(i=r+"1",o.ALL_DERIVED_KEYS.includes(i))return[i,!0]}return[e,!1]},keyFromImage:function(e){return!(!o.IMAGE_KEYS.includes(e)&&!o.IMAGE_DERIVED_KEYS.includes(e))},_implements:function(e){return"TheoMessageSubscriber"==e}},props:{randomDbl:function(){return a.toDouble(m.CoreRandom.nextInt)/a.toDouble(m.CoreRandom.randMax)},getNumThemeColorKeys:function(){return this.getThemeColorKeys().length},getThemeColorKeys:function(){var e=this,t=[];return null==this._themeKeys&&(this._themeKeys=[],this.library.forEachColor((function(t,n){t.includes("themeColor")&&!t.includes("Contrast")&&e.library.color(t)&&e._themeKeys.push(t)})),0==this._themeKeys.length&&(this._themeKeys.push("themeColor0"),this._themeKeys.push("themeColor1"))),a.append(t,a.sort(this._themeKeys)),t},getNumProfilingColorsKeys:function(){return this.getProfilingColorKeys().length},getProfilingColorKeys:function(){for(var e=[],t=2*this.getNumThemeColorKeys(),n=a.iter(a.range(0,Math.min(t,o.THEME_PROFILING_DERIVED_COLORS.length),!1));!n.done;n.next()){var r=n.value,i=o.THEME_PROFILING_DERIVED_COLORS[r];this.library.color(i)&&e.push(i)}return e},setLightnessContrastColorAndReturnKey:function(e,t){var n=o.getLightnessContrastKey(e);if(null==this.library.color(n)){var r=t.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(F.TheoColor.init_5344(r,null,null),n)}return n},isSparkColorInUse:function(e){return this.areSparkColorsInUse([e])},areSparkColorsInUse:function(e){if(0==e.length)return!1;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,o=this.library.color(n);if(null!=o.sparkElementID&&o.sparkElementID.length>0&&e.includes(o.sparkElementID))return!0}return!1},areAnySparkColorsInUse:function(){for(var e=a.iter(a.toSequence(this.getThemeColorKeys()));!e.done;e.next()){var t=e.value.element,n=this.library.color(t);if(a.opt(n,(function(e){return null!=e.sparkElementID&&n.sparkElementID.length>0})))return!0}return!1},getSparkColor:function(e){if(a.isEmpty(e))return null;for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,o=this.library.color(n);if(null!=o.sparkElementID&&o.sparkElementID==e)return o}return null},updateSparkColor:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,r=this.library.color(n);if(null!=r.sparkElementID&&r.sparkElementID==e.sparkElementID){this.library.setColor(n,e);var i=o.getLightnessContrastKey(n);if(null!=this.library.color(i)){var l=e.rgbColor.contrastWithSelf();this.setTheoColorToLibrary(F.TheoColor.init_5344(l,null,null),i)}return void this.updateDerivedColors()}}s.CoreAssert.fail("asked to update spark color which isn't currently used.","ColorLibraryController.updateSparkColor","ColorLibraryController.swift",372)},calculateShadeDelta:function(e){for(var t=a.iter(a.toSequence(this.getThemeColorKeys()));!t.done;t.next()){var n=t.value.element,o=this.library.color(n);if(o.isBrandkitColor()&&o.isBrandkitPrimaryColor())for(var r=a.iter(e);!r.done;r.next()){var i=r.value;if(i.isBrandkitPrimaryColor()){var l=o.getBrandkitShadeRole(),s=i.getBrandkitShadeRole();if(null!=l&&null!=s){var u=l.substr(F.SHADE_ROLE_PREFIX.length),c=s.substr(F.SHADE_ROLE_PREFIX.length),m=a.toInt(u),d=a.toInt(c);if(null!=m&&null!=d)return d-m}return 0}}}return 0},updateSparkColorsByRole:function(e){for(var t=[],n=e.concat(),o=this.calculateShadeDelta(a.clone(e)),r=a.iter(a.toSequence(this.getThemeColorKeys()));!r.done;r.next()){var i=r.value.element;if((l=this.library.color(i)).isBrandkitColor()){var l,u=(l=this.library.color(i)).getBrandkitShadeRole();if(null!=u&&0!=o){var c=u.substr(F.SHADE_ROLE_PREFIX.length),m=a.toInt(c);if(null!=m&&(s.CoreAssert.isTrue(m>=0&&m<=6,"Shade out of range","ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",443),0!=m&&6!=m)){var d=m+o;d<=0?d+=5:d>=6&&(d-=5),s.CoreAssert.isTrue(d>=0&&d<=6,"Desired shade out of range","ColorLibraryController.updateSparkColorsByRole","ColorLibraryController.swift",457),u=F.SHADE_ROLE_PREFIX+a.toString(d)}}for(var h=!1,f=a.iter(n);!f.done;f.next()){var p=f.value;if(null!=u){if(p.getBrandkitShadeRole()==u){this.library.setColor(i,p),t.push(p),a.remove(n,p),h=!0;break}}else if(l.isBrandkitPrimaryColor()&&p.isBrandkitPrimaryColor()||l.isBrandkitSecondaryColor()&&p.isBrandkitSecondaryColor()){this.library.setColor(i,p),t.push(p),a.remove(n,p),h=!0;break}}if(!h)for(var g=a.iter(t);!g.done;g.next())if((p=g.value).isBrandkitSecondaryColor()){this.library.setColor(i,p),h=!0;break}}}this.updateDerivedColors(),a.info("updateSparkColorsByRole given list of "+e.length+" new colors. Used "+t.length+" of them.")},addNewThemeColorKey:function(){for(var e=2,t=a.clone(this.getThemeColorKeys());t.includes("themeColor"+a.toString(e));)e+=1;var n="themeColor"+a.toString(e);return this._themeKeys.push(n),n},addNewThemeKeyWithColor:function(e){var t=this.addNewThemeColorKey();return this.library.setColor(t,e),t},ensureDerivedColorsAreSet:function(){if(0==this.library.hasEntries(a.clone(o.ALL_DERIVED_KEYS))){for(var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(a.clone(e))),n={},r=a.iter(t);!r.done;r.next()){var i=r.key,l=r.value;null==this.library.color(i)&&(n[i]=l)}a.opt(this.library,(function(e){return e.setColors(a.clone(n))}))}},getTheoColorForSolidColor:function(e){for(var t=a.clone(this.getThemeColorKeys()),n=a.iter(t);!n.done;n.next()){var o=n.value,r=this.library.color(o);if(null!=r&&a.eq(S._equality_SolidColor_SolidColor,e,r.rgbColor))return r}return F.TheoColor.init_5344(e,null,null)},getKeyOfColorInTheme:function(e){for(var t,n=this.getThemeColorKeys().concat(o.THEME_DERIVED_BW_KEYS),r=a.iter(n);!r.done;r.next()){var i=r.value;if(a.eq(S._equality_SolidColor_SolidColor,e.rgbColor,a.opt(this.library.color(i),(function(e){return e.rgbColor})))){t=i;break}}return t},getCurrentThemeHexString:function(){for(var e="",t=a.iter(this.getThemeColorKeys());!t.done;t.next()){var n,o=t.value;(n=this.library.color(o))&&(e=e+n.rgbColor.hex+",")}return e},getBaseThemeKeyForDerivedKey:function(e){var t,n,r;return null!=(n=o.DERIVED_KEY_MAP[e])&&(r=this.library.color(n))&&(t=this.getKeyOfColorInTheme(r)),t},ensureUniqueColors:function(e){for(var t=a.sort(e,(function(e,t){return e.lightness<t.lightness})),n=[],o=a.iter(t);!o.done;o.next()){var r=o.value;(0==n.length||r.distanceTo(a.last(n).rgbColor)>2.3)&&n.push(F.TheoColor.init_5344(r,null,null))}if(n.length<e.length){for(var i=e.length-n.length,l=n[n.length-1].rgbColor.red,s=n[n.length-1].rgbColor.green,u=n[n.length-1].rgbColor.blue,c=n[n.length-1].rgbColor.alpha,m=a.iter(a.range(1,i,!0));!m.done;m.next()){var d=m.value,h=l+a.toDouble(d)*(1-l)/a.toDouble(i),f=s+a.toDouble(d)*(1-s)/a.toDouble(i),p=u+a.toDouble(d)*(1-u)/a.toDouble(i);n.push(F.TheoColor.init_5344(new S.SolidColor(h,f,p,c),null,null))}return n=a.reverse(n)}return n},generateDerivedColorsForTheme:function(e){if(e.length<this.getNumThemeColorKeys())return{};var t={},n=e[0].rgbColor.asHSB,r=new g.HSBColor(n.h,n.s,this.DERIVED_DARK_BRIGHTNESS,n.alpha),i=new g.HSBColor(n.h,this.DERIVED_LIGHT_SATURATION,this.DERIVED_LIGHT_BRIGHTNESS,n.alpha);t.themeDerivedDark=F.TheoColor.init_5344(r.asRGB,null,null),t.themeDerivedLight=F.TheoColor.init_5344(i.asRGB,null,null);for(var l=a.iter(a.range(0,e.length,!1));!l.done;l.next()){var s=(n=e[S=l.value].rgbColor.asHSB).b<.22?.03:n.b-.2,u=n.b>.78?.97:n.b+.2,c=n.s<.22?.03:n.s-.2,m=n.s>.78?.97:n.s+.2;r=new g.HSBColor(n.h,m,s,n.alpha),i=new g.HSBColor(n.h,c,u,n.alpha),t["theme"+a.toString(S)+"Dark"]=F.TheoColor.init_5344(r.asRGB,null,null),t["theme"+a.toString(S)+"Light"]=F.TheoColor.init_5344(i.asRGB,null,null)}for(var d=[],h=a.iter(a.range(0,2,!0));!h.done;h.next()){for(var f=h.value,p=0,y=0,T=a.iter(a.toSequence(e));!T.done;T.next()){var C=T.value,S=C.offset,v=C.element;if(!d.includes(S)){var _=v.rgbColor,A=0;_.asHSB.s>.1&&(A+=100+_.asHSB.s),_.asLAB.l>30&&(A+=100);for(var w=100,E=a.iter(d);!E.done;E.next()){var b=E.value;w=Math.min(w,_.asLAB.hueDistance(e[b].rgbColor.asLAB))}p<(A+=w)&&(p=A,y=S)}}d.push(y);var D=e[y];t[o.DERIVED_BASE_KEYS[f]]=D;var I=D.rgbColor.asHSB;t[o.FILTER_MULTIPLY_KEYS[f]]=F.TheoColor.init_5344(new g.HSBColor(I.h,(I.s+.5)/2,(I.b+1)/2,I.alpha).asRGB,null,null),t[o.FILTER_OVERLAY_KEYS[f]]=F.TheoColor.init_5344(new g.HSBColor(I.h,(I.s+1)/2,(I.b+1)/2,I.alpha).asRGB,null,null),t[o.FILTER_BLEND_KEYS[f]]=F.TheoColor.init_5344(new g.HSBColor(I.h,I.s,I.b,I.alpha).asRGB,null,null),t[o.FILTER_SCREEN_KEYS[f]]=F.TheoColor.init_5344(new g.HSBColor(I.h,I.s,I.b,I.alpha).asRGB,null,null),t[o.FILTER_DUOTONE_LOW_KEYS[f]]=F.TheoColor.init_5344(new g.HSBColor(I.h,Math.min(I.s,.8),Math.min(I.b,.2),I.alpha).asRGB,null,null),t[o.FILTER_DUOTONE_HIGH_KEYS[f]]=F.TheoColor.init_5344(new g.HSBColor(I.h,Math.min(I.s,.8),Math.max(I.b,.8),I.alpha).asRGB,null,null)}return t},updateDerivedColors:function(){var e=a.clone(this.getColorThemeAsArrayOfTheoColors()),t=a.clone(this.generateDerivedColorsForTheme(a.clone(e)));this.library.setColors(a.clone(t))},setTheoColorToLibrary:function(e,t){var n=this.library.color(t);this.library.setColor(t,e),null!=e.sparkElementID?l.BrandingFacade.brandDocumentForElement(this.document,e.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):a.opt(n,(function(e){return null!=e.sparkElementID}))&&l.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.document)},getSolidColorForKey:function(e){var t=this.library.color(e);return a.opt(t,(function(e){return e.rgbColor}))},getTheoColorForKey:function(e){return this.library.color(e)},clearCache:function(){this._themeKeys=null},onMessage:function(e){var t;if((t=a.as(e,u.ColorLibraryChangedMessage))&&null!=this._themeKeys&&t.isAfter){for(var n=!1,o=a.iter(t.affectedColorIDs);!o.done;o.next()){var r=o.value;if(a.opt(this.library,(function(e){return null!=e.color(r)}))){n=!0;break}}n&&this.clearCache()}},recordUndoState:function(){return this.library.recordUndoState()},restoreUndoState:function(e){var t;(t=a.as(e,["Dictionary","String",h.DBProperty]))&&(this.library.matchProperties(a.clone(t)),this.clearCache())},getColorThemeAsArrayOfSolidColors:function(){for(var e=[],t=a.clone(this.getThemeColorKeys()),n=a.iter(t);!n.done;n.next()){var o,r=n.value;(o=this.library.color(r))&&e.push(o.rgbColor)}return a.sort(e,(function(e,t){return e.lightness<t.lightness}))},getColorThemeAsArrayOfTheoColors:function(){var e=[],t=a.clone(this.getThemeColorKeys());a.sortInPlace(t);for(var n=a.iter(t);!n.done;n.next()){var o,r=n.value;(o=this.library.color(r))&&e.push(o)}return a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness}))},getThemeDerivedColorsAsArrayOfSolidColors:function(){for(var e=[],t=a.iter(a.toSequence(o.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var n,r=t.value.element;(n=this.library.color(r))&&e.push(n.rgbColor)}return e},getThemeDerivedColorsAsArrayOfTheoColors:function(){for(var e=[],t=a.iter(a.toSequence(o.THEME_DERIVED_BW_KEYS));!t.done;t.next()){var n,r=t.value.element;(n=this.library.color(r))&&e.push(n)}return e},applyLegacyFilterColorsAndReturnKeys:function(e){var t,n,r;if(r=e.filter){var i,a;switch(r.name){case"Greyscale":case"GreyscaleDark":t="themeDerivedDark",n="themeDerivedDark";break;case"Monochrome":t=o.FILTER_MULTIPLY_KEYS[0];break;case"Duotone":t=o.FILTER_DUOTONE_LOW_KEYS[0],n=o.FILTER_DUOTONE_HIGH_KEYS[1];break;case"DesaturateMultiply":t=o.FILTER_MULTIPLY_KEYS[0];break;case"ReduceContrastOverlay":t=o.FILTER_OVERLAY_KEYS[0];break;default:t=o.FILTER_MULTIPLY_KEYS[0]}(i=e.colors.color(d.ColorRole.FieldPrimary))&&this.library.setColor(t,F.TheoColor.init_5344(i,null,null)),(a=e.colors.color(d.ColorRole.FieldSecondary))&&null!=n&&this.library.setColor(n,F.TheoColor.init_5344(a,null,null))}return{primaryKey:t,secondaryKey:n}},mergeSolidColorDictionaries:function(e,t){for(var n=a.clone(e),o=a.iter(t);!o.done;o.next()){var r=o.key,i=o.value;n[r]=i}return n},mergeTheoColorDictionaries:function(e,t){for(var n=a.clone(e),o=a.iter(t);!o.done;o.next()){var r=o.key,i=o.value;n[r]=i}return n},applyLegacyColorThemeFromDocument:function(e){var t,n={},o=[];if(t=a.opt(e,(function(e){return e.colorTheme})))for(var r=a.iter(a.range(0,5,!1));!r.done;r.next()){var i,l=r.value;if(i=a.as(t.swatchByTag("theme",a.toString(l)),v.SimpleSwatch)){var s,u=this.getThemeColorKeys()[l];if(s=i.color){var c=F.TheoColor.init_5344(s,null,null);n[u]=c,o.push(c)}}}else for(var m=a.iter(a.range(0,this.getNumThemeColorKeys(),!1));!m.done;m.next()){l=m.value;var d=1/a.toDouble(l+1),h=(u=this.getThemeColorKeys()[l],new S.SolidColor(d,d,d,1));c=F.TheoColor.init_5344(h,null,null),n[u]=c,o.push(c)}var f=a.clone(this.generateDerivedColorsForTheme(a.clone(o)));this.library.setColors(a.clone(this.mergeTheoColorDictionaries(a.clone(n),a.clone(f))))},deleteThemeColorsFromDocument:function(e){for(var t=a.iter(e);!t.done;t.next()){var n=t.value;this.library.setColor(n,null)}this.document.firstPage.root.visitAll(f.FormaTraversal.PreOrder,(function(t){var n=t.style.colors.colorID(d.ColorRole.FieldPrimary);null!=n&&e.includes(n)&&t.style.colors.setColorId(d.ColorRole.FieldPrimary,"themeColor0");var o=t.style.colors.colorID(d.ColorRole.FieldSecondary);null!=o&&e.includes(o)&&t.style.colors.setColorId(d.ColorRole.FieldSecondary,"themeColor1");var r=t.style.colors.colorID(d.ColorRole.Border);null!=r&&e.includes(r)&&t.style.colors.setColorId(d.ColorRole.Border,"themeDerivedDark")})),this.clearCache()},deleteExtraThemeColors:function(e){var t=[],n=a.clone(this.getThemeColorKeys()),r="themeColor".length;for(a.sortInPlace(n,(function(e,t){var n=e.substr(r),o=t.substr(r);return a.toInt(n)<a.toInt(o)}));n.length>e;){var i=n.pop();t.push(i),t.push(o.getLightnessContrastKey(i)),t.push(o.getBackgroundContrastKey(i))}this.deleteThemeColorsFromDocument(a.clone(t))},applyColorTheme:function(e,t,n){if(void 0===n&&(n=!1),e.length<2)s.CoreAssert.isTrue(!1,"Color themes must have at least 2 colors","ColorLibraryController.applyColorTheme","ColorLibraryController.swift",1261);else{if(n&&e.length==this.getNumThemeColorKeys()){function o(e,t){return e.rgbColor.print()<t.rgbColor.print()}var r=a.clone(this.getColorThemeAsArrayOfTheoColors());a.sortInPlace(r,o);for(var i=a.sort(e,o),u=!0,c=a.iter(a.range(0,i.length,!1));!c.done;c.next()){var m=c.value;if(!a.eq(F._equality_TheoColor_TheoColor,r[m],i[m])){u=!1;break}}if(u)return}var d,h={},f=[];this.getNumThemeColorKeys()>e.length&&this.deleteExtraThemeColors(e.length);for(var p=a.iter(a.toSequence(e));!p.done;p.next()){var g=p.value,y=g.offset,T=g.element;h[y<this.getNumThemeColorKeys()?this.getThemeColorKeys()[y]:this.addNewThemeColorKey()]=T,f.push(T),null==d&&null!=T.sparkElementID&&(d=T)}var S=a.clone(this.generateDerivedColorsForTheme(a.clone(f)));this.library.setColors(a.clone(this.mergeTheoColorDictionaries(a.clone(h),a.clone(S)))),this.library.paletteID=t,null!=d?l.BrandingFacade.brandDocumentForElement(this.document,d.sparkElementID,l.AUTHORING_CONTEXT_TYPE_COLOR):l.BrandingFacade.unBrandDocumentIfNoBrandedElements(this.document),(new C.ProfilingColorMap).updateRoleProfilingColorMap(this.document.firstPage)}},enteredPalettePicker:function(){(new C.ProfilingColorMap).setPaletteMappingForFormaWithSameRGBColor(this.document.firstPage)},returnCurrentPaletteMapping:function(){return(new C.ProfilingColorMap).getCurrentPaletteMapping()},getRandomBackgroundColor:function(){var e=a.clone(this.getThemeColorKeys());return l.BrandingFacade.isDocumentBranded(this.document,!1)||a.append(e,o.THEME_DERIVED_BW_KEYS),e[m.CoreRandom.nextIntUniform(e.length)]},shuffleColorAssignments:function(){this.document.firstPage.root.style.colors.setColorId(d.ColorRole.FieldPrimary,this.getRandomBackgroundColor()),(new C.ProfilingColorMap).updateRoleProfilingColorMap(this.document.firstPage),(new C.ProfilingColorMap).updateCurrentColorIndices(),this.document.firstPage.root.visitAll(f.FormaTraversal.PreOrder,(function(e){null==e.controller||p.GridController.isBackgroundColoredCell(e)||e.controller.shuffleColorAssignment()}))},createInitialThemeFromImage:function(){var e,t,n=null,r=a.clone(this.document.firstPage.root.filterWithCallback((function(e){return e instanceof y.ImageForma})));if(r.length>0&&(e=a.as(r[0],y.ImageForma))&&(n=a.opt(e.contentNode,(function(e){return e.image}))),t=n){var i=a.clone(t.getImageColors(o.kDefaultNumThemeColors)),l=a.clone(this.ensureUniqueColors(a.clone(i)));this.applyColorTheme(a.clone(l),"image"),this.shuffleColorAssignments()}else s.CoreAssert.fail("createInitialThemeFromImage has no image to create a theme from","ColorLibraryController.createInitialThemeFromImage","ColorLibraryController.swift",1440)},extractImageColors:function(){var e,t,n=[],r=[],i={},l=a.clone(this.document.firstPage.root.filterWithCallback((function(e){return e instanceof y.ImageForma&&!e.isLogo()&&e.parent.isBackgroundImage()})));l.length>0&&(e=a.as(l[l.length-1],y.ImageForma))&&(t=a.opt(e.contentNode,(function(e){return e.image})))&&(n=a.clone(t.getImageColors(o.kDefaultNumThemeColors)),r=a.clone(this.ensureUniqueColors(a.clone(n))));for(var s=a.iter(a.toSequence(r));!s.done;s.next()){var u=s.value,c=u.offset,m=u.element;i[o.IMAGE_KEYS[c]]=m}this.library.setColors(a.clone(i))},getSuggestedColorThemesAsArraysOfTheoColors:function(){var e=[],t=[];null==this.library.color(o.IMAGE_KEYS[0])&&this.extractImageColors();for(var n=a.iter(a.toSequence(o.IMAGE_KEYS));!n.done;n.next()){var r,i=n.value.element;(r=this.library.color(i))&&t.push(r)}if(t.length>0){var l=a.clone(this.removeSimilarColors(a.clone(t)));l.length>2&&e.push(a.clone(l))}var s=a.clone(this.getTheoColorsUsedInDocument()),u=o.kDefaultNumThemeColors-s.length+1;if(s.length>1&&u>0){for(var c=0,m=[],d=[],h=a.iter(s);!h.done;h.next()){var f=h.value,p=f.rgbColor.lightness;p>4&&p<96&&(m.push(f),d.push(f),c<u&&(c+=1,m.push(F.TheoColor.init_5344(f.rgbColor.contrastWithSelf())),p>50?d.push(F.TheoColor.init_5344(f.rgbColor.darkenForTint())):d.push(F.TheoColor.init_5344(f.rgbColor.lightenForTint()))))}var g=a.clone(this.removeSimilarColors(a.clone(d)));g.length>2&&e.push(a.clone(g));var y=a.clone(this.removeSimilarColors(a.clone(m)));y.length>2&&e.push(a.clone(y))}return e},removeSimilarColors:function(e){for(var t=a.sort(e,(function(e,t){return e.rgbColor.lightness<t.rgbColor.lightness})),n=[],o=a.iter(t);!o.done;o.next()){var r=o.value;(0==n.length||r.rgbColor.distanceTo(a.last(n).rgbColor)>2.3)&&n.push(r)}return n},getSuggestedColorsAsArraysOfTheoColors:function(){for(var e=a.clone(this.getSuggestedColorThemesAsArraysOfTheoColors()),t=[],n=a.iter(e);!n.done;n.next())for(var o=n.value,r=a.iter(o);!r.done;r.next()){var i=r.value;t.push(i)}return t},addUnlinkedColor:function(e){for(var t=0,n="unlinked"+a.toString(t),o=this.library.color(n);null!=o;)t+=1,n="unlinked"+a.toString(t),o=this.library.color(n);return this.library.setColor(n,F.TheoColor.init_5344(e,null,null)),n},getTheoColorsUsedInDocument:function(){var e=[];this.document.firstPage.root.visitAll(f.FormaTraversal.PreOrder,(function(t){var n;null!=(n=t.style.colors.colorID(d.ColorRole.FieldPrimary))&&(e.includes(n)||e.push(n)),null!=(n=t.style.colors.colorID(d.ColorRole.FieldSecondary))&&(e.includes(n)||e.push(n))}));for(var t=[],n=a.iter(e);!n.done;n.next()){var o=n.value,r=this.library.color(o);null!=r&&t.push(r)}return t},unusedColorKeys:function(e,t){var n=this,o=a.clone(this.getThemeColorKeys());if(t){for(var r=a.iter(this.getThemeColorKeys());!r.done;r.next()){var i=r.value,l=this.library.color(i);null!=l&&l.isBrandkitColor()&&a.remove(o,i)}if(0==o.length)return o}return this.document.firstPage.root.visitAll(f.FormaTraversal.PreOrder,(function(t){var r;if(null!=e&&t.formaID==e.formaID||(null!=(l=t.style.colors.colorID(d.ColorRole.FieldPrimary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1)),null!=(l=t.style.colors.colorID(d.ColorRole.FieldSecondary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1))),r=a.as(t.style,T.LockupStyle))for(var i=a.iter(r.characterStyles);!i.done;i.next()){var l,s,u,c=i.value;null!=(l=c.colors.colorID(d.ColorRole.FieldPrimary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1)),null!=(l=c.colors.colorID(d.ColorRole.FieldSecondary))&&(a.remove(o,l),null!=(s=n.getBaseThemeKeyForDerivedKey(l))&&null!=(u=a.indexOf(o,s))&&o.splice(u,1))}})),o},addColorsToTheme:function(e,t){for(var n=a.clone(this.unusedColorKeys(t,!0)),r=[],i=a.iter(a.range(0,e.length,!1));!i.done;i.next()){var l,u,c,m=e[i.value];null!=(u=this.getKeyOfColorInTheme(m))?(l=u,n.includes(u)&&a.remove(n,u)):(l=n.length>0?n[0]:this.addNewThemeColorKey(),this.setTheoColorToLibrary(m,l),null!=(c=a.indexOf(n,l))&&n.splice(c,1),this.setTheoColorToLibrary(F.TheoColor.init_5344(m.rgbColor.contrastWithSelf(),null,null),o.getLightnessContrastKey(l))),r.push(l)}return s.CoreAssert.isTrue(r.length==e.length,void 0,"ColorLibraryController.addColorsToTheme","ColorLibraryController.swift",1775),r}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_c45bf18f-a3f08dde.js.map
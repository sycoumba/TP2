(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[83,68,76],{"4pbt":function(e,t,o){var n,a;function r(e,t){var o=Object.keys(e);if(Object.getOwnPropertySymbols){var n=Object.getOwnPropertySymbols(e);t&&(n=n.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),o.push.apply(o,n)}return o}function i(e){for(var t=1;t<arguments.length;t++){var o=null!=arguments[t]?arguments[t]:{};t%2?r(Object(o),!0).forEach((function(t){s(e,t,o[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(o)):r(Object(o)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(o,t))}))}return e}function s(e,t,o){return t in e?Object.defineProperty(e,t,{value:o,enumerable:!0,configurable:!0,writable:!0}):e[t]=o,e}n=[o("xeH2"),o("UFvF"),o("YLtl"),o("Uwho"),o("gBAB"),o("2ofD"),o("Na8G"),o("tY4j"),o("zTjw"),o("bBG2"),o("MGCh"),o("vOKO"),o("+Ltv"),o("ZLL8"),o("8DU0"),o("Dcjk"),o("3xdQ"),o("3xm6"),o("Avqh"),o("KFmL"),o("+VG/"),o("WPh2"),o("sggK"),o("2Fsf"),o("0VUy"),o("5eso"),o("TW0n"),o("C8IR"),o("W1Jy"),o("M1RA"),o("NgGw"),o("tpS0"),o("0gXD"),o("z4rR"),o("7LIx"),o("/Elb"),o("r30K"),o("KQv+"),o("FIWz"),o("UXma"),o("mYMA"),o("vdJz"),o("e8qH"),o("wRAw"),o("GN+k"),o("W3p6"),o("mTyn"),o("7VrH"),o("uZvm"),o("efk3"),o("ZXGz"),o("jo99"),o("HPKp"),o("FpXA"),o("OI2j"),o("UzQk"),o("lulf"),o("dcsN"),o("Ctaw"),o("Exk9"),o("+gTl"),o("a8ov"),o("TdwW"),o("O0ct"),o("QX4k"),o("1geK"),o("WpJZ"),o("I/Z9"),o("GnB6"),o("2PxR"),o("mwMu"),o("qnb0"),o("8VGm"),o("b2xK"),o("pVEn"),o("pEL3"),o("/nf9"),o("hSNs"),o("Pbp+"),o("GSfz"),o("fuLW"),o("d/MO"),o("dO52"),o("kdSY"),o("Ww1C"),o("3Jkv"),o("rjtT"),o("TY/+"),o("tQ0N"),o("Mbmg"),o("q6ln"),o("4hMT"),o("UNP3"),o("XR60")],void 0===(a=function(e,t,n,a,r,s,l,d,c,p,u,m,g,b,h,f,w,v,k,T,I,P,B,C,S,x,y,D,A,E,M,L,F,W,N,R,z,O,U,G,j,H,_,K,V,$,X,Y,q,Q,J,Z,ee,te,oe,ne,ae,re,ie,se,le,de,ce,pe,ue,me,ge,be,he,fe,we,ve,ke,Te,Ie,Pe,Be,Ce,Se,xe,ye,De,Ae,Ee,Me,Le,Fe,We,Ne,Re,ze,Oe,Ue,Ge){const je=de.default,He=ke.default,_e=Re.default,Ke=p.default,Ve=ue.default,$e=ze.default,Xe=Oe.default,Ye=ae.default,qe=h.default,Qe=re.default,Je=Ge.default,Ze=me.default,et={STALE_SESSION:"Stale Session"};Se.init();var tt,ot,nt=Ee(),at=u.channel("controller"),rt={},it=!0,st=!1,lt={errorDialogs:{}},dt=[],ct=-1,pt=t.defer(),ut=t.defer();ut.resolve();var mt,gt,bt,ht,ft,wt,vt,kt,Tt,It,Pt,Bt=!1,Ct=!0,St=!1,xt=!1,yt=null,Dt={DOCUMENT:1,TEMPLATE:2},At=new Ye,Et=new Qe(At),Mt="app.kDefaultDocName",Lt="app.kDefaultTemplateName",Ft=["showFacebookUploadButton","showImageModalPanelOnload","showShareButton","showDownloadButton"],Wt={default:{isDefault:!0,showShareButton:!0,showDownloadButton:!0},"facebook-cover-image-design":{showFacebookUpdateCoverButton:!0,showNoProfilePic:!1,showImageModalPanelOnload:!0},"facebook-holiday-ad-design":{showFacebookUploadButton:!0,showImageModalPanelOnload:!0},"twitter-design":{showTwitterUpload:!0}},Nt=!1,Rt=!1,zt="",Ot="",Ut="";if(rt.enabled=!1,window.newrelic&&window.newrelic.setCustomAttribute){const e=window.adobeIMS.getUserProfile().userId;window.newrelic.setCustomAttribute("adobeId",e)}function Gt(){g.inPremiumTemplateOnboardingFlow=!0,to()}function jt(e){lt.collabStatusButton.$el.toggleClass("shared-document",!!e)}function Ht(e){s.currentDoc===e.composite&&(jt(e.collab.collaborators.length+e.collab.invitations.length>0),lt.brandIndicator&&lt.brandIndicator.update({collaborationStatus:s.currentDoc.getCollaboration()||"NONE"}))}function _t(e){Ea(e.authContext).then(()=>{lt.brandIndicator.events.publish("brand-switch-complete")}).done()}function Kt(){if(Tt&&Tt.newTemplateId){var e="design-edit-template/post/"+Tt.contextId+"/"+Tt.newTemplateId;marvel.navigate(e,{trigger:!1,replace:!0})}}function Vt(e){var t="design/post/"+e;marvel.navigate(t,{trigger:!1,replace:!0})}var $t=!1;function Xt(){lt.addContentPopUp.$el.addClass("slide-right-fade-out"),lt.addContentButton.$el.removeClass("rotate"),$t=!1,lt.postEditorView.$el.off("click",Xt),setTimeout((function(){lt.addContentPopUp.hide(),lt.addContentPopUp.$el.removeClass("slide-right-fade-out")}),300)}function Yt(e){$t?Xt():(Ke.publish("editor:addPressed"),lt.addContentPopUp.$el.addClass("slide-left-fade-in"),lt.addContentPopUp.show(),lt.addContentButton.$el.addClass("rotate"),lt.addContentButton.$el.removeClass("large"),$t=!0,t.resolve().then((function(){lt.postEditorView.$el.on("click",Xt)})),setTimeout((function(){lt.addContentPopUp.$el.removeClass("slide-left-fade-in")}),300))}function qt(){const e=ot.hasAnimationStyle(),t=rt.webAnimationEnabled()&&e?[{label:"app.downloadOptions.mp4Video.kButtonLabel",filetype:"mp4_SEVEN_TWENTY_P",checked:!0,betaflag:!0,tooltipMessage:"app.downloadOptions.mp4Video.kTooltip"}]:[],o=At.featureEnabled("post-enable-server-rendering")&&nt,n=o?[{label:"app.downloadOptions.pngImgV2.kButtonLabel",filetype:"img_png_v2",betaflag:!0,tooltipMessage:"app.downloadOptions.pngImgV2.kTooltip"}]:[],a=o?[{label:"app.downloadOptions.jpgImgV2.kButtonLabel",filetype:"img_jpeg_v2",betaflag:!0,tooltipMessage:"app.downloadOptions.jpgImgV2.kTooltip"}]:[];return[...t,i({},e?{}:{checked:!0},{label:"app.downloadOptions.pngImg.kButtonLabel",filetype:"img_png",tooltipMessage:"app.downloadOptions.pngImg.kTooltip"}),{label:"app.downloadOptions.jpgImg.kButtonLabel",filetype:"img_jpg",tooltipMessage:"app.downloadOptions.jpgImg.kTooltip"},...n,...a,{label:"app.downloadOptions.printPdf.kButtonLabel",filetype:"pdf",betaflag:!0,tooltipMessage:"app.downloadOptions.printPdf.kTooltip"}]}async function Qt(){st=!0;var e=gt===Dt.TEMPLATE?"template-mode main-toolbar toolbar":"main-toolbar toolbar";if(lt.postEditorView=new A({id:"PostEditorContent",layout:"rows",parent:lt.windowPanel,panels:[{id:"PostTopBar",class:e,size:"66px"},{id:"PostApp",size:"auto"}]}),lt.topColorStrip=new k({parent:"PostTopBar",id:"colorStrip",tag:"DIV"}),gt!==Dt.TEMPLATE?(lt.postAppSection=new A({layout:"columns",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostControlSection",size:"280px"},{id:"PostNavStrip",size:"80px"}],parent:"PostApp"}),lt.postControlStrip=new A({layout:"rows",panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}],parent:"PostControlSection"}),lt.brandIndicator=new W({collaborationStatus:s.currentDoc.getCollaboration(),height:50,id:"PostBrandIndicator",isEntitled:At.featureEnabled("entitle-brand-kit"),parent:"PostBrandIndicatorContainer",navigateToCreateBrandMethod:Ra,width:280})):lt.postAppSection=new A({layout:"columns",parent:"PostApp",panels:[{id:"PostCanvasSection",size:"auto"},{id:"PostSidebar",size:"280px"},{id:"PostNavStrip",size:"80px"}]}),lt.postContentSection=new A({layout:"rows",parent:"PostCanvasSection",panels:[{id:"PostContentSection",size:"auto"},{id:"PostActionsStrip",size:"0px"}]}),lt.canvasInteractionLayer=new S({id:"canvasInteractionLayer",parent:"PostCanvasSection",onPointerDown:function(e){var t=Jt(e.x,e.y);ot.handlePointerChanged({updateType:"pointerDown",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerUp:function(e){var t=Jt(e.x,e.y);ot.handlePointerChanged({updateType:"pointerUp",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})},onPointerMove:function(e){var t=Jt(e.x,e.y);ot.handlePointerChanged({updateType:"pointerMove",x:t.x,y:t.y,pointerType:e.pointerType,pointerId:e.pointerId,tapCount:e.tapCount,modifierKeys:e.modifierKeys})}}),lt.imageWrapper=new D({id:"PosterImageWrapper",parent:lt.canvasInteractionLayer,aspect:1,margin:40,marginLeft:70,marginRight:70,minTop:100}),At.featureEnabled("post-enable-zendesk-widget")&&(ye.loadZendeskWidget(),lt.feebackButton=new I({parent:lt.canvasInteractionLayer,class:"feedback-button",width:40,height:40,onClick:function(){window.zE.activate({hideOnClose:!0})}})),gt===Dt.TEMPLATE&&lt.imageWrapper.$el.on("click",(function(){lt.docNameInput.blur()})),lt.poster=new oe({parent:lt.imageWrapper,watermarkEnabled:it}),ne.Host.setPosterView(lt.poster),rt.webAnimationEnabled()&&(lt.animationPlayButton=new Ne({parent:lt.imageWrapper,class:"animation-playback-button",hidden:!ot.hasAnimationStyle(),poster:lt.poster,playAnimation:function(e){Xa(e)},pauseAnimation:function(e){Ya(e)}})),lt.postTopBarLeft=new C({parent:"PostTopBar",id:"PostTopBarLeft",class:"application-options",height:"auto",width:gt===Dt.TEMPLATE?"auto":495}),lt.postTopBarMid=new C({parent:"PostTopBar",id:"PostTopBarMid",class:"document-options",template:"",height:"auto",width:"auto"}),lt.postTopBarRight=new C({parent:"PostTopBar",id:"PostTopBarRight",class:"editor-options",height:"auto",left:"auto",width:360}),gt===Dt.TEMPLATE?(lt.saveTemplateButton=new T({parent:"PostTopBarLeft",class:"pill pill-primary-on-light",hidden:!1,label:"i18n.common.kSave",onClick:oo}),lt.cancelTemplateButton=new T({parent:"PostTopBarLeft",class:"pill pill-secondary-on-light",hidden:!1,label:"i18n.common.kCancel",onClick:no})):(lt.hamburgerMenu=new T({parent:"PostTopBarLeft",class:"hamburgerButton mrvl-hamburger-menu",attributes:{"data-auto":"mrvl-hamburger-menu"},label:" ",tag:"div",onClick:function(){window.marvel&&window.marvel.events.trigger("mrvl-show-global-nav")}}),lt.homeButton=new T({parent:"PostTopBarLeft",class:"homeButton",id:"PostHomeButton",label:" ",tag:"div",onClick:Na}),lt.postLogo=new C({parent:"PostTopBarLeft",id:"PostLogo",template:"i18n.app.kPost",class:"name"}),lt.navCrumbs=new C({parent:"PostTopBarLeft",id:"PostTopBarNavCrumbs"}),lt.backToProjects=new T({class:"post-top-bar-crumb",parent:lt.navCrumbs,label:"i18n.app.kProjects",onClick:za}),lt.carrotOne=new k({class:"post-top-bar-carrot",parent:lt.navCrumbs})),lt.docNameInput=new Ie({parent:gt===Dt.TEMPLATE?"PostTopBarLeft":lt.navCrumbs,onFocusOut:function(){var e=lt.docNameInput.getText();if(e.trim().length<1){e="";var t=gt===Dt.TEMPLATE?Lt:Mt,o=v.translate(t);lt.docNameInput.setText(o),lt.docNameInput.$el.addClass("placeholder"),lt.docNameInput.$el.removeClass("named")}else{(gt===Dt.TEMPLATE?se.getTemplateName(kt):s.currentDoc.getProjectName())!==e?Ke.publish("renameDocument",{}):Ke.publish("renameDocumentCancelled",{}),lt.docNameInput.$el.removeClass("placeholder"),lt.docNameInput.$el.addClass("named")}!function(e){gt===Dt.TEMPLATE?se.setTemplateName(kt,e):s.currentDoc.setProjectName(e);ra()}(e),lt.editNameButton.$el.css("visibility","visible")},onFocus:function(){Ke.publish("renameDocumentClicked",{}),ot.deselect(),lt.editNameButton.$el.css("visibility","hidden"),lt.docNameInput.$el.hasClass("placeholder")&&(lt.docNameInput.setText(""),lt.docNameInput.$el.removeClass("placeholder"),lt.docNameInput.$el.addClass("named"))},attributes:{"data-i18n":"[aria-label]app.kPostNameInputLabel"}}),lt.editNameButton=new I({parent:gt===Dt.TEMPLATE?"PostTopBarLeft":lt.navCrumbs,class:"edit-name-button",width:16,height:16,onClick:function(){lt.docNameInput.focus(),lt.editNameButton.$el.css("visibility","hidden")}}),lt.savingIndicator=new k({id:"PostSavingIndicator",parent:"PostTopBarLeft",template:"i18n.app.kSaving",hidden:!0}),lt.undo=new T({parent:"PostTopBarMid",id:"PostUndoButton",tag:"div",hoverLabel:"i18n.app.kUndo",hoverLabelPosition:"below",label:"i18n.app.kUndo",onClick:Zt}),lt.redo=new T({parent:"PostTopBarMid",id:"PostRedoButton",tag:"div",hoverLabel:"i18n.app.kRedo",hoverLabelPosition:"below",label:"i18n.app.kRedo",onClick:eo}),At.featureEnabled("post-enable-debug-menu")&&(lt.debugMenu=new T({parent:"PostTopBarMid",id:"PostDebugMenuButton",tag:"div",label:"Debug",onClick:function(){lt.debugView.show()}}),lt.debugView=new R({id:"PostDebugView",parent:"PostCanvasSection"})),gt!==Dt.TEMPLATE){lt.collabStatusButton=new I({parent:"PostTopBarRight",class:"collabStatusButton",width:50,height:63,onClick:function(){co("projectHeader")}}),jt(s.currentDoc.attributes.collaboration&&"NONE"!==s.currentDoc.attributes.collaboration);var t={parent:"PostTopBarRight",class:"button downloadButton",id:"downloadButton",label:"app.kDownload",submitButtonLabel:"app.kStartDownload",optionsList:qt(),onIMGDownload:uo,onIMGDownloadV2:mo,onPDFDownload:go,onOptionsShown:fo};rt.webAnimationEnabled()&&(t.onMP4Download720p=bo,t.onMP4Download1080p=ho),lt.downloadButton=new De(t);const e={parent:"PostTopBarRight",class:"postShareMenu",id:"postShareMenu",menutitle:"app.kShare",onClick:po,icon:"/images/sp-editor-share.svg",iconHover:"/images/sp-editor-share-hover.svg",menuitems:[{icon:"/marvel-core/images/share/sp-editor-publish.svg",menuItemText:"app.shareMenuItems.publish.kMenuItemText",tooltipMessage:"app.shareMenuItems.publish.kTooltip",id:"sharemenu-publish"},{icon:"/marvel-core/images/share/sp-editor-invite.svg",menuItemText:"app.shareMenuItems.invite.kMenuItemText",tooltipMessage:"app.shareMenuItems.invite.kTooltip",id:"sharemenu-invite"}]};lt.sharePostButton=new Ae(e),Le.getAccountType().then((function(t){Le.shouldShowNewBadge().then((function(o){const n=[...e.menuitems];"teacher"===t&&n.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:"app.shareMenuItems.lms.kAttachText",id:"sharemenu-lms-attach",menuItemTag:o?"app.shareMenuItems.lms.kMenuItemTag":""}),"student"===t&&n.push({icon:"/marvel-core/images/share/sp-editor-canvas-lms.svg",menuItemText:"app.shareMenuItems.lms.kTurninText",id:"sharemenu-lms-attach",menuItemTag:o?"app.shareMenuItems.lms.kMenuItemTag":""}),lt.sharePostButton.update({menuitems:n,menutitle:e.menutitle,icon:e.icon,iconHover:e.iconHover}),o&&(lt.lmsCoachmark||(lt.lmsCoachmark=new Pe({parent:"postShareMenu",id:"lmsCoachmark",message:"i18n.components.coachmarks.lms.kMessage",arrowDirection:"top-right",closeButtonType:"icon",height:52,width:330,top:66,hidden:!0,left:"calc(100% - 330px)",priority:10,anchorElement:lt.sharePostButton})),setTimeout(()=>{lt.lmsCoachmark.show()},0))}))}))}lt.facebookUploadButton=new T({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"FacebookUploadButton",hidden:!0,tag:"div",label:"i18n.app.kShareFacebook",onClick:wo}),lt.facebookUpdateCover=new T({parent:"PostTopBarMid",class:"button uploadButton facebookUploadButton",id:"facebookUpdateCoverButton",hidden:!0,tag:"div",label:"i18n.app.kUpdateFacebookCover",onClick:wo}),lt.twitterUpload=new T({parent:"PostTopBarMid",class:"button uploadButton twitterUploadButton",id:"TwitterUploadButton",hidden:!0,tag:"div",label:"i18n.app.kUploadTwitter",onClick:vo}),lt.addContentRegion=new C({parent:"PostNavStrip",id:"PostAddContentRegion",height:80,width:80}),lt.addContentButton=new I({parent:"PostAddContentRegion",id:"PostAddContentButton",height:"auto",width:"auto",label:"i18n.components.buttons.kAdd",iconTemplate:"<i class='circle-button'></i>",onClick:Yt}),lt.addContentPopUp=new E({id:"PostAddContentPopUp",parent:"PostAddContentRegion",focusScrim:!1,hidden:!0,iconCount:4,carrot:!0,preventDefaultAnimation:!0}),lt.addContentTextButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-left",id:"PostAddContentPopUpText",label:"i18n.components.buttons.kText",width:60,height:60,onClick:qo}),lt.addContentImageButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpImage",width:60,height:60,label:"i18n.components.buttons.kPhoto",onClick:$o}),lt.colorPicker=new N({id:"colorPicker",parent:lt.postEditorView,top:180,left:10,width:250,height:350,hideBrandkit:!At.featureEnabled("entitle-brand-kit")}),lt.sidebarGlobal=new M({parent:"PostSidebar",hidden:!1}),lt.sidebarTheme=new _({parent:lt.sidebarGlobal,hidden:!1,visibilityGroup:"main-sidebar",showMerchPopup:!At.featureEnabled("entitle-brand-kit")}),lt.sidebarPalette=new K({parent:lt.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",colorPicker:lt.colorPicker}),lt.sidebarResize=new H({parent:lt.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),rt.webAnimationEnabled()&&(lt.sidebarAnimation=new Q({parent:lt.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar",class:"post-panel-scrollable"})),gt!==Dt.TEMPLATE&&(lt.sidebarTemplates=new q({waitForSaveMethod:Ka,saveDocument:ra,deletingCurrentDoc:pa,imageWrapper:lt.imageWrapper,parent:lt.sidebarGlobal,poster:lt.poster,hidden:!0,visibilityGroup:"main-sidebar",showResizeOption:At.featureEnabled("post-templates-show-resize"),getDocSize:ha})),lt.sidebarLayout=new j({parent:lt.sidebarGlobal,hidden:!0,visibilityGroup:"main-sidebar"}),lt.sidebarGlobal.registerSidebarTabWithId(lt.sidebarTheme,"theme"),lt.sidebarGlobal.registerSidebarTabWithId(lt.sidebarPalette,"palette"),lt.sidebarGlobal.registerSidebarTabWithId(lt.sidebarLayout,"layout"),lt.sidebarGlobal.registerSidebarTabWithId(lt.sidebarResize,"resize"),lt.sidebarAnimation&&lt.sidebarGlobal.registerSidebarTabWithId(lt.sidebarAnimation,"animation"),lt.sidebarTemplates&&lt.sidebarGlobal.registerSidebarTabWithId(lt.sidebarTemplates,"templates"),lt.sidebarText=new G({parent:"PostSidebar",hidden:!0,entitleBrandKit:At.featureEnabled("entitle-brand-kit"),wheelImprovementsEnabled:At.featureEnabled("post-wheel-improvements"),colorPicker:lt.colorPicker}),lt.sidebarBackground=new U({parent:"PostSidebar",hidden:!0,enablePixiRenderer:At.featureEnabled("post-pgm-poster"),colorPicker:lt.colorPicker,disableImageFrames:Xn(),cutoutEnabled:At.featureEnabled("post-enable-remove-background")}),lt.sidebarLogo=new V({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),lt.sidebarIcon=new $({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",colorPicker:lt.colorPicker}),lt.sidebarMultiselect=new X({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",alignmentTypes:ot.getAlignmentTypes(),distributeTypes:ot.getDistributeTypes()}),lt.sidebarGroup=new Y({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),lt.addTextSidebar=new Z({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar",onAddText:Po}),lt.sidebarCrop=new ee({parent:"PostSidebar",hidden:!0,visibilityGroup:"local-sidebar"}),lt.navStripTabsWrapper=new k({parent:"PostNavStrip",id:"PostNavStripTabsWrapper"}),lt.globalTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostGlobalTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"global-tabs",defaultActive:!0,rememberLastTab:!0,onShown:Pn}),gt!==Dt.TEMPLATE&&(lt.tabButtonTemplates=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kTemplates",id:"sectionTabTemplates",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:zn}),lt.globalTabsWrapper.registerTab(lt.tabButtonTemplates)),gt!==Dt.TEMPLATE&&(lt.tabButtonTheme=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kDesign",id:"sectionTabTheme",group:"global-sidebar-tabs",defaultSelected:!0,onSelect:On}),lt.globalTabsWrapper.registerTab(lt.tabButtonTheme)),lt.tabButtonPalette=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kColors",id:"sectionTabPalette",group:"global-sidebar-tabs",onSelect:Un}),lt.globalTabsWrapper.registerTab(lt.tabButtonPalette),lt.tabButtonLayout=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kLayout",id:"sectionTabLayout",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:Wn}),lt.globalTabsWrapper.registerTab(lt.tabButtonLayout),lt.tabButtonResize=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kResize",id:"sectionTabResize",group:"global-sidebar-tabs",defaultSelected:!1,isPremium:At.featureEnabled("post-resize-is-paid-feature")&&gt!==Dt.TEMPLATE,isEntitled:Et.isEntitledToFeature("postResizeButton"),onTrySelect:Nn,onSelect:Rn}),lt.globalTabsWrapper.registerTab(lt.tabButtonResize),rt.webAnimationEnabled()&&(lt.tabButtonAnimation=new P({parent:"PostGlobalTabsWrapper",label:"i18n.components.buttons.kAnimation",id:"sectionTabAnimation",group:"global-sidebar-tabs",defaultSelected:!1,onSelect:Kn}),lt.globalTabsWrapper.registerTab(lt.tabButtonAnimation)),lt.textTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"text-tabs",defaultActive:!1,onHidden:function(){lt.sidebarText.hide(),ot&&ot.exitCharStyleMode()},onShown:yn}),lt.tabButtonTextType=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kType",id:"sectionTabText",group:"text-tabs",onSelect:function(e){Gn({tabId:"type"}),e&&Ke.publish("editor:typePressed")}}),lt.textTabsWrapper.registerTab(lt.tabButtonTextType),lt.tabButtonTextColor=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabTextColor",group:"text-tabs",onSelect:function(){Gn({tabId:"color"})}}),lt.textTabsWrapper.registerTab(lt.tabButtonTextColor),lt.tabButtonTextShape=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kShape",id:"sectionTabTextShape",group:"text-tabs",onSelect:function(){Gn({tabId:"shape"})}}),lt.textTabsWrapper.registerTab(lt.tabButtonTextShape),lt.tabButtonTextEffects=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kEffects",id:"sectionTabTextEffects",group:"text-tabs",onSelect:function(){Gn({tabId:"effects"})}}),lt.textTabsWrapper.registerTab(lt.tabButtonTextEffects),lt.tabButtonTextStyle=new P({parent:"PostTextTabsWrapper",label:"i18n.components.buttons.kStyle",id:"sectionTabTextStyle",group:"text-tabs",onSelect:function(){Gn({tabId:"style"})}}),lt.textTabsWrapper.registerTab(lt.tabButtonTextStyle),lt.addTextTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostAddTextTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"add-text-tabs",defaultActive:!1,onHidden:Bn,onShown:Cn}),lt.tabButtonAddText=new P({parent:"PostAddTextTabsWrapper",label:"i18n.components.buttons.kText",id:"sectionTabAddText",group:"local-sidebar-tabs"}),lt.addTextTabsWrapper.registerTab(lt.tabButtonAddText),lt.cropTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostCropTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"crop-tabs",defaultActive:!1,onHidden:Sn}),lt.tabButtonCrop=new P({parent:"PostCropTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabCrop",group:"local-sidebar-tabs"}),lt.cropTabsWrapper.registerTab(lt.tabButtonCrop),lt.backgroundTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostBackgroundTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"background-tabs",defaultActive:!1,onHidden:lt.sidebarBackground.hide,onShown:xn}),lt.tabButtonBackgroundImage=new P({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kImage",id:"sectionTabBackground",group:"local-sidebar-tabs",onSelect:function(){jn({tabId:"image"});var e=ot.getSelectedForma();e&&!e.isImage()&&Yo({disallowClose:!0,setHome:!0})}}),lt.backgroundTabsWrapper.registerTab(lt.tabButtonBackgroundImage),lt.tabButtonBackgroundLooks=new P({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kFilters",id:"sectionTabBackgroundLooks",group:"local-sidebar-tabs",onSelect:function(){jn({tabId:"looks"});var e=ot.getSelectedForma();e&&!e.isImage()&&Yo({disallowClose:!0,setHome:!0})}}),lt.backgroundTabsWrapper.registerTab(lt.tabButtonBackgroundLooks),lt.tabButtonBackgroundColor=new P({parent:"PostBackgroundTabsWrapper",label:"i18n.components.buttons.kBackgroundColor",id:"sectionTabBackgroundColor",group:"local-sidebar-tabs",onSelect:function(){jn({tabId:"color"})}}),lt.backgroundTabsWrapper.registerTab(lt.tabButtonBackgroundColor),lt.logoTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostLogoTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"logo-tabs",defaultActive:!1,onHidden:lt.sidebarLogo.hide,onShown:Dn}),lt.tabButtonLogo=new P({parent:"PostLogoTabsWrapper",label:"i18n.components.buttons.kLogo",id:"sectionTabLogo",group:"local-sidebar-tabs",onSelect:Hn}),lt.logoTabsWrapper.registerTab(lt.tabButtonLogo),lt.iconTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostIconTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"icon-tabs",defaultActive:!1,onHidden:lt.sidebarIcon.hide,onShown:An}),At.featureEnabled("post-language-switcher")&&(lt.LanguageSwitcher=new Ce({parent:"PostNavStrip",id:"PostLanguageSwitcher"}));let o="i18n.components.buttons.kIcon";Se.run("IconShapeExperiment",{shape_for_icon_label:function(e){o="i18n.components.buttons.kShape"},control:function(e){}}).then((function(e){lt.tabButtonIcon=new P({parent:"PostIconTabsWrapper",label:o,id:"sectionTabIcon",group:"local-sidebar-tabs",onSelect:function(){_n({tabId:"icon"})}}),lt.iconTabsWrapper.registerTab(lt.tabButtonIcon),lt.tabButtonIconColor=new P({parent:"PostIconTabsWrapper",label:"i18n.components.buttons.kColor",id:"sectionTabIconColor",group:"local-sidebar-tabs",onSelect:function(){_n({tabId:"color"})}}),lt.iconTabsWrapper.registerTab(lt.tabButtonIconColor),lt.addContentIconButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-mid",id:"PostAddContentPopUpIcon",width:60,height:60,label:o,onClick:Vo}),lt.addContentLogoButton=new I({parent:"PostAddContentPopUp",class:"pop-up-icon-right",id:"PostAddContentPopUpLogo",width:60,height:60,label:"i18n.components.buttons.kLogo",onClick:Jo}),fa()})).done(),lt.multiselectTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostMultiselectTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"multiselect-tabs",defaultActive:!1,onHidden:lt.sidebarMultiselect.hide,onShown:En}),lt.tabButtonMultiselect=new P({parent:"PostMultiselectTabsWrapper",label:"i18n.components.buttons.kMultipleObjects",id:"sectionTabMultiple",group:"multiselect-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"multiple"})||{}).tabId||"multiple",lt.sidebarMultiselect.showSidebarWithId(e.tabId),Fn({component:lt.sidebarMultiselect}),"multiple"===t&&Ke.publish("multiselectSidebarDisplayed:align")}}),lt.multiselectTabsWrapper.registerTab(lt.tabButtonMultiselect),lt.groupTabsWrapper=new B({parent:"PostNavStripTabsWrapper",id:"PostGroupTabsWrapper",visibilityGroup:"nav-tabs",tabGroup:"group-tabs",defaultActive:!1,onHidden:lt.sidebarGroup.hide,onShown:Mn}),lt.tabButtonGroup=new P({parent:"PostGroupTabsWrapper",label:"i18n.components.buttons.kGroup",id:"sectionTabGroup",group:"group-tabs",onSelect:function(){var e,t;t=(e=(e={tabId:"group"})||{}).tabId||"group",lt.sidebarGroup.showSidebarWithId(e.tabId),Fn({component:lt.sidebarGroup}),"group"===t&&Ke.publish("groupSidebarDisplayed:group")}}),lt.groupTabsWrapper.registerTab(lt.tabButtonGroup),lt.changeImageModalPanel=new A({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostImagePicker",size:"auto"}]}),lt.changeImageModalPanel.remove=function(){lt.changeImageModalPanel.$el.hide()};var n=!1;lt.changeImageModalPanel.insert=function(){n?lt.changeImageModalPanel.$el.show():(lt.changeImageModalPanel.parent.$el.append(lt.changeImageModalPanel.$el),n=!0)},lt.imagePicker=new J({parent:"PostImagePicker",waitForSaveMethod:Ka,onClose:function(){lt.changeImageModalPanel.hide(),!ot.getSelectedForma()&&Ut.length?(ot.selectFormaById({formaId:Ut}),Ut=""):(ot.deselect(),ba())}}),lt.changeIconModalPanel=new A({layout:"rows",parent:"PostSidebar",hidden:!0,panels:[{id:"PostIconPicker",size:"auto"}]}),lt.changeIconModalPanel.remove=function(){lt.changeIconModalPanel.$el.hide()};var a=!1;lt.changeIconModalPanel.insert=function(){a?lt.changeIconModalPanel.$el.show():(lt.changeIconModalPanel.parent.$el.append(lt.changeIconModalPanel.$el),a=!0)},lt.iconPicker=new J({parent:"PostIconPicker",waitForSaveMethod:Ka,sources:[],assetType:"vector",image_filter:[".svg","image/svg+xml"],label:"Choose icon",onClose:function(){lt.changeIconModalPanel.hide(),!ot.getSelectedForma()&&Ut.length?(ot.selectFormaById({formaId:Ut}),Ut=""):(ot.deselect(),ba())}}),lt.textCapture=new O({parent:lt.windowPanel,hidden:!0,coreWrapper:ot}),lt.posterAdornments=new te({poster:lt.poster,background:lt.postContentSection,pageElement:tt}),lt.watermarkButton=new y({id:"PostWatermarkButton",parent:lt.imageWrapper,onClick:lo,hidden:!!it}),it&&function(){lt.watermarkButton.$el.on("mouseover",(function(){it&&It&&lt.watermarkTooltip.show()})),lt.watermarkButton.$el.on("mouseleave",(function(){it&&It&&lt.watermarkTooltip.hide()})),lt.watermarkCoachmark=new Pe({parent:lt.imageWrapper,id:"watermarkCoachmark",message:"i18n.components.coachmarks.watermark.kMessage",title:"i18n.components.coachmarks.watermark.kTitle",hidden:!0,arrowDirection:"down",offsetY:-210,priority:0,anchorElement:lt.watermarkButton,userSettingFlag:xe.keys.POST_WATERMARK_COACHMARK_DISMISSED,onHide:function(){It=!0}}),it&&!It&&lt.watermarkCoachmark.show();lt.watermarkTooltip=new Be({parent:lt.imageWrapper,id:"watermarkTooltip",message:"i18n.components.coachmarks.watermark.kTooltip",arrowDirection:"down",width:"auto",height:34,hidden:!0})}(),lt.noProfilePic=new y({id:"PostNoProfilePic",parent:lt.imageWrapper,hidden:!0})}function Jt(e,t){var o=lt.poster.getViewScale(),n=lt.poster.$el.offset();return{x:(e-n.left)/o,y:(t-n.top)/o}}function Zt(){if(ot.canUndo()){var e=ot.getUndoDescription();Ke.publish("undoApplied",{actionDescription:e}),ot.undo()}}function eo(){if(ot.canRedo()){var e=ot.getRedoDescription();Ke.publish("redoApplied",{actionDescription:e}),ot.redo()}}function to(){lt.premiumTemplateTextTooltip=new Pe({parent:"PostApp",id:"textTooltip",message:"i18n.components.coachmarks.premiumText.kMessage",arrowDirection:"left",showCloseButton:!1,anchorElement:lt.imageWrapper,height:"auto",width:130,offsetY:250,offsetX:5,priority:1,hidden:!0}),lt.premiumTemplateTextTooltip.show()}function oo(){lt.posterAdornments.hideSelectionBox(),Ka().done((function(){marvel.navigate("/branding/"+Tt.contextId,{trigger:!0})}))}function no(){lt.posterAdornments.hideSelectionBox();var e=t.defer();lt.poster.disable(),lt.posterAdornments.hideSelectionBox(),ot.undoToInitialState(),se.setTemplateName(kt,ht.templateName);var o=ot.getDocumentSize(),a=o.width/o.height;lt.imageWrapper.update({aspect:a}),n.delay((function(){lt.poster.update({core:ot}),lt.poster.enable(),e.resolve()}),250),e.promise.done((function(){ca(),Ka("Please wait...").done((function(){marvel.navigate("/branding/"+Tt.contextId,{trigger:!0})}))}))}function ao(e){lt.sidebarTheme.setDesigns({aspectRatio:ot.getPageAspectRatio(),wordCount:ot.getLockupWordCount(),iconCount:ot.getIconCount(),imageCount:ot.getPotentialBackgroundImageCount(),isInitialLoad:e||!1,manifest:ot.getManifestData(),docId:ot.getDocumentCCID()})}function ro(e){var t=ot.getColorPalette();lt.sidebarPalette.setCurrentPalette(t,e)}function io(){lt.sidebarAnimation&&lt.sidebarAnimation.update()}function so(e){it=e,lt.poster.setWatermark(it),lt.watermarkButton.show(e)}function lo(){lt.watermarkCoachmark&&lt.watermarkCoachmark.hide(),It=!0,qe.setSetting(xe.keys.POST_WATERMARK_COACHMARK_DISMISSED,!0),Ke.publish("editor:watermarkPressed"),l.showMerchPopover({$element:lt.watermarkButton.$el,position:"top",touchpointName:"postWatermark",notify:function(e){"secondary"===e?(ot.setWatermarkEnabledForDoc(!1),so(!1),ca(),Ke.publish("editor:watermarkRemoved")):"no-selection"===e&&Ke.publish("editor:watermarkRemoveCancelled",{payToRemove:!1})}})}function co(e){$e.invite(s.currentDoc,e,"post:editor")}function po(e){lt.lmsCoachmark&&!lt.lmsCoachmark.isHidden()&&lt.lmsCoachmark.hide(),Ka().done((function(){return"sharemenu-publish"===e?(Ke.publish("shareButtonPressed"),void wt.publish(a,ca)):"sharemenu-invite"===e?co("project"):"sharemenu-lms-turnin"===e||"sharemenu-lms-attach"===e?(Le.showModal({type:"adobe-theo",id:s.currentDoc.id},{syncInProgress:!1}),null):""===e?(lt.downloadButton.el.hideDownloadList(),null):(console.warn("handleShareMenuClick called with unrecognized menuItemId",e),null)}))}function uo(e){const t=e.originalEvent.detail.mediaType.split("_")[1];Ke.publish("downloadButtonPressed"),"string"==typeof t&&Ke.publish("downloadImgButtonPressed:"+t),wt.downloadImg({coreWrapper:ot,mediaType:t,isWatermarkEnabled:it,MarvelSettings:a,docName:lt.docNameInput.getText(),requestSaveMethod:ca})}function mo(e){const t=e.originalEvent.detail.mediaType.split("_")[1];Ka().done((function(){wt.downloadImgV2(s,a,t).done()}))}function go(){Ka().done((function(){Ke.publish("downloadPDFButtonPressed"),wt.downloadPDF(s,a,ca)}))}function bo(){Ka().done((function(){Ke.publish("downloadMP4_720pButtonPressed"),wt.downloadMP4(s,a,ot,1280,ca)}))}function ho(){Ka().done((function(){Ke.publish("downloadMP4_1080pButtonPressed"),wt.downloadMP4(s,a,ot,1920,ca)}))}function fo(){lt.sharePostButton.el.hideMenuDropdown()}function wo(){Ka().done((function(){wt.uploadToFacebook()}))}function vo(){Ka().done((function(){wt.uploadToTwitter()}))}function ko(){var e=ot.getSelectedForma();e&&e.isTypeLockup()&&ne.LockupStyle.isPath(e.style.layout)&&(lt.tabButtonTextShape.isSelected&&lt.tabButtonTextType.select(),lt.tabButtonTextShape.disable())}function To(){lt.tabButtonTextShape.isEnabled()||lt.tabButtonTextShape.enable()}function Io(){var e=ot.getTextForSelectedLockup();if(e){var o=ot.getSelectedForma();lt.textCapture.prompt(e).then((function(n){if(n&&n!==e){var a=n.length.toString(),r=o.source;if(ne.FormaSourceUtils.isDesignIngredient(r)){var i=ne.BadgeFacade.getDesignIngredientIDAndType(r);Ke.publish("designIngredient:textEdited",{contextualData1:"id:"+i.id,contextualData2:"type:"+i.type,contextualData7:"lengthOfText:"+a})}else{var s=o.style,l=s.font.fontData.postScriptName,d=function(e){switch(e.backing){case ne.LockupBacking.None:return"none";case ne.LockupBacking.Rows:return"row";case ne.LockupBacking.BannerHorizontal:return"bannerHorizontal";case ne.LockupBacking.BannerVertical:return"bannerVertical";case ne.LockupBacking.Knockout:return"knockout";case ne.LockupBacking.LegacyShadow:return"none";default:if(e.backingArtworkID)return e.backingArtworkID}return"none"}(s);Ke.publish("customTextEdited",{contextualData7:"lengthOfText:"+a,contextualData10:"fontName:"+l,contextualData12:"shapeName:"+d})}return ot.setTextForSelectedLockup(n)}return t.resolve()})).done(lt.posterAdornments.showSelectionBox)}}function Po(){var e=!1;Xt(),ot.downloadNewLockupRandomFontsAsync(),lt.textCapture.prompt("").then((function(o){if(o){var n=o.length.toString();return Ke.publish("customTextAdded",{contextualData7:"lengthOfText:"+n}),e=!0,ot.addNewLockup(o,{select:!0})}return t.resolve()})).done((function(){e&&(lt.tabButtonTextType.select(),lt.posterAdornments.showSelectionBox())}))}function Bo(){var e,t=ot.getAllSelectedFormas();t&&(e=t,ot.canDuplicateFormae(e)?ot.duplicateFormae(e).done():Ko())}function Co(t){Ke.publish("editImage:cropPressed"),e("#PostApp").addClass("crop-scrim"),e("#PostTopBar").addClass("crop-scrim").append('<div class="full-scrim"></div>'),e("#PostTopBar").find(".full-scrim").on("click",(function(e){yo()})),ot.enterCropMode().then((function(){lt.tabButtonCrop.select(),lt.sidebarCrop.show(),lt.sidebarCrop.moveToSection(t)}))}function So(e){ot.applyAspectRatioCropToImage(e).done()}function xo(e){ot.applyShapeMaskToImage(e).done()}function yo(){Do(),ot.exitCropMode().then((function(){lt.tabButtonBackgroundImage.select(),lt.sidebarBackground.show()}))}function Do(){e("#PostApp").removeClass("crop-scrim"),e("#PostTopBar").removeClass("crop-scrim"),e("#PostTopBar").find(".full-scrim").remove()}function Ao(e){let{messageType:t,messageObj:o}=e;lt.errorDialogs.actionFeedbackModal&&lt.errorDialogs.actionFeedbackModal.hide();let n=o.message,a=null;t===ne.ActionFeedbackMessageType.Error&&null!=o.type&&null!=o.message?o.type===ne.HostNetworkErrorType.NoInternetConnection?(n=v.translate("dialogs.networkError.kOfflineErrorTitle"),a=v.translate("dialogs.networkError.kOfflineErrorText")):(n=v.translate("dialogs.networkError.kGenericErrorTitle"),a="".concat(v.translate("dialogs.networkError.kGenericErrorText")).concat(o.message)):o instanceof ne.HostCutoutMaskError&&(n=v.translate("dialogs.networkError.kGenericErrorTitle"),a=v.translate("dialogs.networkError.kCutoutMaskErrorText")),n&&a&&(lt.errorDialogs.actionFeedbackModal=new L({headerText:n,contentText:a,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){lt.errorDialogs.actionFeedbackModal.hide()}}]}),lt.errorDialogs.actionFeedbackModal.show())}function Eo(){Ke.publish("editImage:layerSelected",{contextualData1:"imageLayer:floating"}),ot.setImageAsForeground().done()}function Mo(){Ke.publish("editImage:layerSelected",{contextualData1:"imageLayer:background"}),ot.setImageAsBackground().done()}function Lo(){var e=ot.getSelectedForma();Wo(ne.AnalyticsConstants.kAnalyticsDataEditImageReturnBackgroundPressed,e),ot.setImageCutout(e,new ne.CutoutStyle(ne.CutoutMode.Off)).done()}function Fo(){var e=ot.getSelectedForma();Wo(ne.AnalyticsConstants.kAnalyticsDataEditImageRemoveBackgroundPressed,e),ot.setImageCutout(e,new ne.CutoutStyle(ne.CutoutMode.BackgroundRemoval)).done()}function Wo(e,t){const o=ne.ImageFacade.getImageContentForForma(t);let n="unknown";o&&o.mediaMetadata&&o.mediaMetadata.sourceName&&(n=o.mediaMetadata.sourceName);const a=t.isBackgroundImage()?"background":"floating";Ke.publish(e,{contextualData1:"imageSource:".concat(n),contextualData2:"imageType:".concat(a)})}function No(){var e=ot.getAllSelectedFormas();if(e){var t=ot.getDeleteInfo(e);if(t.isDeleteable&&t.isBackgroundImage)var o=new L({headerText:"i18n.dialogs.delete.kHeaderText",contentText:"i18n.dialogs.delete.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeleteContentButtonLabel",onClick:function(){ot.replaceImagesWithColors(null,[]).done(),o.hide()}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.delete.kDeletePhotoSectionLabel",onClick:function(){Oo(e),o.hide()}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){o.hide()}}]});else t.isBackgroundImage?ot.replaceImagesWithColors(null,[]).done():t.isDeleteable&&Oo(e)}}function Ro(e){const t=ot.getAllSelectedFormas();ot.groupItems(t,!0,e.method)}function zo(e){const t=ot.getAllSelectedFormas();ot.ungroupItems(t,!0,e.method)}function Oo(e){e=e||ot.getAllSelectedFormas(),ot.deleteFormae(e).done()}function Uo(t,o){var n=e("#swapCellThumbnail");if(n.length)n.css({top:o.y+5+"px",left:o.x-50+"px"});else{var a=e('<div id="swapCellThumbnail"></div>').css({position:"absolute",top:o.y+5+"px",left:o.x-50+"px",opacity:.5,"box-shadow":"0px 0px 4px 0px"});if(e("body").append(a),t.isBackgroundImage()){var r=ot.getImagePreviewData(t),i=e('<img src="'+r.url+'">').css({"max-height":"100px","max-width":"100px"});a.append(i)}else{var s=t.style.colors.fieldPrimary;if(s){var l=ce.rgb2hex(ce.solidColor2Rgba(s)),d=t.frame.width>t.frame.height;a.css({background:"#"+l,height:d?t.frame.height/t.frame.width*100+"px":"100px",width:d?"100px":t.frame.width/t.frame.height*100+"px"})}}}}function Go(){e("#swapCellThumbnail").remove()}function jo(t){e("#swapScrim").remove();var o=t.finalFrame,n=lt.poster.getViewScale(),a=lt.poster.$el.offset(),r=a.top+o.minY*n,i=a.left+o.minX*n,s=(o.maxY-o.minY)*n,l=(o.maxX-o.minX)*n,d=e('<div id="swapScrim"></div>').css({background:"rgba(0,0,0,.25)",outline:"solid white 4px",top:r,left:i,height:s,width:l,position:"absolute"});e("body").append(d)}function Ho(){e("body").find("#swapScrim").remove()}function _o(){lt.sidebarCrop.recordFormaResize()}function Ko(){var e=new L({headerText:"i18n.dialogs.tooManyImages.kHeaderText",contentText:"i18n.dialogs.tooManyImages.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){e.hide()}}]});e.show()}function Vo(e){e=e||{},lt.posterAdornments.hideSelectionBox(),Ut=ot.getSelectedFormaId()||"",ot.deselect({silent:!0}),lt.tabButtonIcon.select(),lt.tabButtonIconColor.hide({silent:!0,preventSelection:!0}),e.setHome=!0,xt||(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=function(){let e=["badge","fun","spark","circle","singer","arrow","heart","star","flower","rectangle","love","party","triangle","square","oval","phone","food","sun"];At.featureEnabled("use-translation-service-for-icon-search")&&(e=["iconSearch.kBadge","iconSearch.kFun","iconSearch.kSpark","iconSearch.kCircle","iconSearch.kSinger","iconSearch.kArrow","iconSearch.kHeart","iconSearch.kStar","iconSearch.kFlower","iconSearch.kRectangle","iconSearch.kLove","iconSearch.kParty","iconSearch.kTriangle","iconSearch.kSquare","iconSearch.kOval","iconSearch.kPhone","iconSearch.kFood","iconSearch.kSun"]);var t=Math.floor(Math.random()*(e.length+1));return v.translate(e[t])}(),xt=!0),e.label="Add icon",Qo(e),Xt(),Ke.publish("editor:addIconPressed")}function $o(e){Ke.publish("editor:addImagePressed"),e=e||{},ot.canAddMoreImages(1)?(St=!1,lt.posterAdornments.hideSelectionBox(),Ut=ot.getSelectedFormaId()||"",ot.deselect({silent:!0}),lt.tabButtonBackgroundImage.select(),lt.tabButtonBackgroundColor.hide({silent:!0,preventSelection:!0}),lt.tabButtonBackgroundLooks.hide({silent:!0,preventSelection:!0}),e.setHome=!0,e.label="Add photo",e.disallowClose=ot.backgroundImageFormas().length<1,Yo(e),lt.changeIconModalPanel.hide(),Xt()):Ko()}function Xo(e){e=e||{},St=!0;var t=ot.getSelectedForma();t&&(ot.isIcon(t)?(lt.tabButtonIcon.select(),e.label="Replace icon","dooplo"===t.contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.contentNode.mediaMetadata.searchTerm),Qo(e)):(e.label="Replace photo",t.isImage()&&t.childCount>0&&t.childAt(0).contentNode.mediaMetadata&&"dooplo"===t.childAt(0).contentNode.mediaMetadata.searchSource&&(e.context=e.context||{},e.context.class_name="DooploImagePickerContext",e.context.search_string=t.childAt(0).contentNode.mediaMetadata.searchTerm),Yo(e)))}function Yo(e){if("boolean"!=typeof(e=e||{}).disallowClose){var t=ot.getSelectedForma();t&&(t.isImage()||t.isGridCell())?e.disallowClose=!1:e.disallowClose=ot.imageFormas().length<1}lt.imagePicker.show(e),lt.changeImageModalPanel.show(e),lt.imagePicker.removeSelection(),e.label&&lt.imagePicker.setTitle(e.label),e.setHome&&lt.imagePicker.home(),lt.imagePicker.setCloseButtonVisibility(!e.disallowClose)}function qo(){Ke.publish("editor:addTextPressed",{sparkFormat:"post"}),ot.triggerTextSidebarDisplayed(),lt.tabButtonAddText.select(),lt.addTextSidebar.show(),Ke.publish("addTextSidebarDisplayed"),Xt()}function Qo(e){e=e||{},lt.iconPicker.show(e),lt.changeIconModalPanel.show(e),lt.iconPicker.removeSelection(),e.label&&lt.iconPicker.setTitle(e.label),e.setHome&&lt.iconPicker.home(),lt.iconPicker.setCloseButtonVisibility(!e.disallowClose)}function Jo(){Ke.publish("editor:addLogoPressed"),At.featureEnabled("entitle-brand-kit")?(Xt(),lt.tabButtonLogo.select(),lt.changeImageModalPanel.hide(),lt.changeIconModalPanel.hide()):l.showMerchPopover({$element:lt.addContentButton.$el,position:"bottom-left",width:320,positionOffset:-4,touchpointName:"postLogoButton"})}function Zo(){Ke.publish("uploadNewLogoSelected"),lt.posterAdornments.hideSelectionBox(),Xt()}var en=n.throttle((function(e,t){ot.applyGridStyle(e,t).done(),Ke.publish("layoutSelected",{layoutID:e.gridStyle.name})}),40);function tn(e){if("Original"===e.id){var t=ot.getOriginalImageSize();if(!t)return;e=ne.DesignSizeLibrary.getOriginalSize(t.width,t.height)}lt.poster.disable();var o=!1;return lt.watermarkCoachmark&&!It&&(lt.watermarkCoachmark.hide(),o=!0),lt.posterAdornments.hideSelectionBox(),ot.setPageSizeFromDesignSize(e).then((function(){lt.imageWrapper.update({aspect:e.aspectRatio||1}),o&&(o=va()),lt.sidebarBackground.updateFilters({tileAspect:e.aspectRatio||1}),n.delay((function(){lt.poster.enable()}),50),o&&!It&&lt.watermarkCoachmark.show(),Ke.publish("canvasSizeSelected",{aspectRatio:e.aspectRatio||1,targetId:e.id})}))}var on=n.throttle((function(e){"Custom"===e.id?function(){var e=ot.getPageExportData(),t=e.pixelDimensions,o=ot.getDocumentSizeId(),n=e.format,a=e.ppi;"Custom"===o&&(n=ot.getPageCustomSizeFormat(),a=ot.getPageCustomSizePPI());var r=new F({currentExportSize:t,currentFormat:n,currentPPI:a});r.events.subscribe("submit",(function(e){e.exportData.format===n&&t.width===e.exportData.pixelWidth&&t.height===e.exportData.pixelHeight||(tn(ne.DesignSizeLibrary.getCustomSize(e.exportData.width,e.exportData.height,e.exportData.format,e.exportData.ppi)),Ke.publish("customSizeSet",{dimensions:e.exportData.width+"x"+e.exportData.height+" "+e.exportData.format}))})),r.events.subscribe("cancel",(function(){lt.sidebarResize.selectDocumentSizeWithId(ot.getDocumentSizeId(),{silent:!0}),Ke.publish("customSizeCancelled")}))}():tn(e)}),40);function nn(t,o,n){n.silent||!e(n.target).closest("[class*='tile-shuffle-button']").length&&0!==o||(0===o?ot.setColorPalette(t,{shuffle:!0}).done():ot.shuffleColorPalette().done())}function an(e){e=e||{};var t,o=ot.getDocumentSizeId();o===zt&&"Custom"!==o||(zt=o,lt.imageWrapper.update({aspect:ot.getPageAspectRatio()}),lt.sidebarResize.selectDocumentSizeWithId(ot.getDocumentSizeId(),{silent:!0})),lt.tabButtonPalette&&lt.tabButtonPalette.isSelected()&&ro(),lt.tabButtonTheme&&(t=ot.getThemeId())!==Ot&&(lt.sidebarTheme.selectThemeWithid(t,{silent:!0}),Ot=t),e.formaAdded&&pn(),lt.sidebarAnimation&&io(),lt.animationPlayButton&&lt.animationPlayButton.update({hidden:!ot.hasAnimationStyle()}),Nt=!0}var rn=n.throttle((function(e,t){e.manifestPromise().then((function(e){return ot.applyDesignTheme(e,t)})).done((function(){Ke.publish("designVariationSelected",{contextualData1:"variationTemplateDocumentId:"+e.assetId,contextualData2:"numShuffles:"+t})}))}),40),sn=n.throttle((function(e){e.manifestPromise().done((function(t){ot.addBadge(t,e.assetId).done()}))}),40);function ln(e){e.data.forma.isTypeLockup()&&lt.tabButtonTheme&&lt.tabButtonTheme.isSelected()&&lt.sidebarTheme.setDesigns({aspectRatio:ot.getPageAspectRatio(),wordCount:ot.getLockupWordCount(),iconCount:ot.getIconCount(),imageCount:ot.getPotentialBackgroundImageCount(),manifest:ot.getManifestData(),docId:ot.getDocumentCCID()}),e.selected&&!lt.sidebarBackground.isHidden()&&lt.sidebarBackground.updateFilters({whilePanelVisibleOnly:!0,image:ot.getImagePreviewData(ot.getSelectedForma())})}function dn(e){e.duplicatedImage&&ot.updateConstrainedImages(),pn()}function cn(e){un(),lt.posterAdornments.dismissPopUp(),e.deletedImage&&ot.updateConstrainedImages()}function pn(){un()}function un(){lt.tabButtonTheme&&lt.tabButtonTheme.isSelected()&&ao()}function mn(e){var t;ot.isMultiSelect()?(t=ot.getSettableFeatures(),lt.sidebarMultiselect.update({attributes:t}),lt.multiselectTabsWrapper.isActive()||lt.tabButtonMultiselect.select()):ot.isGroupSelect()?function(){var e=ot.getSettableFeatures();lt.sidebarGroup.update({attributes:e}),lt.groupTabsWrapper.isActive()||lt.tabButtonGroup.select()}():function(e){lt.downloadButton&&lt.downloadButton.el.hideDownloadList();lt.sharePostButton&&lt.sharePostButton.el.hideMenuDropdown();Array.isArray(e.forma)&&(e.forma=e.forma[0]);if(lt.changeImageModalPanel.hide(),lt.changeIconModalPanel.hide(),e.forma){if("Root"===e.forma.kind)bn(lt.tabButtonBackgroundImage),bn(lt.tabButtonBackgroundLooks),gn(lt.tabButtonBackgroundColor,!1,!1),lt.tabButtonBackgroundColor.isSelected()||lt.tabButtonBackgroundColor.select();else if(e.forma.isTypeLockup())Ke.publish("editor:textSelected"),lt.textTabsWrapper.isActive()||lt.tabButtonTextType.select();else if(e.forma.isLogo())lt.logoTabsWrapper.isActive()||lt.tabButtonLogo.select();else if(ot.isIcon(e.forma))lt.iconTabsWrapper.isActive()||lt.tabButtonIcon.select(),gn(lt.tabButtonIconColor);else if(e.forma.isImage()){gn(lt.tabButtonBackgroundImage);var t=e.forma.isVideo();t&&bn(lt.tabButtonBackgroundLooks),lt.tabButtonBackgroundLooks.isHidden()&&!t&&(bn(lt.tabButtonBackgroundColor),gn(lt.tabButtonBackgroundLooks));var o=e.forma.controller,n=o.kind===ne.FrameController.KIND&&o.isBackgroundImageWithAlpha();if(ot.inCropMode())return;const a=ne.ImageFacade.getFrameFormaForForma(e.forma);ne.ImageFacade.canApplyBackgroundColor(a)?gn(lt.tabButtonBackgroundColor):(bn(lt.tabButtonBackgroundColor),lt.tabButtonBackgroundColor.isSelected()&&lt.tabButtonBackgroundColor.deselect()),lt.backgroundTabsWrapper.isActive()&&(n||lt.tabButtonBackgroundImage.isSelected()||lt.tabButtonBackgroundLooks.isSelected()||lt.tabButtonBackgroundColor.isSelected())||lt.tabButtonBackgroundImage.select()}else e.forma.isGridCell()&&(bn(lt.tabButtonBackgroundLooks),gn(lt.tabButtonBackgroundColor,!0,!1),lt.tabButtonBackgroundColor.isSelected()||lt.tabButtonBackgroundColor.select());(e.forma.isBackgroundImage()||e.forma.isGridCell())&&(e.forma.isGridCell()&&!e.forma.isImage()&&gn(lt.tabButtonBackgroundColor),e.forma.controller.moveable?bn(lt.tabButtonBackgroundImage):gn(lt.tabButtonBackgroundImage))}else ba()}(e)}function gn(e){let t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],o=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];e&&e.isHidden()&&e.show({silent:t,preventSelection:o})}function bn(e){e&&e.hide()}function hn(){if(!ot.isMultiSelect()){var e=ot.getSelectedForma();e&&(e.isTypeLockup()?Io():(e.isImage()&&!e.isLogo()||ot.isIcon(e))&&Xo())}}function fn(e){let{backgroundColor:t}=e;lt.errorDialogs.imageCorruptedModal||(lt.errorDialogs.imageCorruptedModal=new L({headerText:'\n            <span class="error-modal-header">\n              <span>i18n.dialogs.corruptedDocument.kHeaderText</span>\n              <i class="error-modal-header__icon"></i>\n            </span>\n          ',contentText:'<div class="error-modal-content">\n                <span>i18n.dialogs.corruptedDocument.kContentText</span>\n                <span class="error-modal-content_placeholder-indicator" style="background-color: #'.concat(t,';"></span>\n              </div>'),dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptedDocument.kButtonLabel",onClick:function(){lt.errorDialogs.imageCorruptedModal.hide()}}]})),lt.errorDialogs.imageCorruptedModal.show()}function wn(){if(lt.sidebarLayout){var e=lt.sidebarResize.getSelected(),t=ot.getDocumentSize(),o=ot.getImageSizeIfFullBleed(),n=o&&o.width&&o.height&&Math.atan(o.height/o.width)*(4/Math.PI),a=t&&t.width&&t.height&&Math.atan(t.height/t.width)*(4/Math.PI),r=Math.abs(n-a)<=.01;e&&e.item&&"original"===e.item.data.aspect&&!r&&lt.sidebarResize.deselectSelected()}}function vn(e){var t=v.toLocaleKey(ot.getUndoDescription());t?(lt.undo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kUndo","action-name":"i18n.actions."+t}}),lt.undo.enable()):(lt.undo.update({hoverLabel:"i18n.app.kUndo"}),lt.undo.disable());var o=v.toLocaleKey(ot.getRedoDescription());o?(lt.redo.update({hoverLabel:"i18n.app.kActionLabel",context:{"action-type":"i18n.app.kRedo","action-name":"i18n.actions."+o}}),lt.redo.enable()):(lt.redo.update({hoverLabel:"i18n.app.kRedo"}),lt.redo.disable());const n=ot.getWatermarkEnabledForDoc();it!==n&&(lt.poster.setWatermark(n),so(n)),function(e){(function(){if(!lt.downloadButton)return;var e=qt();lt.downloadButton.update({optionsList:e})})(),function(e){if(!lt.animationPlayButton)return;const t=e.atShowEditor,o=e.changeType,n=ot.hasAnimationStyle();if(lt.animationPlayButton.update({hidden:!n}),n)if(t)lt.animationPlayButton.reset(),ua(lt.posterAdornments,"first-full-render",()=>{Xa()});else{const e=ot.getCurrentTimelineState();e.action&&"k_apply_animation_style"===e.action.description?"state-changed"===o&&Xa():Ya()}else Ya()}(e)}(e)}function kn(){In(),ot.updateConstrainedImages(),ot.validateDoc("undo")}function Tn(){In(),ot.updateConstrainedImages(),ot.validateDoc("redo")}function In(){lt.sidebarBackground&&!lt.sidebarBackground.isHidden()&&lt.sidebarBackground.selectCurrentColor({silent:!0}),lt.sidebarIcon&&!lt.sidebarIcon.isHidden()&&lt.sidebarIcon.selectCurrentColor({silent:!0}),lt.sidebarText&&!lt.sidebarText.isHidden()&&lt.sidebarText.selectCurrentColor({silent:!0}),lt.sidebarPalette&&!lt.sidebarPalette.isHidden()&&lt.sidebarPalette.selectCurrentPalette({silent:!0})}function Pn(){ot.deselect()}function Bn(){lt.addTextSidebar.hide()}function Cn(){Ln()}function Sn(){lt.undo.show(),lt.redo.show(),lt.sidebarCrop.hide()}function xn(){Ln()}function yn(){ot.ensureLockupSelected(),Ln()}function Dn(){Ca(ie.currentBrandElements()),Ln()}function An(){Ln()}function En(){Ln()}function Mn(){Ln()}function Ln(){lt.tabButtonPalette.isSelected()&&lt.sidebarPalette.unbindColorPicker(),lt.sidebarTemplates&&!lt.sidebarTemplates.isHidden()&&lt.sidebarTemplates.switchedToLocalTabSet()}function Fn(e){e=e||{},lt.sidebarLayout.isHidden()&&ot.disableAutomaticLayoutMode(),e.component&&(yt=e.component,lt.brandIndicator&&(yt===lt.sidebarTemplates?(lt.brandIndicator.hide(),lt.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})):(lt.brandIndicator.show(),lt.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"50px"},{id:"PostSidebar",size:"auto"}]}))))}function Wn(){Fn({component:lt.sidebarLayout}),"layout"!==lt.sidebarGlobal.activeSidebarId()&&(lt.sidebarGlobal.showSidebarWithId("layout"),Ke.publish("editor:layoutPressed"))}function Nn(){return Ke.publish("editor:resizePressed"),Se.run("PostResize").catch(e=>{at.error("Ran into error with PostResize experiment",e)}).done(),!At.featureEnabled("post-resize-is-paid-feature")||Et.tryPremiumFeature({$element:lt.tabButtonResize.$el,position:"left",touchpointName:"postResizeButton"})}function Rn(){Fn({component:lt.sidebarResize}),"resize"!==lt.sidebarGlobal.activeSidebarId()&&(lt.sidebarGlobal.showSidebarWithId("resize"),Ke.publish("layoutResizeDisplayed"))}function zn(){Fn({component:lt.sidebarTemplates}),"templates"!==lt.sidebarGlobal.activeSidebarId()&&lt.sidebarGlobal.showSidebarWithId("templates")}function On(){Fn({component:lt.sidebarTheme}),"theme"!==lt.sidebarGlobal.activeSidebarId()&&(lt.sidebarGlobal.showSidebarWithId("theme"),lt.sidebarTheme.setDefaultSelection(),ao(),Ke.publish("editor:designFilterPressed"))}function Un(){Fn({component:lt.sidebarPalette}),"palette"!==lt.sidebarGlobal.activeSidebarId()&&(lt.sidebarGlobal.showSidebarWithId("palette"),ro({updateSelection:!0}),Ke.publish("editor:colorPressed"),ot.triggerEnteredPalette())}function Gn(e){var t=(e=e||{}).tabId||"type";switch(lt.sidebarText.showSidebarWithId(t),Fn({component:lt.sidebarText}),lt.posterAdornments.handleTextTabSelected(),Ke.publish("textSidebarDisplayed"),Ke.publish("text"+t.toLowerCase()+"SidebarDisplayed"),t){case"type":Ke.publish("textSidebarDisplayed:type");break;case"color":Ke.publish("textSidebarDisplayed:color");break;case"shape":Ke.publish("textSidebarDisplayed:shape");break;case"style":Ke.publish("textSidebarDisplayed:style");break;case"effects":Ke.publish("textSidebarDisplayed:effects")}}function jn(e){var t=(e=e||{}).tabId||"color";lt.sidebarBackground.isHiding()&&null==e.reselectWhenHiding?n.delay((function(){e.reselectWhenHiding=!0,jn(e)}),200):(lt.sidebarBackground.showSidebarWithId(e.tabId),Fn({component:lt.sidebarBackground}),Ke.publish("photoSidebarDisplayed"),"image"===t?Ke.publish("backgroundSidebarDisplayed:image"):"color"===t?Ke.publish("backgroundSidebarDisplayed:color"):"looks"===t&&Ke.publish("backgroundSidebarDisplayed:looks"))}function Hn(){Fn({component:lt.sidebarLogo}),lt.sidebarLogo.show(),Ke.publish("logoSidebarDisplayed")}function _n(e){var t=(e=e||{}).tabId||"icon";lt.sidebarIcon.showSidebarWithId(e.tabId),Fn({component:lt.sidebarIcon}),"icon"===t?Ke.publish("iconSidebarDisplayed:icon"):"color"===t&&Ke.publish("iconSidebarDisplayed:color")}function Kn(e){lt.sidebarAnimation&&(Fn({component:lt.sidebarAnimation}),"animation"!==lt.sidebarGlobal.activeSidebarId()&&(io(),lt.sidebarGlobal.showSidebarWithId("animation"),Ke.publish("editor:AnimationPressed")))}function Vn(e){Yn(e,ta,!0)}function $n(e){var t,o=fe.getImageMediaMetadata(e.info);St&&(t=ot.getSelectedForma()),ot.createFormaFromSVG(e.files[0],o,t),Ke.publish("addedIconToProject:icon")}function Xn(){return!At.featureEnabled("post-pgm-poster")}function Yn(t,o){let n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(St||ot.canAddMoreImages(1)){o=o||na;var a=ot.getSelectedForma();if((St||null!=a&&a.isShape())&&(t.replacementForma=a,lt.posterAdornments.showImageMenu(),t.replacementForma&&("Root"===t.replacementForma.kind?t.replacementForma=null:t.replacementFrame=t.replacementForma.finalFrame)),n&&(t.floatingImageStrategy=ne.FloatingImageStrategy.IfHasAlphaOrIsLogo),n||null!=t.replacementForma)Jn(t,o);else{Ke.publish("editor:addImagePressed",{contextualData1:"numImages:1",contextualData2:"actionType:success"});var r=ot.backgroundImageFormas().length>0?"kChoosePhotoAddToCollageButtonLabel":"kChoosePhotoPinToBackgroundButtonLabel";if(Xn())return t.floatingImageStrategy=ne.FloatingImageStrategy.IfHasAlphaOrIsLogo,void Jn(t,o);var i=new L({id:"PostImageLayerPicker",headerText:"i18n.dialogs.choosePhotoLayer.kHeaderText",contentText:'<div class="image-layer-picker-visualization">\n           <span class="background-layer-visualization"></span>\n           <span class="foreground-layer-visualization"></span>\n           </div>',dismissable:!1,addButtonParent:!0,onShow:function(){e(".background-layer-visualization").click((function(){Qn(t,o,i)})),e(".foreground-layer-visualization").click((function(){qn(t,o,i)}))},onHide:function(){e(".background-layer-visualization").off("click",Qn),e(".foreground-layer-visualization").off("click",qn)},buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer.kChoosePhotoMoveFreelyButtonLabel",onClick:function(){qn(t,o,i)}},{class:"pill pill-primary-on-light",label:"i18n.dialogs.choosePhotoLayer."+r,onClick:function(){Qn(t,o,i)}}]})}}else Ko()}function qn(e,t,o){Ke.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:floating"}),e.floatingImageStrategy=ne.FloatingImageStrategy.Always,Jn(e,t),o.hide()}function Qn(e,t,o){Ke.publish("editor:imageLayerPressed",{contextualData1:"imageLayer:background"}),e.floatingImageStrategy=ne.FloatingImageStrategy.Never,Jn(e,t),o.hide()}function Jn(e,o){var n=t.defer();o(e,n),n.promise.done()}var Zn=1600;function ea(e){Ke.publish("brandKitLogoApplied"),lt.poster&&lt.poster.events.publish("image-loading-begin"),Ke.publish("editor:logoAdded"),ot.addLogo(e).then((function(){lt.poster&&lt.poster.events.publish("image-loading-end")}))}function ta(e,o){lt.poster&&lt.poster.events.publish("image-loading-begin");var n=e.files[0];return be.renderBlobToCanvas(n).then(e=>{var n=t.defer();if(e.width<180||e.height<180)var a=new L({headerText:"i18n.panels.addNewLogo.kSizeWarningHeader",contentText:"i18n.panels.addNewLogo.kSizeWarningContent",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.components.buttons.kContinue",onClick:function(){a.hide(),n.resolve(e)}},{class:"pill pill-secondary-on-light",label:"i18n.common.kCancel",onClick:function(){lt.poster&&lt.poster.events.publish("image-loading-end"),a.hide(),n.reject(),o.resolve()}}]});else n.resolve(e);return n.promise}).then(o=>{var a=o.getContext("2d");return e.hasAlpha=be.checkCanvasForAlpha(a,o.width,o.height),e.hasAlpha?(be.trimTransparentEdges(o),be.canvasToBlob(o)):t.resolve(n)}).then(o=>{if(e.processedImgData=o,!At.featureEnabled("entitle-brand-kit")||"brandkit"===e.source)return t.resolve(o);var n=ie.currentBrandElements(),a=!n||!n.logos||n.logos.length<1;return ie.addLogoToCurrentBrand(o,a)}).then(t=>(e.isLogo=!0,t&&(Aa(!0),e.sparkElementId=t.getValue("id"),e.sparkRoles=t.getValue("ac#roles")),na(e,o))).catch(()=>t.resolve())}function oa(e){var t={files:[{source:"adobestock",mimeType:e.newItemInfo.mimeType,original:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},preview:{link:e.newItemInfo.href,height:e.newItemInfo.height,width:e.newItemInfo.width},thumbnail:{link:e.newItemInfo.thumb.url,height:e.newItemInfo.thumb.height,width:e.newItemInfo.thumb.width},licenseInfo:e.newItemInfo.info}],info:e.newItemInfo.info};St=!0,Yn(t,na)}function na(e,o,a,r,i){let s=!(arguments.length>5&&void 0!==arguments[5])||arguments[5];o=o||t.defer(),a=a||t.defer(),r=r||!1,i=i||!1,ot.validateDoc("addImageBegin"),_e.beginTrackingPendingXhrRequests();var l=Date.now();ut.promise.isFulfilled()&&(ut=t.defer()),_e.pageUnloadBlockingBegin();var c=e.processedImgData||e.files[0],p=c.type||c.mimeType||"image/jpeg";"dooplo"===c.source&&c.preview.link.indexOf(".png")>-1&&"image/png"!==p&&(p="image/png");var u,g,b,h,f,w,v,k=fe.getImageMediaMetadata(e.info),T=c instanceof Blob,I="Adobe Stock"===k.sourceName,P="google drive"===c.source,B=null,C=e.isLogo;return lt.poster&&lt.poster.events.publish("image-loading-begin"),t().then((function(){if(T||I||P)return t.resolve();var e=c.thumbnail||c.small||c.preview,o="/api/post/v1/proxy?url="+encodeURIComponent(e.link);return["dropbox","cc","lightroom","ccl"].indexOf(c.source)>-1&&(o=e.link),m.load(o)})).then((function(o){if(T||I||P)return t.resolve();var n=be.createCanvas(o),a=n.getContext("2d");if(B=be.checkCanvasForAlpha(a,n.width,n.height)){if(St)return t.resolve();be.trimTransparentEdges(n)}return u=n.toDataURL(),ot.addOrReplaceImage({id:null,imageId:null,metadata:k,isLowResImage:!0,isNewPostImage:r,url:u,width:n.width,height:n.height,mimeType:p,replacementForma:e.replacementForma,replacementFrame:e.replacementFrame,sparkRoles:e.sparkRoles,sparkElementId:e.sparkElementId,hasAlpha:B,forceReplacement:St,floatingImageStrategy:e.floatingImageStrategy,allowSelection:s})})).then((function(e){return w=e&&e.formaId,v=e&&e.contentNodeId,T||I||P||St&&B||!lt.poster?e:(a.resolve(),n.delay((function(){lt.poster&&lt.poster.events.publish("image-loading-end")}),350),e)})).then((function(t){if(t=t||{},lt.savingIndicator&&lt.savingIndicator.show(),c instanceof Blob)return ot.saveImageComponent(c,p);var o=function(e,t){if(e instanceof Blob)return e;var o=e.source,n=e.original.link,a=e.original.width,r=e.original.height;if("dooplo"===e.source&&e.original.width&&e.original.height&&e.original.width*e.original.height>Zn*Zn){var i=t._links.rendition.filter((function(e){return!!(e.href&&e.width&&e.height)&&e.width*e.height<Zn*Zn}));i.sort((function(e,t){return e.width<t.width?-1:e.width>t.width?1:0}));var s=i.pop();s&&(o="dooplocdn",n=s.href,a=s.width,r=s.height)}return o||at.error("getBestRenditionForImageSaving source is falsy, imgData is ",e),{source:o,assetId:n,width:a,height:r}}(c,e.info);return h=o.width,f=o.height,d(ot.saveImageComponent,{maxAttempts:3})({source:o.source,assetId:o.assetId},p,null,t.contentNodeId,t.contentNodeId)})).then((function(e){return c instanceof Blob?m.loadImageFromBlob(c).then((function(t){return h=t.width,f=t.height,e})).catch((function(){return t.reject()})):e})).then((function(e){return g=e,b=je.decodeUrl(g.encodedUrl),m.load(b)})).then((function(e){var t;return null===B&&(t=be.createCanvas(e),B=be.checkCanvasForAlpha(t.getContext("2d"),t.width,t.height)),h=e.width,f=e.height,B&&!C?(t||(t=be.createCanvas(e)),be.trimTransparentEdges(t),h=t.width,f=t.height,be.canvasToBlob(t)):e})).then((function(e){return!B||C?e:(lt.savingIndicator&&lt.savingIndicator.show(),ot.saveImageComponent(e,p))})).then((function(e){return!B||C?e:(g=e,b=je.decodeUrl(g.encodedUrl),m.load(b))})).then((function(t){if(C){var o={url:g.encodedUrl,pixelWidth:t.width,pixelHeight:t.height,mimeType:p,acRoles:e.sparkRoles,id:e.sparkElementId,componentId:g.component.id};return Ke.publish("editor:logoAdded"),ot.addLogo(o)}var n={id:g.component.id,imageId:null,metadata:k,isLowResImage:!1,isNewPostImage:r,url:g.encodedUrl,width:h||t.width,height:f||t.height,mimeType:p,replacementForma:e.replacementForma,replacementFrame:e.replacementFrame,lowResImageUrl:u,hasAlpha:B,forceReplacement:St,contentNodeId:v,floatingImageStrategy:e.floatingImageStrategy,allowSelection:s};return u?ot.replaceImageWithHighRes(n):ot.addOrReplaceImage(n)})).then((function(e){return e&&e.formaId&&(w=e.formaId),a.resolve()})).then((function(){ot.updateConstrainedImages();var e=Date.now()-l;return Ke.publish("post:addImageEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"imageSource:"+c.source}),ut.promise})).then((function(){_e.endTrackingPendingXhrRequests(),ot.validateDoc("addImageSuccess"),o&&o.resolve(),(T||St&&B)&&n.delay((function(){lt.poster&&lt.poster.events.publish("image-loading-end")}),350)})).catch((function(t){if(t instanceof ot.ActionError&&!t.isAllowedError&&ot.shouldReloadOnActionFailure())return at.error("doAction",t.message),void ga();var n;if(e.replacementForma||e.replacementFrame?(at.error("failed to replace image",t),ot.cleanupInvalidImageWithColorSync(w,v,[]),n="i18n.dialogs.addOrReplaceImageFailed.kContentTextReplace"):(at.error("failed to add image",t),ot.cleanupInvalidImageSync(w,v),n="i18n.dialogs.addOrReplaceImageFailed.kContentText"),!i)var r=new L({headerText:"i18n.dialogs.addOrReplaceImageFailed.kHeaderText",contentText:n,dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.addOrReplaceImageFailed.kOK",onClick:function(){r.hide()}}]});lt.poster&&lt.poster.events.publish("image-loading-end"),ot.updateConstrainedImages(),ot.validateDoc("addImageFail"),o.reject(),a.reject()})).done(),a.promise}function aa(e){e&&e.id&&0===e.id.indexOf("bk_")&&Ke.publish("usedBrandKitPalette"),Ke.publish("paletteSelected")}const ra=function(){let e,o,n,a=!1,r=!1;return function(i){var l,d;if(!Bt)return ut.promise.isPending()||(ut=t.defer()),ot.validateDoc("saveBegin"),l=s.currentDoc.getDataFromRoot("cp#isExported"),"boolean"==typeof(d=ot.getIsExported())&&d!==l&&ot.setIsExported(l),(i?ot.validateDBSaveState(i)?t.resolve(i):t.reject():ot.postDocumentHasHighResImageSaveableState()).then(i=>{if(lt.savingIndicator&&lt.savingIndicator.show(),a)return o||(o=t.defer()),r=!0,o.promise;a=!0,n=Date.now(),Ke.publish("saveDocumentBegin"),s.currentDoc&&window.marvel.logger.beginTrackingFlow("saveProjectFromEditor",{sparkFormat:"post",projectId:s.currentDoc.id,projectUrn:s.currentDoc.getDCXComposite().assetId}),e||(e=t.defer());const l=ot.imageFormas();for(let e=0;e<l.length;e++){const t=l[e];null==t.contentNode?at.error("saving image with no contentNode"):null==t.contentNode.url&&at.error("saving image with no url")}_e.pageUnloadBlockingBegin();let d,c,p;p="edit-template"===Tt.operation||"new-template-from-template"===Tt.operation||At.featureEnabled("post-preview-image-disabled2")?t():lt.poster.getRendition({width:1200,imageQuality:.94}),p.then(e=>(d=e,lt.poster.getRendition({width:500,imageQuality:.94}))).then(e=>(c=e,gt===Dt.TEMPLATE&&ie.currentBrandKit()&&kt?se.setUsedBrandElementsData(ie.currentBrandKit(),kt,ot,!1):t.resolve(null))).then(()=>ot.saveWithRenditions(d,c,i)).then(()=>{if(lt.docNameInput){const e=lt.docNameInput.getText();s.currentDoc.setProjectName(e)}e.resolve();const t=Date.now()-n;d?Ke.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:s.currentDoc.id,previewImageSize:d.size}):Ke.publish("saveDocumentEnd",{saveTimeElapsedMs:t,docId:s.currentDoc.id}),a=!1,s.currentDoc&&window.marvel.logger.endTrackingFlow("saveProjectFromEditor"),ot.validateDoc("saveSuccess"),r&&ot.canSave()?(r=!1,e=o,ra()):(lt.savingIndicator&&lt.savingIndicator.hide(),e=null,_e.pageUnloadBlockingEnd(),ut.resolve()),o=null},o=>{a=!1,e.reject(o),lt.savingIndicator&&lt.savingIndicator.hide(),at.error("Failed to save Post project",o),ot.validateDoc("saveFail"),e=null,_e.pageUnloadBlockingEnd(),ut.reject(o),function(e){function o(){window.location.pathname.includes("/design/post/")||window.location.reload()}if("UPDATE_CONFLICT"===e.code)var n=new L({headerText:"i18n.dialogs.saveFailedMergeConflict.kHeaderText",contentText:"i18n.dialogs.saveFailedMergeConflict.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailedMergeConflict.kRefresh",onClick:function(){n.hide(),(ut=t.defer()).resolve(),window.location.reload()}}]});else var a=new L({headerText:"i18n.dialogs.saveFailed.kHeaderText",contentText:"i18n.dialogs.saveFailed.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.saveFailed.kRefresh",onClick:function(){a.hide(),(ut=t.defer()).resolve(),window.location.reload()}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveFailed.kTryAgain",onClick:function(){a.hide(),ra(),Ka().done(o)}}]})}(o)})}).catch(()=>{a=!1,lt.savingIndicator&&lt.savingIndicator.hide(),e=null,ut.resolve()}).done(),e;Ct=!0}}();var ia=n.debounce(ra,4e3);function sa(){Bt=!0}function la(){Bt=!1,Ct&&(ca(),Ct=!1)}function da(e){ia&&ia.cancel(),ra(e.stateID)}function ca(){ut.promise.isFulfilled()&&(_e.pageUnloadBlockingBegin(),ut=t.defer()),ia()}function pa(){return ia&&ia.cancel(),ra(),At.featureEnabled("spark-home-enabled")?(Rt=!0,Ga()):ut.promise}function ua(e,t,o){dt.push(e.events.subscribe(t,o))}function ma(e,t){var o=lt.poster.$el.offset(),n=lt.poster.getViewScale(),a=lt.poster.getWidth(),r=lt.poster.getHeight(),i=e.pageX-o.left,s=e.pageY-o.top;i>0&&i<a&&s>0&&s<r?lt.poster.getColorAtPoint({x:Math.round(i/n),y:Math.round(s/n)}).then((function(o){var n=ce.rgb2hex(o);"click"===e.type?t.handleEyeDropperClicked(n):t.handleEyeDropperMoved(n,e)})):"click"===e.type?t.handleEyeDropperClicked(!1):t.handleEyeDropperMoved(!1,e)}function ga(e){const t=new L({headerText:"i18n.dialogs.mustReloadEditor.kHeaderText",contentText:e||"i18n.dialogs.mustReloadEditor.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.mustReloadEditor.kRefresh",onClick:function(){t.hide(),window.location.reload()}}]});t.show()}function ba(e){(e=e||{}).silent="boolean"==typeof e.silent&&e.silent,lt.posterAdornments&&lt.posterAdornments.dismissPopUp(),lt.globalTabsWrapper&&!lt.globalTabsWrapper.isActive()&&(lt.textTabsWrapper.hide(),lt.backgroundTabsWrapper.hide(),lt.logoTabsWrapper.hide(),lt.globalTabsWrapper.show()),lt.tabButtonLayout&&lt.tabButtonLayout.isSelected()&&lt.sidebarLayout.returnFromSelectionState(),lt.tabButtonPalette&&lt.tabButtonPalette.isSelected()&&lt.sidebarPalette.rebindColorPicker(),lt.sidebarTemplates&&!lt.sidebarTemplates.isHidden()&&(lt.sidebarTemplates.returnedToGlobalSidebarState(),lt.brandIndicator&&(lt.brandIndicator.hide(),lt.postControlStrip.update({panels:[{id:"PostBrandIndicatorContainer",size:"0px"},{id:"PostSidebar",size:"auto"}]})))}function ha(){const e=ot.getRootForma().page;return{sizeID:e.sizeID,pageSize:e.pageSize,exportData:e.exportData}}function fa(){let e=!0;if(!s.currentDoc.belongsToUser()){const t=ie.currentBrandKit();t&&!1!==ie.currentBrandElements().showBrandInUI&&t.getLogosSync().length||(e=!1)}e?lt.addContentLogoButton.enable():lt.addContentLogoButton.disable()}async function wa(e){(Ke.publish("showEditor"),st&&gt===bt||await Qt().catch(at.error),wt=new $e({doc:ot.getDocument(),am:vt,poster:lt.poster}),lt.addContentLogoButton&&fa(),ua(ot,"mini-save-requested",da),ua(ot,"save-requested",ca),ua(ot,"design-updated",an),ua(ot,"forma-updated",ln),ua(ot,"formae-duplicated",dn),ua(ot,"formae-deleted",cn),ua(ot,"forma-added",pn),ua(ot,"forma-selected",mn),ua(ot,"filter-applied",lt.sidebarBackground.updateFilters),ua(ot,"undo-redo-state-changed",vn),ua(ot,"undo-finished",kn),ua(ot,"redo-finished",Tn),ua(ot,"forma-drag-start",sa),ua(ot,"forma-drag-end",la),ua(ot,"layer-double-tapped",hn),ua(ot,"show-image-forma-corrupted-modal",fn),ua(ot,"current-brand-changed",Ma),ua(ot,"exit-crop-mode",Do),ua(ot,"show-actionfeedback-message-modal",Ao),ua(ot,"enter-char-style-mode",ko),ua(ot,"exit-char-style-mode",To),ua(ot,"force-reload-editor",ga),ua(lt.posterAdornments,"buttonpress-style",lt.tabButtonTextType.select),ua(lt.posterAdornments,"buttonpress-edit",Io),ua(lt.posterAdornments,"buttonpress-duplicate",Bo),ua(lt.posterAdornments,"buttonpress-delete",No),ua(lt.posterAdornments,"buttonpress-group",Ro),ua(lt.posterAdornments,"buttonpress-ungroup",zo),ua(lt.posterAdornments,"buttonpress-addText",Po),ua(lt.posterAdornments,"buttonpress-change-photo",Xo),ua(lt.posterAdornments,"buttonpress-logo",Jo),ua(lt.posterAdornments,"create-swap-thumbnail",Uo),ua(lt.posterAdornments,"remove-swap-thumbnail",Go),ua(lt.posterAdornments,"handle-drag",_o),ua(lt.posterAdornments,"create-swap-forma-overlay",jo),ua(lt.posterAdornments,"remove-swap-forma-overlay",Ho),ua(lt.posterAdornments,"stock-image-licensed",oa),ua(lt.posterAdornments,"post-interaction-layer-clicked",(function(){lt.docNameInput.$el.is(":focus")&&lt.docNameInput.blur(),lt.downloadButton&&lt.downloadButton.el.hideDownloadList(),lt.sharePostButton&&lt.sharePostButton.el.hideMenuDropdown(),$t&&Xt()})),ua(lt.sidebarText,"buttonpress-edit",Io),ua(lt.sidebarText,"buttonpress-delete",No),ua(lt.sidebarText,"buttonpress-addText",Po),ua(lt.sidebarText,"get-new-brandkit-colors",xa),ua(lt.sidebarText,"eyedropper-changed",(function(e){ma(e,lt.sidebarText)})),ua(lt.sidebarText,"buttonpress-close",ba),ua(lt.sidebarText,"size-slide-start",lt.posterAdornments.hideSelectionBox),ua(lt.sidebarText,"size-slide-end",lt.posterAdornments.showSelectionBox),ua(lt.poster,"rendered-image-layer-url-changed",wn),ua(lt.poster,"watermark-footprint-changed",(function(e){lt.watermarkButton.update({height:e.height+"%",width:e.width+"%"}),ka(),Ta()})),ua(lt.sidebarTheme,"item-selected",rn),ua(lt.sidebarTheme,"brand-button-pressed",Pa),ua(lt.sidebarBackground,"buttonpress-change-photo",Xo),ua(lt.sidebarBackground,"buttonpress-add-photo",$o),ua(lt.sidebarBackground,"filter-selected",(function(e,t,o){ot.setImageFilterForSelection(e,t,o).done()})),ua(lt.sidebarBackground,"bg-color-selected",(function(e){ot.setColorForSelection(e).done()})),ua(lt.sidebarBackground,"image-forma-replace-with-color",ot.updateConstrainedImages),ua(lt.sidebarBackground,"eyedropper-changed",(function(e){ma(e,lt.sidebarBackground)})),ua(lt.sidebarBackground,"buttonpress-close",ba),ua(lt.sidebarBackground,"buttonpress-set-foreground",Eo),ua(lt.sidebarBackground,"buttonpress-set-background",Mo),ua(lt.sidebarBackground,"buttonpress-crop",Co),ua(lt.sidebarBackground,"buttonpress-set-cutout-none",Lo),ua(lt.sidebarBackground,"buttonpress-set-cutout-remove-background",Fo),ua(lt.sidebarLayout,"grid-item-selected",en),ua(lt.sidebarResize,"size-item-selected",on),ua(lt.sidebarPalette,"item-selected",nn),ua(lt.sidebarPalette,"item-selected",aa),ua(lt.sidebarPalette,"eyedropper-changed",(function(e){ma(e,lt.sidebarPalette)})),ua(lt.sidebarPalette,"update-palette-color",(function(e,t){ot.updateColorInTheme(e,t).done()})),ua(lt.sidebarLogo,"item-selected",ea),ua(lt.sidebarLogo,"buttonpress-uploadNewLogo",Zo),ua(lt.sidebarLogo,"logo-uploaded",Vn),ua(lt.sidebarLogo,"buttonpress-closeLogoPanel",ba),ua(lt.sidebarIcon,"buttonpress-replace-icon",Xo),ua(lt.sidebarIcon,"icon-color-selected",(function(e,t){ot.setColorForSelection(e,t).done()})),ua(lt.sidebarIcon,"hide-icon-picker",(function(){lt.changeIconModalPanel.hide()})),ua(lt.sidebarIcon,"eyedropper-changed",(function(e){ma(e,lt.sidebarIcon)})),ua(lt.iconPicker,"item-selected",$n),ua(lt.iconPicker,"hide",(function(){lt.changeIconModalPanel.hide()})),ua(lt.addTextSidebar,"badge-selected",sn),ua(lt.addTextSidebar,"buttonpress-addTextPanel",ba),ua(lt.sidebarCrop,"crop-shape-selected",xo),ua(lt.sidebarCrop,"crop-aspect-ratio-selected",So),ua(lt.sidebarCrop,"close-crop-picker",yo),ua(lt.imagePicker,"item-selected",Yn),ua(lt.imagePicker,"hide",(function(){lt.changeImageModalPanel.hide()})),ua(lt.sidebarBackground,"hide-image-picker",(function(){lt.changeImageModalPanel.hide()})),ua(lt.colorPicker,"brand-color-added",xa),ua(lt.colorPicker,"colorChangeModal",(function(e){"begin"===e.type?ot.beginBranch():"confirm"!==e.type&&"cancel"!==e.type||ot.endBranch("confirm"===e.type)})),lt.brandIndicator&&ua(lt.brandIndicator,"switch-brand",_t),lt.sidebarAnimation&&(ua(lt.sidebarAnimation,"animation-loading-begin",Va),ua(lt.sidebarAnimation,"animation-loading-end",$a)),At.featureEnabled("entitle-brand-kit")&&!At.featureEnabled("hide-premium-font-onboarding")&&(lt.tabButtonTextType.$el.addClass("premium-highlight-badge"),lt.sidebarText.events.subscribe("font-picker-opened",(function(){lt.tabButtonTextType.$el.removeClass("premium-highlight-badge")}))),lt.imagePicker&&lt.imagePicker.home(),gt===Dt.TEMPLATE?lt.topColorStrip.$el.css({background:"#ffffff"}):lt.topColorStrip.$el.css({background:"#10c459"}),lt.collabStatusButton)&&jt(s.currentDoc.getCollaboration()&&"NONE"!==s.currentDoc.getCollaboration());!function(){const e=ot.getRootForma(),t=e.filterWithCallback(e=>e.isSticker()),o=e.filterWithCallback(e=>e.isVideo());var n=t.length>0||o.length>0;if(!rt.webAnimationEnabled()){const t=e.filterWithCallback(e=>!!e.animation);n=n||t.length>0}if(n){const e=new L({headerText:"i18n.dialogs.minisFeatureNotice.kHeaderText",contentText:"i18n.dialogs.minisFeatureNotice.kContentText",buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.minisFeatureNotice.kButtonLabel",onClick:function(){e.hide()}}]});e.show()}}(),lt.poster&&(it?(lt.poster.setWatermark(!0),Ke.publish("editor:watermarkShown",{payToRemove:!1})):lt.poster.setWatermark(!1)),it?lt.watermarkButton.isHidden()&&lt.watermarkButton.show():lt.watermarkButton.hide(),gt!==Dt.TEMPLATE&&(e.showShareButton?lt.sharePostButton.show():lt.sharePostButton.hide(),e.showDownloadButton?lt.downloadButton.show():lt.downloadButton.hide()),e.showFacebookUpdateCoverButton?lt.facebookUpdateCover.show():lt.facebookUpdateCover.hide(),e.showFacebookUploadButton?lt.facebookUploadButton.show():lt.facebookUploadButton.hide(),e.showTwitterUpload?lt.twitterUpload.show():lt.twitterUpload.hide(),lt.sidebarTheme.setCoreWrapper(ot),lt.sidebarText.setCoreWrapper(ot),lt.sidebarBackground.setCoreWrapper(ot),lt.sidebarLogo.setCoreWrapper(ot),lt.sidebarIcon.setCoreWrapper(ot),lt.sidebarMultiselect.setCoreWrapper(ot),lt.sidebarGroup.setCoreWrapper(ot),lt.sidebarLayout.setCoreWrapper(ot),lt.sidebarLayout.deselectSelected(),lt.sidebarCrop.setCoreWrapper(ot),lt.sidebarResize.setCoreWrapper(ot),lt.sidebarResize.deselectSelected(),lt.sidebarAnimation&&lt.sidebarAnimation.setCoreWrapper(ot),lt.debugView&&lt.debugView.setCoreWrapper(ot),lt.postEditorView.show(),lt.windowPanel.resize(),lt.sidebarTemplates&&(Tt.projectContext||(Tt.projectContext=s.getProjectContexts()),lt.sidebarTemplates.setupSessionData(Tt,s.currentDoc,Pt,vt.remixParentAnalyticsMetadata,At.featureEnabled("is-paid-user")),lt.sidebarTemplates.setCoreWrapper(ot));var t=Date.now(),o=lt.poster.events.subscribe("rendered",(function(){var e=Date.now()-t;Ke.publish("post:posterInitialRenderEnd",{contextualData1:"timeElapsedMs:"+e,contextualData2:"editorOperation:"+Tt.operation,contextualData3:"numImages:"+ot.imageFormas().length}),lt.sidebarTemplates&&lt.sidebarTemplates.events.publish("poster-initial-render-end"),o.remove()}));lt.poster.update({core:ot}),ot.setViewScale(lt.poster.getViewScale()),lt.posterAdornments.setPageElement(tt),lt.posterAdornments.setCoreWrapper(ot),lt.posterAdornments.enable(),lt.imageWrapper.update({aspect:lt.poster.getAspect()}),lt.brandIndicator&&lt.brandIndicator.update({collaborationStatus:s.currentDoc.getCollaboration()||"NONE",isEntitled:At.featureEnabled("entitle-brand-kit"),navigateToCreateBrandMethod:Ra}),lt.sidebarBackground.update();var n,a,r=lt.poster.getWatermarkFootprint();lt.watermarkButton.update({height:r.height+"%",width:r.width+"%"}),ka(),Ta(),gt===Dt.TEMPLATE?(lt.tabButtonResize.select(),n=se.getTemplateName(kt),a=v.translate(Lt)):(e.startingMenu?"colors"===e.startingMenu?lt.tabButtonPalette.select():"layout"===e.startingMenu?lt.tabButtonLayout.select():"resize"===e.startingMenu?lt.tabButtonResize.select():"templates"===e.startingMenu?(lt.tabButtonTemplates.select(),delete e.startingMenu):lt.tabButtonTheme.select():e.showImageModalPanelOnload?(lt.tabButtonBackgroundImage.select(),lt.changeImageModalPanel.show()):"remix"===Tt.operation||"new-from-template"===Tt.operation?lt.tabButtonLayout.select():lt.tabButtonTheme.select(),n=s.currentDoc.getProjectName(),a=v.translate(Mt)),lt.docNameInput&&((n=n||a)===a?(lt.docNameInput.$el.addClass("placeholder"),lt.docNameInput.$el.removeClass("named")):(lt.docNameInput.$el.removeClass("placeholder"),lt.docNameInput.$el.addClass("named")),lt.docNameInput.setText(n)),window.addEventListener("resize",(function(e){Xt(),lt.posterAdornments.handleWindowResize(),Ta()})),vn({atShowEditor:!0})}function va(){if(it&&lt.imageWrapper&&lt.watermarkButton){var e=lt.poster.getWatermarkFootprint();return lt.imageWrapper.getWidth()>=e.width&&lt.imageWrapper.getHeight()>=e.height}return!1}function ka(){var e=va();it&&(e?(lt.poster.setWatermark(!0),lt.watermarkButton.show()):(lt.poster.setWatermark(!1),lt.watermarkButton.hide()))}function Ta(){if(it){var e=lt.poster.getWatermarkFootprint(),t=lt.imageWrapper.getHeight(),o=lt.imageWrapper.getWidth(),n=o-o*(e.width/100)/2,a=t*(1-e.height/100);lt.watermarkCoachmark&&it&&!It&&lt.watermarkCoachmark.reposition(),!It&&lt.watermarkCoachmark&&lt.watermarkButton.isHidden()&&!lt.watermarkCoachmark.isHidden()&&lt.watermarkCoachmark.hide(),lt.watermarkTooltip&&(lt.watermarkTooltip.update({left:n-41,top:a-48}),lt.watermarkButton.isHidden()&&!lt.watermarkTooltip.isHidden()&&lt.watermarkTooltip.hide())}}function Ia(e){const o=ie.currentBrandElements();if(!o||!o.activated)return t.resolve(null);e||o.coreBrandPromise&&o.coreBrandPromise.isFulfilled()||Ba(o),lt.poster&&lt.poster.events.publish("image-loading-begin");const n=e?le.getLiteCoreBrand(o):o.coreBrandPromise,a=o.belongsToUser?ie.checkForRestrictedFonts():t.resolve([]);let r;return n.then(e=>(r=e,a)).then((function(e){if(e.length){const o=t.defer();return window.marvel.events.trigger("missing-brand-fonts-ux",{doc:s.currentDoc,missingFonts:e,defer:o}),o.promise.then(e=>e?t.resolve():t.reject({brandFontsVerificationFailed:!0}))}return t.resolve()})).then(()=>r?ot.brandDocument(r):t.resolve()).then(()=>{lt.poster&&lt.poster.events.publish("image-loading-end")}).catch(e=>{if(e&&e.brandFontsVerificationFailed)return t.resolve();const o=e&&e.message?": ".concat(e.message):"";return at.error("brandDocument error ".concat(o),e),t.resolve()})}function Pa(e){const t=ie.currentBrandElements();"INCOMING"!==s.currentDoc.getCollaboration()||t&&(!t||!1!==t.showBrandInUI)?t&&t.activated?(Ia().done(),Ke.publish("brandifyApplied")):window.marvel.events.trigger("spark-post-show-brandify-onboarding",{element:e.$element}):Fe.showAlert(v.translate("dialogs.brandifySharedProjectAlert.kHeaderText"),v.translate("dialogs.brandifySharedProjectAlert.kContentText"),{okText:v.translate("dialogs.brandifySharedProjectAlert.kButtonLabel")})}function Ba(e){e&&e.coreBrandPromise?e.coreBrandPromise.done(()=>(ne.Host.setAuthoringContext(e.coreBrand),e.coreBrand)):ne.Host.setAuthoringContext(null)}function Ca(e){lt.sidebarLogo&&(e&&e.primaryLogoPromise?lt.sidebarLogo.updateListOfBrandKitLogos(e):lt.sidebarLogo.updateListOfBrandKitLogos([]))}function Sa(e){var t=e&&e.activated?e:null;lt.sidebarPalette&&lt.sidebarPalette.setListOfBrandKitPalettes(t),lt.sidebarText&&lt.sidebarText.setBrandKitColors(ot.getBrandKitColorsPalettesForSelectedLockup(t)),lt.sidebarBackground&&lt.sidebarBackground.setBrandKitColors(t),lt.sidebarIcon&&lt.sidebarIcon.setBrandKitColors(t),lt.colorPicker&&lt.colorPicker.update({authoringContext:ie.currentBrandKit()})}function xa(){!function(e){const o=ie.currentBrandElements();!At.featureEnabled("entitle-brand-kit")||o&&!1===o.showBrandInUI?t():ie.refreshBrandColors().then((function(t){Ba(t),e&&Sa(t)}))}(!0)}function ya(e){e=e||ie.currentBrandElements();const t=ie.currentBrandKit();let o=e;e&&!1===e.showBrandInUI&&(o=null),Ca(o),Sa(o),lt.sidebarText&&lt.sidebarText.setBrandkit(e&&!1!==e.showBrandInUI?t:null),lt.sidebarTheme&&lt.sidebarTheme.setBrandKitThemes(o),lt.brandIndicator&&lt.brandIndicator.setBrand(e,t)}function Da(e,t){Ba(e),t&&ya(e)}function Aa(e,o){return ie.refreshCachedCurrentBrandElements().then(Ha(o,t=>{Da(t,e)})).catch(e=>{if(e&&e.message===et.STALE_SESSION)return t.reject(e);at.error("refreshCurrentBrandElements: ".concat(e))})}function Ea(e){let o=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];return ie.switchCurrentAuthoringContext(e).then(e=>(Da(e,!0),e.coreBrandPromise)).then(e=>{if(o)return ot.changeBranding(e)}).timeout(3e5).catch(e=>{const o=e?e.message:"";return Fe.showAlert(v.translate("dialogs.switchBrandFailureAlert.kHeaderText"),v.translate("dialogs.switchBrandFailureAlert.kContentText"),{okText:v.translate("dialogs.switchBrandFailureAlert.kButtonLabel")}),at.error("switchBrand error: ".concat(o),e),t.reject()})}function Ma(e){e!==(ie.currentBrandElements()&&ie.currentBrandElements().id)&&Ea(e,!1)}function La(t){e(t.target).is("#PosterImageWrapper")||1===e(t.target).closest("#PosterImageWrapper").length||1===e(t.target).closest("#selectionPopUp").length||lt.globalTabsWrapper.isActive()||ba()}let Fa;function Wa(e){if(e=e||{},!Fa){Fa=t.defer();const n=Date.now();o.e(48).then(function(a){const r=o("+7aA"),i=Date.now();at.info("headless load time = "+(i-n)),("string"==typeof e.authoringContextId?ie.getBrandKitById(e.authoringContextId):t.resolve()).then(e=>r.initialize(e)).done(()=>{const e=Date.now();at.info("headless init time = ".concat(e-i)),Fa.resolve(r)})}.bind(null,o)).catch(o.oe)}return Fa.promise}function Na(e){Oa(e,"home")}function Ra(e){Oa(e,"create_brand")}function za(e){Oa(e,"organizer")}function Oa(e,t){var o="/";if("organizer"===t?o+="projects":"create_brand"===t&&(o+="branding/create"),e="boolean"==typeof e&&e,ia&&ia.cancel(),ot&&ot.willCloseDocument(),Rt=!0,e)ut.resolve();else{if(Ua())return void ja({returnPath:o});ra()}Ka().done((function(){window.marvel.navigate(o,{trigger:!0})}))}function Ua(){return At.featureEnabled("spark-home-enabled")&&"new"===Tt.operation&&"blank"===Tt.workflow&&!Nt}function Ga(){const e=t.defer();return ut.promise.finally((function(){s.waitForQuiet().then((function(){e.resolve()}))})),e.promise}function ja(e){e=e||{};const o=t.defer(),n=new L({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kHeaderText",contentText:"i18n.dialogs.saveNonDirtyNewBlank.kContentText",dismissable:!0,onDismissed:function(){o.resolve({dismissed:!0})},buttons:[{class:"pill pill-primary-on-dark",label:"i18n.dialogs.saveNonDirtyNewBlank.kDontSave",onClick:function(){n.hide(),o.resolve(!1)}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.saveNonDirtyNewBlank.kSaveProject",onClick:function(){n.hide(),o.resolve(!0)}}]});o.promise.then((function(o){if(!o.dismissed)if(ra(),o)Ga().done((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}));else{const o=new L({headerText:"i18n.dialogs.saveNonDirtyNewBlank.kDeleteProgress",contentText:'<div class="postspinner postspinner-small"></div>',dismissable:!1});o.show();const n=function(){o.hide()};window.marvel.events.once("design-view-unloading",n),Ga().done((function(){const o=t.defer();window.marvel.events.trigger("delete-current-doc",{doc:s.currentDoc,defer:o}),o.promise.then((function(){e.returnPath?window.marvel.navigate(e.returnPath,{trigger:!0}):e.defer&&e.defer.resolve()}))}))}}))}function Ha(e,o){var n=this;return function(){if("number"==typeof e&&e!==ct)return t.reject(new Error(et.STALE_SESSION));var a=[].slice.apply(arguments);try{var r=o.apply(n,a);return r}catch(e){return t.reject(e)}}}function _a(e){e&&e.message===et.STALE_SESSION?at.warn("Abandoning stale session. May be benign."):(window.marvel.events.trigger("hide-interstitial"),!e||e.userCanceledNPW||e.doNotLog||e.isWebGLUnavailable?(e&&e.isWebGLUnavailable&&at.warn("Failed to enable Post editor due to WebGL unavailability"),Oa(!0)):(e.url=window.location.href,at.error("error enabling Post editor",e),lt.windowPanel.show(),lt.errorDialogs.enableEditorErrorModal=Me(e,()=>{Oa(!0)})))}function Ka(e){var t="string"==typeof e?e:"i18n.app.kSavingPost";return ut.promise.isPending()&&(mt&&t===ft||(mt=new L({headerText:t,contentText:'<div class="postspinner postspinner-large"></div>',dismissable:!1}),ft=t),mt.show()),ut.promise.finally((function(){mt&&mt.hide()})).done(),ut.promise}function Va(){lt.posterAdornments.showLoadingSkrim()}function $a(){lt.posterAdornments.hideLoadingSkrim()}function Xa(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];qa(e),function(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];ot.hasAnimationStyle()&&"function"==typeof lt.poster.playAnimation&&(ot.generateKeyFrames(),e&&lt.animationPlayButton&&lt.animationPlayButton.startProgress(),lt.poster.playAnimation())}(e)}function Ya(){qa(!(arguments.length>0&&void 0!==arguments[0])||arguments[0])}function qa(){let e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];"function"==typeof lt.poster.pauseAnimation&&lt.poster.stopAnimation(),e&&lt.animationPlayButton&&lt.animationPlayButton.reset()}return rt.enable=function(o,a){vt=new Xe;var r=++ct;if(o){lt.errorDialogs.fontMissingNoticeModal&&lt.errorDialogs.fontMissingNoticeModal.hide(),tt=o,lt.windowPanel?lt.windowPanel.update({parentDomElement:tt,hidden:!0}):lt.windowPanel=new x({id:"PostWindowPanel",parentDomElement:tt,hidden:!0});var i,d,c=Date.now(),p=!st,u=0,m="new"===(Tt=a).operation;bt=gt,gt=Dt.DOCUMENT,"edit-template"===Tt.operation&&(gt=Dt.TEMPLATE);var g={};rt.enabled=!0,pe.resetLoadingTimes();var h,f,k=(h=qe.getSetting(xe.keys.POST_WATERMARK_UNLOCKED).catch(e=>{const o=e?e.message:"";return at.warn("Error fetching user settings for watermark status. Error: ".concat(o),e),t.resolve(!1)}),f=At.loadFeatures(),Promise.all([h,f]).then((function(e){var t=e[0],o=At.featureEnabled("show-remove-branding-flow"),n=At.featureEnabled("remove-branding-enabled");return!t&&o&&n?(qe.setSetting(xe.keys.POST_WATERMARK_UNLOCKED,!0),!0):t}))),T=t.allSettled([ut.promise,At.loadFeatures()]);b.doSerial([T,function(){return v.initLocalization(v.sparkSelectedLocale)}]).then(Ha(r,(function(){window.marvel.events.on("saved-composite-doc",Kt),At.featureEnabled("entitle-brand-kit")&&window.marvel.events.on("onboarding-premium-templates-remove",Gt),window.marvel.events.on("document-collaboration-changed",Ht),ne.Host.setFeatureController(At)}))).then(Ha(r,(function(){if(At.featureEnabled("entitle-brand-kit")||"remix"!==Tt.operation)return t.resolve();var e=t.defer();return vt.getRemixParentCPMetadata(Tt.cpAssetId,Tt.cpServiceDomain||"cc-api-cp.adobe.io",!1).then(Ha(r,t=>{const{tags:o,id:n,alias:a}=t;o&&o.includes("remixpaid")?(window.marvel.events.trigger("hide-interstitial"),lt.windowPanel.show(),l.showMerchMessagingModal({workflow:"remixPremiumTemplate",destinationUrl:Tt.routeFragment,asset:{id:n,alias:a,tags:o,isPremiumTemplate:!0,remixable:!0,remixpaid:!0,app:"post"},analyticsPage:"editor:post",analyticsFullTagNames:"[".concat(o.join(", "),"]")}),window.marvel.events.on("upgrade-view-closed",()=>{window.marvel.events.off("upgrade-view-closed"),e.reject({message:"user not entitled to remix premium template",doNotLog:!0})})):e.resolve()})).catch((function(t){e.reject(t)})),e.promise}))).then(Ha(r,(function(){var e=t.defer(),o=document.createElement("canvas").getContext("webgl");if(!1===(null!==o&&o instanceof WebGLRenderingContext)){var n=he.webGLSystemInfo();Ke.publish("webGLUnavailable",n),lt.errorDialogs.webglWarningModal=new L({headerText:"i18n.dialogs.webGLDisabled.kHeaderText",contentText:"i18n.dialogs.webGLDisabled.kContentText<br/><br/>Vendor: "+n.vendor+"<br/>Renderer: "+n.renderer+"<br/>Platform: "+n.platform+"<br/>UserAgent: "+n.userAgent,dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){lt.errorDialogs.webglWarningModal.hide(),e.reject({isWebGLUnavailable:!0})}}]}),window.marvel.events.trigger("hide-interstitial"),lt.windowPanel.show(),lt.errorDialogs.webglWarningModal.show()}else Ke.publish("webGLAvailable"),e.resolve();return e.promise}))).then(Ha(r,(function(){if(!m)return t.resolve();lt.newPostWorkflow||(lt.newPostWorkflow=new z({parent:lt.windowPanel})),Ke.publish("newProjectWorkflowLoaded");var e=Date.now(),o=lt.newPostWorkflow.prompt(a);return lt.windowPanel.show(),o.then((function(t){Pt=i=t,u=Date.now()-e,window.marvel.events.trigger("show-interstitial",{typeName:"post"})}))}))).then(Ha(r,(function(){return function(e,t){return(t=t||{}).belongsToUser="boolean"!=typeof t.belongsToUser||t.belongsToUser,e=At.featureEnabled("entitle-brand-kit")?e:null,ie.loadBrandKit(e,t).then(e=>{const o=!!(t.belongsToUser||e&&!e.belongsToUser()),n=e&&o?e.getId():null;ne.Host.brandkitManager.activateBrand(n)})}(Tt.contextId||s.currentDoc.getDCXRoot().getValue("authctx#ctxid"),{skipReload:!0,belongsToUser:"INCOMING"!==s.currentDoc.getCollaboration(),isEntitledUser:At.featureEnabled("entitle-brand-kit")})}))).then(Ha(r,(function(){return e=ie.currentBrandKit(),pe.load({loadForEditor:!0,authoringContext:e});var e}))).then(Ha(r,()=>Aa(!1,r))).then(Ha(r,(function(){const e=ie.currentBrandKit(),t=ie.currentBrandElements();if(m){t&&t.activated&&((d="true"===Tt.branded)?Ke.publish("paidProjectStartBranded"):Ke.publish("paidProjectStartUnbranded"))}else{if("edit-template"===Tt.operation||"new-from-template"===Tt.operation||"new-template-from-template"===Tt.operation)return kt=e.getThemeById(Tt.templateId),g.persistSource=we.fromTemplate(e,kt),"new-template-from-template"===Tt.operation?(Ke.publish("createdTemplateFromTemplate"),se.createEmptyPostTemplate(e).then(Ha(r,(function(t){return g.persistSave=ve.toTemplateLocal(e,kt,ve.CommitChanges.AUTO),Tt.newTemplateId=t.id,g})))):("edit-template"===Tt.operation?(Ke.publish("editedTemplate"),g.persistSave=ve.toTemplateLocal(e,kt,ve.CommitChanges.AUTO)):(Ke.publish("projectCreated",{projectId:s.currentDoc.id}),Ke.publish("createdBrandedProject",{projectId:s.currentDoc.id,templateName:kt._data["theme#data"].name,themeletId:Tt.templateId}),Ke.publish("createdProjectFromTemplate"),Vt(s.currentDoc.id),g.persistSave=ve.toDocument(s.currentDoc)),g);"remix"===Tt.operation?(je.setCPServiceDomain(Tt.cpServiceDomain),Vt(s.currentDoc.id),new Ve({cpServiceDomain:Tt.cpServiceDomain}).trackRepeatableActivity(Tt.cpAssetId,"remix_count"),g={persistSource:new He({assetId:Tt.cpAssetId,cpServiceDomain:Tt.cpServiceDomain,urn:Tt.urn}),persistSave:ve.toDocument(s.currentDoc)}):(je.setCPServiceDomain(""),g={persistSource:we.fromDocument(s.currentDoc),persistSave:ve.toDocument(s.currentDoc)})}return ne.FormaToPGMUtils.cpEnv=Tt.cpServiceDomain===window.marvel.settings.cpsStage?"stage":"prod",g}))).then(Ha(r,(function(e){return(ot=new w(e)).whenInitialized().then(Ha(r,(function(){pe.logLoadingTimes();var e=ot.missingFontListInDoc();e.length>0&&function(e){var t=e.join(", ");lt.errorDialogs.fontMissingNoticeModal||(lt.errorDialogs.fontMissingNoticeModal=new L({headerText:"i18n.dialogs.fontMissingNotice.kHeaderText",contentText:v.translate("dialogs.fontMissingNotice.kContentText",{missingFontNames:t}),buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.fontMissingNotice.kEditButtonLabel",onClick:function(){lt.errorDialogs.fontMissingNoticeModal.hide(),Ke.publish("missingFontsWhenOpenReplaceButtonPressed")}},{class:"pill pill-secondary-on-light",label:"i18n.dialogs.fontMissingNotice.kCancelButtonLabel",onClick:function(){lt.errorDialogs.fontMissingNoticeModal.hide(),Oa(!0),Ke.publish("missingFontsWhenOpenCancelButtonPressed")}}]})),lt.errorDialogs.fontMissingNoticeModal.show()}(e),ne.Host.setCoreWrapper(ot),ot.validateDoc("open"),vt.setDocument(ot.getDocument()),pt.resolve(ot)})))}))).then(Ha(r,(function(){if("remix"===Tt.operation){var e;if(Tt.aspectId||Tt.customSize)if(Tt.customSize){var o=Tt.customSize.split(":");4===o.length&&(e=ne.DesignSizeLibrary.getCustomSize(o[0],o[1],o[2],o[3]))}else e=ne.DesignSizeLibrary.getById(Tt.aspectId);return(e?ot.setPageSizeFromDesignSize(e):t.resolve()).then(Ha(r,(function(){return ot.recordOriginalSize()})))}return m?ot.setPageSizeFromDesignSize(i.shapeData).then(Ha(r,(function(){return ot.recordOriginalSize()}))).then(Ha(r,(function(){if(!i.image)return t.resolve();if(i.image&&(Nt=!0),Array.isArray(i.image)){var e,o=[];return i.image.forEach((function(n){var a=t.defer();a.promise.catch((function(){if(!e){var t=new L({headerText:"i18n.dialogs.addImageError.kHeaderText",contentText:"i18n.dialogs.addImageError.kContentText",dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"Ok",onClick:function(){t.hide()}}]});lt.errorDialogs.addImageErrorOverlay=t,e=!0}})),o.push(na(n,a,null,!0,!0,!1))})),t.allSettled(o)}return na(i.image,null,null,!0,null,!1).catch((function(){return t.resolve()}))}))).then(Ha(r,(function(){return ot.initializeNewPost(i)}))).then(Ha(r,(function(){return d?Ia(!0):t.resolve()}))).then(Ha(r,(function(){Ke.publish("projectCreated",{projectId:s.currentDoc.id,aspectRatio:i.shapeData.aspectRatio,targetId:i.shapeData.id,id:i.id,textLength:i.text.length,workflow:a.workflow}),d&&Ke.publish("createdBrandedProject",{projectId:s.currentDoc.id})}))):t.resolve()}))).then(Ha(r,(function(){var e="remix"===Tt.operation,o="new-from-template"===Tt.operation,n=Tt.cpServiceDomain||"cc-api-cp.adobe.io",a=ot.getRemixParentsCpIds(),i=Tt.cpAssetId||(a?a[a.length-1]:null),l=o?Tt.templateId:ot.getAuthoringContextThemeId();return o&&ot.setAuthoringContextThemeId(Tt.templateId),vt.getRemixParentCPMetadata(i,n,!!l).then(Ha(r,(function(t){e&&(s.currentDoc.name="",ot.setRemixParentCpId(t.id))}))).catch((function(o){return o&&o.message===et.STALE_SESSION?t.reject(o):e?t.reject(o):(at.warn("Failed to get parent CP metadata for a non-remix flow",o),t.resolve())}))}))).then(Ha(r,(function(){if("remix"!==Tt.operation&&"new-from-template"!==Tt.operation)return t.resolve();var e=t.defer();return 0===ot.getRootForma().childCount?(lt.errorDialogs.notRemixableOverlay=new L({headerText:"i18n.dialogs.remixFailed.kHeaderText",contentText:"i18n.dialogs.remixFailed.kContentText",dismissable:!1,buttons:[{class:"pill pill-primary-on-light",label:"OK",onClick:function(){lt.errorDialogs.notRemixableOverlay.hide(),e.reject(),Oa(!0)}}]}),window.marvel.events.trigger("hide-interstitial"),lt.windowPanel.show(),lt.errorDialogs.notRemixableOverlay.show()):(ca(),e.resolve()),e.promise}))).then(Ha(r,(function(){return k}))).then(Ha(r,(function(e){var o=At.featureEnabled("entitle-brand-kit"),n=At.featureEnabled("post-create-template-contentteam");return it=!n&&(!e&&!o&&("remix"===Tt.operation||ot.getWatermarkEnabledForDoc())),ot.setWatermarkEnabledForDoc(it),qe.getSetting(xe.keys.POST_WATERMARK_COACHMARK_DISMISSED).then(Ha(r,(function(e){It=e}))).catch(e=>{const o=e?e.message:"";if(o===et.STALE_SESSION)return t.reject(e);at.warn("Error fetching user settings for watermark coachmark. Error: ".concat(o),e),It=!1})}))).then(Ha(r,(function(){ot.resetUserActions(),ot.monitorTransactions(),wa(function(e){e=e||{};var t=Wt.default;if(e.workflow&&Wt.hasOwnProperty(e.workflow)&&(t=n.clone(Wt[e.workflow])),e.startingMenu&&(t.startingMenu=e.startingMenu),!t.isDefault&&e.buttons){var o=e.buttons;o.indexOf("facebook_upload")>=0&&(t.showFacebookUploadButton=!0),o.indexOf("share")>=0&&(t.showShareButton=!0),o.indexOf("download")>=0&&(t.showDownloadButton=!0)}return n.each(Ft,(function(o){var a;n.isUndefined(e[o])||(a="true"===e[o]||"false"!==e[o]&&e[o],t[o]=a)})),t}(a)).then(Ha(r,()=>{gt===Dt.TEMPLATE&&(ht={templateName:se.getTemplateName(kt)}),lt.windowPanel.show(),window.marvel.events.trigger("hide-interstitial"),ya(ie.currentBrandElements())})).catch(at.error)}))).then(Ha(r,(function(){var t=["new","new-from-theme","new-from-template","remix"].indexOf(Tt.operation)>=0,o=ie.currentBrandElements()||{id:""};const a=vt.remixParentAnalyticsMetadata;Ke.publish("project:editorDisplayed",{isBranded:!n.isEmpty(s.currentDoc.getDCXRoot().getValue("authctx#ctxid")),contextualData23:o.isDefault?"":o.id,isNewProject:t,sparkFormat:"post",contextData:["projectId"],includesUploadedFonts:rt.includesUploadedFonts(),contextualData5:"tagNames:"+a.tagNames,contextualData6:"templateType:"+a.templateType,contextualData24:"collabStatus:"+s.currentDoc.getCollaborationForAnalytics(),templateId:a.templateId}),window.marvel.events.trigger("editor-displayed",{appName:"post"});var r=Date.now()-c;u&&(r-=u),Ke.publish("post:editorStartupEnd",{contextualData1:"timeElapsedMs:"+r,contextualData2:"editorOperation:"+Tt.operation,contextualData3:"isFreshLoad:"+p,contextualData4:"hasActivatedBrand:"+(!!o&&o.activated),contextualData5:"timeSpentInNpw:"+u}),Je.startListening({handleUndo:Zt,handleRedo:eo,selectAll:ot.selectAll,deselectAll:ot.deselectAll}),e("#PostCanvasSection").on("click",La)}))).then(Ha(r,()=>{"new"!==Tt.operation&&(ot.replaceCorruptImageFrames()&&(at.error("Replacing corrupt images in document during open"),lt.errorDialogs.replacedLowResImagesModal||(lt.errorDialogs.replacedLowResImagesModal=new L({headerText:'\n                  <span class="error-modal-header">\n                    <span>i18n.dialogs.corruptImageReplacement.kHeaderText</span>\n                    <i class="error-modal-header__icon"></i>\n                  </span>\n                ',contentText:'<div class="error-modal-content">\n                      <span>i18n.dialogs.corruptImageReplacement.kContentText</span>\n                      <span class="error-modal-content_placeholder-indicator" style="background-color: #FF0000;"></span>\n                    </div>',dismissable:!0,buttons:[{class:"pill pill-primary-on-light",label:"i18n.dialogs.corruptImageReplacement.kButtonLabel",onClick:()=>lt.errorDialogs.replacedLowResImagesModal.hide()}]})),lt.errorDialogs.replacedLowResImagesModal.show()))})).catch(_a).done()}},rt.getMetadataForExportAnalytics=function(e,t){return vt.getMetadataForExportAnalytics(e,t)},rt.disable=function(){rt.enabled=!1,ie.resetBrandCaches(),kt=null,ht=null,Nt=!1,Pt=null,Object.keys(lt.errorDialogs).forEach(e=>lt.errorDialogs[e].hide()),ba({silent:!0}),lt.windowPanel&&lt.windowPanel.hide(),pt=t.defer(),ut.promise.done((function(){lt.poster&&lt.poster.update({core:null}),lt.posterAdornments&&lt.posterAdornments.disable(),lt.postEditorView&&lt.postEditorView.hide(),lt.newPostWorkflow&&lt.newPostWorkflow.hide(),window.marvel.events.off("saved-composite-doc",Kt),window.marvel.events.off("onboarding-premium-templates-remove",to),window.marvel.events.off("upgrade-view-closed"),window.marvel.events.off("document-collaboration-changed",Ht),function(){for(var e=0;e<dt.length;e++)dt[e].remove();dt=[]}(),Je.stopListening(),e("#PostCanvasSection").off("click",La)}))},rt.handleUnload=function(){const e=ot.getDocument();if(!ot||!e)return t();const o=ge.getAllStringForFormaUsedWheelSuggestions(e);if(o.length>0&&Ke.publish("lockupStyleCaptured",{contextualData1:"styleString:".concat(o),contextualData2:"location:EditorClose"}),!Rt&&Ua()){var n=t.defer();return ja({defer:n}),n.promise}return Rt=!1,Rt=!1,Rt=!1,Ka()},rt.getCurrentDocumentSynthesizedName=function(){return ot.getCurrentDocumentSynthesizedName()},rt.getCurrentDocumentDescription=function(){return ot.getCurrentDocumentDescription()},rt.getRemixAncestorsIntoMachineTags=function(e){return ot.getRemixAncestorsIntoMachineTags(e)},rt.getDocumentSize=function(){return ot.getDocumentSize()},rt.getCoreWrapperPromise=function(){return pt.promise},rt.saveAsCopyToTemplate=function(){var e,t;return lt.poster.getRendition({width:500,imageQuality:.75}).then((function(e){return t=e,r.getController()})).then((function(e){return e.getGlobalActiveContext()})).then((function(t){if(!(e=t))throw new Error("No current BrandKit.");return se.createEmptyPostTemplate(e)})).then((function(o){var n=ve.toTemplateExternal(e,o,ve.CommitChanges.AUTO);return ot.saveCopyWithRenditions(n,null,t)}))},rt.getDownloadImageBlobPromise=function(e,t,o){if(rt.enabled)return wt.generateImageBlob(t,o);let n;return Wa({authoringContextId:e.getDCXRoot().getValue("authctx#ctxid")}).then(t=>{const o=we.fromDocument(e),a=new Te;return n=new w({persistSource:o,persistSave:a}),n.whenInitialized().then(()=>t)}).then(e=>{var o=n.getDocument();Ue.reportNounProjectIds(o,a,ca);const r=$e.getRenditionParams(o,t);return e.getRenditionBlobPromise(n,r)})},rt.getPgmGraphForPublish=function(){return Ze.getPgmGraphForPublish(ot)},rt.hasAnimationStyle=function(){return!!ot&&ot.hasAnimationStyle()},rt.webAnimationEnabled=function(){return At.featureEnabled("post-web-animation-enabled")||At.featureEnabled("force-post-web-animation-enabled-for-adobe")&&nt},rt.getCompositeImageFiles=function(e){var o;return Wa().then((function(){var t=we.fromDocument(e),n=new Te;return(o=new w({persistSource:t,persistSave:n})).whenInitialized()})).then((function(){var e=o.imageFormas(),n=[];e.forEach((function(e){n.push(m.load(je.decodeUrl(e.contentNode.url)))}));var a=[];return t.all(n).then((function(){for(var e=[],o=[],n=0;n<arguments[0].length;n++){var r=arguments[0][n];if(r instanceof HTMLImageElement){o.push(r.src);var i=r.src.substring(r.src.lastIndexOf("=")+1),s=be.createCanvas(r);e.push(be.canvasToBlob(s,i))}}return t.all(e).then((function(){for(var e=0;e<arguments[0].length;e++){var t=arguments[0][e],n=new RegExp(/asset_id=([^&]*)/),r=n.exec(o[e])[1],i=o[e].substring(o[e].lastIndexOf("/")+1);a.push({name:r+"."+i,assetId:r,blob:t})}return a})).catch((function(e){at.error("getCompositeImageFiles fail-1",e)}))})).catch((function(e){at.error("getCompositeImageFiles fail-2",e)}))}))},rt.includesUploadedFonts=function(){return!!ot&&ot.includesUploadedFonts()},rt.includesPaidAdobeFonts=function(){return ot?ot.getDocFontSourceUsage().indexOf(ne.describeFontSource(ne.FontSource.TYPEKIT_PREMIUM))>-1:(at.warn("includesPaidAdobeFonts: Unable to get font usage info from doc - coreWrapper unavailable"),"unknown")},rt.getRemixParentsCpIds=function(){return ot?ot.getRemixParentsCpIds():(at.warn("getRemixParentsCpIds: Unable to get remix parent ids from doc - coreWrapper unavailable"),null)},rt.getConstrainedImages=function(){return ot?ot.getConstrainedImages():(at.warn("getConstrainedImages: Unable to get constrained images info from doc - coreWrapper unavailable"),null)},rt.getFontsUsed=function(){var e=t.defer();return pt.promise.done((function(){ot?e.resolve(ot.getFontsUsed()):e.reject("coreWrapper is undefined")}),(function(){e.reject("could not load coreWrapper")})),e.promise},rt.setCPProjectId=function(e){ot&&ot.setCPProjectID(e)},rt.setCPAlias=function(e){ot&&ot.setCommunityPlatformAlias(e)},rt.setCPAssetId=function(e){ot&&ot.setCommunityPlatformAssetID(e)},rt.setPublishedContentEtag=function(e){ot&&ot.setPublishedEtag(e)},rt}.apply(t,n))||(e.exports=a)}}]);
//# sourceMappingURL=theo-web-view_e27cd5be-c8fa3fb6.js.map
(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[18],{"6Rk9":function(e,r,t){var o,n=r,a=t("oAGj"),i=t("sIWg");n.GeometryFacade=(o=function(){},a.defineClass({name:"GeometryFacade",ctor:o,statics:{getFormaeBounds:function(e,r){void 0===r&&(r=!1);var t=i.TheoRect.Zero;if(e.length>0)if(r){var o=e.map((function(e){return e.controller.getUserPerceivedFrame()}),this);t=o.reduce((function(e,r){return e.unionWith(r)}),o[0])}else{var n=e[0];t=e.reduce((function(e,r){return e.unionWith(r.finalFrame)}),n.finalFrame)}return t},unionFrame:function(e,r){if(void 0===r&&(r=null),0==e.length)return null;for(var t=r||e[0].parent,o=null,n=a.iter(e);!n.done;n.next()){for(var i=n.value,l=i.placement,s=i.parent;null!=s&&s!=t;)l=l.concat(s.placement),s=a.opt(s,(function(e){return e.parent}));var u=i.boundsInCoordSpace(l);o=null==o?u:o.unionWith(u)}return o}}}),o)},"6h7+":function(e,r,t){var o,n,a,i=r,l=t("oAGj"),s=t("Tq01"),u=t("dHJt"),c=t("CWW7"),d=t("yGNn"),m=t("G1DZ"),g=t("8t9B");i.AddBadgeParams=(o=function(e){void 0===e&&(e=null),this.controllerType=e},n={},l.defineClass({name:"AddBadgeParams",ctor:o,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===n.DEFAULTS&&(n.DEFAULTS=new o),n.DEFAULTS}}}}),o),i.BadgeFacade=(a=function(){},l.defineClass({name:"BadgeFacade",ctor:a,statics:{addBadge:function(e,r,t,o){void 0===o&&(o=null);var n=l.clone(a.getFormaeToCopy(e,l.opt(o,(function(e){return e.controllerType}))));return 0==n.length?d.CorePromise.reject("Badge is empty"):c.CreationFacade.copyItems(l.clone(n),t).then((function(e){var t=l.clone(e);return a.recordSources(r,l.clone(n),l.clone(t)),new u.BadgeLayoutController(l.clone(t)).update(),t.forEach(a.onBadgeFormaPlaced),new s.FormaActionResult(l.clone(t))}))},getDesignIngredientIDAndType:function(e){return{id:m.FormaSourceUtils.stripNamespace(e),type:"lockup"}},getFormaeToCopy:function(e,r){var t;return e.firstPage.root.filterByControllerKind((t=r)||null!=t?t:g.TypeLockupController.KIND)},onBadgeFormaPlaced:function(e){var r;(r=l.as(e.controller,g.TypeLockupController))&&(r.updateScoring(),r.styleController.doesLockupContrastWithBackground()||r.shuffleColorAssignment())},recordSources:function(e,r,t){for(var o=t.length>1,n=l.iter(l.toSequence(t));!n.done;n.next()){var i=n.value,s=i.offset;i.element.source=a.makeSourceDescriptor(e,o?r[s].formaID:null)}},makeSourceDescriptor:function(e,r){var t;return null!=(t=r)?m.FormaSourceNamespace.DesignIngredient+e+":"+t:m.FormaSourceNamespace.DesignIngredient+e}}}),a)},CWW7:function(e,r,t){var o,n,a,i=r,l=t("oAGj"),s=t("Tq01"),u=t("0wFF"),c=t("KSe6"),d=t("kYI4"),m=t("SpAV"),g=t("vYM0"),f=t("gXiO"),p=t("yGNn"),F=t("FNB+"),C=t("cmoc"),v=t("V3yt"),h=t("ZK0l"),y=t("pnSN"),I=t("X0GW"),T=t("iCxV"),A=t("2rlr"),k=t("q5zr"),S=t("fdtz"),D=t("MYNe"),b=t("c+uM"),P=t("tGKA"),N=t("VkKB"),M=t("K17h"),E=t("uxH+"),x=t("K0Rh"),R=t("JO5d"),w=t("djAF"),_=t("35Q0"),L=t("lJxM"),B=t("T6jX"),O=t("8t9B"),G=t("1NAc"),U=t("LGJg"),Y=t("sW6f"),j=t("WWR6"),H=t("zjod"),K=t("QTen");i.FloatingImageStrategy=l.defineEnum("FloatingImageStrategy",{IfHasAlphaOrIsLogo:0,Always:1,Never:2}),i.AddFormaParentingHint=l.defineEnum("AddFormaParentingHint",{defaultHandling:0,addToRoot:1,doNotAddFormaForContentToTree:2}),i.AddFormaParams=(o=function(e,r,t,o,n){void 0===e&&(e=s.ControllerSettingsBehaviorEnum.IgnoreControllerSettings),void 0===r&&(r=!0),void 0===t&&(t=null),void 0===o&&(o=i.FloatingImageStrategy.IfHasAlphaOrIsLogo),void 0===n&&(n=i.AddFormaParentingHint.defaultHandling),this.behavior=e,this.suggestPlacement=r,this.formaToReplace=t,this.floatingImageStrategy=o,this.parentingHint=n},n={},l.defineClass({name:"AddFormaParams",ctor:o,superName:"CoreObject",statics:{DEFAULTS:{get:function(){return void 0===n.DEFAULTS&&(n.DEFAULTS=new o),n.DEFAULTS}},makeWithFormaToReplace:function(e){return new o(void 0,void 0,e)},makeWithFormaToReplace:function(e,r){return new o(void 0,void 0,e,void 0,r)}}}),o),i.CreationFacade=(a=function(){f.CoreObject.call(this)},l.defineClass({name:"CreationFacade",ctor:a,superName:"CoreObject",statics:{addImage:function(e,r,t,o,n,s,u,c,d,m){var g,f,F,C,v,h;if(void 0===o&&(o=null),void 0===n&&(n=null),void 0===s&&(s=null),void 0===u&&(u=!1),void 0===c&&(c=i.AddFormaParams.DEFAULTS),void 0===d&&(d=null),void 0===m&&(m=null),(C=e.document)&&(v=C.controller)&&(h=l.as(C.content.createNode(k.ImageContentNode.KIND,null),k.ImageContentNode))){var y;if(null==h.componentID&&null!=m&&(h.componentID=m),h.url=r,h.mimeType=t,y=d)for(var I=l.iter(y);!I.done;I.next()){var T=I.key,S=I.value;h.setTag(T,S)}return h.whenLoaded().then((function(e){var r;return(r=l.as(e,A.HostImage))&&(u&&h.createImageFeatures(),h.hasAlpha=(g=s)||null!=g?g:r.hasAlpha(),h.pixelWidth=(f=o)||null!=f?f:r.getWidth(),h.pixelHeight=(F=n)||null!=F?F:r.getHeight()),a.addImageForContentNode(v.document.firstPage,h,c)}))}return p.CorePromise.reject("document has no controller or imageCN was nil")},addImageForContentNode:function(e,r,t){return a.addContent(e,r,null,!1,t).then((function(r){var t;return(t=l.as(r,F.Forma))?(t.isImage()&&B.TheoDocumentUtils.updateConstrainedImageInfo(e.document),t):(m.CoreAssert.fail("expected a forma result from CreationFacade.addContent","CreationFacade.addImageForContentNode","CreationFacade.swift",162),null)}))},addLibraryShape:function(e,r,t,o){var n;return(n=l.as(e.createFormaWithController(w.ShapeForma.KIND,R.ShapeController.KIND),w.ShapeForma))?(e.root.appendChild(n),n.intent=F.Forma.INTENT_ICON,_.ShapeLibrary.applyToShapeForma(n,r),n.style.colors.fieldPrimary=o,n.controller.fit(t),p.CorePromise.resolve(n)):p.CorePromise.reject("could not create shape forma")},addText:function(e,r,t,o){var n;return void 0===o&&(o=i.AddFormaParams.DEFAULTS),(n=e.document)?p.CorePromise.resolve(null).then((function(e){var i;return(i=l.as(n.content.createNode(L.TextContentNode.KIND,null),L.TextContentNode))?(i.text=r,a.addContent(n.firstPage,i,void 0,void 0,o).then((function(e){var r;return(r=l.as(e,F.Forma))?r:(m.CoreAssert.fail("Unexpected result from AddContentAction, expected a Forma","CreationFacade.addText","CreationFacade.swift",217),null)})).then((function(e){return t?(r=l.as(e,F.Forma))&&(o=l.as(r.controller,O.TypeLockupController))&&(n=l.as(r.style,b.LockupStyle))&&(a=n.font)?v.FontFacade.ensureFontLoaded(a.fontData).then((function(e){return o.updateGroup(),r})):p.CorePromise.reject("unable to inspect created lockup for style and font"):e;var r,o,n,a}))):p.CorePromise.reject("textCN is nil")})):p.CorePromise.reject("document has no controller")},duplicateItems:function(e,r,t){var o,n,i=l.clone(D.LayerFacade.sortInZOrder(l.clone(e)));return a.copyItems(l.clone(i)).then((function(e){var a=l.clone(e);if(0==!a.length&&(r&&a.forEach((function(e){return e.move(P.Matrix2D.translationXY(25,25))})),t&&a[0].page.document.controller.selection.replaceSelectionWithFormae(l.clone(a)),((o=l.opt(l.opt(a[0].page.document,(function(e){return e.controller})),(function(e){return e.enableMoveableChildren})))||null!=o)&&o&&i.length==a.length))for(var s=l.iter(l.range(0,i.length,!1));!s.done;s.next()){var u=s.value;((n=l.opt(i[u].controller,(function(e){return e.userGroupChild})))||null!=n)&&n&&l.opt(i[u].parent,(function(e){return e.appendChild(a[u])}))}return a}))},remapReferences:function(e,r){if(e.page!=r.page){var t,o,n=e.style,a=r.style;if((t=n.colorLibrary)&&(o=a.colorLibrary)){var i,s,u={};g.ColorLibraryMap.remapColors(a.colors,t,o,u),(i=l.as(a,b.LockupStyle))&&(s=i.characterStyles[O.TypeLockupController.HIGHLIGHT_STYLE])&&g.ColorLibraryMap.remapColors(s.colors,t,o,u)}}},copyItems:function(e,r){if(void 0===r&&(r=null),0==e.length)return p.CorePromise.resolve([]);var t;if(t=e[0].page.document){var o=e.filter((function(e){return l.opt(e.controller,(function(e){return 1==e.duplicatable}))}),this);if(0==o.length)return p.CorePromise.resolve([]);var n=[],i=!1,s=p.CorePromise.resolve(null);return o.forEach((function(e){s=s.then((function(t){return e.controller.copyTo(r).then((function(r){var t;return(t=l.as(r,F.Forma))?(t.isImage()&&(i=!0),a.remapReferences(e,t),n.push(t),t):null}))}))})),s.then((function(e){return i&&B.TheoDocumentUtils.updateConstrainedImageInfo(l.opt(r,(function(e){return e.document}))||t),n}))}return p.CorePromise.reject("copyItems: no document?")},deleteFormae:function(e,r){var t,o;if(e.length>0&&(o=e[0].page.document)){for(var n,a,i=!1,s=!1,m=!1,g=l.iter(e);!g.done;g.next()){var f=g.value;if(!(f instanceof x.RootForma)){var p;if(f.isImage()&&(s=!0),f.isLogo()?d.BrandingFacade.isImageBrandedLogo(f)&&(i=!0):f.isTypeLockup()?d.BrandingFacade.doesLockupUseBrandedFonts(f)&&(i=!0):f.hasIntent(F.Forma.INTENT_ICON)&&l.opt(T.Host.logging,(function(e){return e.logToAnalytics(u.AnalyticsConstants.kAnalyticsIconDeleted,{})})),f.isVideo()&&(m=!0),o.controller.selection.isSelected(f)&&o.controller.selection.deselectForma(f),p=f.parent){var C=f.parent;for(l.opt(l.as(p.controller,h.GroupController),(function(e){return e.removeFormaFromGroup(f)}));((t=l.opt(l.opt(C,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=t)&&t;){var v=C.parent;C.childCount<=1?I.GroupFacade.ungroupItems([C]):I.GroupFacade.updateUserGroupBounds(C),C=v}}var y=f.controller.settings;null!=y&&y==f.page.document.controller.controllerSettingsState.settings&&(f.page.document.controller.controllerSettingsState.settings=null)}}(n=l.as(o.firstPage.root.controller,E.RootController))&&(a=n.getGridController())&&a.onFormaeDeleted(l.clone(e)),c.AnimationLibrary.updateCurrentStyle(o,m),i&&d.BrandingFacade.unBrandDocumentIfNoBrandedElements(o),s&&B.TheoDocumentUtils.updateConstrainedImageInfo(o)}l.opt(r,(function(e){return e()}))},addContentNodeToDocument:function(e,r){var t;(t=e)&&null==t.parent&&r.content.root.appendChild(t)},removeContentNodeFromDocument:function(e,r){var t;(t=e)&&r.content.root.removeChild(t)},addContent:function(e,r,t,o,n){var s,u,d,m,g;return void 0===t&&(t=null),void 0===o&&(o=!1),void 0===n&&(n=i.AddFormaParams.DEFAULTS),(s=e.document)&&(u=s.controller)?(a.addContentNodeToDocument(r,s),a.addContentNodeToDocument(t,s),M.MotionUtils.invalidateAnimation(s),(d=a.createFormaFromContent(e,r,t))?(m=n.formaToReplace)&&(g=l.as(l.opt(m.parent,(function(e){return e.controller})),h.GroupController))?(g.replaceChildWithForma(m,d,o),c.AnimationLibrary.updateCurrentStyle(s,d.isVideo()),p.CorePromise.resolve(d)):n.parentingHint==i.AddFormaParentingHint.doNotAddFormaForContentToTree?p.CorePromise.resolve(d):a.addForma(u.document.firstPage,d,n).thenReturn(d):p.CorePromise.reject("Could not create forma from content")):p.CorePromise.reject("No related document, or controller")},addForma:function(e,r,t){var o;return void 0===t&&(t=i.AddFormaParams.DEFAULTS),(o=r.controller)?o.addForma(e,r,t).then((function(o){var n;return r.isImage()&&B.TheoDocumentUtils.updateConstrainedImageInfo(e.document),(n=e.document)&&c.AnimationLibrary.updateCurrentStyle(n,r.isVideo()),t.behavior==s.ControllerSettingsBehaviorEnum.SetControllerSettings&&l.opt(l.opt(e.document,(function(e){return e.controller})),(function(e){return e.controllerSettingsState.settings=l.opt(r.controller,(function(e){return e.settings}))})),null})):p.CorePromise.resolve(null)},createFormaFromContent:function(e,r,t){var o,n,a,i,s,u,c;if((n=e.document)&&(a=n.controller))if(i=l.as(r,k.ImageContentNode)){var g=e.createForma(S.ImageForma.KIND);if(g.contentID=r.id,r.getTag(k.ImageContentNode.IMAGE_MASK_ROLE_TAG)==k.ImageContentNode.ROLE_MASK)o=g;else{switch(l.opt(i.mediaMetadata,(function(e){return e.designIntent}))){case"logo":null!=i.sparkElementID&&""!=i.sparkElementID&&d.BrandingFacade.brandDocumentForElement(n,i.sparkElementID,d.AUTHORING_CONTEXT_TYPE_LOGO),g.intent=F.Forma.INTENT_LOGO;break;case"pattern":g.intent=F.Forma.INTENT_PATTERN;break;case"icon":g.intent=F.Forma.INTENT_ICON;break;case"floating-image":g.intent=F.Forma.INTENT_FLOATING_IMAGE}(p=e.createForma(C.FrameForma.KIND)).appendChild(g),o=p}}else if(s=l.as(r,Y.VideoContentNode)){var f,p,v=e.createForma(H.VideoForma.KIND);v.videoContentNode=s,(f=l.as(v.style,K.VideoStyle))&&(f.duration=s.duration),null!=t&&(v.contentID=t.id),(p=e.createForma(C.FrameForma.KIND)).appendChild(v),o=p,l.opt(l.opt(v.contentNode,(function(e){return e.mediaMetadata})),(function(e){return e.designIntent==N.MediaMetadata.DESIGNINTENT_STICKER}))&&(v.intent=F.Forma.INTENT_STICKER)}else if(u=l.as(r,U.VectorContentNode)){m.CoreAssert.isFalse(l.opt(u.mediaMetadata,(function(e){return e.designIntent==N.MediaMetadata.DESIGNINTENT_ICON})),"can't create icon from VectorContentNode","CreationFacade.createFormaFromContent","CreationFacade.swift",672);var h=e.createForma(j.VectorForma.KIND);h.contentID=u.id,o=h}else if(c=l.as(r,L.TextContentNode)){var I=e.createForma(y.GroupForma.KIND),T=a.controllerFactory.createController(O.TypeLockupController.KIND,I);I.controller=T,T.contentNode=c,T.size=new G.TheoSize(400,300),o=I}return o}}}),a)},"LP+A":function(e,r,t){var o,n=r,a=t("oAGj"),i=t("gXiO"),l=t("iSwi"),s=t("LqGn");n.DesignSuggestionFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"DesignSuggestionFacade",ctor:o,superName:"CoreObject",statics:{createSuggestionsFromTemplate:function(e,r,t,o){void 0===o&&(o=10);var n=new l.RetargetSuggester(r,t,e),i=a.clone(n.createSuggestions()).filter((function(e){return e instanceof s.RetargetSuggestion}),this).map((function(e){return e}),this);return i.slice(0,Math.min(i.length,o))}}}),o)},MWx2:function(e,r,t){var o,n=r,a=t("oAGj");n.HandleFacade=(o=function(){},a.defineClass({name:"HandleFacade",ctor:o}),o)},MYNe:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("gXiO");n.LayerFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"LayerFacade",ctor:o,superName:"CoreObject",statics:{sortInZOrder:function(e){var r=a.clone(e);return a.sortInPlace(r,(function(e,r){return o.getZOrder(e)<o.getZOrder(r)})),r},getZOrder:function(e){var r;return(r=e.controller)?r.getZOrder():0},setZOrder:function(e,r){a.opt(r.controller,(function(r){return r.setZOrder(e)}))},getMinLayerIndex:function(e){var r;return(r=e.controller)?r.getMinLayerIndex():0},getReorderableLayerCount:function(e){var r;return(r=e.controller)?r.getReorderableLayerCount():0}}}),o)},O8XL:function(e,r,t){var o,n,a=r,i=t("oAGj"),l=t("0wFF"),s=t("cZuM"),u=t("SpAV"),c=t("gXiO"),d=t("wNKJ"),m=t("FNB+"),g=t("iCxV"),f=t("tGKA"),p=t("3DEm");a.DistributeType=i.defineEnum("DistributeType",{HorizontalSpace:0,LeftEdge:1,CenterX:2,RightEdge:3,VerticalSpace:4,TopEdge:5,CenterY:6,BottomEdge:7,Row:8,Column:9}),a.describeDistributeType=function(e){switch(e){case 0:return"HorizontalSpace";case 1:return"LeftEdge";case 2:return"CenterX";case 3:return"RightEdge";case 4:return"VerticalSpace";case 5:return"TopEdge";case 6:return"CenterY";case 7:return"BottomEdge";case 8:return"Row";case 9:return"Column"}},a.FormaGeometryInfo=(o=function(){this.minEdge=99999999.9,this.maxEdge=-99999999.9,this.totalObjectSpan=0,this.interiorFormaeSortedByPosition=[]},i.defineClass({name:"FormaGeometryInfo",ctor:o,props:{getNumFormae:function(){return i.eq(m._equality_Forma_Forma,this.firstForma,this.lastForma)?this.interiorFormaeSortedByPosition.length+1:this.interiorFormaeSortedByPosition.length+2}}}),o),a.AlignmentFacade=(n=function(){c.CoreObject.call(this)},i.defineClass({name:"AlignmentFacade",ctor:n,superName:"CoreObject",statics:{arrangeFormae:function(e,r){i.opt(g.Host.logging,(function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeArranged,{contextualData1:"horizontal: "+e,contextualData2:"formae count: "+r.length})})),n.distributeOrArrangeFormae(e?a.DistributeType.Row:a.DistributeType.Column,i.clone(r)),n.rescueFormae(i.clone(r))},distributeFormae:function(e,r){i.opt(g.Host.logging,(function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeDistributed,{contextualData1:"type: "+a.describeDistributeType(e),contextualData2:"formae count: "+r.length})})),u.CoreAssert.isTrue(r.length>2,"not enough formae to distribute","AlignmentFacade.distributeFormae","AlignmentFacade.swift",79),u.CoreAssert.isTrue(e!=a.DistributeType.Row&&e!=a.DistributeType.Column,"Use arrangeFormae to do row/column layout","AlignmentFacade.distributeFormae","AlignmentFacade.swift",80),n.distributeOrArrangeFormae(e,i.clone(r)),n.rescueFormae(i.clone(r))},alignFormae:function(e,r){i.opt(g.Host.logging,(function(t){return t.logToAnalytics(l.AnalyticsConstants.kAnalyticsFormaeAligned,{contextualData1:"type: "+s.describeAlignmentType(e),contextualData2:"formae count: "+r.length})})),e==s.AlignmentType.CenterX||e==s.AlignmentType.CenterY?n.alignCenters(e,i.clone(r)):n.alignEdges(e,i.clone(r)),n.rescueFormae(i.clone(r))},rescueFormae:function(e){for(var r=i.iter(e);!r.done;r.next()){var t=r.value;d.DragFacade.rescueFormaToPageBounds(t)}},calculateFormaGeometryInfo:function(e,r){u.CoreAssert.isTrue(r.length>=2,"Not enough forma to distribute","AlignmentFacade.calculateFormaGeometryInfo","AlignmentFacade.swift",110);for(var t=new a.FormaGeometryInfo,o=i.iter(r);!o.done;o.next()){var l=o.value.controller.getUserPerceivedFrame();if(null!=l)switch(e){case 0:case 1:case 2:case 3:case 8:t.minEdge=p.MathUtils.minDouble(t.minEdge,l.minX),t.maxEdge=p.MathUtils.maxDouble(t.maxEdge,l.maxX),t.totalObjectSpan+=l.maxX-l.minX;break;case 4:case 5:case 6:case 7:case 9:t.minEdge=p.MathUtils.minDouble(t.minEdge,l.minY),t.maxEdge=p.MathUtils.maxDouble(t.maxEdge,l.maxY),t.totalObjectSpan+=l.maxY-l.minY}}var s=i.sort(r,(function(r,t){var o=r.controller.getUserPerceivedFrame(),n=t.controller.getUserPerceivedFrame();if(null!=o&&null!=n)switch(e){case 0:case 1:case 2:case 3:case 8:return o.minX<n.minX;case 4:case 5:case 6:case 7:case 9:return o.minY<n.minY}return!1}));t.firstForma=i.first(s),t.lastForma=i.last(s);for(var c=i.iter(s);!c.done;c.next()){var d=c.value,g=d.controller.getUserPerceivedFrame(),f=t.firstForma.controller.getUserPerceivedFrame(),F=t.lastForma.controller.getUserPerceivedFrame();switch(e){case 0:case 1:case 2:case 3:case 8:n.isVeryClose(f.minX,g.minX)&&g.width>f.width&&(t.firstForma=d),(g.maxX>F.maxX||n.isVeryClose(g.maxX,F.maxX)&&g.width>F.width)&&(t.lastForma=d);break;case 4:case 5:case 6:case 7:case 9:n.isVeryClose(f.minY,g.minY)&&g.height>f.height&&(t.firstForma=d),(g.maxY>F.maxY||n.isVeryClose(g.maxY,F.maxY)&&g.height>F.height)&&(t.lastForma=d)}}return i.remove(s,t.firstForma),i.eq(m._equality_Forma_Forma,t.firstForma,t.lastForma)||i.remove(s,t.lastForma),t.interiorFormaeSortedByPosition=i.clone(s),t},distributeOrArrangeFormae:function(e,r){var t=n.calculateFormaGeometryInfo(e,i.clone(r));u.CoreAssert.isTrue(null!=t.firstForma,"expected to have a firstForma computed","AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",194),u.CoreAssert.isTrue(null!=t.lastForma,"expected to have a lastForma computed","AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",195),u.CoreAssert.isTrue(t.getNumFormae()==r.length,"expected sorted formae to match formae list","AlignmentFacade.distributeOrArrangeFormae","AlignmentFacade.swift",196),e==a.DistributeType.Row||e==a.DistributeType.Column||e==a.DistributeType.VerticalSpace||e==a.DistributeType.HorizontalSpace?n.distributeSpaceOrMakeRowColumn(t,e):n.distributeEdges(t,e)},distributeEdges:function(e,r){u.CoreAssert.isTrue(e.getNumFormae()>=3,"expected at least 3 items to distribute","AlignmentFacade.distributeEdges","AlignmentFacade.swift",206),u.CoreAssert.isTrue(r==a.DistributeType.LeftEdge||r==a.DistributeType.CenterX||r==a.DistributeType.RightEdge||r==a.DistributeType.TopEdge||r==a.DistributeType.CenterY||r==a.DistributeType.BottomEdge,"unexpected distribute type","AlignmentFacade.distributeEdges","AlignmentFacade.swift",207);var t=0,o=0,n=e.firstForma.controller.getUserPerceivedFrame(),l=e.lastForma.controller.getUserPerceivedFrame();switch(u.CoreAssert.isTrue(null!=n&&null!=l,"expecting formae to have frames","AlignmentFacade.distributeEdges","AlignmentFacade.swift",214),r){case 1:t=n.minX,o=l.minX;break;case 5:t=n.minY,o=l.minY;break;case 3:t=n.maxX,o=l.maxX;break;case 7:t=n.maxY,o=l.maxY;break;case 2:t=(n.maxX+n.minX)/2,o=(l.maxX+l.minX)/2;break;case 6:t=(n.maxY+n.minY)/2,o=(l.maxY+l.minY)/2;break;default:u.CoreAssert.isTrue(!1,"unexpected distribute type","AlignmentFacade.distributeEdges","AlignmentFacade.swift",235)}for(var s=(o-t)/i.toDouble(e.getNumFormae()-1),c=t+s,d=i.iter(e.interiorFormaeSortedByPosition);!d.done;d.next()){var m=d.value,g=m.controller.getUserPerceivedFrame();if(null!=g){var p=0,F=0;switch(r){case 1:p=c-g.minX,c=g.minX+p+s;break;case 3:p=c-g.maxX,c=g.maxX+p+s;break;case 5:F=c-g.minY,c=g.minY+F+s;break;case 7:F=c-g.maxY,c=g.maxY+F+s;break;case 2:var C=(g.maxX+g.minX)/2;c=C+(p=c-C)+s;break;case 6:var v=(g.maxY+g.minY)/2;c=v+(F=c-v)+s;break;default:u.CoreAssert.isTrue(!1,"unexpected distribute type","AlignmentFacade.distributeEdges","AlignmentFacade.swift",275)}if(0!=p||0!=F){var h=new f.Matrix2D(1,0,0,1,p,F);i.opt(m.controller,(function(e){return e.move(h)}))}}}},isVeryClose:function(e,r){return p.MathUtils.absDouble(e-r)<1e-4},getRequiredShiftAmount:function(e,r,t){var o=0;if(t==a.DistributeType.Row||t==a.DistributeType.Column){var n,l,s=e.totalObjectSpan+r*i.toDouble(e.getNumFormae()-1),u=e.firstForma.controller.getUserPerceivedFrame();t==a.DistributeType.Row?(n=u.minX+s,l=e.firstForma.page.pageSize.width):(n=u.minY+s,l=e.firstForma.page.pageSize.height),n>l&&(o=s>l?t==a.DistributeType.Row?-1*u.minX:-1*u.minY:l-n)}return o},getFormaSpacingForRowCol:function(e,r){var t=e.totalObjectSpan/(10*i.toDouble(e.getNumFormae())),o=e.totalObjectSpan/(5*i.toDouble(e.getNumFormae())),a=e.totalObjectSpan/(2*i.toDouble(e.getNumFormae()));return r<0?0:n.isVeryClose(r,t)?o:n.isVeryClose(r,o)?a:n.isVeryClose(r,a)?0:t},distributeSpaceOrMakeRowColumn:function(e,r){var t,o;u.CoreAssert.isTrue(r==a.DistributeType.Row||r==a.DistributeType.Column||r==a.DistributeType.VerticalSpace||r==a.DistributeType.HorizontalSpace,"wrong distribute type","AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",358);var l,s=(e.maxEdge-e.minEdge-e.totalObjectSpan)/i.toDouble(e.getNumFormae()-1),c=e.interiorFormaeSortedByPosition.concat();r!=a.DistributeType.Row&&r!=a.DistributeType.Column||(c.push(e.lastForma),s=n.getFormaSpacingForRowCol(e,s)),l=r==a.DistributeType.Row||r==a.DistributeType.HorizontalSpace?((t=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxX})))||null!=t?t:0)+s:((o=i.opt(e.firstForma.controller.getUserPerceivedFrame(),(function(e){return e.maxY})))||null!=o?o:0)+s;var d=n.getRequiredShiftAmount(e,s,r);0!=d&&c.splice(0,0,e.firstForma);for(var g=i.iter(c);!g.done;g.next()){var p=g.value,F=p.controller.getUserPerceivedFrame();if(null!=F){var C=0,v=0;if(i.eq(m._equality_Forma_Forma,p,e.firstForma)&&!i.eq(m._equality_Forma_Forma,p,e.lastForma)?(u.CoreAssert.isTrue(0!=d,"shouldn't be moving first element","AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",399),r==a.DistributeType.Row?(C=d,l=F.maxX+C+s):(u.CoreAssert.isTrue(r==a.DistributeType.Column,"Shouldn't have a shift unless we're doing Row or Column layout","AlignmentFacade.distributeSpaceOrMakeRowColumn","AlignmentFacade.swift",405),v=d,l=F.maxY+v+s)):r==a.DistributeType.Row||r==a.DistributeType.HorizontalSpace?(C=l-F.minX,l=F.maxX+C+s):(v=l-F.minY,l=F.maxY+v+s),0!=C||0!=v){var h=new f.Matrix2D(1,0,0,1,C,v);i.opt(p.controller,(function(e){return e.move(h)}))}}}},alignCenters:function(e,r){u.CoreAssert.isTrue(e==s.AlignmentType.CenterX||e==s.AlignmentType.CenterY,void 0,"AlignmentFacade.alignCenters","AlignmentFacade.swift",435);for(var t=99999999.9,o=-99999999.9,n=i.iter(r);!n.done;n.next())null!=(d=(c=n.value).controller.getUserPerceivedFrame())&&(e==s.AlignmentType.CenterX?(t=p.MathUtils.minDouble(t,d.minX),o=p.MathUtils.maxDouble(o,d.maxX)):(t=p.MathUtils.minDouble(t,d.minY),o=p.MathUtils.maxDouble(o,d.maxY)));for(var a=(t+o)/2,l=i.iter(r);!l.done;l.next()){var c,d;if(null!=(d=(c=l.value).controller.getUserPerceivedFrame())){var m=0,g=0;if(e==s.AlignmentType.CenterX?m=a-(d.minX+d.maxX)/2:g=a-(d.minY+d.maxY)/2,0!=m||0!=g){var F=new f.Matrix2D(1,0,0,1,m,g);i.opt(c.controller,(function(e){return e.move(F)}))}}}},alignEdges:function(e,r){var t=99999999.9;e!=s.AlignmentType.Right&&e!=s.AlignmentType.Bottom||(t*=-1);for(var o=i.iter(r);!o.done;o.next())null!=(l=(a=o.value).controller.getUserPerceivedFrame())&&(e==s.AlignmentType.Left?t=p.MathUtils.minDouble(t,l.minX):e==s.AlignmentType.Right?t=p.MathUtils.maxDouble(t,l.maxX):e==s.AlignmentType.Top?t=p.MathUtils.minDouble(t,l.minY):e==s.AlignmentType.Bottom?t=p.MathUtils.maxDouble(t,l.maxY):u.CoreAssert.isTrue(!1,"align to type "+e+" not yet implemented","AlignmentFacade.alignEdges","AlignmentFacade.swift",498));for(var n=i.iter(r);!n.done;n.next()){var a,l;if(null!=(l=(a=n.value).controller.getUserPerceivedFrame())){var c=0,d=0;if(e==s.AlignmentType.Left?c=t-l.minX:e==s.AlignmentType.Right?c=t-l.maxX:e==s.AlignmentType.Top?d=t-l.minY:e==s.AlignmentType.Bottom&&(d=t-l.maxY),0!=c||0!=d){var m=new f.Matrix2D(1,0,0,1,c,d);i.opt(a.controller,(function(e){return e.move(m)}))}}}}}}),n)},V3yt:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("yGNn"),l=t("iCxV");n.FontFacade=(o=function(){},a.defineClass({name:"FontFacade",ctor:o,statics:{ensureFontLoaded:function(e){switch(e.availability){case 1:var r;return(r=l.Host.fontProvider)?new i.CorePromise((function(t,o){return r.loadFont(e,(function(){return t(e)}),(function(){return o("could not load font")}))})):i.CorePromise.reject("Host.fontProvider not available; can't load font.");case 2:return i.CorePromise.resolve(e);case 3:return i.CorePromise.reject("font cannot be loaded");case 0:return i.CorePromise.reject("font unknown loadable")}}}}),o)},X0GW:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("SpAV"),l=t("gXiO"),s=t("yGNn"),u=t("FNB+"),c=t("ZK0l"),d=t("pnSN"),m=t("6Rk9"),g=t("iCxV"),f=t("MYNe"),p=t("tGKA"),F=t("JFv5"),C=t("sIWg");n.GroupFacade=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"GroupFacade",ctor:o,superName:"CoreObject",statics:{groupItems:function(e){return 0==e.length?s.CorePromise.resolve([]):(r=o.createGroupFromFormae(a.clone(e)))?(r.intent=u.Forma.INTENT_USER_GROUP,s.CorePromise.resolve(r)):s.CorePromise.reject("couldn't create a group");var r},updateUserGroupBounds:function(e){i.CoreAssert.isTrue(e.controller.userGroup,void 0,"GroupFacade.updateUserGroupBounds","GroupFacade.swift",33);var r=a.clone(e.childrenAsArray);if(r.length>0){for(var t={},o=m.GeometryFacade.unionFrame(a.clone(r)),n=a.iter(r);!n.done;n.next())t[(d=n.value).formaID]=d.finalFrame,e.root.appendChild(d,!0);var l=e.placement.calculateTransformValuesSKRT(),s=p.Matrix2D.rotation(l.rotCosine,l.rotSine).transformPoint(o.origin);e.bounds=C.TheoRect.fromSize(o.size),e.placement=e.placement.translateXY(s.x,s.y);for(var u=a.iter(r);!u.done;u.next()){var c,d=u.value;e.appendChild(d,!0),(c=d.finalFrame)&&(t[d.formaID].equalWithAccuracy(c,.001)||g.Host.logging.warning("error. a child's position changed in updateUserGroupBounds."))}}},updateUserGroupHierarchy:function(e){for(var r,t=e;((r=a.opt(a.opt(t,(function(e){return e.controller})),(function(e){return e.userGroup})))||null!=r)&&r;)o.updateUserGroupBounds(t),t=a.opt(t,(function(e){return e.parent}))},createGroupFromFormae:function(e){var r;if(0==e.length)return null;var t,o,n=m.GeometryFacade.unionFrame(a.clone(e)),i=e.concat(),l=a.as(a.opt(a.first(e),(function(e){return e.page.createFormaWithController(d.GroupForma.KIND,c.GroupController.KIND)})),d.GroupForma);if((t=l)&&(o=n)){a.opt(a.opt(a.first(e),(function(e){return e.parent})),(function(e){return e.appendChild(t)})),t.intent=u.Forma.INTENT_USER_GROUP,t.placement=p.Matrix2D.translationXY(o.minX,o.minY),t.bounds=C.TheoRect.fromSize(o.size);var s=t.controller;s.preferredResizeType=F.ResizeLayoutType.Proportional,s.preserveResizeController=!0;for(var g=0,v=a.iter(i);!v.done;v.next()){var h=v.value;g=Math.max(g,(r=a.opt(h.parent,(function(e){return e.indexOfChild(h)})))||null!=r?r:0)}a.opt(t.parent,(function(e){return e.insertChildAt(t,g,!0)}));for(var y=a.iter(f.LayerFacade.sortInZOrder(a.clone(i)));!y.done;y.next())h=y.value,t.appendChild(h,!0);return t}return null},cleanupGroup:function(e){for(var r,t=a.iter(e.childrenAsArray);!t.done;t.next()){var o=t.value,n=(r=a.opt(e.parent,(function(r){return r.indexOfChild(e)})))||null!=r?r:e.childCount;a.opt(e.parent,(function(e){return e.insertChildAt(o,n,!0)}))}e.removeFromParent()},ungroupItems:function(e){var r,t;if(0==e.length)return s.CorePromise.resolve([]);for(var n=[],i=[],l=[],u=!1,c=a.iter(e);!c.done;c.next()){var d,m=c.value;((r=a.opt(m.controller,(function(e){return e.userGroup})))||null!=r)&&r?(a.append(n,m.childrenAsArray),a.append(l,m.childrenAsArray)):(f=m.controller)&&(d=f.userGroupRoot)&&(u=!0,n.push(m),a.append(l,d.childrenAsArray))}for(var g=a.iter(l);!g.done;g.next()){var f,p,F,C;if((f=(m=g.value).controller)&&(p=m.parent)&&(F=a.opt(m.parent,(function(e){return e.parent})))&&null!=(C=F.indexOfChild(p))&&f.userGroupChild)if(F.insertChildAt(m,C,!0),p.childCount<=1){for(var v=a.iter(p.childrenAsArray);!v.done;v.next()){var h=v.value,y=(t=F.indexOfChild(p))||null!=t?t:F.childCount;F.insertChildAt(h,y,!0),u||n.push(h)}p.removeFromParent()}else i.includes(p)||i.push(p)}for(var I=a.iter(i);!I.done;I.next()){var T=I.value;o.updateUserGroupBounds(T)}return s.CorePromise.resolve(a.clone(n))},getGroupDepth:function(e){var r,t=0;return e.visit(u.FormaTraversal.PreOrder,(function(e,o,n){return((r=a.opt(e.controller,(function(e){return e.userGroupChild})))||null!=r)&&r&&(t=Math.max(t,o)),!1})),t}}}),o)},cYKp:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("gXiO");n.AnimationFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"AnimationFacade",ctor:o,superName:"CoreObject",statics:{applyAnimationStyle:function(e,r){r.animationLibrary.modifyModelForAnimation(e,r.root)},shuffleAnimationStyle:function(e,r){return r.animationLibrary.getNextAnimationStyleOfSameType(e)}}}),o)},"gBh/":function(e,r,t){var o,n=r,a=t("oAGj"),i=t("gXiO");n.ColorThemeFacade=(o=function(){i.CoreObject.call(this)},a.defineClass({name:"ColorThemeFacade",ctor:o,superName:"CoreObject",statics:{applyColorTheme:function(e,r,t){t.colorLibraryController.applyColorTheme(a.clone(e),r,!0)},shuffleColorTheme:function(e){e.colorLibraryController.shuffleColorAssignments()},modifyColorTheme:function(e,r,t){t.colorLibraryController.setTheoColorToLibrary(e,r)}}}),o)},gpZI:function(e,r,t){var o,n,a=r,i=t("oAGj"),l=t("SpAV"),s=t("gXiO"),u=t("ascj"),c=t("6ZWm"),d=t("cmoc"),m=t("lmwz"),g=t("c+uM"),f=t("T6jX"),p=t("8t9B");a.SavedColorState=(o=function(e,r,t,o){this.formae=i.clone(e),this.colorLibraryState=r,this.primaryColorIDs=i.clone(t),this.secondaryColorIDs=i.clone(o)},i.defineClass({name:"SavedColorState",ctor:o,superName:"CoreObject"}),o),a.ColorFacade=(n=function(){s.CoreObject.call(this)},i.defineClass({name:"ColorFacade",ctor:n,superName:"CoreObject",statics:{applyColorsToForma:function(e,r,t,o){void 0===t&&(t=!1),void 0===o&&(o=0);var a,l,s=o%2==0?u.ColorRole.FieldPrimary:u.ColorRole.FieldSecondary;if(e.isTypeLockup())return(a=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))&&(t&&i.opt(i.opt(e.page.document,(function(e){return e.controller})),(function(e){return e.selection.inCharStyleMode=!0})),n.getDominantColorRoleOfLockup(e)==u.ColorRole.FieldSecondary&&(s=s==u.ColorRole.FieldPrimary?u.ColorRole.FieldSecondary:u.ColorRole.FieldPrimary),a.applyColors(i.clone(r),s)),e;if(e instanceof d.FrameForma){if(l=f.TheoDocumentUtils.getCellBackgroundShape(e))i.opt(l.controller,(function(e){return e.applyColors(i.clone(r),s)}));else if(null!=i.as(e.controller,c.FrameController))return m.ImageFacade.replaceImageWithColors(e,i.clone(r))}else i.opt(e.controller,(function(e){return e.applyColors(i.clone(r),s)}));return e},applyColorsToFormae:function(e,r,t,o){return void 0===t&&(t=!1),void 0===o&&(o=0),e.map((function(e){return n.applyColorsToForma(e,i.clone(r),t,o)}),this)},applyNoneColorToFormae:function(e,r){return void 0===r&&(r=u.ColorRole.FieldPrimary),e.map((function(e){return l.CoreAssert.isTrue(e.kind==d.FrameForma.KIND,"Only frame forma can have primary color as nil","ColorFacade.applyNoneColorToFormae","ColorFacade.swift",83),e.style.colors.setColor(r,null),e}),this)},getDominantColorRoleOfLockup:function(e){var r;if(e.isTypeLockup()&&(r=i.opt(i.as(e.controller,p.TypeLockupController),(function(e){return e.styleController})))){var t=r.targetedLockupStyle;return t.textLook==g.LockupTextLook.KnockoutOnly||t.textLook==g.LockupTextLook.OutlineOnly?u.ColorRole.FieldSecondary:u.ColorRole.FieldPrimary}return u.ColorRole.FieldPrimary},getSavedColorState:function(e){var r,t;l.CoreAssert.isTrue(e.length>0,"empty Forma array","ColorFacade.getSavedColorState","ColorFacade.swift",106);var o=e[0].page.colorLibraryController.recordUndoState(),n=e.map((function(e){return(r=e.style.colors.colorID(u.ColorRole.FieldPrimary))||null!=r?r:""}),this),s=e.map((function(e){return(t=e.style.colors.colorID(u.ColorRole.FieldSecondary))||null!=t?t:""}),this);return new a.SavedColorState(i.clone(e),o,i.clone(n),i.clone(s))}}}),n)},kYI4:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("0wFF"),l=t("SpAV"),s=t("CWW7"),u=t("gXiO"),c=t("yGNn"),d=t("ascj"),m=t("QgZx"),g=t("ZK0l"),f=t("iCxV"),p=t("3lr5"),F=t("q5zr"),C=t("fdtz"),v=t("c+uM"),h=t("VkKB"),y=t("umUn"),I=t("VJ9E"),T=t("8t9B");n.AUTHORING_CONTEXT_TYPE_LOGO="LOGO",n.AUTHORING_CONTEXT_TYPE_FONT="FONT",n.AUTHORING_CONTEXT_TYPE_COLOR="COLOR",n.SPARK_LOGO_ROLE_PRIMARY="primary-logo",n.SPARK_LOGO_ROLE_SECONDARY="secondary-logo",n.SPARK_LOGO_ROLE_POST_STAMP="post-stamp",n.IAuthoringContextManager=a.defineProtocol("IAuthoringContextManager",{authoringContexts:"Array<IAuthoringContext>",authoringContext:"(String) -> IAuthoringContext",getOwnedAuthoringContextIDs:"() -> Array<String>",createAuthoringContext:"(String, Boolean) -> IAuthoringContext"}),n.IAuthoringContext=a.defineProtocol("IAuthoringContext",{id:"String",name:"String",activated:"Boolean",isDefault:"Boolean",contextID:"String",colors:"Array<IAuthoringContextColor>",fonts:"Array<IAuthoringContextFont>",logos:"Array<IAuthoringContextLogo>",isMinimal:"Boolean",isValidVersion:"Boolean",ownedByCurrentUser:"Boolean",isBrandkitComplete:"() -> Boolean"}),n.IAuthoringContextColor=a.defineProtocol("IAuthoringContextColor",{id:"String",acRoles:"Array<String>",red:"Double",green:"Double",blue:"Double",alpha:"Double"}),n.IAuthoringContextFont=a.defineProtocol("IAuthoringContextFont",{id:"String",acRoles:"Array<String>",sourceType:"String",descriptor:"FontDescriptor"}),n.IAuthoringContextLogo=a.defineProtocol("IAuthoringContextLogo",{id:"String",acRoles:"Array<String>",acName:"String",url:"String",pixelWidth:"Integer",pixelHeight:"Integer",mimeType:"String"}),n.BrandingFacade=(o=function(){u.CoreObject.call(this)},a.defineClass({name:"BrandingFacade",ctor:o,superName:"CoreObject",statics:{brandifyDocument:function(e,r,t,n,a){return void 0===t&&(t=!0),void 0===n&&(n=!0),void 0===a&&(a=!0),l.CoreAssert.isTrue(""!=r.id,void 0,"BrandingFacade.brandifyDocument","BrandingFacade.swift",120),o.addBrandLogo(e,r,n).then((function(n){return a&&o.brandifyColors(e,r),t&&o.brandifyFonts(e,r),null}))},addBrandLogo:function(e,r,t){void 0===t&&(t=!0);var i=c.CorePromise.resolve(null);if(t){var l,u=r.logos.filter((function(e){return!a.isEmpty(e.url)&&e.acRoles.includes(n.SPARK_LOGO_ROLE_POST_STAMP)}),this);if((l=a.first(u))&&null==a.first(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})))){var d=o.makeLogoContentNode(l,e);i=i.then((function(r){return s.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new s.AddFormaParams(void 0,void 0,null))}))}}return i},brandifyColors:function(e,r,t){void 0===t&&(t=!1),o.updateBrandedColorPalette(e,r,t)},updateBrandedColorPalette:function(e,r,t){for(var o=0,n=0,i=a.clone(e.firstPage.colorLibraryController.getTheoColorsUsedInDocument()),s=a.iter(i);!s.done;s.next()){var u=s.value;u.isBrandkitSecondaryColor()&&(n+=1),u.isBrandkitShade()&&(o+=1)}for(var c=n>0&&n>=o,m=[],g=a.iter(r.colors);!g.done;g.next()){var f=g.value,p=y.TheoColor.init_bb45(f);(c&&(p.isBrandkitSecondaryColor()||p.isBrandkitPrimaryColor())||!c&&p.isBrandkitShade())&&m.push(p)}if(m.length>0){var F;if(t)if(null!=(h=e.firstPage.root.controller.getGridController())){l.CoreAssert.isTrue(h.gridStyle.gridCells.length>=1,"expecting to have a grid with at least one cell","BrandingFacade.updateBrandedColorPalette","BrandingFacade.swift",216);var C=h.forma.childAt(0).style.colors.colorID(d.ColorRole.FieldPrimary);null!=C&&(F=e.firstPage.colorLibraryController.getTheoColorForKey(C))}else{var v=e.firstPage.root.style.colors.colorID(d.ColorRole.FieldPrimary);null!=v&&(F=e.firstPage.colorLibraryController.getTheoColorForKey(v))}if(e.firstPage.colorLibraryController.applyColorTheme(a.clone(m),"brandkit"),t){if(null!=F){var h,I=e.firstPage.colorLibraryController.getKeyOfColorInTheme(F);null==I&&(I=e.firstPage.colorLibraryController.addNewThemeKeyWithColor(F)),null!=(h=e.firstPage.root.controller.getGridController())?h.forma.childAt(0).style.colors.setColorId(d.ColorRole.FieldPrimary,I):e.firstPage.root.style.colors.setColorId(d.ColorRole.FieldPrimary,I)}}else e.firstPage.colorLibraryController.shuffleColorAssignments()}else a.info("addBranding asked to update color palette, but brandkit doesn't have any colors. Hope that's ok.")},brandifyFonts:function(e,r){var t=o.getTheoFontForRole(I.TheoFont.SPARK_FONT_ROLE_HEADLINE,r);if(null==t)if(r.fonts.length>0){var n,i=r.fonts[0];(n=o.getFontFromIncludedFonts(i.descriptor))?t=I.TheoFont.init_9e5c(n,i.id,a.clone(i.acRoles)):(a.info("addBranding asked to apply fonts, but brandkit doesn't have a headline font, so we're just picking some random font. Hope that's ok."),t=I.TheoFont.init_9e5c(f.Host.fontProvider.getIncludedFonts(e).fontAt(0)))}else a.info("addBranding asked to apply fonts, but brandkit doesn't have any fonts. Hope that's ok.");if(null!=t){for(var l=!1,s=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!s.done;s.next()){var u,c=s.value;(u=a.as(c.style,v.LockupStyle))&&(u.font=t,l=!0)}0==l&&a.info("addBranding asked to apply fonts, but document contains no text lockups, so we can't. Hope that's ok.")}},getTheoFontForRole:function(e,r){for(var t,n=a.iter(r.fonts);!n.done;n.next()){var i,l=n.value;if(i=o.getFontFromIncludedFonts(l.descriptor)){var s=I.TheoFont.init_9e5c(i,l.id,a.clone(l.acRoles));if(s.getSparkFontRole()==e){t=s;break}}}return t},getFontFromIncludedFonts:function(e){if(null==e)return null;var r,t=f.Host.fontProvider.getIncludedFonts(p.ANY_DOCUMENT);return null!=(r=t.indexOf(e))?t.fontAt(r):null},changeBranding:function(e,r){return c.CorePromise.resolve(null).then((function(t){return null==r?""==e.authoringContextID?null:o.removeBranding(e):e.authoringContextID==r.id?null:""==e.authoringContextID?(a.opt(f.Host.brandkitManager,(function(e){return e.activateBrand(r.id)})),null):o.addBranding(e,r)}))},addBranding:function(e,r){return l.CoreAssert.isTrue(""!=r.id,void 0,"BrandingFacade.addBranding","BrandingFacade.swift",408),o.applyLogoForAddBranding(e,r).then((function(t){return a.opt(f.Host.fontProvider,(function(e){return e.registerBrandFonts(r.id)})),o.applyBrandFontsForAddBranding(e,r),o.applyColorsForAddBranding(e,r),a.opt(f.Host.brandkitManager,(function(e){return e.activateBrand(r.id)})),e.authoringContextID=r.id,null}))},applyLogoForAddBranding:function(e,r){for(var t=[],n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!n.done;n.next()){var i=n.value;t.push(i)}for(var l=c.CorePromise.resolve(null),u=a.iter(t);!u.done;u.next()){var d=u.value,m=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode),g=o.getReplacementLogoContentNode(e,r,m.getSparkLogoRole());null!=g&&(l=l.then((function(r){return s.CreationFacade.addContent(e.firstPage,g,void 0,void 0,new s.AddFormaParams(void 0,void 0,d.parent))})))}return l},applyColorsForAddBranding:function(e,r){for(var t=[],o=a.iter(r.colors);!o.done;o.next()){var n=o.value;t.push(y.TheoColor.init_bb45(n))}t.length>0&&e.firstPage.colorLibraryController.updateSparkColorsByRole(a.clone(t))},applyBrandFontsForAddBranding:function(e,r){for(var t,o=[],n=a.iter(r.fonts);!n.done;n.next()){var i=n.value,l=I.TheoFont.init_a314(i);o.push(l),l.getSparkFontRole()==I.TheoFont.SPARK_FONT_ROLE_BODY&&(t=l)}for(var s=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!s.done;s.next()){var u,c=s.value;if(u=a.as(c.style,v.LockupStyle)){var d;if((d=u.font)&&d.isSparkFont()){for(var m,g=t,f=a.iter(o);!f.done;f.next())if(i=f.value,d.getSparkFontRole()==i.getSparkFontRole()){g=i;break}(m=g)&&(u.font=m)}for(var p=a.iter(u.characterStyles);!p.done;p.next()){var F,C=p.value;if((F=C.font)&&F.isSparkFont()){g=t;for(var h=a.iter(o);!h.done;h.next())if(i=h.value,F.getSparkFontRole()==i.getSparkFontRole()){g=i;break}null!=g&&(C.font=g)}}}}},getReplacementLogoContentNode:function(e,r,t){for(var i,l=a.iter(r.logos);!l.done;l.next())for(var s=l.value,u=a.iter(s.acRoles);!u.done;u.next()){var c=u.value;if(c==t)return o.makeLogoContentNode(s,e);c==n.SPARK_LOGO_ROLE_PRIMARY&&(i=s)}return null!=i?o.makeLogoContentNode(i,e):null},removeBranding:function(e){return o.removeAllBrandkitFontsAndLogos(e),e.authoringContextID="",c.CorePromise.resolve(null)},removeAllBrandkitFontsAndLogos:function(e){var r;if(r=e.controller)for(var t=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()||e.isLogo()})));!t.done;t.next()){var n=t.value;if(n.isTypeLockup()){var i,s;if((i=a.as(n.style,v.LockupStyle))&&(s=i.font)&&s.isSparkFont()){var u=o.getNonBKFontForRemapping(s);a.info("Replacing brandkit font "+s.fontData.postScriptName+" with non-BK font "+u.postScriptName),i.font=I.TheoFont.init_9e5c(u)}}else{var c;r.selection.deselectForma(n),(c=n.parent)&&a.opt(a.as(c.controller,g.GroupController),(function(e){return e.removeFormaFromGroup(n)}));var d=n.controller.settings;null!=d&&d==r.controllerSettingsState.settings&&(r.controllerSettingsState.settings=null)}}else l.CoreAssert.fail("Document has no controller","BrandingFacade.removeAllBrandkitFontsAndLogos","BrandingFacade.swift",565)},getNonBKFontForRemapping:function(e){return e.fontData.source==m.FontSource.EMBEDDED?e.fontData:e.fontData.serif?e.fontData.blackness>=7?o.getFontWithPostscriptName("CantataOne-Regular"):e.fontData.italic?o.getFontWithPostscriptName("OldStandardTT-Italic"):o.getFontWithPostscriptName("Lora-Regular"):e.fontData.calligraphic?o.getFontWithPostscriptName("Yellowtail"):e.fontData.blackness>=7?o.getFontWithPostscriptName("SourceSansPro-Black"):e.fontData.italic?o.getFontWithPostscriptName("CallunaSans-Italic"):o.getFontWithPostscriptName("Raleway")},getFontWithPostscriptName:function(e){return f.Host.fontProvider.descriptorForPostScriptName(e,p.ANY_DOCUMENT)},brandDocumentForElement:function(e,r,t){var o=f.Host.brandkitManager.brandkitForElement(r,t);l.CoreAssert.isTrue(null!=o,"Adding a branded "+t+", but can't find the brandkit it belongs to","BrandingFacade.brandDocumentForElement","BrandingFacade.swift",612),a.opt(f.Host.logging,(function(e){return e.logToAnalytics(i.AnalyticsConstants.kAnalyticsDataBrandkitElementUsed,{elementType:t})})),null!=o&&(""==e.authoringContextID?(a.info("** Branding document, because it now contains a branded element of type "+t),a.opt(f.Host.logging,(function(r){return r.logToAnalytics(i.AnalyticsConstants.kAnalyticsEventAddedBrandingToProject,{projectID:e.uuid})}))):e.authoringContextID!=o.id&&a.info("** Re-Branding document, because it was branded (for a different brand) and now contains a branded element of type "+t),e.authoringContextID=o.id)},unBrandDocumentIfNoBrandedElements:function(e){""!=e.authoringContextID&&(o.doesDocumentContainBrandedElements(e,!1)||(e.authoringContextID="",a.info("** Unbranding document, because it no longer contains any branded elements")))},isDocumentBranded:function(e,r){return""!=e.authoringContextID&&(!r||o.getDocumentBrandedElementsUsage(e,!0).length>0)},kBrandUsageColor:"color",kBrandUsageFont:"font",kBrandUsageCustomFont:"customFont",kBrandUsageLogo:"logo",getDocumentBrandedElementsUsage:function(e,r,t){void 0===t&&(t=!0);var n=!1,i=!1,l=!1,s=!1,u=[];if(!r&&e.firstPage.colorLibraryController.areAnySparkColorsInUse()&&(u.push(o.kBrandUsageColor),n=!0,1==t))return u;for(var c=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()||e.isTypeLockup()})));!c.done;c.next()){var d=c.value;if(d.isTypeLockup())!i&&o.doesLockupUseBrandedFonts(d)&&(u.push(o.kBrandUsageFont),i=!0),!l&&o.doesLockupUseCustomFonts(d)&&(u.push(o.kBrandUsageCustomFont),l=!0);else if(!s&&d.isLogo()&&null!=d.contentID){var m;(m=a.as(e.content.nodeByID(d.contentID),F.ImageContentNode))&&null!=m.sparkElementID&&""!=m.sparkElementID&&(u.push(o.kBrandUsageLogo),s=!0)}if(t&&(n||i||l||s))return u;if(n&&i&&l&&s)break}return u},doesDocumentContainBrandedElements:function(e,r){return o.getDocumentBrandedElementsUsage(e,r).length>0},areSparkFontsInUse:function(e,r){if(0==r.length)return!1;for(var t=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!t.done;t.next()){var o,n=t.value;if(o=a.as(n.style,v.LockupStyle)){var i;if((i=o.font)&&null!=i.sparkElementID&&i.sparkElementID.length>0&&r.includes(i.sparkElementID))return!0;for(var l=a.iter(o.characterStyles);!l.done;l.next()){var s;if((s=l.value.font)&&null!=s.sparkElementID&&s.sparkElementID.length>0&&r.includes(s.sparkElementID))return!0}}}return!1},updateSparkFont:function(e,r){for(var t=!1,o=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!o.done;o.next()){var n,i=o.value;if(n=a.as(i.style,v.LockupStyle)){var s;if(s=n.font){var u=s.sparkElementID;null!=u&&u.length>0&&u==r.id&&(t=!0,n.font=I.TheoFont.init_a314(r))}for(var c=a.iter(n.characterStyles);!c.done;c.next()){var d=c.value;null!=d.font&&null!=d.font.sparkElementID&&d.font.sparkElementID.length>0&&d.font.sparkElementID==r.id&&(t=!0,d.font=I.TheoFont.init_a314(r))}}}l.CoreAssert.isTrue(t,"asked to update spark font which isn't currently used.","BrandingFacade.updateSparkFont","BrandingFacade.swift",834)},relinkSparkFont:function(e,r,t){for(var o=!1,n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isTypeLockup()})));!n.done;n.next()){var i,s=n.value;if(i=a.as(s.style,v.LockupStyle)){var u;if(u=i.font){var c=u.sparkElementID;null!=c&&c.length>0&&c==r&&(o=!0,i.font=I.TheoFont.init_a314(t))}for(var d=a.iter(i.characterStyles);!d.done;d.next()){var m=d.value;null!=m.font&&null!=m.font.sparkElementID&&m.font.sparkElementID.length>0&&m.font.sparkElementID==r&&(o=!0,m.font=I.TheoFont.init_a314(t))}}}l.CoreAssert.isTrue(o,"asked to relink spark font which isn't currently used.","BrandingFacade.relinkSparkFont","BrandingFacade.swift",873)},doesLockupUseBrandedFonts:function(e){var r;if(r=a.as(e.style,v.LockupStyle)){var t;if((t=r.font)&&null!=t.sparkElementID&&t.sparkElementID.length>0)return!0;for(var o=a.iter(r.characterStyles);!o.done;o.next()){var n=o.value;if(null!=n.font&&null!=n.font.sparkElementID&&n.font.sparkElementID.length>0)return!0}}else l.CoreAssert.isTrue(!1,"doesLockupUseBrandedFonts called for something which is not a type lockup","BrandingFacade.doesLockupUseBrandedFonts","BrandingFacade.swift",906);return!1},doesLockupUseCustomFonts:function(e){var r;if(r=a.as(e.style,v.LockupStyle)){var t;if((t=r.font)&&t.fontData.source==m.FontSource.USER_UPLOAD)return!0;for(var o=a.iter(r.characterStyles);!o.done;o.next()){var n=o.value;if(null!=n.font&&n.font.fontData.source==m.FontSource.USER_UPLOAD)return!0}}else l.CoreAssert.isTrue(!1,"doesLockupUseCustomFonts called for something which is not a type lockup","BrandingFacade.doesLockupUseCustomFonts","BrandingFacade.swift",941);return!1},areSparkLogosInUse:function(e,r){if(0==r.length)return!1;for(var t=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!t.done;t.next()){var o,n=t.value;if((o=a.as(e.content.nodeByID(n.contentID),F.ImageContentNode))&&null!=o.sparkElementID&&""!=o.sparkElementID&&r.includes(o.sparkElementID))return!0}return!1},updateSparkLogo:function(e,r){for(var t=!1,n=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!n.done;n.next()){var i=n.value,u=a.as(e.content.nodeByID(i.contentID),F.ImageContentNode);if(a.opt(u,(function(e){return null!=e.sparkElementID&&a.opt(u,(function(e){return""!=e.sparkElementID}))&&r.id==a.opt(u,(function(e){return e.sparkElementID}))}))){t=!0;var c=o.makeLogoContentNode(r,e);s.CreationFacade.addContent(e.firstPage,c,void 0,void 0,new s.AddFormaParams(void 0,void 0,i.parent))}}l.CoreAssert.isTrue(t,"asked to update spark logo which isn't currently used.","BrandingFacade.updateSparkLogo","BrandingFacade.swift",993)},relinkSparkLogo:function(e,r,t){for(var n=!1,i=a.iter(e.firstPage.root.filterWithCallback((function(e){return e.isLogo()&&e.kind==C.ImageForma.KIND})));!i.done;i.next()){var u=i.value,c=a.as(e.content.nodeByID(u.contentID),F.ImageContentNode);if(a.opt(c,(function(e){return null!=e.sparkElementID&&a.opt(c,(function(e){return""!=e.sparkElementID}))&&r==a.opt(c,(function(e){return e.sparkElementID}))}))){n=!0;var d=o.makeLogoContentNode(t,e);s.CreationFacade.addContent(e.firstPage,d,void 0,void 0,new s.AddFormaParams(void 0,void 0,u.parent))}}l.CoreAssert.isTrue(n,"asked to relink spark logo which isn't currently used.","BrandingFacade.relinkSparkLogo","BrandingFacade.swift",1017)},isImageBrandedLogo:function(e){var r;return!(null==e.contentID||!(r=a.as(e.page.document.content.nodeByID(e.contentID),F.ImageContentNode))||!e.isLogo()||null==r.sparkElementID||""==r.sparkElementID)},makeLogoContentNode:function(e,r){var t=r.content.createNode(F.ImageContentNode.KIND,null);return t.url=e.url,t.pixelWidth=e.pixelWidth,t.pixelHeight=e.pixelHeight,t.mimeType=e.mimeType,t.setRoles(a.clone(e.acRoles)),t.sparkElementID=e.id,t.mediaMetadata=h.MediaMetadata.init_36a2(void 0,void 0,void 0,void 0,void 0,void 0,"brandkit",void 0,void 0,void 0,void 0,h.MediaMetadata.DESIGNINTENT_LOGO),t},areSparkColorsInUse:function(e,r){return 0!=r.length&&e.firstPage.colorLibraryController.areSparkColorsInUse(a.clone(r))},updateSparkColor:function(e,r){return e.firstPage.colorLibraryController.updateSparkColor(y.TheoColor.init_bb45(r))},getBrandkitColorsForUI:function(e,r){var t,o,n=!1,i=[];if((t=a.as(a.opt(r,(function(e){return e.controller})),T.TypeLockupController))&&t.styleController.isCurrentlyShowingMultipleColors()){n=!0;var l=t.lockupStyle.colors.theoColor(d.ColorRole.FieldPrimary),s=t.lockupStyle.colors.theoColor(d.ColorRole.FieldSecondary);null!=l&&l.isBrandkitColor()&&null!=s&&s.isBrandkitColor()&&(i=[l,s])}for(var u=[],c=a.iter(e.colors);!c.done;c.next()){var m=c.value,g=y.TheoColor.init_bb45(m);if(0==n)u.push([g]),g.isBrandkitPrimaryColor()&&(o=g,g.isBrandkitShade()&&u.push([y.TheoColor.init_bb45(m)]));else{var f=0,p="";if(g.isBrandkitPrimaryColor())o=g,f=5;else if(g.isBrandkitSecondaryColor())f=3;else if(g.isBrandkitShade()){f=1;var F=g.getBrandkitShadeRole();if(F.startsWith(y.SHADE_ROLE_PREFIX)){var C=F.substr(y.SHADE_ROLE_PREFIX.length),v=(a.toInt(C)+3)%7;p=y.SHADE_ROLE_PREFIX+a.toString(v)}}else f=1;for(var h=0,I=a.clone(a.shuffle(e.colors)),A=a.iter(I);!A.done;A.next()){var k=A.value,S=y.TheoColor.init_bb45(k);if((""==p&&Math.abs(g.rgbColor.lightness-S.rgbColor.lightness)>30||p==S.getBrandkitShadeRole())&&(u.push([g,S]),(h+=1)>=f))break}}}if(n&&i.length>0){for(var D=!1,b=a.iter(u);!b.done;b.next()){var P=b.value;if(P[0].sparkElementID==i[0].sparkElementID&&P[1].sparkElementID==i[1].sparkElementID){D=!0;break}}D||u.push(a.clone(i))}return a.sortInPlace(u,(function(e,r){var t=e[0],n=r[0];if(null!=o){if(t===o)return n!==o;if(n===o)return!1}if(t.isBrandkitSecondaryColor())return!n.isBrandkitSecondaryColor()||t.rgbColor.lightness<n.rgbColor.lightness;if(n.isBrandkitSecondaryColor())return!1;var a=t.getBrandkitShadeRole(),i=n.getBrandkitShadeRole();return null!=a?null==i||a<i:null==i&&t.rgbColor.lightness<n.rgbColor.lightness})),u},getTheoColorForSolidColor:function(e,r){if(null!=e)for(var t=a.iter(e.colors);!t.done;t.next()){var o=t.value,n=y.TheoColor.init_bb45(o);if(n.rgbColor.isEqual(r))return n}return y.TheoColor.init_5344(r,null,null)}}}),o)},lmwz:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("SpAV"),l=t("aO0D"),s=t("gpZI"),u=t("CWW7"),c=t("gXiO"),d=t("yGNn"),m=t("Bpjk"),g=t("ascj"),f=t("FNB+"),p=t("6ZWm"),F=t("cmoc"),C=t("JEzR"),v=t("P83h"),h=t("9Lk3"),y=t("4mVB"),I=t("iCxV"),T=t("xYeW"),A=t("kJ8p"),k=t("Qlvz"),S=t("U010"),D=t("q5zr"),b=t("fdtz"),P=t("uWOl"),N=t("tGKA"),M=t("uxH+"),E=t("K0Rh"),x=t("JO5d"),R=t("djAF"),w=t("35Q0"),_=t("fAXt"),L=t("8t9B"),B=t("oKlP"),O=t("sIWg"),G=t("zjod");n.ImageFacade=(o=function(){c.CoreObject.call(this)},a.defineClass({name:"ImageFacade",ctor:o,superName:"CoreObject",statics:{replaceImageWithColors:function(e,r){var t=e;if(e instanceof F.FrameForma||e instanceof b.ImageForma&&e.parent instanceof F.FrameForma){var o,n,i=a.as(e,F.FrameForma)||e.parent;(o=a.as(e.parent,E.RootForma))?(u.CreationFacade.deleteFormae([i],null),null!=r&&s.ColorFacade.applyColorsToForma(o,a.clone(r)),t=o):(t=i,(n=a.opt(a.as(i.controller,p.FrameController),(function(e){return e.replaceWithColoredShape()})))&&(null!=r?s.ColorFacade.applyColorsToForma(n,a.clone(r)):a.opt(n.controller,(function(e){return e.shuffleColorAssignment()})),t=n))}return t},replaceImagesWithColors:function(e,r){return e.map((function(e){return o.replaceImageWithColors(e,a.clone(r))}),this)},applyImageFilter:function(e,r,t){a.clone(t?o.getBackgroundImagesFromPage(e.document.firstPage):e.selection.asFormaArray()).forEach((function(e){var t;if(t=o.getImageFormaForForma(e)){r.adjustments=k.ImageAdjustments.createDefault();var n=t.style;r.adjustments=n.adjustments,o.applyImageStyle(r,[e])}}))},applyImageStyle:function(e,r){for(var t=a.iter(r);!t.done;t.next()){var n,i=t.value;(n=o.getImageFormaForForma(i))&&(a.opt(a.opt(n.root,(function(e){return e.animation})),(function(e){return e.invalidate()})),n.applyStyle(e))}},getImageStyleForForma:function(e){var r;return(r=o.getImageFormaForForma(e))?a.as(r.style,P.ImageStyle):null},isFrame:function(e){return e instanceof F.FrameForma},getImageContentForForma:function(e){var r;return(r=o.getImageFormaForForma(e))?r.contentNode:null},getImageFormaForForma:function(e){var r,t,o;if(r=a.as(e,b.ImageForma))return r;if(t=a.as(e,G.VideoForma))return t;if((o=a.as(e,F.FrameForma))&&o.childCount>0){for(var n=a.iter(o.childrenAsArray);!n.done;n.next()){var i,l=n.value;if(i=a.as(l,b.ImageForma))return i}return null}return null},getMaskFormaForFormaByIntent:function(e,r){var t;return(t=o.getFrameFormaForForma(e))?t.findAuxiliary((function(e){return e.hasIntent(r)})):a.opt(e,(function(e){return 1==e.hasIntent(r)}))?e:null},getMaskFormaForForma:function(e){return o.getMaskFormaForFormaByIntent(e,f.Forma.INTENT_IMAGE_MASK)},getCutoutMaskFormaForForma:function(e){return a.as(o.getMaskFormaForFormaByIntent(e,f.Forma.INTENT_CUTOUT_MASK),b.ImageForma)},setCutoutModeForForma:function(e,r){var t,n,i;if((t=o.getFrameFormaForForma(e))&&(n=o.getImageFormaForForma(e))&&(i=a.as(t.style,C.FrameStyle))){var l=new v.FormaCutoutChangedEvent(n);n.beginUpdate(l),i.cutoutMode=r,n.endUpdate(l)}},getCutoutModeForForma:function(e){var r,t;return(r=o.getFrameFormaForForma(e))&&(t=a.as(r.style,C.FrameStyle))?t.cutoutMode:S.CutoutMode.Off},getVideoFormaForForma:function(e){var r;return(r=a.as(e,F.FrameForma))&&r.childCount>0?a.as(r.childAt(0),G.VideoForma):a.as(e,G.VideoForma)},getFrameFormaForForma:function(e){var r,t;return(r=a.as(a.opt(e,(function(e){return e.parent})),F.FrameForma))?r:(t=a.as(e,b.ImageForma))?a.as(t.parent,F.FrameForma):a.as(e,F.FrameForma)},getBackgroundImagesFromPage:function(e){for(var r=[],t=a.iter(e.root.filterWithCallback((function(e){return e.kind==F.FrameForma.KIND&&e.isBackgroundImage()&&e.childCount>0})));!t.done;t.next()){var o=t.value;r.push(o.childAt(0))}return r},getCropRatioId:function(e){var r;return(r=o.getFrameFormaForForma(e))?r.cropRatioId:m.CropRatioPresetLibrary.FREEFORM_ID},setImageCropToFreeform:function(e){var r;if((r=o.getFrameFormaForForma(e))&&r.cropRatioId!=m.CropRatioPresetLibrary.FREEFORM_ID){var t=new v.FormaTransformChangedEvent(r);r.beginUpdate(t),r.cropRatioId=m.CropRatioPresetLibrary.FREEFORM_ID,r.endUpdate(t)}},usesFreeformCropPreset:function(e){return o.getCropRatioId(e)==m.CropRatioPresetLibrary.FREEFORM_ID},migrateImageRotationToFrame:function(e,r){var t,o,n=e.placement.transformValues;if((t=r.bounds)&&(o=r.parent)){var a=Math.atan2(n.rotSine,n.rotCosine);if(Math.abs(a)>.001){var i=N.Matrix2D.rotation(n.rotCosine,n.rotSine),l=N._asterisk_TheoPoint_Matrix2D(t.evalXY(.5,.5),r.totalPlacement),s=N._asterisk_Matrix2D_Matrix2D(N._asterisk_Matrix2D_Matrix2D(N.Matrix2D.translation(B._negate_TheoPoint(l)),i),N.Matrix2D.translation(l)),u=N._asterisk_Matrix2D_Matrix2D(N._asterisk_Matrix2D_Matrix2D(o.totalPlacement,s),o.totalPlacement.inverse);r.move(u),_.TransformFacade.rotateForma(e,-a),n=e.placement.transformValues}}return n},resetCrop:function(e){var r,t,n,l;if((r=o.getFrameFormaForForma(e))&&(t=a.as(r.controller,p.FrameController))&&(n=e.bounds)&&(l=e.page.root.bounds)){var s=l.insetXY(10,10),u=e.finalFrame||s,c=u.center,d=new v.FormaTransformChangedEvent(r);r.beginUpdate(d);for(var g=o.migrateImageRotationToFrame(e,r),f=g.xscale,F=g.yscale,C=!1,h=0;!C&&h<10;){var y=n.transform(N.Matrix2D.scalingXY(f,F)),I=O.TheoRect.fromSize(y.size);t.setBoundsWithCropType(I,p.CropType.FitBorder);var T=(u=e.finalFrame||s).center;if(t.move(N.Matrix2D.translation(B._minus_TheoPoint_TheoPoint(c,T))),0==e.totalPlacement.transformPoints(a.clone(n.points)).filter((function(e){return s.containsPoint(e)}),this).length){u=e.finalFrame||s;var A=s.intersectionWith(u)||s,k=Math.max(u.width/A.width,u.height/A.height);k=Math.max(k,1.05),0==h&&(c=A.center),f/=k,F/=k,h+=1}else C=!0}10==h&&i.CoreAssert.warning("resetCrop did not converge"),r.cropRatioId=m.CropRatioPresetLibrary.ORIGINAL_ID,r.endUpdate(d),t.updateCropModeImage()}},cropImageToRatio:function(e,r,t){var n,l,s,u,c;if(void 0===r&&(r=0),void 0===t&&(t=null),o.canCropImage(e)){if(o.removeMaskForForma(e),(l=o.getFrameFormaForForma(e))&&(s=o.getImageFormaForForma(e))&&(u=s.finalFrame)&&(c=s.bounds)){var d,g;r<=0?(g=c.aspectRatio,d=m.CropRatioPresetLibrary.ORIGINAL_ID):(g=r,d=(n=m.CropRatioPresetLibrary.getIdForRatio(r))||null!=n?n:m.CropRatioPresetLibrary.FREEFORM_ID);var f=l.controller,F=u.origin,C=new v.FormaTransformChangedEvent(l);l.beginUpdate(C);var h=t||l.bounds,y=O.TheoRect.fromSize(h.fitAspectRatioWithin(g)),I=f.isImageCropped()?p.CropType.PreserveFocusAndScale:p.CropType.FitBorder;f.setBoundsWithCropType(y,I);var T=a.opt(s.finalFrame,(function(e){return e.origin}))||B.TheoPoint.ZERO;f.move(N.Matrix2D.translation(B._minus_TheoPoint_TheoPoint(F,T))),l.cropRatioId=d,l.endUpdate(C),f.updateCropModeImage()}}else i.CoreAssert.warning("Asked to crop an image that can't be.")},inCropMode:function(e){return o.pageInCropMode(a.opt(e,(function(e){return e.page})))},pageInCropMode:function(e){var r;return null!=(r=a.opt(a.opt(a.opt(e,(function(e){return e.document})),(function(e){return e.controller})),(function(e){return e.selection.inCropMode})))&&r},enterCropMode:function(e){var r,t;return!(!(r=a.as(a.opt(e.parent,(function(e){return e.controller})),p.FrameController))||!(t=a.opt(e.controller,(function(e){return e.owner})))||(t.selection.inCropMode=!0,r.enterCropMode(),0))},exitCropMode:function(e){var r;if((o=a.as(a.opt(e.parent,(function(e){return e.controller})),p.FrameController))&&(r=a.opt(e.controller,(function(e){return e.owner})))&&(r.selection.inCropMode=!1,o.cleanupCropVisualization()),a.as(e.controller,M.RootController)&&(r=a.opt(e.controller,(function(e){return e.owner})))){r.selection.inCropMode=!1;for(var t=a.iter(e.filterByKind(F.FrameForma.KIND));!t.done;t.next()){var o,n=t.value;(o=a.as(n.controller,p.FrameController))&&o.cleanupCropVisualization()}}},getTempCropImageForForma:function(e){var r;if(r=a.opt(a.opt(e,(function(e){return e.parent})),(function(e){return e.visitAsArray(f.FormaTraversal.JustChildren)})))for(var t=a.iter(r);!t.done;t.next()){var o=t.value;if(o.hasIntent(f.Forma.INTENT_TEMP_IMAGE_CROP)&&o.kind==F.FrameForma.KIND)return o}return null},canSetBackgroundImage:function(e){var r,t;return!(!(r=a.as(e,F.FrameForma))||!(t=r.controller))&&e.isImage()&&!r.isLogo()&&t.floating&&!e.isSticker()&&!t.userGroupMember},canSetFloatingImage:function(e){var r,t;return!(!(r=e)||!(t=r.controller))&&r.isImage()&&!r.isLogo()&&!t.floating&&!r.isVideo()&&!t.userGroupMember},canApplyCutout:function(e){var r;return!!(r=e)&&r.isImage()&&!r.isLogo()&&!r.isVideo()&&!r.isSticker()},canApplyBackgroundColor:function(e){var r,t;return!(!(r=a.as(e,F.FrameForma))||!(t=a.as(r.controller,p.FrameController)))&&r.isImage()&&(t.isBackgroundImageWithAlpha()||t.hasCutout)},isPotentialBackgroundImage:function(e){var r;return!!(r=a.as(e,F.FrameForma))&&(!r.isLogo()&&!r.isSticker()&&!r.controller.userGroupMember||r.isBackgroundImage())},canCropImage:function(e){var r,t;return!(!(r=o.getFrameFormaForForma(e))||!(t=r.controller))&&!r.isLogo()&&t.floating&&!e.isSticker()},addHiddenImageToGrid:function(e){var r,t,n;(r=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),M.RootController),(function(e){return e.getGridController()})))&&(t=a.as(e,F.FrameForma))&&(n=o.getImageFormaForForma(t))&&(n.style.opacity=1,n.intent=f.Forma.INTENT_GRID_CELL,t.intent=f.Forma.INTENT_GRID_CELL,t.allowUserMove=!1,r.removeFormaFromGroup(t),r.addFormaToGroup(t))},setBackgroundImage:function(e){e.isBackgroundImage()||(i.CoreAssert.isTrue(o.canSetBackgroundImage(e),void 0,"ImageFacade.setBackgroundImage","ImageFacade.swift",554),o.setBackgroundOrFloatingImage(e,!0))},setFloatingImage:function(e){var r;(r=e.controller)&&r.floating||(i.CoreAssert.isTrue(o.canSetFloatingImage(e),void 0,"ImageFacade.setFloatingImage","ImageFacade.swift",564),o.setBackgroundOrFloatingImage(e,!1))},setBackgroundOrFloatingImage:function(e,r){var t,n,l,s;if(!(e.isBackgroundImage()&&r||!e.isBackgroundImage()&&!r)&&(t=a.opt(a.as(a.opt(e.root,(function(e){return e.controller})),M.RootController),(function(e){return e.getGridController()})))&&(n=a.as(e,F.FrameForma))&&(l=o.getImageFormaForForma(n))&&(s=n.finalFrame)){var u,c=a.opt(l.finalFrame,(function(e){return e.intersectionWith(s)})),d=new v.FormaStyleChangedEvent(t.forma);t.forma.beginUpdate(d),r&&(o.formaHasMask(n)&&o.removeMaskForForma(e),a.opt(l.controller,(function(e){return e.rotate(n.rotationInRadians())})),l.style.opacity=1,n.cropRatioId=m.CropRatioPresetLibrary.FREEFORM_ID,null!=(u=t.getBasicShapeLayoutColor())&&a.opt(e.root,(function(e){return e.style.colors.setColorId(g.ColorRole.FieldPrimary,u)})));var p=!1;if(!r&&null!=t.formaMappingSwiftDict[n.formaID]){var C=t.gridStyle.name.includes(y.GridStyle.SINGLE_LAYOUT_NAME)||t.gridStyle.name.includes(y.GridStyle.BALANCED_LAYOUT_NAME)||t.gridStyle.name==y.GridStyle.CUSTOM_LAYOUT_NAME;(t.getBackgroundShapes().length>0||!C)&&(t.removeFormaWithoutGridModification(n),p=!0)}if(p||t.removeFormaFromGroup(n),n.allowUserMove=!r,n.intent=r?f.Forma.INTENT_GRID_CELL:f.Forma.INTENT_FLOATING_IMAGE,l.intent=r?f.Forma.INTENT_GRID_CELL:f.Forma.INTENT_FLOATING_IMAGE,!r){var h=s.center;(null!=c?c.area/s.area:1)<.8?(n.bounds=O.TheoRect.fromSize(c.size),h=c.center):n.bounds=a.opt(n.bounds,(function(e){return e.scale(.95,new B.TheoPoint(0,0))})),n.moveCenterToPoint(h)}if(t.addFormaToGroupWithCurrentImage(n),!r){var I,T=n.parent,A=a.clone(T.filterByControllerKind(L.TypeLockupController.KIND));if(A.length>0){for(var k,S=A[0];null!=S&&null==T.indexOfChild(S);)S=S.parent;(k=S)?T.insertBefore(n,k,!0):i.CoreAssert.fail("Parenting confusion while moving image to fore; not reordering","ImageFacade.setBackgroundOrFloatingImage","ImageFacade.swift",676)}(I=o.getCutoutMaskFormaForForma(n))&&o.setTightCropToCutoutMask(n,I,!1)}t.forma.endUpdate(d)}},getFrameForForma:function(e){var r;return(r=a.as(e,F.FrameForma))?r:e instanceof b.ImageForma||e instanceof G.VideoForma?a.as(e.parent,F.FrameForma):null},logCutoutProgressToAnalytics:function(e,r,t,o){var n;if(void 0===o&&(o=null),n=I.Host.logging){var i,l={mode:r,duration:t,platformID:n.platformID()};null!=(i=o)&&(l.error=i),n.logToNewRelic(e,a.clone(l))}},generateMaskFromImageBytes:function(e,r,t){var n,l,s,u,c;if((n=a.opt(e.contentNode,(function(e){return e.image})))&&null!=(l=e.mimeType)&&(s=I.Host.network)&&(u=I.Host.dataFactory)&&(c=I.Host.logging)){var m=c.getCurrentTime();return n.getImageRepresentationData(l,t).then((function(e){var t;return(t=a.as(e,T.HostDataProtocol))?(r.data=u.createFromFormData({file:new T.HostNetworkFormDatum(t,"masksource")}),s.request(r).then((function(e){return o.logCutoutProgressToAnalytics(S.CUTOUT_SUCCESS_TYPE,"upload",a.toInt(1e3*(c.getCurrentTime()-m))),e})).fail((function(e){return o.logCutoutProgressToAnalytics(S.CUTOUT_ERROR_TYPE,"upload",a.toInt(1e3*(c.getCurrentTime()-m)),a.toString(e)),d.CorePromise.reject(e)}))):(i.CoreAssert.fail("Failed to get resized image.","ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",760),d.CorePromise.reject("Failed to get resized image."))}))}return i.CoreAssert.fail("Invalid image data or Host instance(s).","ImageFacade.generateMaskFromImageBytes","ImageFacade.swift",765),d.CorePromise.reject("Invalid image data or Host instance(s).")},generateMaskFromCCStorageImage:function(e,r){var t,n,l,s,u,c,m;if((t=a.opt(e.contentNode,(function(e){return e.image})))&&(n=e.contentNode)&&null!=(l=t.getStoragePath(n))&&(s=I.Host.network)&&(u=I.Host.dataFactory)&&(c=I.Host.logging)&&(m=u.createFromString("cc-storage://"+l,"text/plain"))){var g=c.getCurrentTime();return r.data=u.createFromFormData({url:new T.HostNetworkFormDatum(m)}),s.request(r).then((function(e){return o.logCutoutProgressToAnalytics(S.CUTOUT_SUCCESS_TYPE,"cc-storage",a.toInt(1e3*(c.getCurrentTime()-g))),e})).fail((function(e){var r,t=a.toString(e);return(r=a.as(e,A.HostNetworkError))&&r.type==A.HostNetworkErrorType.NotFound&&(t="image not found on CC Storage"),o.logCutoutProgressToAnalytics(S.CUTOUT_ERROR_TYPE,"cc-storage",a.toInt(1e3*(c.getCurrentTime()-g)),t),d.CorePromise.reject(e)}))}return i.CoreAssert.fail("Invalid image data or Host instance(s).","ImageFacade.generateMaskFromCCStorageImage","ImageFacade.swift",817),d.CorePromise.reject("Invalid image data or Host instance(s).")},processNetworkResponse:function(e,r){var t,o,n,i;return(t=a.as(e,A.HostNetworkResponse))&&(o=t.data)?((n=t.headers)&&null!=(i=n["x-version"])&&(r.modelVersion=i,r.model==S.ImageCutoutModelLibrary.CURRENT_MODEL&&S.ImageCutoutModelLibrary.instance.setModelVersion(i)),I.Host.network.saveImageComponent(o,t.mimeType)):d.CorePromise.reject("Invalid network response")},generateCutoutMaskForImage:function(e,r,t){var n;return void 0===t&&(t=10),(n=o.getImageFormaForForma(e))?S.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(r,S.MASK_ENDPOINT,A.HostNetworkRequestMethod.post,t).then((function(e){var t;return(t=a.as(e,A.HostNetworkRequest))?o.generateMaskFromCCStorageImage(n,t).then((function(e){return r.maskSize=S.CutoutMaskSize.ORIGINAL,e})).fail((function(e){var i;return(i=a.as(e,A.HostNetworkError))&&i.type==A.HostNetworkErrorType.NotFound?o.generateMaskFromImageBytes(n,t,r.maskSize):d.CorePromise.reject(e)})):d.CorePromise.reject("Invalid network request object")})).then((function(e){return o.processNetworkResponse(e,r)})):d.CorePromise.reject("Invalid image or frame")},retryNewMaskFromCC:function(e,r){var t,n;if((t=o.getImageFormaForForma(e))&&(n=I.Host.logging)){var i=n.getCurrentTime();return o.logCutoutProgressToAnalytics(S.CUTOUT_RETRY_TYPE,"cc-storage",a.toInt(1e3*(n.getCurrentTime()-i))),S.ImageCutoutModelLibrary.buildMaskNetworkRequestForConfig(r,S.MASK_ENDPOINT,A.HostNetworkRequestMethod.post).then((function(l){var s;return(s=a.as(l,A.HostNetworkRequest))?o.generateMaskFromCCStorageImage(t,s).then((function(t){return r.maskSize=S.CutoutMaskSize.ORIGINAL,o.logCutoutProgressToAnalytics(S.CUTOUT_RETRY_SUCCESS_TYPE,"cc-storage",a.toInt(1e3*(n.getCurrentTime()-i))),o.processNetworkResponse(t,r).then((function(t){var n;return(n=a.as(t,A.HostComponentResponse))?o.applyCutoutMaskToImage(e,n.url,n.type,n.id,r):d.CorePromise.reject("Invalid network response object")}))})):d.CorePromise.reject("Invalid network request object")}))}return d.CorePromise.reject("Invalid image data or Host instance(s).")},getNewMaskForImage:function(e,r){return o.generateCutoutMaskForImage(e,r).then((function(t){var n;return(n=a.as(t,A.HostComponentResponse))?o.applyCutoutMaskToImage(e,n.url,n.type,n.id,r):d.CorePromise.reject(t)}))},createCutoutMaskForImage:function(e,r,t){var n=o.getCutoutMaskFormaForForma(e),i=new S.CutoutMaskMetadata(r,t,null);if(null==n)return o.getNewMaskForImage(e,i);var l=a.opt(a.opt(n,(function(e){return e.contentNode})),(function(e){return e.getTag(D.ImageContentNode.IMAGE_MASK_METADATA_TAG)})),s=S.CutoutMaskMetadata.decode(l),u=a.opt(s,(function(e){return e.maskSize==S.CutoutMaskSize.ORIGINAL}));return S.ImageCutoutModelLibrary.isMaskUptodateWithCurrentModel(s).then((function(r){var t;return null!=(t=a.as(r,"Bool"))&&t?u?n:o.retryNewMaskFromCC(e,i).fail((function(e){return n})):o.getNewMaskForImage(e,i)}))},removeCutoutMaskFromImage:function(e){return o.setCutoutModeForForma(e,S.CutoutMode.Off),d.CorePromise.resolve(null)},formaHasMask:function(e){return null!=o.getMaskFormaForForma(e)},formaHasShapeMask:function(e){return o.getMaskFormaForForma(e)instanceof R.ShapeForma},setAuxiliaryForForma:function(e,r,t){var n;if(n=o.getFrameFormaForForma(e)){var a,i,l,s=new v.FormaContentChangedEvent(n);if(n.beginUpdate(s),(a=o.getMaskFormaForFormaByIntent(n,t))&&n.removeAuxiliary(a),(i=r)&&(i.intent=t,n.appendAuxiliary(i)),e.endUpdate(s),l=o.getImageFormaForForma(e)){var u=new v.FormaContentChangedEvent(l);l.beginUpdate(u),l.endUpdate(u)}}},setMaskForForma:function(e,r){o.setAuxiliaryForForma(e,r,f.Forma.INTENT_IMAGE_MASK)},removeMaskForForma:function(e){o.setMaskForForma(e,null)},setCutoutForForma:function(e,r){var t;o.setAuxiliaryForForma(e,r,f.Forma.INTENT_CUTOUT_MASK),(t=r)&&o.updateCutoutMaskPlacement(e,t)},removeCutoutForForma:function(e){o.setCutoutForForma(e,null),o.setCutoutModeForForma(e,S.CutoutMode.Off)},getMaskForForma:function(e){var r,t,n,i,s=o.getMaskFormaForForma(e);return(r=a.as(s,R.ShapeForma))&&null!=(t=r.shapeLibraryID)?l.CropAssetLibrary.getCropShapeFromID(t):(n=a.as(s,b.ImageForma))&&null!=(i=n.contentNode.getTag(D.ImageContentNode.ASSET_ID_TAG))?l.CropAssetLibrary.getRasterMaskFromID(i):null},applyMaskToForma:function(e,r,t,n){var i;if(void 0===t&&(t=null),void 0===n&&(n=!1),i=a.as(e,F.FrameForma)){var s,u,c,g=null,f=new v.FormaApplyMaskEvent(i);return i.beginUpdate(f),(s=a.as(r,l.CropShape))?g=o.applyShapeMaskToImage(e,s.id,t,n):(u=a.as(r,l.RasterMask))&&(g=o.applyRasterMaskToImage(e,u,t,n)),(c=g)?c.then((function(e){var r;if(r=a.as(i.controller,p.FrameController)){if(o.formaHasMask(i)){var t=new v.FormaGeometryChangedEvent(i);i.beginUpdate(t),r.fitChildrenToFrame(),i.endUpdate(t)}r.fitting=p.FitType.None,r.updateCropModeImage()}return i.cropRatioId=m.CropRatioPresetLibrary.NONE_ID,i.endUpdate(f),e})):d.CorePromise.reject("Invalid CropAsset type.")}return d.CorePromise.reject("Invalid frame.")},applyShapeMaskToImage:function(e,r,t,n){var i;if(void 0===t&&(t=null),void 0===n&&(n=!1),i=a.as(e,F.FrameForma)){var l,s,u,c,m,g=o.formaHasMask(i),C=a.opt(a.opt(o.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin}));if((l=t)&&a.opt(a.as(i.controller,p.FrameController),(function(e){return e.setBoundsWithCropType(l,p.CropType.PreserveFocusAndScale)})),o.removeMaskForForma(i),null!=r&&(s=a.as(i.page.createFormaWithController(R.ShapeForma.KIND,x.ShapeController.KIND),R.ShapeForma))){w.ShapeLibrary.applyToShapeForma(s,r);var v,h,y=s.canonicalArtwork;if(!n&&(v=y.bounds)&&(h=i.bounds)){var I=h.fitAspectRatioWithin(v.aspectRatio);i.bounds=O.TheoRect.fromXYWH(h.minX,h.minY,I.width,I.height)}s.preScale=null,s.allowUserMove=!1,s.intent=f.Forma.INTENT_IMAGE_MASK,o.setMaskForForma(i,s)}return(h=i.bounds)&&(u=a.opt(o.getImageFormaForForma(i),(function(e){return e.bounds})))&&!o.formaHasMask(i)&&g&&null==t&&(I=h.fitAspectRatioWithin(u.aspectRatio),i.bounds=O.TheoRect.fromXYWH(h.minX,h.minY,I.width,I.height)),(c=C)&&(m=a.opt(a.opt(o.getImageFormaForForma(i),(function(e){return e.finalFrame})),(function(e){return e.origin})))&&i.move(N.Matrix2D.translation(B._minus_TheoPoint_TheoPoint(c,m))),d.CorePromise.resolve(o.getMaskFormaForForma(e))}return d.CorePromise.reject("frame is nil")},applyRasterMaskToImage:function(e,r,t,n){var i,l,s;if(void 0===t&&(t=null),void 0===n&&(n=!1),(i=o.getFrameFormaForForma(e))&&(l=r)&&null!=(s=I.Host.resourceUtils.urlForResource("raster",l.id))){var c=new u.AddFormaParams(void 0,void 0,void 0,void 0,u.AddFormaParentingHint.doNotAddFormaForContentToTree),m={"image-role":D.ImageContentNode.ROLE_MASK,"asset-id":l.id};return u.CreationFacade.addImage(e.page,s,l.mimeType,l.width,l.height,!1,void 0,c,a.clone(m)).then((function(e){var r;return(r=a.as(e,b.ImageForma))?(o.setMaskForForma(i,r),r):d.CorePromise.reject("imageCN is nil")}))}return d.CorePromise.reject("frame is invalid")},updateCutoutMaskPlacement:function(e,r){var t,n,a;if((t=o.getImageFormaForForma(e))&&(n=t.bounds)&&(a=r.bounds)){i.CoreAssert.isTrue(a.width>0&&a.height>0,"Invalid mask bounds.","ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1209);var l=n.width/a.width,s=n.height/a.height;r.placement=N.Matrix2D.scalingXY(l,s).concat(t.placement)}else i.CoreAssert.fail("Failed to update cutout mask bounds - invalid image or mask bounds.","ImageFacade.updateCutoutMaskPlacement","ImageFacade.swift",1215)},applyCutoutMaskToImage:function(e,r,t,n,i){var l,c;if(void 0===n&&(n=null),void 0===i&&(i=null),c=a.as(e,F.FrameForma)){var m=new u.AddFormaParams(void 0,void 0,void 0,void 0,u.AddFormaParentingHint.doNotAddFormaForContentToTree),g={"image-role":D.ImageContentNode.ROLE_MASK,"image-mask-metadata":(l=a.opt(i,(function(e){return e.encode()})))||null!=l?l:""};return u.CreationFacade.addImage(e.page,r,t,void 0,void 0,void 0,void 0,m,a.clone(g),n).then((function(e){var r;return(r=a.as(e,b.ImageForma))?a.opt(r.contentNode,(function(e){return null==e.trimmedBounds}))?(r.removeFromParent(),d.CorePromise.reject(new A.HostCutoutMaskError)):(s.ColorFacade.applyNoneColorToFormae([c]),o.setCutoutForForma(c,r),o.setCutoutModeForForma(c,S.CutoutMode.Off),r):d.CorePromise.reject("mask is not an ImageForma.")}))}return d.CorePromise.reject("frame is nil")},setTightCropToCutoutMask:function(e,r,t){var n,i,l,s,u,c;if(void 0===t&&(t=!0),!(o.formaHasShapeMask(e)||e.isBackgroundImage()||((n=a.opt(e.controller,(function(e){return e.userGroupChild})))||null!=n)&&n||null!=e.style.colors.fieldPrimary&&t)&&(i=o.getImageFormaForForma(e))&&(l=a.as(e.controller,p.FrameController))&&(s=i.bounds)&&(u=r.bounds)&&(c=a.opt(r.contentNode,(function(e){return e.trimmedBounds})))){var d,m,g=c.multiplyXY(s.width/u.width,s.height/u.height);if((d=a.opt(i.placement.inverse,(function(r){return r.transformRect(e.bounds)})))&&(m=g.intersectionWith(d))){var f=new v.FormaGeometryChangedEvent(e);e.beginUpdate(f);var F=i.placement.transformRect(m),C=i.totalPlacement.transformPoint(m.center);e.bounds=O.TheoRect.fromSize(F.size);var h=N.Matrix2D.translation(B._minus_TheoPoint_TheoPoint(e.bounds.center,i.placement.transformPoint(m.center)));i.move(h),l.fitChildrenToFrame(),e.move(N.Matrix2D.translation(B._minus_TheoPoint_TheoPoint(C,e.finalFrame.center))),e.endUpdate(f)}}},canAddImages:function(e,r){return r+e.filterByControllerKind(p.FrameController.KIND).length<=h.GridController.MAX_IMAGE_COUNT}}}),o)},pmb0:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("VQVe"),l=t("FNB+"),s=t("KkVW"),u=t("3/rh"),c=t("Pn67"),d=t("nQ+V"),m=t("SAU6"),g=t("nUE5");n.EXPOSE_MOTION_STYLE=!1,n.MotionFacade=(o=function(){},a.defineClass({name:"MotionFacade",ctor:o,statics:{ANIM_STYLE_NAME_STACKED:"Stacked",ANIM_STYLE_NAME_COMPOSITE:"Composite",getCurrentAnimationStyle:function(){return o._animStyle},applyEntryToForma:function(e,r){var t=g.MotionSource.getSourceAnimation(r.srcId,e);r.logic.apply(e,t,a.clone(r.args))},canApplyStyle:function(e){return e.name==o.ANIM_STYLE_NAME_STACKED||e.name==o.ANIM_STYLE_NAME_COMPOSITE||e.name==i.AnimationStyle.NAME_DYNAMIC&&3==e.variant},createAllAnimationStyles:function(){return n.EXPOSE_MOTION_STYLE?[i.AnimationStyle.init_e14f(o.ANIM_STYLE_NAME_STACKED,0,1,i.AnimationStyleCategory.Text),i.AnimationStyle.init_e14f(o.ANIM_STYLE_NAME_COMPOSITE,0,1,i.AnimationStyleCategory.Text)]:[]},applyStyle:function(e,r){if(o.canApplyStyle(r))if(o._animStyle=r,r.name==i.AnimationStyle.NAME_DYNAMIC)o.applyEntryToForma(e,new m.MotionEntryStackedRoot);else{var t,n=[],g=new c.MotionEntryNone;e.visitAll(l.FormaTraversal.PreOrder,(function(e){o.applyEntryToForma(e,g),e.isTypeLockup()&&n.push(e)})),(t=a.first(n))&&(r.name==o.ANIM_STYLE_NAME_COMPOSITE?(o.applyEntryToForma(t,new s.MotionEntryDropIn),o.applyEntryToForma(t,new u.MotionEntryFadeIn)):r.name==o.ANIM_STYLE_NAME_STACKED&&o.applyEntryToForma(t,new d.MotionEntryStacked))}}}}),o)},wNKJ:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("SpAV"),l=t("gXiO"),s=t("quOg"),u=t("FNB+"),c=t("6ZWm"),d=t("cmoc"),m=t("OdB2"),g=t("P83h"),f=t("9Lk3"),p=t("ZK0l"),F=t("pnSN"),C=t("X0GW"),v=t("iCxV"),h=t("fdtz"),y=t("lmwz"),I=t("tGKA"),T=t("KIfs"),A=t("K0Rh"),k=t("djAF"),S=t("6Tzw"),D=t("T6jX"),b=t("oKlP"),P=t("sIWg");n.DragFacade=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"DragFacade",ctor:o,superName:"CoreObject",statics:{processBeginFormaDrag:function(e){var r=e.dragDelegate.dragController,t=a.opt(r,(function(e){return e.owner.document.firstPage}));a.opt(t,(function(e){return e.publish(new m.BeginFormaDragMessage(t))})),a.opt(r,(function(r){return r.afterProcessBeginFormaDrag(e)}))},processFormaDrag:function(e){var r=e.dragDelegate.dragController;a.opt(r,(function(r){return r.beforeProcessFormaDrag(e)}));var t=[],n=!(1==e.dragDelegate.modifierKeys.control)&&1==e.dragDelegate.draggedFormae.length;return e.dragDelegate.forEachDraggedForma((function(r,a){t=t.concat(o.processOneFormaDrag(e,r,a,n))})),a.opt(r,(function(r){return r.afterProcessFormaDrag(e)})),t},processOneFormaDrag:function(e,r,t,n){var i=[],l=e.drag;if(null==e.dragDelegate.dragController.owner)return i;if(null==r.controller)return i;var u=e.dragDelegate.dragController.owner,c=r.controller,d=u.selection;if(!c.moveable||u.interactionMode==s.InteractionMode.SelectionFocused&&d.selectedCount>0&&!d.isSelected(r))return i;var f=new g.FormaTransformChangedEvent(r);r.beginUpdate(f),o.doMove(l,r,t,d),n&&(i=a.clone(o.doSnap(l,r,t))),r.endUpdate(f);var p=u.document.firstPage;return p.publish(new m.FormaDragMessage(p)),i},doMove:function(e,r,t,o){var n,l=a.opt(r.parent,(function(e){return e.totalPlacement.inverse}))||I.Matrix2D.Identity,s=e.freeMovement(l),u=s.movement;switch(s.rise,s.run,n=r.parent instanceof d.FrameForma?r.parent.bounds.center:I._asterisk_TheoPoint_Matrix2D(r.bounds.center,t),e.dragMode){case 1:u=e.noScale(l,n);break;case 2:u=e.noRotation(l,n)}i.CoreAssert.isFalse(0==u.determinant,void 0,"DragFacade.doMove","DragFacade.swift",101),I._asterisk_Matrix2D_Matrix2D(I._asterisk_Matrix2D_Matrix2D(I.Matrix2D.translation(n),u),I.Matrix2D.translation(b._negate_TheoPoint(n))),e.uncommitedMovement=u;var c,m=I._asterisk_Matrix2D_Matrix2D(t,u);(c=r.controller)&&c.place(m)},doSnap:function(e,r,t){var o,n,i=[];n=r.parent instanceof d.FrameForma?r.parent.bounds.center:I._asterisk_TheoPoint_Matrix2D(r.bounds.center,t);var l,s=r.bounds.locatePoint(r.placement.inverse.transformPoint(n)),c=e.dragMode==T.DragMode.NoScaleNoSkew,m=e.activePace();l=!(!(o=a.opt(v.Host.platform,(function(e){return e.isWeb})))&&null==o||!o)||m==T.DragPace.MediumPace||e.currentlySnapped,e.dragMode==T.DragMode.UniformScaleNoRotationNoSkew&&(l=!1);var g,p,F,C=a.clone(r.filterByControllerKind(f.GridController.KIND,u.FormaTraversal.NearestAncestor));if((g=a.as(a.opt(a.first(C),(function(e){return e.controller})),f.GridController))&&g.isChildSwappable(r)&&l&&(l=c),(p=y.ImageFacade.getFrameFormaForForma(r))&&(l=p.controller.floating),F=r.controller){var h=e.currentlySnapped;if(e.currentlySnapped=!1,l){var A,k=F.setSnappedPlacement(c?s:null,8/e.viewportScale,!1);(A=k.snapLines)&&(i=a.clone(A)),null!=k.movement&&(e.currentlySnapped=!0),!h&&e.currentlySnapped&&e.commitDrag()}}return i},processEndFormaDrag:function(e){var r,t,n,i=e.dragDelegate.dragController;if(n=a.as(i,c.FrameController))n.processEndFormaDrag(e);else{var l=e.drag.viewportScale,s=26/l,u=0;e.drag.pointers.length>1&&(u=24/l),S.SelectionFacade.enableAdditionalMultiSelectGestures()&&a.opt(i,(function(r){return r.owner.selection.replaceSelectionWithFormae(a.clone(e.dragDelegate.draggedFormae))}));var d=!(!(r=a.opt(i,(function(e){return e.owner.selection.inCropMode})))&&null==r)&&r;e.dragDelegate.forEachDraggedForma((function(e,r){o.rescueFormaToPageBounds(e,s,u),d||!(t=a.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t||C.GroupFacade.updateUserGroupHierarchy(e.parent)}));var g=a.opt(i,(function(e){return e.owner.document.firstPage}));a.opt(g,(function(e){return e.publish(new m.EndFormaDragMessage(g))})),e.dragDelegate.forEachDraggedForma((function(e,r){var t;if(t=a.opt(e.root,(function(e){return e.filterWithCallback((function(e){return e instanceof F.GroupForma&&null!=e.controller}))})))for(var o=a.iter(t);!o.done;o.next()){var n,i=o.value;(n=a.as(i.controller,p.GroupController))&&n.canClaimForma(e)&&n.claimForma(e)}else v.Host.logging.error("Error: forma has not root "+e.print())})),a.opt(i,(function(r){return r.afterProcessEndFormaDrag(e)}))}},rescueFormaToPageBounds:function(e,r,t){var n;if(void 0===r&&(r=50),void 0===t&&(t=50),n=e.root){var a=n.bounds,i=I.Matrix2D.Identity;o.rescueToArbitraryBounds(e,a,i,r,t)}},rescueToArbitraryBounds:function(e,r,t,o,n){var l;if(l=e.parent){var s=e.totalPlacement,u=e.bounds,c=o*Math.sqrt(Math.abs(t.determinant)),d=r.insetXY(c,c),m=u.maximumSpan(s);if(m<n){i.CoreAssert.isTrue(m>0,void 0,"DragFacade.rescueToArbitraryBounds","DragFacade.swift",264);var g=s.transformPoint(u.center),f=I.Matrix2D.translation(g.multiply(-1)).concat(I.Matrix2D.uniformScaling(n/m).concat(I.Matrix2D.translation(g))),p=(F=l.totalPlacement).concat(f.concat(F.inverse));a.opt(e.controller,(function(e){return e.move(p)}))}if(s=e.totalPlacement,!P.TheoRect.PointInCommon(u,I._asterisk_Matrix2D_Matrix2D(s,t.inverse),r)){var F,C=P.TheoRect.JustTouch(u,s,d,t);p=(F=l.totalPlacement).concat(C.concat(F.inverse)),a.opt(e.controller,(function(e){return e.move(p)}))}}},getSwappableFormae:function(e){var r=a.first(e.dragDelegate.draggedFormae);a.opt(r,(function(e){return e.kind==h.ImageForma.KIND}))&&(r=a.opt(r,(function(e){return e.parent})));var t=e.dragDelegate.dragController,n=a.opt(a.opt(t,(function(e){return e.owner})),(function(e){return e.document})),i=[];return null==r||null==n?i:(n.firstPage.root.visitAll(u.FormaTraversal.PreOrder,(function(e){o.isFormaSwappable(e,n)&&i.push(e)})),i)},getSwapState:function(e,r,t,n,i){var l=o.getSwapTargetForma(e,a.clone(r),t),s=n;(s||null!=l)&&(s=!0,null!=i&&a.opt(a.first(e.dragDelegate.draggedFormae),(function(e){return e.placement=i})));var u=e.drag.pointers[0].currentLocation,c=a.opt(a.opt(e.dragDelegate.dragController.owner,(function(e){return e.document})),(function(e){return e.firstPage.formaAtPoint(u)})),d=null!=c&&c.kind==A.RootForma.KIND;return null==l&&d&&(l=t,s=n),[s,l]},getSwapTargetForma:function(e,r,t){var n=e.drag;if(1!=e.dragDelegate.draggedFormae.length)return null;var i=a.first(e.dragDelegate.draggedFormae);a.opt(i,(function(e){return e.kind==h.ImageForma.KIND}))&&(i=a.opt(i,(function(e){return e.parent})));var l=e.dragDelegate.dragController,s=a.opt(a.opt(l,(function(e){return e.owner})),(function(e){return e.document}));if(1!=n.pointers.length||null==i||null==s)return null;if(!o.isFormaSwappable(i,s))return null;var c=n.pointers[0].currentLocation,d=s.firstPage.pageSize;if(c.x<0||c.x>d.width||c.y<0||c.y>d.height)return null;for(var m=null,g=a.iter(r);!g.done;g.next()){var f=g.value;if(f.finalFrame.containsPoint(c)&&o.inSwappableRegion(i,f,c,s)){m=f;break}}return null==t&&a.eq(u._equality_Forma_Forma,m,i)&&(m=null),m},isFormaSwappable:function(e,r){return!(e.kind==A.RootForma.KIND||e.kind==F.GroupForma.KIND||null!=e.controller&&e.controller.moveable||!e.isGridCell()||null==o.getGridForma(r)||(t=a.as(e,k.ShapeForma))&&null!=D.TheoDocumentUtils.getCellBackgroundImage(t));var t},getGridForma:function(e){var r=a.clone(e.firstPage.root.filterByControllerKind(f.GridController.KIND));return r.length>0?r[0]:null},inSwappableRegion:function(e,r,t,n){var a=o.getGridForma(n),i=0;if(null!=a&&(i=a.controller.spacing),null==e.finalFrame||null==r.finalFrame)return!1;var l=e.finalFrame.minY==r.finalFrame.maxY+i,s=e.finalFrame.maxY==r.finalFrame.minY-i,u=e.finalFrame.minX==r.finalFrame.maxX+i,c=e.finalFrame.maxX==r.finalFrame.minX-i,d=l&&u||l&&c||s&&u||s&&c,m=e.finalFrame.minY>=r.finalFrame.minY&&e.finalFrame.minY<=r.finalFrame.maxY||r.finalFrame.minY>=e.finalFrame.minY&&r.finalFrame.minY<=e.finalFrame.maxY||d,g=e.finalFrame.minX>=r.finalFrame.minX&&e.finalFrame.minX<=r.finalFrame.maxX||r.finalFrame.minX>=e.finalFrame.minX&&r.finalFrame.minX<=e.finalFrame.maxX||d,f=l&&m,p=s&&m,F=u&&g,C=c&&g;if(f||p||F||C){var v=r.finalFrame.minY,h=r.finalFrame.maxY,y=r.finalFrame.minX,I=r.finalFrame.maxX,T=h-v,A=I-y;return f&&(h-=.2*T),p&&(v+=.2*T),F&&(I-=.2*A),C&&(y+=.2*A),t.x>=y&&t.y>=v&&t.x<=I&&t.y<=h}return!0}}}),o)},x35w:function(e,r,t){var o,n=r,a=t("oAGj"),i=t("SpAV"),l=t("gXiO"),s=t("ascj"),u=t("FNB+"),c=t("9Lk3"),d=t("uxH+");n.GridFacade=(o=function(){l.CoreObject.call(this)},a.defineClass({name:"GridFacade",ctor:o,superName:"CoreObject",statics:{getPageGrid:function(e,r){var t=a.clone(e.root.filterByControllerKind(c.GridController.KIND));return t.length>0?a.as(t[0].controller,c.GridController):r?a.opt(a.as(e.root.controller,d.RootController),(function(e){return e.createGridControllerIfNone()})):null},createPaddedCollage:function(e){var r;return(r=o.getPageGrid(e,!0))?(r.setMarginAndSpacing(10,10),r.forma.root.style.colors.setColorId(s.ColorRole.FieldPrimary,"white"),r.forma):(i.CoreAssert.fail("couldn't get a grid controller","GridFacade.createPaddedCollage","GridFacade.swift",45),null)},setPageGridParameters:function(e,r,t){var n;(n=o.getPageGrid(e,!0))?isNaN(r)||isNaN(t)?isNaN(r)?isNaN(t)||(n.margin=t):n.spacing=r:n.setMarginAndSpacing(r,t):i.CoreAssert.fail("couldn't get a grid controller","GridFacade.setPageGridParameters","GridFacade.swift",67)},isChildSwappable:function(e){var r,t=a.clone(e.filterByControllerKind(c.GridController.KIND,u.FormaTraversal.NearestAncestor));return!!(r=a.as(a.opt(a.first(t),(function(e){return e.controller})),c.GridController))&&r.isChildSwappable(e)},swapChildren:function(e,r){var t,n=a.clone(e.filterByControllerKind(c.GridController.KIND,u.FormaTraversal.NearestAncestor));(t=a.as(a.opt(a.first(n),(function(e){return e.controller})),c.GridController))&&o.isChildSwappable(e)&&o.isChildSwappable(r)&&t.swapGridChildren(e,r)},setMoveableShift:function(e,r){e.moveableShift=r},getMoveableShift:function(e){return e.moveableShift},applyGridStyle:function(e,r,t){var n;(n=o.getPageGrid(t,!1))?n.applyStyle(e,r):i.CoreAssert.fail("couldn't get a grid controller","GridFacade.applyGridStyle","GridFacade.swift",127)}}}),o)}}]);
//# sourceMappingURL=vendors_npm_spark_62e2d343-b4dbc37b.js.map
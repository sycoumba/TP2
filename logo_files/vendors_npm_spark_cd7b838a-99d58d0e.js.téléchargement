(window.webpackJsonptheoWebApp=window.webpackJsonptheoWebApp||[]).push([[32],{"/afT":function(e,t,r){var a,n=t,o=r("oAGj"),i=r("cZuM"),l=r("XmBt"),u=r("SpAV"),s=r("gXiO"),c=r("FNB+"),m=r("9Lk3"),g=r("ZK0l"),h=r("pnSN"),f=r("NkBu"),v=r("fdtz"),p=r("tGKA"),d=r("K0Rh"),F=r("T6jX"),y=r("oKlP"),C=r("sIWg");n.GroupDetector=(a=function(){s.CoreObject.call(this)},o.defineClass({name:"GroupDetector",ctor:a,superName:"CoreObject",statics:{Y_DISTANCE_THRESHOLD:150,X_DISTANCE_THRESHOLD:0,splitFormaGroups:function(e,t){for(var r=0,n=o.iter(e);!n.done;n.next())r+=n.value.length;for(var i=e.concat();i.length<r&&i.length<t;){for(var l=-1,s=null,c=o.iter(o.range(0,i.length,!1));!c.done;c.next()){var m=c.value;if(i[m].length>1){var g=a.groupFrame(o.clone(i[m]));(null==s||g.area>s.area)&&(l=m,s=g)}}if(null==s){u.CoreAssert.fail("should have found a group to split","GroupDetector.splitFormaGroups","GroupDetector.swift",56);break}var h=a.splitGroup(o.clone(i[l])),f=h[0],v=h[1];i[l]=o.clone(f),i.splice(l+1,0,o.clone(v))}return i},groupFrame:function(e){if(0==e.length)return C.TheoRect.Zero;for(var t=e[0].finalFrame,r=o.iter(e);!r.done;r.next()){var a=r.value;t=t.unionWith(a.finalFrame)}return t},splitGroup:function(e){if(e.length<=1)return u.CoreAssert.fail("should have found a group to split","GroupDetector.splitGroup","GroupDetector.swift",87),[e,[]];for(var t=e[0].finalFrame,r=o.iter(e);!r.done;r.next()){var a=r.value;t=t.unionWith(a.finalFrame)}var n=t.origin,i=o.sort(e,(function(e,t){return e.finalFrame.center.distanceTo(n)<t.finalFrame.center.distanceTo(n)})),l=[],s=[],c=0,m=i.length-1,g=i[c].finalFrame,h=i[m].finalFrame;for(l.push(i[c]),s.push(i[m]);c<m-1;){var f=g.area<h.area;i[c+1].finalFrame.intersects(g)&&(f=!0),i[m-1].finalFrame.intersects(h)&&(f=!1),f?(c+=1,l.push(i[c]),g=g.unionWith(i[c].finalFrame)):(m-=1,s.push(i[m]),h=h.unionWith(i[m].finalFrame))}return u.CoreAssert.isTrue(l.length+s.length==i.length,"counts don't match","GroupDetector.splitGroup","GroupDetector.swift",146),[l,s]},shareVisualParent:function(e,t){var r=a.getVisualParent(e).finalFrame,n=a.getVisualParent(t).finalFrame;return a.visualParentFramesOverlap(r,n)},visualParentFramesOverlap:function(e,t){var r;return!!(r=e.intersectionWith(t))&&r.area/Math.max(t.area,e.area)>.95},detectOverlapGroups:function(e){var t=[],r=o.sort(e,(function(e,t){return e.finalFrame.area>t.finalFrame.area}));if(r.length<=1)return t;for(var a=[],n=o.iter(o.range(0,r.length-1,!1));!n.done;n.next()){var i=n.value;if(!o.containsEq(a,r[i],c._equality_Forma_Forma)){for(var l=[r[i]],u=o.iter(o.range(i+1,r.length,!1));!u.done;u.next()){var s,m=u.value;(s=r[i].finalFrame.intersectionWith(r[m].finalFrame))&&!o.containsEq(a,r[m],c._equality_Forma_Forma)&&s.area/r[m].finalFrame.area>.5&&l.push(r[m])}if(l.length>1){for(var g=o.iter(l);!g.done;g.next()){var h=g.value;a.push(h)}t.push(o.clone(l))}}}for(var f=[],v=o.iter(t);!v.done;v.next()){var p=v.value,d=o.sort(p,(function(e,t){var r,a;return null!=(r=o.opt(e.parent,(function(t){return t.indexOfChild(e)})))&&null!=(a=o.opt(t.parent,(function(e){return e.indexOfChild(t)})))&&r<a}));f.push(o.clone(d))}return f},detectProximityGroups:function(e,t,r){if(void 0===t&&(t=null),void 0===r&&(r=!1),0==e.length)return[];var n=null!=t?t:a.Y_DISTANCE_THRESHOLD,l=e.concat();o.sortInPlace(l,(function(e,t){return e.finalFrame.center.distanceTo(y.TheoPoint.ZERO)<t.finalFrame.center.distanceTo(y.TheoPoint.ZERO)}));var u,s=[],m=l.concat(),g=1,h=o.first(l);(u=o.opt(o.opt(h,(function(e){return e.page.view})),(function(e){return e.getViewportTransform()})))&&(g=Math.sqrt(Math.abs(u.determinant)));for(var f=F.TheoDocumentUtils.enableFastHeuristicsForComplexPage(h.page),v=o.iter(l);!v.done;v.next()){var p=v.value,d=[];if(r){var C=i.AlignmentDetector.DISTANCE_THRESHOLD/g,T=i.AlignmentDetector.init_a05b(p);d=o.clone(T.detectFormaAlignments(C))}if(o.containsEq(m,p,c._equality_Forma_Forma)){var _=[];_.push(p);var x=p.finalFrame;if(null==x)continue;for(var A=!0;A;){A=!1;for(var S=o.iter(m);!S.done;S.next()){var D,I=S.value;if(!o.eq(c._equality_Forma_Forma,I,p)&&(D=I.finalFrame)){var N=D.xDistance(x),k=D.yDistance(x),b=f||a.shareVisualParent(p,I)?n:50;if(r){for(var L=!1,P=o.iter(d);!P.done;P.next()){var E=P.value;o.eq(c._equality_Forma_Forma,E.forma,I)&&(L=!0)}if(!L)continue}k<=b&&N<=b&&(x=x.unionWith(D),A=!0,_.push(I))}}for(var O=o.iter(_);!O.done;O.next())I=O.value,o.remove(m,I)}s.push(o.clone(_))}}return s},shareVisualParent0:function(e,t){for(var r=o.clone(e.root.filterWithCallback((function(e){return e.isGraphic()}))),a=null,n=null,i=e.finalFrame,l=t.finalFrame,u=o.iter(r);!u.done;u.next()){var s,m,g=u.value;g.kind==v.ImageForma.KIND||g.isDescendent(e)||g.isDescendent(t)||(s=g.finalFrame)&&((m=s.intersectionWith(i))&&m.area/i.area>.75&&(a=g),(m=s.intersectionWith(l))&&m.area/l.area>.75&&(n=g))}return o.eq(c._equality_Forma_Forma,a,n)},getVisualParent:function(e){var t=e.finalFrame;return a.getVisualParentHelper(e,t)},getGroupVisualParent:function(e){var t=e.childrenFinalFrame;return a.getVisualParentHelper(e,t)},getVisualParentHelper:function(e,t){for(var r=e.root,a=o.clone(e.root.filterWithCallback((function(t){var r=t.isDescendent(e);return!(o.eq(c._equality_Forma_Forma,t,e)||r||null==t.controller||t.controller.kind==f.ImageController.KIND||t.controller.kind==m.GridController.KIND||!t.isBackgroundImage()&&t.hasIntent(c.Forma.INTENT_ICON)&&t.kind!=d.RootForma.KIND&&t.controller.kind!=l.AlignmentGroupController.KIND)}))),n=o.iter(a);!n.done;n.next()){var i,u=n.value;(i=u.finalFrame)&&i.contains(t)&&i.area<=r.finalFrame.area&&(r=u)}return r},detectVerticalAlignmentGroups:function(e){var t=[];if(0==e.length)return t;for(var r=e.concat();r.length>0;){var a,n=r[0],l=null,u=i.AlignmentDetector.init_a05b(n),s=[n];o.remove(r,n);for(var m=o.iter(u.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD));!m.done;m.next()){var g=m.value;u.isVerticalAlignment(g.line.type)&&null!=g.forma&&o.containsEq(r,g.forma,c._equality_Forma_Forma)&&(l!=g.line.type&&null!=l||(l=g.line.type,o.containsEq(s,g.forma,c._equality_Forma_Forma)||(s.push(g.forma),o.remove(r,g.forma))))}null==l&&(l=null!=(a=o.opt(s[0].controller,(function(e){return e.preferredXAlignment})))?a:i.AlignmentType.CenterX),t.push({alignment:l,formae:s})}return t},flattenInferredGroups:function(e){for(var t=o.iter(e.visitAsArray(c.FormaTraversal.JustChildren));!t.done;t.next()){var r=t.value;if(r.hasIntent(c.Forma.INTENT_INFERRED_TEMP_GROUP)){for(var a=o.iter(r.visitAsArray(c.FormaTraversal.JustChildren));!a.done;a.next()){var n=a.value;e.appendChild(n,!0)}r.removeFromParent(),o.opt(o.as(e.controller,m.GridController),(function(e){return e.inferGridCellAssignment()}))}}},inferVisualParentGroup:function(e,t){for(var r=t.finalFrame,a=o.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}),c.FormaTraversal.JustChildren)),n=[],i=o.iter(a);!i.done;i.next()){var l,u,s=i.value;o.eq(c._equality_Forma_Forma,s,t)||(l=s.finalFrame)&&(u=r.intersectionWith(l))&&u.area/l.area>.75&&n.push(s)}if(n.length>0){var m=t.page.createFormaWithController(h.GroupForma.KIND,g.GroupController.KIND);m.allowUserMove=!0,m.intent=c.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(m),m.placement=p.Matrix2D.translationXY(r.minX,r.minY),m.bounds=C.TheoRect.fromSize(r.size);for(var f=o.iter(n);!f.done;f.next()){var v=f.value;m.appendChild(v,!0)}return m}return null},createOverlapGroups:function(e){for(var t=o.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.kind!=v.ImageForma.KIND&&e.controller.floating&&!e.hasIntent(c.Forma.INTENT_INFERRED_TEMP_GROUP)}),c.FormaTraversal.JustChildren)),r=[],n=o.iter(a.detectOverlapGroups(o.clone(t)));!n.done;n.next()){var i=n.value,l=e.page.createFormaWithController(h.GroupForma.KIND,g.GroupController.KIND);l.allowUserMove=!0,l.intent=c.Forma.INTENT_INFERRED_TEMP_GROUP,e.appendChild(l);for(var u=i[0].frame,s=o.iter(i);!s.done;s.next()){var m=s.value;u=u.unionWith(m.frame)}var f=u;l.placement=p.Matrix2D.translationXY(f.minX,f.minY),l.bounds=C.TheoRect.fromSize(f.size);for(var d=o.iter(i);!d.done;d.next())m=d.value,l.appendChild(m,!0);r.push(l)}return r},inferVisualGroups:function(e){return[]}}}),a)},"9WSY":function(e,t,r){var a,n,o,i=t,l=r("oAGj"),u=r("SpAV"),s=r("dJuF"),c=r("Quhx"),m=r("umUn"),g=r("90dd");i.ColorLibrary=(a=function(){this.changedIDs_=null},n={},l.defineClass({name:"ColorLibrary",ctor:a,superName:"PostPublishingObject",statics:{SCHEMA_CLASS_NAME:"ColorLibrary",codec:{get:function(){return void 0===n.codec&&(n.codec=s.DBPropertyCodec.registerCodec(a.SCHEMA_CLASS_NAME,s.DBPropertyCodec.directObjectCodec(a.SCHEMA_CLASS_NAME))),n.codec}},factory:{get:function(){return void 0===n.factory&&(n.factory=function(e,t,r,n){return a.init_866e(r,e)}),n.factory},set:function(e){n.factory=e}},PROPERTY_ENTRIES:"entries",PROPERTY_ENTRY_COLORID:"id",PROPERTY_ENTRY_COLOR:"color",PROPERTY_PALETTE_ID:"palette:id",_implements:function(e){return"IDBObject"==e||"TheoMessagePublisher"==e}},props:{init_fcb1:function(e){l.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_dd5d,l.clone(l.opt(e,(function(e){return e.state.allProperties}))||{}),{})},init_d41d:function(){l.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_dd5d,{},{})},init_866e:function(e,t){l.super_init(this,c.PostPublishingObject,c.PostPublishingObject.prototype.init_866e,e,t)},className:{get:function(){return a.SCHEMA_CLASS_NAME}},paletteID_:{get:function(){return l.as(this.get(a.PROPERTY_PALETTE_ID),"String")},set:function(e){this.set(a.PROPERTY_PALETTE_ID,e)}},entries:{get:function(){return l.as(this.get(a.PROPERTY_ENTRIES),["Array",["Dictionary","String","Any"]])}},lookupFromEntries:function(e){var t={};if(null!=e)for(var r=l.iter(e);!r.done;r.next()){var n,o,i=r.value;null!=(n=l.as(i[a.PROPERTY_ENTRY_COLORID],"String"))&&(o=l.as(i[a.PROPERTY_ENTRY_COLOR],m.TheoColor))&&(t[n]=o)}return t},lookup_:{get:function(){return this.lookupFromEntries(l.clone(this.entries))}},flushColors:function(e){for(var t=[],r=l.iter(e);!r.done;r.next()){var n={id:r.key,color:r.value};t.push(l.clone(n))}this.set(a.PROPERTY_ENTRIES,l.clone(t))},hasEntries:function(e){for(var t=!0,r=l.keys(this.lookup_),a=l.iter(e);!a.done;a.next()){var n=a.value;if(!r.includes(n)){t=!1;break}}return t},getIdForEntry:function(e){for(var t,r=l.iter(this.lookup_);!r.done;r.next()){var a=r.key,n=r.value;if(l.eq(m._equality_TheoColor_TheoColor,e,n)){t=a;break}}return t},color:function(e){return this.lookup_[e]},paletteID:{get:function(){return this.paletteID_},set:function(e){this.paletteID_=e}},setColor:function(e,t){this.setColors(l.dict([e,t]))},setColors:function(e){for(var t=!1,r=l.keys(e),a=l.clone(this.lookup_),n=l.iter(e);!n.done;n.next()){var o=n.key,u=n.value,s=this.lookup_[o];null==u&&null!=s?(t||(this.makeMutable(),this.publish(new i.ColorLibraryChangedMessage(this,!0,l.clone(r))),t=!0),l.removeKey(a,o)):null==u||null!=s&&l.eq(m._equality_TheoColor_TheoColor,u,s)||(t||(this.makeMutable(),this.publish(new i.ColorLibraryChangedMessage(this,!0,l.clone(r))),t=!0),a[o]=u)}if(t){var c=this.database.beginTransaction("flushColors",null);this.flushColors(l.clone(a)),c.mergeWithPrevious(),this.publish(new i.ColorLibraryChangedMessage(this,!1,l.clone(r)))}},colorCount:{get:function(){return l.count(this.lookup_)}},forEachColor:function(e){for(var t=l.iter(this.lookup_);!t.done;t.next())e(t.key,t.value)},recordUndoState:function(){return l.as(this.state.allProperties,["Dictionary","String","Any"])},restoreUndoState:function(e){null!=e&&this.matchProperties(l.clone(e))},matchProperties:function(e){var t=l.keys(this.lookup_).map((function(e){return e}),this);this.publish(new i.ColorLibraryChangedMessage(this,!0,l.clone(t))),this.makeMutable(),c.PostPublishingObject.prototype.matchProperties.call(this,l.clone(e)),this.publish(new i.ColorLibraryChangedMessage(this,!1,l.clone(t)))},asString:{get:function(){var e;return"ID:"+this.id.substr(0,8)+" paletteID:"+((e=this.paletteID)||null!=e?e:"<none>")+" themeColors:"+this.themeColorsAsString}},themeColorsAsString:{get:function(){for(var e,t=this,r=["themeColor0","themeColor1","themeColor2","themeColor3","themeColor4","themeColor5"],a=r.map((function(r){return(e=l.opt(t.color(r),(function(e){return e.rgbColor.asString})))||null!=e?e:"<none>"}),this),n="themeColors: ",o=l.iter(l.range(0,r.length,!1));!o.done;o.next()){var i=o.value;n+=r[i]+":("+a[i]+") "}return n}},willChangeState:function(e){var t;if(null!=(t=e[a.PROPERTY_ENTRIES])){u.CoreAssert.isTrue(null==this.changedIDs_,"Got a second will-change without an intervening did-change","ColorLibrary.willChangeState","ColorLibrary.swift",276),this.changedIDs_=[];var r=this.getCodec(a.PROPERTY_ENTRIES);u.CoreAssert.isTrue(null!=r,"Got a state change before the entries codec got registered. How?","ColorLibrary.willChangeState","ColorLibrary.swift",280);for(var n=l.clone(l.as(r.decode(t[0],this),["Array",["Dictionary","String","Any"]])),o=l.clone(l.as(r.decode(t[1],this),["Array",["Dictionary","String","Any"]])),s=l.clone(this.lookupFromEntries(l.clone(n))),m=l.clone(this.lookupFromEntries(l.clone(o))),g=l.keys(s),h=l.iter(l.keys(m));!h.done;h.next()){var f=h.value;g.includes(f)||g.push(f)}for(var v=l.iter(g);!v.done;v.next()){var p=s[f=v.value],d=m[f];null==p||null==d?this.changedIDs_.push(f):p.isEqual(d)||this.changedIDs_.push(f)}this.changedIDs_.length>0&&this.publish(new i.ColorLibraryChangedMessage(this,!0,l.clone(this.changedIDs_)))}c.PostPublishingObject.prototype.willChangeState.call(this,l.clone(e))},didChangeState:function(e){c.PostPublishingObject.prototype.didChangeState.call(this,l.clone(e)),null!=e[a.PROPERTY_ENTRIES]&&(u.CoreAssert.isTrue(null!=this.changedIDs_,"Got a did-change without a matching will-change","ColorLibrary.didChangeState","ColorLibrary.swift",320),this.publish(new i.ColorLibraryChangedMessage(this,!1,l.clone(this.changedIDs_))),this.changedIDs_=null)}}}),a),i.ColorLibraryChangedMessage=(o=function e(t,r,a){this.isBefore=r,this.isAfter=!r,this.affectedColorIDs=l.clone(a),g.TheoMessage.call(this,e.TYPE,t)},l.defineClass({name:"ColorLibraryChangedMessage",ctor:o,superName:"TheoMessage",statics:{TYPE:"ColorLibraryChangedMessage"}}),o)},Bqrm:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("cZuM"),l=r("Z25M"),u=r("FNB+"),s=r("wc1n"),c=r("pnSN"),m=r("fdtz"),g=r("c+uM"),h=r("JO5d"),f=r("8t9B"),v=r("oKlP");n.DesignConstraintFeatureExtractor=(a=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=o.clone(t),this.featureEvals_=[],s.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},o.defineClass({name:"DesignConstraintFeatureExtractor",ctor:a,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Maxzoomlevel",[this.evaluateMaxZoomLevel,s.FeatureType.Numerical]],["textareanotcontrasting",[this.evaluateForUnreadableText,s.FeatureType.Numerical]],["shapesareanotcontrasting",[this.evaluateForUnreadableShapes,s.FeatureType.Numerical]],["lockupareaoutofbounds",[this.evaluateForOutOfBoundsElements,s.FeatureType.Numerical]],["minfontsize",[this.evaluateMinimumFont,s.FeatureType.Numerical]],["maxfontsize",[this.evaluateMaximumFont,s.FeatureType.Numerical]],["mintextarea",[this.evaluateMinimumText,s.FeatureType.Numerical]],["maxtextarea",[this.evaluateMaximumText,s.FeatureType.Numerical]],["minshapesize",[this.evaluateMinimumShape,s.FeatureType.Numerical]],["maxshapesize",[this.evaluateMaximumShape,s.FeatureType.Numerical]],["lockupareaoverlapping",[this.evaluatePercentageOverlapping,s.FeatureType.Numerical]],["Maxemptyspace",[this.evaluateEmptySpace,s.FeatureType.Numerical]],["textincorrectalign",[this.evaluateIncorrectlyAligned,s.FeatureType.Numerical]],["emptygridsquares",[this.evaluateEmptyGridPercent,s.FeatureType.Numerical]],["overlappingmultiplegridcells",[this.evaluateOverlappingMultipleGridCells,s.FeatureType.Numerical]],["maxaspectratio",[this.evaluateMaxAspectRatio,s.FeatureType.Numerical]],["breakingflowX",[this.evaluateBreakFlowX,s.FeatureType.Numerical]],["breakingflowY",[this.evaluateBreakFlowY,s.FeatureType.Numerical]],["BreakingHorisontalSymmetryinsidevisualparent",[this.evaluateHorisontalSymmetry,s.FeatureType.Numerical]],["marginsaretoosmall",[this.evaluateMargins,s.FeatureType.Numerical]],["balanceofvisualparentX",[this.evaluateBalanceX,s.FeatureType.Numerical]],["balanceofvisualparentY",[this.evaluateBalanceY,s.FeatureType.Numerical]],["totalalignmentlines",[this.evaluateTotalAlignmentLines,s.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=o.iter(this.featureEvals_);!t.done;t.next()){var r=t.value;if(e||!e&&this.forFeatures_.includes(r[0])){var a=r[1],n=(0,a[0])(this);this.setFeature(r[0],n,a[1])}}},evaluateMaxZoomLevel:function(e){for(var t=o.clone(e.root_.filterByKind(m.ImageForma.KIND)),r=v.TheoPoint.ZERO,a=o.iter(t);!a.done;a.next()){var n=a.value.placement.extractedScale.scale;n.length()>r.length()&&(r=n)}return r.length()},evaluateForUnreadableText:function(e){return e.TestUnreadableController(f.TypeLockupController.KIND)},evaluateForUnreadableShapes:function(e){return e.TestUnreadableController(h.ShapeController.KIND)},evaluateForOutOfBoundsElements:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),r=e.root_.finalFrame,a=0,n=0,i=o.iter(t);!i.done;i.next()){var l,u;(l=i.value.finalFrame)&&(n+=l.area,(u=r.intersectionWith(l))&&(a+=u.area))}return(n-a)/Math.max(1e-5,n)},evaluateMinimumFont:function(e){for(var t,r=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.controller.kind==f.TypeLockupController.KIND}))),a=null,n=o.iter(r);!n.done;n.next()){var i=n.value.controller.averageLineHeight;0!=i&&(null==a||i<a)&&(a=i)}return(t=a)||null!=t?t:0},evaluateMaximumFont:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.controller.kind==f.TypeLockupController.KIND}))),r=0,a=o.iter(t);!a.done;a.next()){var n=a.value.controller.averageLineHeight;n>r&&(r=n)}return r},evaluateMinimumText:function(e){return e.getMinControllerArea(f.TypeLockupController.KIND)},evaluateMaximumText:function(e){return e.getMaxControllerArea(f.TypeLockupController.KIND)},evaluateMinimumShape:function(e){return e.getMinControllerArea(h.ShapeController.KIND)},evaluateMaximumShape:function(e){return e.getMaxControllerArea(h.ShapeController.KIND)},evaluatePercentageOverlapping:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))),r=[],a=o.iter(t);!a.done;a.next()){var n=a.value;r.push(n.finalFrame)}for(var i=0,l=0,u=0,s=o.iter(r);!s.done;s.next()){var c=s.value;l+=c.area;for(var m=o.iter(o.range(0,u,!1));!m.done;m.next()){var g=m.value,h=c.intersectionWith(r[g]);null!=h&&(i+=h.area)}u+=1}return 2*i/l},evaluateEmptySpace:function(e){return l.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateIncorrectlyAligned:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))),r=t.filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(r.length<=1)return 0;for(var a=0,n=o.iter(r);!n.done;n.next()){var u=n.value,s=o.clone(u.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD)),c=o.clone(l.DesignFeatureUtils.getLockupsWithin(u,o.clone(r),300));o.clone(l.DesignFeatureUtils.getSetDiff(o.clone(c),o.clone(s))).length>0&&(a+=1)}return a/o.toDouble(t.length)},evaluateEmptyGridPercent:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return e.isGridCell()}))),r=0,a=o.iter(t);!a.done;a.next()){var n=a.value,i=o.clone(e.root_.filterWithCallback((function(e){return null!=e.finalFrame&&null!=e.controller&&(e.finalFrame.intersects(n.finalFrame)||e.finalFrame.contains(n.finalFrame))&&e.controller.floating})));n.isShape()&&0==i.length&&(r+=1)}return r/o.toDouble(t.length)},evaluateOverlappingMultipleGridCells:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),r=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&(e.isGridCell()||e.isShape())}))),a=0,n=o.iter(t);!n.done;n.next()){var i=n.value;i.kind==c.GroupForma.KIND?a+=e.groupOverlapHelper(i,o.clone(r)):a+=e.overlapHelper(i,o.clone(r))}return a},evaluateMaxAspectRatio:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return e.isGridCell()}))),r=0,a=o.iter(t);!a.done;a.next()){var n=a.value.finalFrame;if(n.area>0){var i=(n.width>n.height?n.width:n.height)/(n.width>n.height?n.height:n.width);i>r&&(r=i)}}return r},evaluateBreakFlowX:function(e){return e.breakFlowHelper(!0)},evaluateBreakFlowY:function(e){return e.breakFlowHelper(!1)},evaluateHorisontalSymmetry:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating})));if(0==t.length)return 0;for(var r=0,a=o.iter(t);!a.done;a.next()){var n=a.value,l=n.finalFrame.center.x,u=n.controller.visualParent.finalFrame.center.x,s=i.AlignmentDetector.DISTANCE_THRESHOLD;Math.abs(l-u)>s&&(r+=Math.exp(2*s-Math.abs(l-u)))}return r},evaluateMargins:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),r=0,a=o.iter(t);!a.done;a.next()){var n=a.value,i=e.getMinMarginHelper(n);r+=Math.exp(9-i)}return r>9999999?9999999:r},evaluateBalanceX:function(e){return e.balanceHelper(!0)},evaluateBalanceY:function(e){return e.balanceHelper(!1)},evaluateTotalAlignmentLines:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))).filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(t.length<=1)return 0;for(var r=0,a=[],n=o.iter(t);!n.done;n.next()){var l=n.value,s=o.clone(l.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD));if(s.length>0){for(var c=[],m=o.iter(s);!m.done;m.next()){var g=m.value;if(null!=g.forma){var h=g.forma;null!=h.controller&&h.controller.floating&&(h.isTypeLockup()||h.isShape())&&c.push(g.forma)}}for(var f=o.iter(c);!f.done;f.next()){var v=f.value;if(!o.containsEq(a,v,u._equality_Forma_Forma)){for(var p=o.iter(c);!p.done;p.next()){var d=p.value;o.containsEq(a,d,u._equality_Forma_Forma)||a.push(d)}o.containsEq(a,l,u._equality_Forma_Forma)||a.push(l),r+=1;break}}}}return r},TestUnreadableController:function(e,t,r){void 0===t&&(t=5),void 0===r&&(r=.05);var a=o.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e})));if(0==a.length)return 0;for(var n=0,i=0,l=o.iter(a);!l.done;l.next()){for(var u=l.value,s=[],c=u.finalFrame,m=!!u.isTypeLockup()&&u.style.textLook==g.LockupTextLook.Shadow,h=o.clone(c.split(t,!0)),f=o.iter(h);!f.done;f.next()){var v=f.value,p=o.clone(v.split(t,!1));o.append(s,p)}for(var d=0,F=o.iter(s);!F.done;F.next()){var y=F.value,C=u.controller.getBackgroundColor(y),T=u.style.colors.fieldPrimary,_=u.style.colors.fieldSecondary;null!=T&&null!=C&&(C.contrasts(T,!1)||null!=_&&!m&&C.contrasts(_,!1)||(d+=1))}d/o.toDouble(t*t)>r&&(n+=c.area),i+=c.area}return n/i},getMaxControllerArea:function(e){for(var t=o.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e}))),r=0,a=o.iter(t);!a.done;a.next()){var n=a.value.finalFrame.area;n>r&&(r=n)}return r},getMinControllerArea:function(e){for(var t=o.clone(this.root_.filterWithCallback((function(t){return null!=t.controller&&t.controller.floating&&t.controller.kind==e}))),r=null,a=o.iter(t);!a.done;a.next()){var n=a.value.finalFrame.area;0!=n&&(null==r||n<r)&&(r=n)}return null==r?0:r},overlapHelper:function(e,t){for(var r=0,a=e.finalFrame,n=o.iter(t);!n.done;n.next()){var i=n.value,l=i.finalFrame;if(!l.contains(a)&&e.controller.visualParent.formaID==i.controller.visualParent.formaID||e.controller.visualParent.formaID==this.root_.formaID){var u=l.intersectionWith(a);null!=u&&u.area/a.area<.5&&(r+=.5-u.area/a.area)}}return r},groupOverlapHelper:function(e,t){for(var r=0,a=e.childrenFinalFrame,n=o.iter(t);!n.done;n.next()){var i=n.value,l=i.finalFrame;if(!l.contains(a)&&e.controller.groupVisualParent.formaID==i.controller.visualParent.formaID||e.controller.groupVisualParent.formaID==this.root_.formaID){var u=l.intersectionWith(a);null!=u&&u.area/a.area<.5&&(r+=.5-u.area/a.area)}}return r},balanceHelper:function(e){for(var t=o.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),r={},a={},n=o.iter(t);!n.done;n.next()){var i=n.value;null==r[(c=i.controller.visualParent).formaID]?(r[c.formaID]=[i],a[c.formaID]=c.finalFrame):r[c.formaID].push(i)}for(var l=0,u=0,s=o.iter(r);!s.done;s.next()){for(var c=s.key,m=s.value,g=e?a[c].center.x:a[c].center.y,h=0,f=0,v=o.iter(m);!v.done;v.next()){var p=v.value.finalFrame,d=e?p.center.x:p.center.y,F=e?p.width:p.height,y=d-F/2;if(g>d+F/2)h+=p.area;else if(g<y)f+=p.area;else{var C=(g-y)/F;h+=p.area*C,f+=p.area*(1-C)}}l+=Math.abs(h-f),u+=h+f}return l/u},breakFlowHelper:function(e){var t=o.clone(this.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()})));if(0==t.length)return 0;for(var r=0,a=o.iter(t);!a.done;a.next())for(var n=a.value,i=n.controller.averageLineHeight,l=e?n.finalFrame.center.x:n.finalFrame.center.y,s=e?n.finalFrame.minX:n.finalFrame.minY,c=o.iter(t);!c.done;c.next()){var m=c.value;if(o.eq(u._equality_Forma_Forma,n,m))break;var g=m.controller.averageLineHeight,h=e?m.finalFrame.center.x:m.finalFrame.center.y,f=e?m.finalFrame.minX:m.finalFrame.minY;if(g>i){var v=h-l,p=f-s;if((p<v?p:v)>0){r+=1;break}}}return 2*r/o.toDouble(t.length)},getMinMarginHelper:function(e){var t,r;e.kind==c.GroupForma.KIND?(t=e.childrenFinalFrame,r=e.controller.groupVisualParent.finalFrame):(t=e.finalFrame,r=e.controller.visualParent.finalFrame);var a=r.maxY-t.maxY;return t.minX-r.minX<a&&(a=t.minX-r.minX),t.minY-r.minY<a&&(a=t.minY-r.minY),r.maxX-t.maxX<a&&(a=r.maxX-t.maxX),a}}}),a)},KsJe:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("cZuM"),l=r("Z25M"),u=r("wc1n"),s=r("dNmX"),c=r("c+uM"),m=r("TkOd"),g=r("K0Rh"),h=r("7Ta2"),f=r("djAF"),v=r("8t9B");n.LockupStyleFeatureExtractor=(a=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.lockupController_=o.as(this.forma_.controller,v.TypeLockupController),this.forFeatures_=o.clone(t),this.featureEvals_=[],this.lockupAttributes=m.lockupStyleToLockupStyleAttributes(this.forma_.style,e.page.document),u.FeatureExtractor.call(this),null!=this.lockupController_&&(this.initFeatures(),this.evaluateFeatures())},o.defineClass({name:"LockupStyleFeatureExtractor",ctor:a,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Role",[this.evaluateRole,u.FeatureType.Categorical]],["BoundingBox",[this.evaluateBoundingBox,u.FeatureType.Complex]],["BackgroundColors",[this.evaluateBackgroundColors,u.FeatureType.Complex]],["ImageCount",[this.evaluateImageCount,u.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,u.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,u.FeatureType.Numerical]],["TextHeight",[this.evaluateTextHeight,u.FeatureType.Numerical]],["TextWidth",[this.evaluateTextWidth,u.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,u.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,u.FeatureType.Numerical]],["AspectRatio",[this.evaluateAspectRatio,u.FeatureType.Numerical]],["BackgroundType",[this.evaluateBackgroundType,u.FeatureType.Categorical]],["AverageHue",[this.evaluateAverageHue,u.FeatureType.Numerical]],["AverageLightness",[this.evaluateLightness,u.FeatureType.Numerical]],["LightnessSpread",[this.evaluateLightnessSpread,u.FeatureType.Numerical]],["PercentageArea",[this.evaluatePercentageArea,u.FeatureType.Numerical]],["PercentageAreaAllLockups",[this.evaluateAllLockPercentageArea,u.FeatureType.Numerical]],["LockupSymmetryX",[this.evaluateXSymmetry,u.FeatureType.Numerical]],["LockupSymmetryY",[this.evaluateYSymmetry,u.FeatureType.Numerical]],["DistanceXFromCenter",[this.evaluateXDistanceFromCenter,u.FeatureType.Numerical]],["TextString",[this.evaluateTextString,u.FeatureType.Categorical]],["CenterX",[this.evaluateCenterX,u.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,u.FeatureType.Numerical]],["CharacterCount",[this.evaluateCharacterCount,u.FeatureType.Numerical]],["LineHeight",[this.evaluateLineHeight,u.FeatureType.Numerical]],["WordCount",[this.evaluateWordCount,u.FeatureType.Numerical]],["Font",[this.evaluateStyleFont,u.FeatureType.Categorical]],["BackingShape",[this.evaluateStyleBackingShape,u.FeatureType.Categorical]],["TextLook",[this.evaluateStyleTextLook,u.FeatureType.Categorical]],["Layout",[this.evaluateStyleLayout,u.FeatureType.Categorical]],["Opacity",[this.evaluateStyleOpacity,u.FeatureType.Categorical]],["PrimaryColor",[this.evaluateStylePrimaryColor,u.FeatureType.Categorical]],["SecondaryColor",[this.evaluateStyleSecondaryColor,u.FeatureType.Categorical]],["ShapeFilled",[this.evaluateStyleShapeFilled,u.FeatureType.Numerical]],["TextOpacity",[this.evaluateStyleTextOpacity,u.FeatureType.Numerical]],["BackingOpacity",[this.evaluateStyleBackingOpacity,u.FeatureType.Numerical]],["Padding",[this.evaluateStylePadding,u.FeatureType.Numerical]],["ShadowAngle",[this.evaluateStyleShadowAngle,u.FeatureType.Numerical]],["ShadowOffsetY",[this.evaluateStyleShadowOffsetY,u.FeatureType.Numerical]],["Spacing",[this.evaluateStyleSpacing,u.FeatureType.Numerical]],["StrokeWeight",[this.evaluateStyleStokeWeight,u.FeatureType.Numerical]],["Tracking",[this.evaluateStyleTracking,u.FeatureType.Numerical]],["HasMSL",[this.evaluateHasMSL,u.FeatureType.Numerical]],["CollisionPercentage",[this.evaluatePercentageOverlappingWithOtherLockupsAndShapes,u.FeatureType.Numerical]],["SurroundingAlignment",[this.evaluateSurroundingAlignment,u.FeatureType.Complex]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=o.iter(this.featureEvals_);!t.done;t.next()){var r=t.value;if(e||!e&&this.forFeatures_.includes(r[0])){var a=r[1],n=(0,a[0])(this);this.setFeature(r[0],n,a[1])}}},evaluateWordCount:function(e){return o.toDouble(e.lockupController_.wordCount())},evaluateLineHeight:function(e){var t=e.lockupController_.averageLineHeight;return null!=t?t:0},evaluateCharacterCount:function(e){return o.toDouble(e.lockupController_.text.length)},evaluateRole:function(e){return(new h.RoleSuggester).getRole(e.forma_).role},evaluateBoundingBox:function(e){return l.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateBackgroundColors:function(e){return this.setColorsBehindLockup(e),e.colorsBehindLockup.map((function(e){return e.hex}),this)},evaluateImageCount:function(e){return l.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return l.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return l.DesignFeatureUtils.getTextCount(e.root_)},evaluateTextHeight:function(e){return l.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateTextWidth:function(e){return l.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateBackgroundType:function(e){for(var t="root",r=o.clone(e.root_.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==f.ShapeForma.KIND||e.kind==g.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))),a=o.iter(r);!a.done;a.next()){var n=a.value;n.isBackgroundImage()&&n.finalFrame.outsetXY(20,20).contains(e.forma_.finalFrame)?t="image":n.kind==f.ShapeForma.KIND&&(t="shape")}return t},evaluateAverageHue:function(e){var t=0,r=0,a=0,n=0;this.setColorsBehindLockup(e);for(var i=o.iter(e.colorsBehindLockup);!i.done;i.next()){var l=i.value.asLAB;t+=l.l*l.l,r+=l.a*l.a,a+=l.b*l.b,n+=l.alpha*l.alpha}var u=o.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/u),r=Math.sqrt(r/u),a=Math.sqrt(a/u),n=Math.sqrt(n/u),new s.LABColor(t,r,a,n).hue},evaluateAspectRatio:function(e){var t=l.DesignFeatureUtils.getFormaHeight(e.forma_),r=l.DesignFeatureUtils.getFormaWidth(e.forma_);return o.toDouble(r/t)},evaluateLightness:function(e){var t=0,r=0,a=0,n=0;this.setColorsBehindLockup(e);for(var i=o.iter(e.colorsBehindLockup);!i.done;i.next()){var l=i.value.asLAB;t+=l.l*l.l,r+=l.a*l.a,a+=l.b*l.b,n+=l.alpha*l.alpha}var u=o.toDouble(e.colorsBehindLockup.length);return t=Math.sqrt(t/u),r=Math.sqrt(r/u),a=Math.sqrt(a/u),n=Math.sqrt(n/u),new s.LABColor(t,r,a,n).asRGB.lightness},evaluateLightnessSpread:function(e){return this.setColorsBehindLockup(e),e.lockupController_.getBackgroundLightnessSpread(o.clone(e.colorsBehindLockup))},evaluatePercentageArea:function(e){return l.DesignFeatureUtils.formaPercentageArea(e.forma_)},evaluateAllLockPercentageArea:function(e){for(var t=0,r=o.clone(e.forma_.page.root.filterWithCallback((function(e){return e.isTypeLockup()}))),a=o.iter(r);!a.done;a.next()){var n=a.value;t+=l.DesignFeatureUtils.formaPercentageArea(n)}return t},evaluateXSymmetry:function(e){return l.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!0)},evaluateYSymmetry:function(e){return l.DesignFeatureUtils.getSymmAsymm([e.forma_.finalFrame],!1)},evaluateXDistanceFromCenter:function(e){var t,r,a=-1;return(t=e.forma_.finalFrame)&&(r=e.root_.finalFrame)&&(a=t.center.distanceTo(r.center)),a},evaluateTextString:function(e){return e.lockupController_.text},evaluateCenterX:function(e){return l.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return l.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluatePageWidth:function(e){return l.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return l.DesignFeatureUtils.getPageHeight(e.root_)},evaluateStyleShapeFilled:function(e){return e.forma_.style.textBacked?1:0},evaluateStyleTextOpacity:function(e){return e.lockupAttributes.textOpacity},evaluateStyleBackingOpacity:function(e){return e.lockupAttributes.backingOpacity},evaluateStylePadding:function(e){return e.lockupAttributes.padding},evaluateStyleShadowAngle:function(e){return e.lockupAttributes.shadowAngle},evaluateStyleShadowOffsetY:function(e){return e.lockupAttributes.shadowOffset},evaluateStyleSpacing:function(e){return e.lockupAttributes.spacing},evaluateStyleStokeWeight:function(e){return e.lockupAttributes.strokeWeight},evaluateStyleTracking:function(e){return e.lockupAttributes.tracking},evaluateHasMSL:function(e){var t=o.clone(e.forma_.style.characterStyles);return 0!=o.count(t)?1:0},evaluateStyleFont:function(e){return o.toString(e.lockupAttributes.font)},evaluateStyleBackingShape:function(e){return e.lockupAttributes.backing},evaluateStyleTextLook:function(e){return e.lockupAttributes.textLook},evaluateStyleLayout:function(e){return e.lockupAttributes.layout},evaluateStyleOpacity:function(e){return e.lockupAttributes.opacity},evaluateStylePrimaryColor:function(e){return e.lockupAttributes.primaryColor},evaluateStyleSecondaryColor:function(e){return e.lockupAttributes.secondaryColor},setColorsBehindLockup:function(e){null==e.colorsBehindLockup&&(e.colorsBehindLockup=o.clone(e.lockupController_.getBackgroundColors()))},evaluatePercentageOverlappingWithOtherLockupsAndShapes:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isTypeLockup()||e.kind==f.ShapeForma.KIND&&!e.isGridCell()}))),r=1,a=null,n=[],i=o.iter(t);!i.done;i.next()){var u=i.value;u.kind==f.ShapeForma.KIND&&e.forma_.formaID==l.DesignFeatureUtils.getTypeLockupParentFormaIDofShape(u.parent)?u.finalFrame.area>r&&(r=(a=u.finalFrame).area):u.formaID!=e.forma_.formaID&&n.push(u.finalFrame)}null==a&&(r=(a=e.forma_.finalFrame).area);for(var s=0,c=o.iter(n);!c.done;c.next()){var m=c.value.intersectionWith(a);null!=m&&(s+=m.area)}return s/r},evaluateSurroundingAlignment:function(e){var t=c.LockupAlignment.UNSET,r=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&e.isTypeLockup()}))).filter((function(e){return Math.acos(e.totalPlacement.transformValues.rotCosine)<1e-4}),this);if(r.length>1){var a=o.clone(e.forma_.controller.alignmentDetector.detectFormaAlignments(i.AlignmentDetector.DISTANCE_THRESHOLD)),n=o.clone(l.DesignFeatureUtils.getLockupsWithin(e.forma_,o.clone(r),800)),u=o.clone(l.DesignFeatureUtils.getSetSimm(o.clone(n),o.clone(a))),s=o.clone(l.DesignFeatureUtils.getAlignmentConcensus(o.clone(u)));if(s[o.first(o.keys(s))]>.5){var m=o.first(o.keys(s));m==i.describeAlignmentType(i.AlignmentType.Left)?t=c.LockupAlignment.Left:m==i.describeAlignmentType(i.AlignmentType.Right)?t=c.LockupAlignment.Right:m==i.describeAlignmentType(i.AlignmentType.CenterX)&&(t=c.LockupAlignment.Center)}}return t}}}),a)},Q1H8:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("Bqrm"),l=r("pnSN"),u=r("cbNz"),s=r("jC54"),c=r("9BFu");n.DesignScore=(a=function(e){this.versionNumber=1,this.rejectThreshold=-10,this.dataset="DefaultDesignScore",this.root_=e;for(var t,r,a={},n=o.clone(new i.DesignConstraintFeatureExtractor(this.root_).numericalFeatures),s=o.iter(o.keys(n));!s.done;s.next())a[h=s.value]=n[h];if((t=this.root_.controller.getGridController())&&(r=o.as(t.forma,l.GroupForma)))for(var m=o.clone(new u.GridStyleFeatureExtractor(r).numericalFeatures),g=o.iter(o.keys(m));!g.done;g.next()){var h;a[h=g.value]=m[h]}c.WeightedScore.call(this,o.count(a)),this.writeDoubleFeatureDict(this.dataset,o.clone(a))},o.defineClass({name:"DesignScore",ctor:a,superName:"WeightedScore",props:{writeDoubleFeatureDict:function(e,t){var r=this,a=0;o.each(t,(function(t,n){var o=s.ModelWeightLibrary.getData(e,t);r.setFeatureName(a,t),r.setMean(a,o.mean),r.setStd(a,o.std),r.setWeight(a,o.weight),r.setFeature(a,n),a+=1}))},reject:function(){return this.score<this.rejectThreshold}}}),a)},Yudi:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("Z25M"),l=r("FNB+"),u=r("wc1n"),s=r("9Lk3"),c=r("fdtz"),m=r("JO5d"),g=r("T6jX"),h=r("3UhB"),f=r("1NAc"),v=r("zjod"),p=r("zjY7");n.RetargetFeatureExtractor=(a=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=o.clone(t),this.featureEvals_=[],u.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},o.defineClass({name:"RetargetFeatureExtractor",ctor:a,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["Size",[this.evaluateDesignSize,u.FeatureType.Complex]],["EditingResolution",[this.evaluateEditingResolution,u.FeatureType.Numerical]],["PublishResolution",[this.evaluatePublishingResolution,u.FeatureType.Numerical]],["LayoutId",[this.evaluateLayoutId,u.FeatureType.Categorical]],["Edges",[this.evaluateEdges,u.FeatureType.Complex]],["Focus",[this.evaluateFocus,u.FeatureType.Complex]],["NumImages",[this.evaluateImageCount,u.FeatureType.Numerical]],["NumShapes",[this.evaluateShapeCount,u.FeatureType.Numerical]],["NumGridsCells",[this.evaluateGridCellCount,u.FeatureType.Numerical]],["NumMoveable",[this.evaluateNumMoveable,u.FeatureType.Numerical]],["LockupStrings",[this.evaluateLockupStrings,u.FeatureType.Complex]],["VisualGroupInfo",[this.evaluateVisualGroupInfo,u.FeatureType.Complex]],["TextRoles",[this.evaluateTextRoles,u.FeatureType.Complex]],["ShapeRoles",[this.evaluateShapeRoles,u.FeatureType.Complex]],["SalientCoverage",[this.evaluateSalientCoverage,u.FeatureType.Numerical]],["GifsCount",[this.evaluateGifsCount,u.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=o.iter(this.featureEvals_);!t.done;t.next()){var r=t.value;if(e||!e&&this.forFeatures_.includes(r[0])){var a=r[1],n=(0,a[0])(this);this.setFeature(r[0],n,a[1])}}},evaluateDesignSize:function(e){var t=[];return t.push(i.DesignFeatureUtils.getPageWidth(e.root_)),t.push(i.DesignFeatureUtils.getPageHeight(e.root_)),t},evaluateEditingResolution:function(e){return 2},evaluatePublishingResolution:function(e){return 2},evaluateLayoutId:function(e){var t="default",r=o.clone(e.root_.filterByControllerKind(s.GridController.KIND));return r.length>0&&(t=o.as(r[0].controller,s.GridController).gridStyle.name),t},evaluateEdges:function(e){var t=[],r=o.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()})));return r.length>0&&(t=o.clone(r[0].controller.getAverageEdgeGrid(new f.TheoSize(5,5)))),t},evaluateFocus:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()}))),r=[];if(t.length>0){var a,n=t[0];(a=e.getFocusRegion(n))&&(r=o.clone(a.encodeJson()))}return r},getFocusRegion:function(e){var t=null;return e.visitAll(l.FormaTraversal.JustChildren,(function(e){e instanceof c.ImageForma&&null==t&&(t=e.getFocusRegion())})),t},evaluateImageCount:function(e){return i.DesignFeatureUtils.getNonLogoImageCount(e.root_)},evaluateNumMoveable:function(e){return o.toDouble(e.root_.filterWithCallback(i.DesignFeatureUtils.isFloating).length)},evaluateLockupStrings:function(e){return h.TypeLockupUtils.getLockupStringsForRoot(e.root_)},evaluateTextRoles:function(e){for(var t=[],r=o.clone(i.DesignFeatureUtils.getLockupsInDesign(e.root_)),a=o.iter(r);!a.done;a.next()){var n=a.value;t.push(i.DesignFeatureUtils.getRoleString(n))}return t},evaluateShapeRoles:function(e){var t=[];if(g.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.root_.page))return t;for(var r=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==m.ShapeController.KIND&&!e.isGridCell()}))),a=o.iter(r);!a.done;a.next()){var n=a.value;t.push(i.DesignFeatureUtils.getRoleString(n))}return t},evaluateShapeCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==m.ShapeController.KIND&&!e.isGridCell()})).length)},evaluateSalientCoverage:function(e){for(var t=o.clone(e.root_.filterWithCallback((function(e){return e.isBackgroundImage()}))),r=0,a=o.iter(t);!a.done;a.next()){var n,i,l,u=a.value;(n=e.root_.finalFrame)&&(i=e.getFocusRegion(u))&&(l=i.intersectionWith(n))&&(r+=l.area/n.area)}return r},evaluateVisualGroupInfo:function(e){var t={};if(g.TheoDocumentUtils.enableFastHeuristicsForComplexPage(e.root_.page))return t;var r=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating&&!e.isGridCell()&&e.kind!=c.ImageForma.KIND})));if(r.length>0){var a=new p.VisualStructureDetector(o.clone(r),e.root_).inferVisualStructure();return o.opt(a,(function(e){return e.encodeToJson()}))||t}return t},evaluateGridCellCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isGridCell()})).length)},evaluateGifsCount:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return e.kind==v.VideoForma.KIND})));return o.toDouble(t.length)}}}),a)},Z25M:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("cZuM"),l=r("SpAV"),u=r("gXiO"),s=r("FNB+"),c=r("cmoc"),m=r("fdtz"),g=r("lmwz"),h=r("c+uM"),f=r("7Ta2"),v=r("JO5d"),p=r("djAF"),d=r("8t9B"),F=r("sIWg");n.DesignFeatureUtils=(a=function(){u.CoreObject.call(this)},o.defineClass({name:"DesignFeatureUtils",ctor:a,superName:"CoreObject",statics:{evaluateRootEmptySpace:function(e){for(var t=o.clone(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating}))),r={},a={},n=o.iter(t);!n.done;n.next()){var i=n.value,l=i.controller.visualParent;null==a[l.formaID]&&(a[l.formaID]=l),null==r[l.formaID]&&(r[l.formaID]=[]),r[l.formaID].push(i)}for(var u=[],s=o.iter(r);!s.done;s.next()){for(var c=s.key,m=s.value,g=0,h=o.iter(m);!h.done;h.next())g+=h.value.finalFrame.area;null!=a[c].finalFrame&&g>0&&u.push(g/a[c].finalFrame.area)}return 0==u.length?0:1-o.min(u)},getSymmAsymmForForma:function(e,t,r){void 0===r&&(r=0);for(var n=[],i=o.iter(e);!i.done;i.next()){var l=i.value;n.push(l.finalFrame)}return a.getSymmAsymm(o.clone(n),t,r)},getSymmAsymm:function(e,t,r){var n;void 0===r&&(r=0);for(var i=0,l=o.iter(e);!l.done;l.next())for(var u=l.value,s=t?new F.TheoRect(u.minX,1-u.maxY,u.maxX,1-u.minY):new F.TheoRect(1-u.maxX,u.minY,1-u.minX,u.maxY),c=o.iter(e);!c.done;c.next()){var m=c.value,g=a.frameIntersection(m,s);i+=(n=o.opt(g,(function(e){return e.area})))||null!=n?n:0}return e.length>0?i:r},frameIntersection:function(e,t){var r=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(r=new F.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),r},getImageCount:function(e){return o.toDouble(e.filterWithCallback((function(e){return e instanceof m.ImageForma})).length)},getNonLogoImageCount:function(e){return o.toDouble(e.filterWithCallback((function(e){return g.ImageFacade.isPotentialBackgroundImage(e)})).length)},getPossibleBackgroundImageCount:function(e){return o.toDouble(e.filterWithCallback((function(e){return g.ImageFacade.isPotentialBackgroundImage(e)})).length)},getTextCount:function(e){return o.toDouble(e.filterWithCallback((function(e){return e.isTypeLockup()})).length)},getShapeCount:function(e){return o.toDouble(e.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==v.ShapeController.KIND&&!e.isGridCell()})).length)},getFormaBoundingBox:function(e){for(var t=[],r=o.clone(e.totalPlacement.transformPoints(o.clone(e.bounds.points))),a=o.iter(r);!a.done;a.next()){var n=a.value;t.push(n.x),t.push(n.y)}return t},formaPercentageArea:function(e){var t,r=0;if(t=e.bounds){var a=o.clone(e.totalPlacement.transformPoints(o.clone(t.points))),n=a[3].x-a[0].x,i=a[3].y-a[0].y,l=e.page.pageSize.height;r=n*i/(e.page.pageSize.width*l)}return r},getFormaCenterX:function(e){var t=o.clone(e.totalPlacement.transformPoints(o.clone(e.bounds.points)));return(t[0].x+t[3].x)/2/e.page.pageSize.width},getFormaCenterY:function(e){var t=o.clone(e.totalPlacement.transformPoints(o.clone(e.bounds.points)));return(t[0].y+t[3].y)/2/e.page.pageSize.height},getPageWidth:function(e){return e.page.pageSize.width},getPageHeight:function(e){return e.page.pageSize.height},getFormaHeight:function(e){var t=o.clone(e.totalPlacement.transformPoints(o.clone(e.bounds.points))),r=t[1].distanceTo(t[0]);return l.CoreAssert.isTrue(r>=0,void 0,"DesignFeatureUtils.getFormaHeight","DesignFeatureUtils.swift",178),r},getFormaWidth:function(e){var t=o.clone(e.totalPlacement.transformPoints(o.clone(e.bounds.points))),r=t[2].distanceTo(t[0]);return l.CoreAssert.isTrue(r>=0,void 0,"DesignFeatureUtils.getFormaWidth","DesignFeatureUtils.swift",186),r},sumAreaOfForma:function(e,t){var r,a=0;if(r=t.finalFrame){l.CoreAssert.isTrue(r.area>0,void 0,"DesignFeatureUtils.sumAreaOfForma","DesignFeatureUtils.swift",193);for(var n=o.iter(e);!n.done;n.next()){var i;(i=n.value.finalFrame.intersectionWith(r))&&(a+=i.area/r.area)}}return Math.max(a,1)},getLockupsInDesign:function(e){return e.filterByControllerKind(d.TypeLockupController.KIND)},getRoleString:function(e){return(new f.RoleSuggester).getRole(e).role},isFloating:function(e){var t;return(!(t=o.opt(e.controller,(function(e){return e.userGroupChild})))&&null==t||!t)&&(!(null==e.controller||!e.controller.userGroup||!e.controller.floating)||e.isTypeLockup()||e.kind==p.ShapeForma.KIND&&e.hasIntent(s.Forma.INTENT_ICON)||e.kind==c.FrameForma.KIND&&e.controller.floating&&!e.isLogo())},getTypeLockupParentFormaIDofShape:function(e){var t;return e.style.kind==h.LockupStyle.KIND?e.formaID:(t=e.parent)?a.getTypeLockupParentFormaIDofShape(t):null},getLockupsWithin:function(e,t,r){for(var a=[],n=o.iter(t);!n.done;n.next()){var i=n.value,l=i.finalFrame.center.distanceTo(e.finalFrame.center);e.formaID!=i.formaID&&l<r&&a.push(i)}return a},getSetDiff:function(e,t){for(var r=[],a=o.iter(e);!a.done;a.next()){for(var n=a.value,i=!1,l=o.iter(t);!l.done;l.next())l.value.forma.formaID==n.formaID&&(i=!0);i||r.push(n)}return r},getSetSimm:function(e,t){for(var r=[],a=o.iter(e);!a.done;a.next())for(var n=a.value,i=o.iter(t);!i.done;i.next()){var l=i.value;if(l.forma.formaID==n.formaID){r.push(o.clone(l));break}}return r},getAlignmentConcensus:function(e){for(var t={},r=o.iter(e);!r.done;r.next()){var a=r.value,n=i.describeAlignmentType(a.line.type);o.keys(t).includes(n)?t[n]=t[n]+1:t[n]=1}for(var l=0,u=i.describeAlignmentType(i.AlignmentType.None),s=o.iter(o.keys(t));!s.done;s.next())t[n=s.value]>l&&(l=t[n],u=n);var c=0;return e.length>0&&(c=o.toDouble(l)/o.toDouble(e.length)),o.dict([u,c])}}}),a)},c3Vl:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("ascj"),l=r("Z25M"),u=r("6ZWm"),s=r("wc1n"),c=r("9Lk3"),m=r("fdtz"),g=r("c+uM"),h=r("K0Rh"),f=r("djAF"),v=r("8t9B");n.DesignStyleFeatureExtractor=(a=function(e,t){void 0===t&&(t=[]),this.root_=e,this.forFeatures_=o.clone(t),this.featureEvals_=[],s.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},o.defineClass({name:"DesignStyleFeatureExtractor",ctor:a,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["TextSymmetryX",[this.evaluateTextXSymmetry,s.FeatureType.Numerical]],["TextSymmetryY",[this.evaluateTextYSymmetry,s.FeatureType.Numerical]],["Whitespace",[this.evaluateWhiteSpace,s.FeatureType.Numerical]],["DesignAngle",[this.evaluateDesignAngle,s.FeatureType.Numerical]],["TextDesignCoverage",[this.evaluateTextDesignCoverage,s.FeatureType.Numerical]],["ImageDesignCoverage",[this.evaluateImageDesignCoverage,s.FeatureType.Numerical]],["ShapeDesignCoverage",[this.evaluateShapeDesignCoverage,s.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,s.FeatureType.Numerical]],["ImageCount",[this.evaluateImageCount,s.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,s.FeatureType.Numerical]],["LogoCount",[this.evaluateLogoCount,s.FeatureType.Numerical]],["SalientCoverage",[this.evaluateSalientCoverage,s.FeatureType.Numerical]],["MarginSpace",[this.evaluateMarginSpace,s.FeatureType.Numerical]],["TextFonts",[this.evaluateFonts,s.FeatureType.Complex]],["TextShapes",[this.evaluateTextShapes,s.FeatureType.Complex]],["DesignColors",[this.evaluateColors,s.FeatureType.Complex]],["BackgroundTypes",[this.evaluateBackgroundTypes,s.FeatureType.Complex]],["GridCount",[this.evaluateGridCount,s.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,s.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,s.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,s.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,s.FeatureType.Numerical]],["VisualGroupInfo",[this.evaluateVisualGroupInfo,s.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=o.iter(this.featureEvals_);!t.done;t.next()){var r=t.value;if(e||!e&&this.forFeatures_.includes(r[0])){var a=r[1],n=(0,a[0])(this);this.setFeature(r[0],n,a[1])}}},evaluateTextXSymmetry:function(e){var t=o.clone(e.root_.filterByControllerKind(v.TypeLockupController.KIND));return l.DesignFeatureUtils.getSymmAsymmForForma(o.clone(t),!0)},evaluateTextYSymmetry:function(e){var t=o.clone(e.root_.filterByControllerKind(v.TypeLockupController.KIND));return l.DesignFeatureUtils.getSymmAsymmForForma(o.clone(t),!1)},evaluateWhiteSpace:function(e){return l.DesignFeatureUtils.evaluateRootEmptySpace(e.root_)},evaluateDesignAngle:function(e){return e.root_.page.pageSize.angle},evaluateTextDesignCoverage:function(e){return l.DesignFeatureUtils.sumAreaOfForma(o.clone(e.root_.filterByControllerKind(v.TypeLockupController.KIND)),e.root_)},evaluateImageDesignCoverage:function(e){return l.DesignFeatureUtils.sumAreaOfForma(o.clone(e.root_.filterByControllerKind(u.FrameController.KIND)),e.root_)},evaluateShapeDesignCoverage:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return e instanceof f.ShapeForma&&null!=e.controller&&e.controller.floating})));return l.DesignFeatureUtils.sumAreaOfForma(o.clone(t),e.root_)},evaluateTextCount:function(e){return l.DesignFeatureUtils.getTextCount(e.root_)},evaluateImageCount:function(e){return l.DesignFeatureUtils.getImageCount(e.root_)},evaluateShapeCount:function(e){return l.DesignFeatureUtils.getShapeCount(e.root_)},evaluateLogoCount:function(e){var t=o.clone(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.isLogo()})));return o.toDouble(t.length)},evaluateSalientCoverage:function(e){for(var t=o.clone(e.root_.filterByControllerKind(u.FrameController.KIND)),r=0,a=o.iter(t);!a.done;a.next()){var n,i,l,s=a.value;(n=e.root_.finalFrame)&&(i=o.opt(o.as(s,m.ImageForma),(function(e){return e.getFocusRegion()})))&&(l=i.intersectionWith(n))&&(r+=l.area/n.area)}return Math.max(r,1)},evaluateMarginSpace:function(e){var t,r=0,a=o.clone(e.root_.filterByControllerKind(c.GridController.KIND));return a.length>0&&(t=o.as(a[0].controller,c.GridController))&&(r=t.margin),r},evaluateVisualGroupInfo:function(e){return o.toDouble(0)},evaluateFonts:function(e){for(var t=[],r=o.iter(l.DesignFeatureUtils.getLockupsInDesign(e.root_));!r.done;r.next()){var a,n,i=r.value;(a=o.as(i.style,g.LockupStyle))&&(n=a.font)&&t.push(n.fontData.postScriptName)}return t},evaluateTextShapes:function(e){for(var t=[],r=o.iter(l.DesignFeatureUtils.getLockupsInDesign(e.root_));!r.done;r.next()){var a,n=r.value;(a=o.as(n.style,g.LockupStyle))&&t.push(a.backingShapeID)}return t},evaluateColors:function(e){for(var t=[],r=o.clone(e.root_.filterWithCallback((function(e){return e instanceof m.ImageForma}))),a=o.iter(r);!a.done;a.next()){var n,i,u=a.value;(n=o.as(u,m.ImageForma))&&(i=o.opt(n.contentNode,(function(e){return e.image})))&&o.append(t,i.getImageColors(5))}for(var s=o.iter(l.DesignFeatureUtils.getLockupsInDesign(e.root_));!s.done;s.next()){var c,h,f,v,p=s.value;(c=o.as(p.style,g.LockupStyle))&&((f=e.primaryColorForStyle(c))&&t.push(f),(v=e.secondaryColorForStyle(c))&&t.push(v),(h=c.characterStyles.Highlight)&&((f=e.primaryColorForStyle(h))&&t.push(f),(v=e.secondaryColorForStyle(h))&&t.push(v)))}return t.map((function(e){return e.hex}),this)},primaryColorForStyle:function(e){return e.colors.color(i.ColorRole.FieldPrimary)},secondaryColorForStyle:function(e){return e.backing!=g.LockupBacking.None&&e.backing!=g.LockupBacking.UNSET?e.colors.color(i.ColorRole.FieldSecondary):null},evaluateBackgroundTypes:function(e){for(var t=[],r=o.clone(e.root_.filterWithCallback((function(e){return(e.isBackgroundImage()||e.kind==f.ShapeForma.KIND||e.kind==h.RootForma.KIND)&&null!=e.controller&&!e.controller.moveable}))),a=o.iter(r);!a.done;a.next()){var n=a.value;n.isBackgroundImage()?t.push("image"):n.kind==f.ShapeForma.KIND?t.push("shape"):t.push("root")}return t},evaluatePageWidth:function(e){return l.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return l.DesignFeatureUtils.getPageHeight(e.root_)},evaluateGridCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==c.GridController.KIND&&e.isGridCell()})).length)},evaluateBackgroundImageCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&e.isGridCell()})).length)},evaluateForegroundImageCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&!e.isGridCell()})).length)}}}),a)},cZuM:function(e,t,r){var a,n,o,i,l,u,s=t,c=r("oAGj"),m=r("SpAV"),g=r("gXiO"),h=r("FNB+"),f=r("fdtz"),v=r("lmwz"),p=r("c+uM"),d=r("tGKA"),F=r("Zifs"),y=r("MnRR"),C=r("8t9B"),T=r("oKlP");s.AlignmentEdges=c.defineEnum("AlignmentEdges",{None:0,Left:1,Right:2,LeftAndRight:3,Top:4,Bottom:8,CenterX:16,CenterY:32,TopAndBottom:12,LeftAndTopAndBottom:13,Outer:15,All:63}),s.describeAlignmentType=function(e){switch(e){case 0:return"Left";case 1:return"CenterX";case 2:return"Right";case 3:return"Top";case 4:return"CenterY";case 5:return"Bottom";case 6:return"Rotation";case 7:return"None"}},s.AlignmentType=c.defineEnum("AlignmentType",{Left:0,CenterX:1,Right:2,Top:3,CenterY:4,Bottom:5,Rotation:6,None:7}),s.AlignmentLocation=c.defineEnum("AlignmentLocation",{Forma:0,Root:1}),s.LineStyle=c.defineEnum("LineStyle",{Dashed:0,Solid:1}),s.AlignmentLine=(a=function(e,t,r,a,n,o,i){void 0===i&&(i=s.LineStyle.Dashed),this.type=e,this.location=t,this.color=r,this.line=a,this.text=n,this.lineStyle=i,this.coordinateSpace=o},c.defineClass({name:"AlignmentLine",ctor:a,superName:"CoreObject",statics:{DASH_WIDTH:4,DASH_GAP_WIDTH:4,LINE_EXTENSION:24,ROTATION_LINE_EXTENSION:40,LINE_WEIGHT:1}}),a),s.FormaAlignment=(n=function(e,t,r){this.forma=e,this.offset=t,this.line=r},c.defineClass({name:"FormaAlignment",ctor:n,props:{clone:function(){return new n(this.forma,this.offset,this.line)}}}),n),s.FormaAlignmentLines=(o=function(){},c.defineClass({name:"FormaAlignmentLines",ctor:o,props:{init_a036:function(e,t){this.forma=e,this.lines=c.clone(t)},init_implicit:function(e,t){this.forma=e,this.lines=c.clone(t)},clone:function(){return o.init_implicit(this.forma,this.lines)}}}),o),s.FormaAlignmentSlope=(i=function(){},c.defineClass({name:"FormaAlignmentSlope",ctor:i,props:{init_c8bd:function(e,t,r){this.forma=e,this.rise=t,this.run=r},init_implicit:function(e,t,r){this.forma=e,this.rise=t,this.run=r},clone:function(){return i.init_implicit(this.forma,this.rise,this.run)}}}),i),s.AlignmentDetector=(l=function(){this.horizontalAlignments=[s.AlignmentType.CenterY,s.AlignmentType.Top,s.AlignmentType.Bottom],this.verticalAlignments=[s.AlignmentType.CenterX,s.AlignmentType.Left,s.AlignmentType.Right],this.boundaryAlignments=[s.AlignmentType.Left,s.AlignmentType.Right,s.AlignmentType.Top,s.AlignmentType.Bottom]},u={},c.defineClass({name:"AlignmentDetector",ctor:l,superName:"CoreObject",statics:{DISTANCE_THRESHOLD:20,SNAP_ANGLE_THRESHOLD:{get:function(){return void 0===u.SNAP_ANGLE_THRESHOLD&&(u.SNAP_ANGLE_THRESHOLD=Math.PI/64),u.SNAP_ANGLE_THRESHOLD}},ANGULAR_THRESHOLD:{get:function(){return void 0===u.ANGULAR_THRESHOLD&&(u.ANGULAR_THRESHOLD=2*Math.PI/180),u.ANGULAR_THRESHOLD}},ALIGNMENT_FORMA:{get:function(){return void 0===u.ALIGNMENT_FORMA&&(u.ALIGNMENT_FORMA=new F.SolidColor(0,1,1,1)),u.ALIGNMENT_FORMA}},ALIGNMENT_ROOT:{get:function(){return void 0===u.ALIGNMENT_ROOT&&(u.ALIGNMENT_ROOT=new F.SolidColor(1,0,1,1)),u.ALIGNMENT_ROOT}},ALIGNMENT_ROTATION:{get:function(){return void 0===u.ALIGNMENT_ROTATION&&(u.ALIGNMENT_ROTATION=new F.SolidColor(1,78/255,79/255,1)),u.ALIGNMENT_ROTATION}}},props:{init_a05b:function(e){this.forma_=e,this.possibleAlignmentLines_=[],this.possibleAngularAlignments_=[],g.CoreObject.call(this),this.update(!0)},init_f94b:function(e){this.init_a05b(c.first(e))},possibleAlignmentLines:{get:function(){return this.possibleAlignmentLines_}},isVerticalAlignment:function(e){return this.verticalAlignments.includes(e)},isHorizontalAlignment:function(e){return this.horizontalAlignments.includes(e)},isBoundaryAlignment:function(e){return this.boundaryAlignments.includes(e)},alignmentLineCompatible:function(e,t,r,a,n){if(void 0===n&&(n=!0),e.hasIntent(h.Forma.INTENT_GRID_CELL)&&e.finalFrame.contains(t.finalFrame))return!1;if(!n)for(var o=[e.controller,t.controller],i=c.iter(o);!i.done;i.next()){var u,m=i.value;if((u=c.as(m,C.TypeLockupController))&&(f=u.lockupStyle)&&u.numLines()>1){var g=m==e.controller?r.type:a.type;if(g==s.AlignmentType.Left&&p.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=p.LockupAlignment.Left)return!1;if(g==s.AlignmentType.Right&&p.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=p.LockupAlignment.Right)return!1;if(g==s.AlignmentType.CenterX&&p.LockupStyle.layoutSupportsAlignments(f.layout)&&f.alignment!=p.LockupAlignment.Center)return!1}}if(r.type==a.type)return!0;var f,v,d=this.isVerticalAlignment(r.type),y=this.isVerticalAlignment(a.type);if(n&&!c.eq(F._equality_SolidColor_SolidColor,r.color,l.ALIGNMENT_ROOT)&&!c.eq(F._equality_SolidColor_SolidColor,a.color,l.ALIGNMENT_ROOT)&&d==y&&this.isBoundaryAlignment(r.type)&&this.isBoundaryAlignment(a.type))return!0;if((f=c.as(t.style,p.LockupStyle))&&(v=c.as(e.style,p.LockupStyle))&&f.backing!=p.LockupBacking.None&&!p.LockupStyle.isShadowLook(f.textLook)&&v.backing!=p.LockupBacking.None&&!p.LockupStyle.isShadowLook(v.textLook)&&this.boundaryAlignments.includes(r.type)&&this.boundaryAlignments.includes(a.type))return!0;var T=this.horizontalAlignments.includes(r.type),_=this.horizontalAlignments.includes(a.type);return!!(T&&!_||!T&&_)},mergeLines:function(e,t){var r,a;m.CoreAssert.isTrue(c.eq(h._equality_Forma_Forma,e.coordinateSpace,t.coordinateSpace),"mergeLines. al1 - "+((r=c.opt(e.coordinateSpace,(function(e){return e.formaID})))||null!=r?r:"nil")+") al2 - "+((a=c.opt(t.coordinateSpace,(function(e){return e.formaID})))||null!=a?a:"nil"),"AlignmentDetector.mergeLines","AlignmentDetector.swift",241);var n=c.eq(F._equality_SolidColor_SolidColor,e.color,l.ALIGNMENT_ROOT)||c.eq(F._equality_SolidColor_SolidColor,t.color,l.ALIGNMENT_ROOT)?l.ALIGNMENT_ROOT:l.ALIGNMENT_FORMA,o=e.location==s.AlignmentLocation.Root||t.location==s.AlignmentLocation.Root?s.AlignmentLocation.Root:s.AlignmentLocation.Forma;return new s.AlignmentLine(e.type,o,n,t.line.unionWith(e.line),e.text&&t.text,e.coordinateSpace)},update:function(e){void 0===e&&(e=!1);var t=this;this.possibleAlignmentLines_=[],this.possibleAngularAlignments_=[s.FormaAlignmentSlope.init_c8bd(null,0,1),s.FormaAlignmentSlope.init_c8bd(null,1,1),s.FormaAlignmentSlope.init_c8bd(null,1,0),s.FormaAlignmentSlope.init_c8bd(null,-1,1)],c.opt(this.forma_.root,(function(r){return r.visitAll(h.FormaTraversal.PreOrder,(function(r){if(null!=r.controller&&r.kind!=f.ImageForma.KIND&&null==r.visit(h.FormaTraversal.NearestAncestor,(function(e,r,a){return c.eq(h._equality_Forma_Forma,e,t.forma_)}))){t.possibleAlignmentLines_.push(c.clone(s.FormaAlignmentLines.init_a036(r,c.clone(r.controller.getAlignments(e)))));var a=r.totalPlacement.transformValues,n=c.clone(s.FormaAlignmentSlope.init_c8bd(r,a.rotSine,a.rotCosine));n.run<0&&(n.rise=-n.rise,n.run=-n.run),0!=n.rise&&0!=n.run&&t.possibleAngularAlignments_.push(c.clone(n))}}))}))},detectFormaAlignments:function(e,t,r){void 0===t&&(t=!1),void 0===r&&(r=!0),this.update(t);for(var a=[],n=c.iter(this.forma_.controller.getAlignments());!n.done;n.next())for(var o=n.value,i=c.iter(this.possibleAlignmentLines_);!i.done;i.next())for(var u=i.value,m=c.iter(u.lines);!m.done;m.next()){var g=m.value;if(this.alignmentLineCompatible(this.forma_,u.forma,o,g,r)){var h=g.line.projectionOffset(o.line.p2),f=g.line.projectionOffset(o.line.p1),v=h.add(f).multiply(.5),p=o.line.angleWith(g.line)%Math.PI;if(v.length()<e&&Math.abs(p)<l.ANGULAR_THRESHOLD){var d=this.mergeLines(o,g);a.push(c.clone(new s.FormaAlignment(u.forma,v,d)))}}}return a},formaAlignmentDistances:function(e){for(var t=c.clone(this.detectFormaAlignments(1/0)),r=[],a=c.iter(t);!a.done;a.next()){var n=a.value;n.line.type==e&&r.push(c.clone(n))}return r},rotationIndicatorForForma:function(e,t,r,a){var n=[];if(null!=e){var o=e.root,i=e.bounds,u=i.eval(t),c=i.eval(T._plus_TheoPoint_TheoPoint(t,new T.TheoPoint(.5,0))),m=new y.TheoLine(u,c).transform(r),g=new y.TheoLine(m.p1,T._plus_TheoPoint_TheoPoint(m.p1,new T.TheoPoint(m.length,0)));n.push(new s.AlignmentLine(s.AlignmentType.Rotation,s.AlignmentLocation.Forma,l.ALIGNMENT_ROTATION,m,!1,o,a)),n.push(new s.AlignmentLine(s.AlignmentType.Rotation,s.AlignmentLocation.Forma,l.ALIGNMENT_ROTATION,g,!1,o,a))}return n},snapped_Placement:function(e,t,r){var a=null,n=c.clone(this.detectFormaAlignments(t)),o=[];if(v.ImageFacade.inCropMode(this.forma_))return[a,o];if(null!=e){for(var i=this.forma_.totalPlacement.transformValues,u={rise:i.rotSine,run:i.rotCosine},m=Math.atan2(u.rise,u.run),g=Math.atan2(-u.rise,-u.run),f=c.clone(s.FormaAlignmentSlope.init_c8bd(null,0,0)),p=1/0,F=[],y=c.iter(this.possibleAngularAlignments_);!y.done;y.next()){var _=y.value,x=Math.atan2(_.rise,_.run),A=function(e){var t=Math.abs(x-e);(t<p||t<l.SNAP_ANGLE_THRESHOLD)&&(t<p&&(f=c.clone(_),p=t),F.push({forma:_.forma,difference:t}))};A(m),A(g)}if(p<l.SNAP_ANGLE_THRESHOLD){i.rotCosine*f.run+i.rotSine*f.rise<0&&(f.run=-f.run,f.rise=-f.rise);var S=f.run,D=f.rise,I=(Q=this.forma_.totalPlacement).transformPoint(this.forma_.bounds.eval(e)),N=Q.inverse,k=(Q=(Q=(Q=Q.translateXY(-I.x,-I.y)).rotateTo(S,D)).translateXY(I.x,I.y)).concat(N);a=this.forma_.placement.inverse.concat(k).concat(this.forma_.placement);for(var b=s.LineStyle.Dashed,L=c.clone(this.rotationIndicatorForForma(this.forma_,e,Q,b)),P=c.iter(L);!P.done;P.next()){var E=P.value;o.push(E)}for(var O=c.iter(F);!O.done;O.next()){var w=O.value,M=w.difference,R=w.forma;if(Math.abs(M-p)<.001)for(var G=c.clone(this.rotationIndicatorForForma(R,new T.TheoPoint(.5,.5),c.opt(R,(function(e){return e.totalPlacement})),b)),Y=c.iter(G);!Y.done;Y.next())E=Y.value,o.push(E)}}}else{for(var X=c.iter([this.verticalAlignments,this.horizontalAlignments]);!X.done;X.next()){for(var B=X.value,W=(p=1/0,null),H=[],U=!1,V=c.iter(n);!V.done;V.next()){var K=(Z=V.value).line,j=this.isVerticalAlignment(K.type);if(B.includes(Z.line.type))if(null==W)W=Z.offset,H.push(K),U=K.location==s.AlignmentLocation.Root;else{var q=j?Math.abs(Math.round(W.x)-Math.round(Z.offset.x)):Math.abs(Math.round(W.y)-Math.round(Z.offset.y));q<.001?(H.push(K),K.location==s.AlignmentLocation.Root&&(U=!0)):q<p&&(H.splice(0),H.push(K),W=Z.offset,U=K.location==s.AlignmentLocation.Root,p=q)}}if(U&&(H=H.filter((function(e){return e.location==s.AlignmentLocation.Root}),this)),null!=W){for(var z=c.iter(H);!z.done;z.next()){var Z=z.value;o.push(Z)}var J=d.Matrix2D.translationXY(W.x,W.y);if(null!=a){a=c.opt(a,(function(e){return e.concat(J)}));break}a=J}}var Q;if(null!=a)N=(Q=this.forma_.totalPlacement).inverse,k=(Q=Q.concat(a)).concat(N),a=this.forma_.placement.inverse.concat(k).concat(this.forma_.placement)}return r&&(o=[],this.forma_.root.visitAll(h.FormaTraversal.PreOrder,(function(e){var t;if(t=c.as(e.controller,C.TypeLockupController))for(var r=c.iter(t.getAlignments());!r.done;r.next()){var a=r.value;o.push(a)}}))),[a,o]}}}),l)},cbNz:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("SpAV"),l=r("FNB+"),u=r("6ZWm"),s=r("wc1n"),c=r("cmoc"),m=r("tQF8"),g=r("4mVB"),h=r("Dq5S"),f=r("8t9B"),v=r("oKlP"),p=r("sIWg"),d=r("1NAc");n.GridStyleFeatureExtractor=(a=function(e,t,r,a,n,l,u){var c,m,f;if(this.imageCells_=[],this.floatingCells_=[],this.adjacentImageCount_=0,this.cellXSymm_=0,this.cellYSymm_=0,void 0===e&&(e=null),void 0===t&&(t=null),void 0===r&&(r=null),void 0===a&&(a=null),void 0===n&&(n=null),void 0===l&&(l=null),void 0===u&&(u=[]),i.CoreAssert.isTrue(null!=a||null!=t||null!=o.as(o.opt(e,(function(e){return e.style})),g.GridStyle),void 0,"GridStyleFeatureExtractor.init","GridStyleFeatureExtractor.swift",42),(c=t)?this.mapping_=o.clone(c):(this.gridStyle_=a||e.style,this.mapping_=o.clone(this.gridStyle_.formaMapping)),this.gridFrame_=n||e.frame,(m=r)?this.gridCells_=o.clone(m):this.gridCells_=o.clone(this.gridStyle_.gridCellArray),null!=l)this.layoutItems_=o.clone(l);else if(this.layoutItems_=[],f=e)for(var v=o.clone(f.filterWithCallback((function(e){return null!=e.controller&&e.controller.floating||e.isBackgroundImage()}))),p=o.iter(v);!p.done;p.next()){var d=p.value;this.layoutItems_.push(h.LayoutItem.init_b14a(d))}this.currentGrid_=e,this.forFeatures_=o.clone(u),this.featureEvals_=[],s.FeatureExtractor.call(this),this.imageCells_=o.clone(this.getTypeOfCell(h.ItemContentType.Image)),this.floatingCells_=o.clone(this.getTypeOfCell(h.ItemContentType.Floating)),this.adjacentImageCount_=0;for(var F=o.iter(this.imageCells_);!F.done;F.next())for(var y=F.value,C=o.iter(this.imageCells_);!C.done;C.next()){var T=C.value;this.isAdjacent(y,T)&&y!==T&&(this.adjacentImageCount_+=1)}this.cellXSymm_=this.getCellSymmAsymm(!0),this.cellYSymm_=this.getCellSymmAsymm(!1),this.initFeatures(),this.evaluateFeatures()},o.defineClass({name:"GridStyleFeatureExtractor",ctor:a,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["CellAspectRatio",[this.evaluateCellAspectRatio,s.FeatureType.Numerical]],["AreaPercentImages",[this.evaluateAreaPercentImages,s.FeatureType.Numerical]],["ImageCellContentFit",[this.evaluateImageCellContentFit,s.FeatureType.Numerical]],["AverageCellSize",[this.evaluateAverageCellSize,s.FeatureType.Numerical]],["AverageImageCellSize",[this.evaluateAverageImageCellSize,s.FeatureType.Numerical]],["AverageTextCellSize",[this.evaluateAverageTextCellSize,s.FeatureType.Numerical]],["ImageCellVariance",[this.evaluateImageCellVariance,s.FeatureType.Numerical]],["TextCellVariance",[this.evaluateTextCellVariance,s.FeatureType.Numerical]],["OverallCellVariance",[this.evaluateOverallCellVariance,s.FeatureType.Numerical]],["TypeSymmetryAcrosstheXAxis",[this.evaluateXAxisTypeSymmetry,s.FeatureType.Numerical]],["TypeSymmetryAcrosstheYAxis",[this.evaluateYAxisTypeSymmetry,s.FeatureType.Numerical]],["TypeAsymmetryAcrosstheXAxis",[this.evaluateXAxisTypeAsymmetry,s.FeatureType.Numerical]],["TypeAsymmetryAcrosstheYAxis",[this.evaluateYAxisTypeAsymmetry,s.FeatureType.Numerical]],["CellSymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,s.FeatureType.Numerical]],["CellSymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,s.FeatureType.Numerical]],["CellAsymmetryAcrosstheXAxis",[this.evaluateXAxisCellSymmetry,s.FeatureType.Numerical]],["CellAsymmetryAcrosstheYAxis",[this.evaluateYAxisCellAsymmetry,s.FeatureType.Numerical]],["AverageImageXVal",[this.evaluateAverageImageXVal,s.FeatureType.Numerical]],["AverageImageYVal",[this.evaluateAverageImageYVal,s.FeatureType.Numerical]],["AverageTextXVal",[this.evaluateAverageTextXVal,s.FeatureType.Numerical]],["AverageTextYVal",[this.evaluateAverageTextYVal,s.FeatureType.Numerical]],["ImageSpreadinXDimension",[this.evaluateImageXSpread,s.FeatureType.Numerical]],["ImageSpreadinYDimension",[this.evaluateImageYSpread,s.FeatureType.Numerical]],["TextSpreadinXDimension",[this.evaluateTextXSpread,s.FeatureType.Numerical]],["TextSpreadinYDimension",[this.evaluateTextYSpread,s.FeatureType.Numerical]],["MaxImageXOffsetFromCenter",[this.evaluateMaxImageXOffsetFromCenter,s.FeatureType.Numerical]],["MaxImageYOffsetFromCenter",[this.evaluateMaxImageYOffsetFromCenter,s.FeatureType.Numerical]],["MaxTextXOffsetFromCenter",[this.evaluateMaxTextXOffsetFromCenter,s.FeatureType.Numerical]],["MaxTextYOffsetFromCenter",[this.evaluateMaxTextYOffsetFromCenter,s.FeatureType.Numerical]],["TextFocused",[this.evaluateTextFocused,s.FeatureType.Numerical]],["TextDispersement",[this.evaluateTextDispersement,s.FeatureType.Numerical]],["AdjacentMatches",[this.evaluateAdjacentMatch,s.FeatureType.Numerical]],["AdjacentMismatches",[this.evaluateAdjacentMismatch,s.FeatureType.Numerical]],["PreviousOrder",[this.evaluatePreviousOrder,s.FeatureType.Numerical]],["PreviousPosition",[this.evaluatePreviousPosition,s.FeatureType.Numerical]],["PreviousPositionFlip",[this.evaluatePreviousPositionFlip,s.FeatureType.Numerical]],["PreviousImageSize",[this.evaluatePreviousImageSize,s.FeatureType.Numerical]]]},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=o.iter(this.featureEvals_);!t.done;t.next()){var r=t.value;if(e||!e&&this.forFeatures_.includes(r[0])){var a=r[1],n=(0,a[0])(this);this.setFeature(r[0],n,a[1])}}},evaluateCellAspectRatio:function(e){for(var t=0,r=o.iter(e.gridCells_);!r.done;r.next()){var a=r.value,n=e.gridFrame_.evalRect(a.bounds),l=Math.max(n.aspectRatio,1/n.aspectRatio);i.CoreAssert.isTrue(l>0,void 0,"GridStyleFeatureExtractor.evaluateCellAspectRatio","GridStyleFeatureExtractor.swift",168),t+=l}return t/o.toDouble(e.gridCells_.length)},evaluateImageCellContentFit:function(e){for(var t=0,r=0,a=o.iter(e.layoutItems_);!a.done;a.next()){var n,i,l,u=a.value;if(u.type==h.ItemContentType.Image&&(n=o.opt(e.mapping_[u.id],(function(e){return e.bounds})))&&null!=(i=u.width)&&null!=(l=u.height)){var s=e.gridFrame_.evalRect(n),c=p.TheoRect.fromSize(new d.TheoSize(o.toDouble(i),o.toDouble(l)));t+=s.similarity(c),r+=1}}return t/(o.toDouble(r)+1e-5)},evaluateAreaPercentImages:function(e){return e.getCellAreaSum(o.clone(e.getImageCells()))/e.gridFrame_.area},evaluateAverageCellSize:function(e){return 1/o.toDouble(e.gridCells_.length)},evaluateAverageImageCellSize:function(e){var t=o.clone(e.getImageCells());return 0!=t.length?e.getCellAreaSum(o.clone(t))/o.toDouble(t.length)/e.gridFrame_.area:0},evaluateAverageTextCellSize:function(e){var t=o.clone(e.getFloatingCells());return 0!=t.length?e.getCellAreaSum(o.clone(t))/o.toDouble(t.length)/e.gridFrame_.area:0},evaluateImageCellVariance:function(e){return e.getVariance(o.clone(e.getImageCells()))},evaluateTextCellVariance:function(e){return e.getVariance(o.clone(e.getFloatingCells()))},evaluateOverallCellVariance:function(e){var t=o.clone(e.getFloatingCells()),r=o.clone(e.getImageCells()),a=e.getMaxandMinCellArea(o.clone(r)),n=a[0],i=a[1],l=e.getMaxandMinCellArea(o.clone(t)),u=l[0],s=l[1],c=Math.max(n,u),m=Math.min(i,s);return Math.abs((c-m)/e.gridFrame_.area)},evaluateXAxisTypeSymmetry:function(e){return e.getSymmAsymm(o.clone(e.getImageCells()),o.clone(e.getImageCells()),!0,1)},evaluateYAxisTypeSymmetry:function(e){return e.getSymmAsymm(o.clone(e.getImageCells()),o.clone(e.getImageCells()),!1,1)},evaluateXAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(o.clone(e.getImageCells()),o.clone(e.getFloatingCells()),!0,0)},evaluateYAxisTypeAsymmetry:function(e){return 2*e.getSymmAsymm(o.clone(e.getImageCells()),o.clone(e.getFloatingCells()),!1,0)},evaluateXAxisCellSymmetry:function(e){return e.cellXSymm_},evaluateYAxisCellSymmetry:function(e){return e.cellYSymm_},evaluateXAxisCellAsymmetry:function(e){return 1-e.cellXSymm_},evaluateYAxisCellAsymmetry:function(e){return 1-e.cellYSymm_},evaluateAverageImageXVal:function(e){return e.getAverageVal(o.clone(e.getImageCells()),!0)},evaluateAverageImageYVal:function(e){return e.getAverageVal(o.clone(e.getImageCells()),!1)},evaluateAverageTextXVal:function(e){return e.getAverageVal(o.clone(e.getFloatingCells()),!0)},evaluateAverageTextYVal:function(e){return e.getAverageVal(o.clone(e.getFloatingCells()),!1)},evaluateImageXSpread:function(e){return e.getSpread(o.clone(e.getImageCells()),!0)},evaluateImageYSpread:function(e){return e.getSpread(o.clone(e.getImageCells()),!1)},evaluateTextXSpread:function(e){return e.getSpread(o.clone(e.getFloatingCells()),!0)},evaluateTextYSpread:function(e){return e.getSpread(o.clone(e.getFloatingCells()),!1)},evaluateMaxImageXOffsetFromCenter:function(e){return e.getOffsetFromCenter(o.clone(e.getImageCells()),!0)},evaluateMaxImageYOffsetFromCenter:function(e){return e.getOffsetFromCenter(o.clone(e.getImageCells()),!1)},evaluateMaxTextXOffsetFromCenter:function(e){return e.getOffsetFromCenter(o.clone(e.getFloatingCells()),!0)},evaluateMaxTextYOffsetFromCenter:function(e){return e.getOffsetFromCenter(o.clone(e.getFloatingCells()),!1)},evaluateTextFocused:function(e){var t=o.clone(e.getFloatingCells());return 1==t.length&&e.gridFrame_.area>0?t[0].bounds.area/e.gridFrame_.area:0},evaluateTextDispersement:function(e){for(var t=o.clone(e.getFloatingCells()),r=0,a=o.iter(e.layoutItems_);!a.done;a.next()){var n=a.value;null!=e.mapping_[n.id]&&n.type==h.ItemContentType.Floating&&(r+=1)}return o.toDouble(t.length)/(r+.001)},evaluateAdjacentMatch:function(e){for(var t=0,r=0,a=o.clone(e.getFloatingCells()),n=o.clone(e.getImageCells()),i=o.iter(a);!i.done;i.next())for(var l=i.value,u=o.iter(a);!u.done;u.next()){for(var s=u.value,c=o.iter(n);!c.done;c.next()){var m=c.value;e.isAdjacent(l,m)&&(r+=1)}e.isAdjacent(l,s)&&l!==s&&(t+=1,r+=1)}return r+=e.adjacentImageCount_,t+=e.adjacentImageCount_,r>0?o.toDouble(t)/o.toDouble(r):0},evaluateAdjacentMismatch:function(e){for(var t=0,r=0,a=o.clone(e.getFloatingCells()),n=o.clone(e.getImageCells()),i=o.iter(a);!i.done;i.next())for(var l=i.value,u=o.iter(a);!u.done;u.next()){for(var s=u.value,c=o.iter(n);!c.done;c.next()){var m=c.value;e.isAdjacent(l,m)&&(r+=1,t+=1)}e.isAdjacent(l,s)&&l!==s&&(r+=1)}return(r+=e.adjacentImageCount_)>0?o.toDouble(t)/o.toDouble(r):0},evaluatePreviousPosition:function(e){return e.getPreviousPos(!1)},evaluatePreviousPositionFlip:function(e){return e.getPreviousPos(!0)},evaluatePreviousImageSize:function(e){var t;if(t=e.currentGrid_){for(var r=t.root,a=0,n={},i=o.iter(o.keys(e.mapping_));!i.done;i.next()){var l=i.value;n[l]=e.mapping_[l]}for(var u=o.iter(n);!u.done;u.next()){var s,c=u.key,m=u.value,g=o.opt(r,(function(e){return e.formaByID(c)}));if(null!=g&&(s=g.finalFrame)){var h=r.finalFrame.size,f=o.opt(t.finalFrame,(function(e){return e.evalRect(m.bounds)}));g.isImage()&&null!=f&&(a+=Math.abs(s.area-f.area)/(h.width*h.height))}}return a}return 0},evaluatePreviousOrder:function(e){var t;if(t=e.currentGrid_){for(var r=t.root,a=[],n=[],i=o.clone(e.getImageCells()),s=o.clone(e.getFloatingCells()),g=[],h=o.iter(o.range(0,e.gridCells_.length,!1));!h.done;h.next())g.push(null);for(var p={},d=o.iter(o.keys(e.mapping_));!d.done;d.next()){var F=d.value;p[F]=e.mapping_[F]}for(var y=o.iter(p);!y.done;y.next()){var C=y.key,T=y.value,_=o.opt(r,(function(e){return e.formaByID(C)}));o.opt(o.opt(_,(function(e){return e.controller})),(function(e){return e.kind==u.FrameController.KIND}))&&(o.containsEq(i,T,m._equality_GridCell_GridCell)||i.push(T),a.push({cell:T,forma:_})),o.opt(o.opt(_,(function(e){return e.controller})),(function(e){return e.kind==f.TypeLockupController.KIND}))&&(o.containsEq(s,T,m._equality_GridCell_GridCell)||s.push(T),n.push({cell:T,forma:_}))}var x=o.clone(t.root.filterByKind(c.FrameForma.KIND));o.sortInPlace(x,(function(e,t){return e.frame.center.distanceTo(v.TheoPoint.ZERO)<t.frame.center.distanceTo(v.TheoPoint.ZERO)})),o.sortInPlace(a,(function(e,t){return e.cell.bounds.origin.distanceTo(v.TheoPoint.ZERO)<t.cell.bounds.origin.distanceTo(v.TheoPoint.ZERO)}));var A=o.clone(t.root.filterByControllerKind(f.TypeLockupController.KIND));o.sortInPlace(A,(function(e,t){return e.frame.center.distanceTo(v.TheoPoint.ZERO)<t.frame.center.distanceTo(v.TheoPoint.ZERO)})),o.sortInPlace(s,(function(e,t){return e.bounds.center.distanceTo(v.TheoPoint.ZERO)<t.bounds.center.distanceTo(v.TheoPoint.ZERO)}));for(var S=0,D=o.iter(o.range(0,a.length,!1));!D.done;D.next()){var I=a[w=D.value].forma;null!=(M=o.indexOfEq(x,I,l._equality_Forma_Forma))&&M!=w&&(S+=1)}for(var N=[],k=o.iter(s);!k.done;k.next()){for(var b=k.value,L=[],P=o.iter(n);!P.done;P.next()){var E=P.value;o.eq(m._equality_GridCell_GridCell,E.cell,b)&&L.push(E.forma)}o.sortInPlace(L,(function(e,t){return e.finalFrame.origin.distanceTo(v.TheoPoint.ZERO)<t.finalFrame.origin.distanceTo(v.TheoPoint.ZERO)})),o.append(N,L)}for(var O=o.iter(o.range(0,N.length,!1));!O.done;O.next()){var w,M,R=N[w=O.value];null!=(M=o.indexOfEq(A,R,l._equality_Forma_Forma))&&M!=w&&(S+=1)}return S}return 0},getPreviousPos:function(e){var t;if(t=this.currentGrid_){for(var r=t.root,a=0,n={},l=o.iter(o.keys(this.mapping_));!l.done;l.next()){var u=l.value;n[u]=this.mapping_[u]}for(var s=o.iter(n);!s.done;s.next()){var c,m=s.key,g=s.value,h=o.opt(r,(function(e){return e.formaByID(m)}));if(null!=h&&(c=h.finalFrame)){var f=r.finalFrame.size;i.CoreAssert.isTrue(f.width>0&&f.height>0,void 0,"GridStyleFeatureExtractor.getPreviousPos","GridStyleFeatureExtractor.swift",589),a+=(e?new v.TheoPoint(c.center.y/f.height,c.center.x/f.width):new v.TheoPoint(c.center.x/f.width,c.center.y/f.height)).distanceTo(g.bounds.center)}}return a}return 0},getSymmAsymm:function(e,t,r,a){var n;void 0===a&&(a=0);var i=0;if(0==t.length||0==e.length)return a;for(var l=o.iter(o.range(0,e.length,!1));!l.done;l.next())for(var u=e[l.value].bounds,s=r?new p.TheoRect(u.minX,1-u.maxY,u.maxX,1-u.minY):new p.TheoRect(1-u.maxX,u.minY,1-u.minX,u.maxY),c=o.iter(o.range(0,t.length,!1));!c.done;c.next()){var m=c.value,g=this.cellIntersection(t[m].bounds,s);i+=(n=o.opt(g,(function(e){return e.area})))||null!=n?n:0}return e.length>0?i:a},getCellSymmAsymm:function(e){for(var t=0,r=o.iter(o.range(0,this.gridCells_.length,!1));!r.done;r.next())for(var a=r.value,n=this.gridCells_[a].bounds,i=n.area,l=e?new p.TheoRect(n.minX,1-n.maxY,n.maxX,1-n.minY):new p.TheoRect(1-n.maxX,n.minY,1-n.minX,n.maxY),u=o.iter(o.range(0,this.gridCells_.length,!1));!u.done;u.next()){var s,c=u.value,m=this.gridCells_[c].bounds;(s=this.cellIntersection(m,l))&&(t+=s.area/Math.max(i,m.area))}return this.gridCells_.length>0?t/o.toDouble(this.gridCells_.length):0},cellIntersection:function(e,t){var r=null;return Math.max(e.minX,t.minX)<Math.min(e.maxX,t.maxX)&&Math.max(e.minY,t.minY)<Math.min(e.maxY,t.maxY)&&(r=new p.TheoRect(Math.max(e.minX,t.minX),Math.max(e.minY,t.minY),Math.min(e.maxX,t.maxX),Math.min(e.maxY,t.maxY))),r},isAdjacent:function(e,t){var r=e.bounds,a=t.bounds;return r.maxX-a.minX>0&&a.maxX-r.minX>0&&r.maxY-a.minY>=0&&a.maxY-r.minY>=0||r.maxX-a.minX>=0&&a.maxX-r.minX>=0&&r.maxY-a.minY>0&&a.maxY-r.minY>0},getOffsetFromCenter:function(e,t){for(var r=0,a=o.iter(e);!a.done;a.next()){var n=a.value,i=Math.abs((t?n.bounds.center.x:n.bounds.center.y)-.5);i>r&&(r=i)}return r},getAverageVal:function(e,t){for(var r=0,a=o.iter(e);!a.done;a.next()){var n=a.value;r+=t?n.bounds.center.x:n.bounds.center.y}return e.length>0?r/o.toDouble(e.length):0},getSpread:function(e,t){for(var r=1,a=0,n=o.iter(e);!n.done;n.next()){var i=n.value;t?(i.bounds.minX<r&&(r=i.bounds.minX),i.bounds.maxX>a&&(a=i.bounds.maxX)):(i.bounds.minY<r&&(r=i.bounds.minY),i.bounds.maxY>a&&(a=i.bounds.maxY))}return Math.max(a-r,0)},getVariance:function(e){var t=this.getMaxandMinCellArea(o.clone(e)),r=t[0],a=t[1];return Math.abs((r-a)/this.gridFrame_.area)},getMaxandMinCellArea:function(e){for(var t=0,r=this.gridFrame_.area,a=o.iter(e);!a.done;a.next()){var n=a.value,i=this.gridFrame_.evalRect(n.bounds).area;i>t&&(t=i),i<r&&(r=i)}return[t,r]},getCellAreaSum:function(e){for(var t=0,r=o.iter(e);!r.done;r.next()){var a=r.value;t+=this.gridFrame_.evalRect(a.bounds).area}return t},getImageCells:function(){return this.imageCells_},getFloatingCells:function(){return this.floatingCells_},getTypeOfCell:function(e){for(var t=[],r=o.iter(this.layoutItems_);!r.done;r.next()){var a,n=r.value;(a=this.mapping_[n.id])&&n.type==e&&(o.containsEq(t,a,m._equality_GridCell_GridCell)||t.push(a))}return t}}}),a)},iFIB:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("gXiO"),l=r("TP4q"),u=r("3v9D");n.GridLearning=(a=function(){i.CoreObject.call(this)},o.defineClass({name:"GridLearning",ctor:a,superName:"CoreObject",statics:{learnGridMappingWeights:function(e){if(0==e.length)return{weights:[],bestStyle:null};for(var t={},r=o.iter(e);!r.done;r.next()){var n=r.value,i=new l.GridScore(n.gridStyle,n.gridFrame,o.clone(n.layoutItems));t[n.docID]={score:i,features:i.getFeatures()}}for(var u=new l.GridScore(e[0].gridStyle,e[0].gridFrame,o.clone(e[0].layoutItems)),s=o.clone(u.getWeights()),c=null,m=o.iter(o.range(0,500,!1));!m.done;m.next()){for(var g=m.value,h=o.repeat(0,s.length),f=0,v=0,p=null,d=0,F=o.iter(e);!F.done;F.next()){var y,C=t[(n=F.value).docID];if(C.score.setWeights(o.clone(s)),y=a.getBestGridLayout(o.clone(n),o.clone(s))){p=y.gridStyle,f+=C.score.score,v+=y.score;for(var T=o.clone(y.getFeatures()),_=o.iter(o.range(0,s.length,!1));!_.done;_.next())h[A=_.value]+=T[A]-C.features[A];d+=1}}if(f/=o.toDouble(e.length),v/=o.toDouble(e.length),o.info(o.toString("\nNIO iteration "+g+" G: %5.02f fInit: %5.02f fOpt: %5.02f avg mismatch %5.02f",v-f,f,v)),v-f<.001){c=p;break}for(var x=o.iter(o.range(0,s.length,!1));!x.done;x.next()){var A,S=h[A=x.value]/o.toDouble(d);s[A]+=-1*S*.01}}return{weights:s,bestStyle:c}},getBestGridLayout:function(e,t){var r=o.clone(u.LayoutSuggester.init_cb42(o.clone(e),o.clone(t)).createSuggestions());return 0==!r.length?r[0].weightedScore:null}}}),a)},jC54:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("gXiO");n.ModelWeightLibrary=(a=function(){i.CoreObject.call(this)},o.defineClass({name:"ModelWeightLibrary",ctor:a,superName:"CoreObject",statics:{weights:{DefaultDesignScore:{Maxzoomlevel:{mean:.00018027334267821125,std:.8132335406308514,weight:-.08010375273536166},textareanotcontrasting:{mean:-.0033339994317995274,std:.25020875502904477,weight:-.14415975362288352},shapesareanotcontrasting:{mean:-.0005424908444142923,std:.16815414319793917,weight:-.030270956800708296},lockupareaoutofbounds:{mean:.0003963054774770136,std:.03879175427738692,weight:-.1289655276464355},minfontsize:{mean:.4162329663731091,std:27.695820940950014,weight:.04372203001144579},maxfontsize:{mean:.4612274707747426,std:57.444985900183354,weight:.10830759811249395},mintextarea:{mean:488.9105104765153,std:89533.71385858732,weight:-.013866098359443309},maxtextarea:{mean:1325.1752065666267,std:186711.01621053327,weight:-.2361503759042213},minshapesize:{mean:-55.646916071109146,std:44574.83972690322,weight:.029270742827542353},maxshapesize:{mean:-201.25488977770246,std:46340.96127095905,weight:-.08223116203941933},lockupareaoverlapping:{mean:.00020290565299043752,std:.03925994410311496,weight:-.1636881423600194},Maxemptyspace:{mean:-.004717028998489912,std:.1976916685529546,weight:-.11662298994579136},textincorrectalign:{mean:-.004764058495477163,std:.2987539130553497,weight:-.03690998410689036},emptygridsquares:{mean:-.0007268850555160692,std:.14877245350943186,weight:-.23283917900645912},overlappingmultiplegridcells:{mean:-.008452699670100044,std:.4087079047503421,weight:-.0569178307172981},maxaspectratio:{mean:.021926589002448465,std:3.1432119741395548,weight:.21439804312559388},breakingflowX:{mean:-.006980250264133872,std:.45684350428459336,weight:.011093192112083617},breakingflowY:{mean:-.008525554047037538,std:.4077234799494897,weight:-.06308947475173525},BreakingHorisontalSymmetryinsidevisualparent:{mean:412041.9613712293,std:45212121.039130844,weight:-.034310695376294276},marginsaretoosmall:{mean:-32649.714698565716,std:4443401.694947285,weight:-.028229129254167384},balanceofvisualparentX:{mean:-.007559473558332495,std:.3227787688513554,weight:-.13312017596904124},balanceofvisualparentY:{mean:-.010450324811186476,std:.4524201239517186,weight:-.09532942482280946},totalalignmentlines:{mean:-.0009045680687471732,std:.5654767847212782,weight:.007683119790124987},CellAspectRatio:{mean:-.000866027015147402,std:1.4808460165726252,weight:-.2282126421778498},AreaPercentImages:{mean:.0011783622381679377,std:.3209991901820274,weight:.40897766247230655},ImageCellContentFit:{mean:-.0010022863121065778,std:.06839864851764367,weight:-.035663159273769146},AverageCellSize:{mean:-.003853477920843118,std:.3674675336869799,weight:-.0861206668785603},AverageImageCellSize:{mean:.0014705706334928255,std:.30689611738107436,weight:-.310870215199779},AverageTextCellSize:{mean:.0030857846907960075,std:.3190234573570835,weight:.03296304542028719},ImageCellVariance:{mean:.0008047901252859525,std:.06410991367658431,weight:-.024296079984680582},TextCellVariance:{mean:.0036032703466117107,std:.14545169804975572,weight:.08747903039684307},OverallCellVariance:{mean:.010513688422152926,std:.3036485447684895,weight:.006791166993508748},TypeSymmetryAcrosstheXAxis:{mean:.0025981146277427093,std:.43849102556669445,weight:-.2902662035011975},TypeSymmetryAcrosstheYAxis:{mean:-.0007791864813152262,std:.45283696286437347,weight:-.23419662370595393},TypeAsymmetryAcrosstheXAxis:{mean:.008912652724408086,std:.7331157676033474,weight:-.09727780755199468},TypeAsymmetryAcrosstheYAxis:{mean:.010873023708513306,std:.6982196294438795,weight:.03350849616250007},CellSymmetryAcrosstheXAxis:{mean:-.001132162147191269,std:.33392704164452364,weight:.06266679976903884},CellSymmetryAcrosstheYAxis:{mean:-.0005155668142621847,std:.33292297327240367,weight:-.058041551211506504},CellAsymmetryAcrosstheXAxis:{mean:.001132162147191268,std:.33392704164452364,weight:-.06266679976903927},CellAsymmetryAcrosstheYAxis:{mean:.0005155668139908147,std:.3329229732722636,weight:.058041551397742044},AverageImageXVal:{mean:-.0015815559988986917,std:.15008002059800904,weight:-.06098982378772082},AverageImageYVal:{mean:7891179554016043e-20,std:.1438772538377358,weight:-.10273553740768389},AverageTextXVal:{mean:.0049443186134623075,std:.25262901903129675,weight:-.025304213039208205},AverageTextYVal:{mean:.004664303074648295,std:.26747263439055524,weight:.012656120935728677},ImageSpreadinXDimension:{mean:-.00310888031836687,std:.28336827022361394,weight:.24726198560445092},ImageSpreadinYDimension:{mean:.0031367634820247538,std:.27346012927936375,weight:.1989040843352687},TextSpreadinXDimension:{mean:.00650620828022051,std:.4043232862187427,weight:-.1293283969219272},TextSpreadinYDimension:{mean:.007645995665318362,std:.40379994376989187,weight:-.011516607422389176},MaxImageXOffsetFromCenter:{mean:.0016157427991856622,std:.14246903105574066,weight:-.020089296400970874},MaxImageYOffsetFromCenter:{mean:-.0008679463633771875,std:.12934639704481982,weight:-.15444476815025124},MaxTextXOffsetFromCenter:{mean:.0007758562872193546,std:.10612718654583783,weight:-.08563320326004221},MaxTextYOffsetFromCenter:{mean:.0025601067703762033,std:.14804047677121857,weight:.0002795079579061673},TextFocused:{mean:1.1008033251432315e-9,std:3.747646504742835e-7,weight:.011466692333776875},TextDispersement:{mean:.006047062110539865,std:.38381427709455296,weight:.025895655099346427},AdjacentMatches:{mean:.001957343375687507,std:.24482209931437043,weight:-.021211802454498736},AdjacentMismatches:{mean:.005279201174289879,std:.4373270531182902,weight:.0011997430973767964},PreviousOrder:{mean:-.004296698326549073,std:.7698699665723179,weight:-.004121330693776555},PreviousPosition:{mean:.0040594447624014525,std:.4015754424391129,weight:.02671704069247397},PreviousPositionFlip:{mean:.009238177093947593,std:1.072273993426883,weight:.14746380228860045}},DefaultGridScore:{CellAspectRatio:{mean:0,std:1,weight:-.571428571428571},AreaPercentImages:{mean:0,std:1,weight:.3},ImageCellContentFit:{mean:0,std:1,weight:-10},AverageCellSize:{mean:0,std:1,weight:.4},AverageImageCellSize:{mean:0,std:1,weight:.3},AverageTextCellSize:{mean:0,std:1,weight:.2},ImageCellVariance:{mean:0,std:1,weight:-.7},TextCellVariance:{mean:0,std:1,weight:-.7},OverallCellVariance:{mean:0,std:1,weight:0},TypeSymmetryAcrosstheXAxis:{mean:0,std:1,weight:1.42857142857143},TypeSymmetryAcrosstheYAxis:{mean:0,std:1,weight:1.42857142857143},TypeAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-1.42857142857143},TypeAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-1.42857142857143},CellSymmetryAcrosstheXAxis:{mean:0,std:1,weight:.285714285714286},CellSymmetryAcrosstheYAxis:{mean:0,std:1,weight:.285714285714286},CellAsymmetryAcrosstheXAxis:{mean:0,std:1,weight:-.285714285714286},CellAsymmetryAcrosstheYAxis:{mean:0,std:1,weight:-.285714285714286},AverageImageXVal:{mean:0,std:1,weight:0},AverageImageYVal:{mean:0,std:1,weight:0},AverageTextXVal:{mean:0,std:1,weight:0},AverageTextYVal:{mean:0,std:1,weight:0},ImageSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},ImageSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinXDimension:{mean:0,std:1,weight:.571428571428571},TextSpreadinYDimension:{mean:0,std:1,weight:.571428571428571},MaxImageXOffsetFromCenter:{mean:0,std:1,weight:0},MaxImageYOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextXOffsetFromCenter:{mean:0,std:1,weight:0},MaxTextYOffsetFromCenter:{mean:0,std:1,weight:0},TextFocused:{mean:0,std:1,weight:.142857142857143},TextDispersement:{mean:0,std:1,weight:1.17142857142857},AdjacentMatches:{mean:0,std:1,weight:-2.85714285714286},AdjacentMismatches:{mean:0,std:1,weight:2.85714285714286},PreviousOrder:{mean:0,std:1,weight:-1},PreviousPosition:{mean:0,std:1,weight:-1},PreviousPositionFlip:{mean:0,std:1,weight:-.5},PreviousImageSize:{mean:0,std:1,weight:-10}}},getData:function(e,t){return o.keys(a.weights).includes(e)&&o.keys(a.weights[e]).includes(t)?a.weights[e][t]:{mean:0,std:1,weight:0}}}}),a)},pFDI:function(e,t,r){var a,n=t,o=r("oAGj"),i=r("Z25M"),l=r("FNB+"),u=r("6ZWm"),s=r("wc1n"),c=r("dE3O"),m=r("ERpL");n.ShapeFeatureExtractor=(a=function(e,t){void 0===t&&(t=[]),this.root_=e.root,this.forma_=e,this.forFeatures_=o.clone(t),this.featureEvals_=[],s.FeatureExtractor.call(this),this.initFeatures(),this.evaluateFeatures()},o.defineClass({name:"ShapeFeatureExtractor",ctor:a,superName:"FeatureExtractor",statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{initFeatures:function(){this.featureEvals_=[["BoundingBox",[this.evaluateBoundingBox,s.FeatureType.Complex]],["ShapeWidth",[this.evaluateShapeWidth,s.FeatureType.Numerical]],["ShapeHeight",[this.evaluateShapeHeight,s.FeatureType.Numerical]],["Area",[this.evaluateArea,s.FeatureType.Numerical]],["CenterX",[this.evaluateCenterX,s.FeatureType.Numerical]],["CenterY",[this.evaluateCenterY,s.FeatureType.Numerical]],["RotCosine",[this.evaluateRotCosine,s.FeatureType.Numerical]],["RotSine",[this.evaluateRotSine,s.FeatureType.Numerical]],["PercentageDesignArea",[this.evaluatePercentageDesignArea,s.FeatureType.Numerical]],["PercentageOutofBounds",[this.evaluatePercentageOutofBounds,s.FeatureType.Numerical]],["PageHeight",[this.evaluatePageHeight,s.FeatureType.Numerical]],["PageWidth",[this.evaluatePageWidth,s.FeatureType.Numerical]],["ShapeCount",[this.evaluateShapeCount,s.FeatureType.Numerical]],["TextCount",[this.evaluateTextCount,s.FeatureType.Numerical]],["BackgroundImageCount",[this.evaluateBackgroundImageCount,s.FeatureType.Numerical]],["ForegroundImageCount",[this.evaluateForegroundImageCount,s.FeatureType.Numerical]]],this.evaluateOverlappingFeatures(),this.evaluateShapeMaskFeatures()},evaluateOverlappingFeatures:function(){for(var e=o.clone(this.root_.visitAsArray(l.FormaTraversal.PreOrder)),t=0,r=0,a=0,n=0,i=o.iter(e);!i.done;i.next()){var u=i.value;if(null!=u.controller&&u.controller.floating&&!u.isGridCell()&&"temp-struct-vis"!=u.intent&&u!=this.forma_){if(u.parent==this.forma_.parent){var c=this.forma_.parent.indexOfChild(this.forma_),m=this.forma_.parent.indexOfChild(u);if(null!=c&&null!=m&&c>m)continue}var g,h,f;if((g=u.finalFrame)&&(h=this.forma_.finalFrame)&&(f=g.intersectionWith(h))){var v=this.forma_.getAverageAlpha(g),p=f.area/h.area;v>.01&&p>.05&&(u.isTypeLockup()?(r+=1,a+=v*p):(t+=1,n+=v*p))}}}this.setFeature("OverlappingGraphicCount",t,s.FeatureType.Numerical),this.setFeature("OverlappingTextCount",r,s.FeatureType.Numerical),this.setFeature("PercentageTextOverlap",a,s.FeatureType.Numerical),this.setFeature("PercentageGraphicOverlap",n,s.FeatureType.Numerical)},evaluateShapeMaskFeatures:function(){var e,t=0,r=0;if((e=this.forma_.maskImage)&&!e.isEmpty()){var a=c.ImageProcessingUtils.getEdgeMagnitudeImage(e);t=e.sum()/o.toDouble(e.numElements),r=a.sum()/o.toDouble(e.numElements)}this.setFeature(m.ShapeRoleFeatures.MaskAverage,t,s.FeatureType.Numerical),this.setFeature(m.ShapeRoleFeatures.MaskAverageEdge,r,s.FeatureType.Numerical)},evaluateFeatures:function(){for(var e=0==this.forFeatures_.length,t=o.iter(this.featureEvals_);!t.done;t.next()){var r=t.value;if(e||!e&&this.forFeatures_.includes(r[0])){var a=r[1],n=(0,a[0])(this);this.setFeature(r[0],n,a[1])}}},evaluateBoundingBox:function(e){return i.DesignFeatureUtils.getFormaBoundingBox(e.forma_)},evaluateShapeWidth:function(e){return i.DesignFeatureUtils.getFormaWidth(e.forma_)},evaluateShapeHeight:function(e){return i.DesignFeatureUtils.getFormaHeight(e.forma_)},evaluateArea:function(e){return e.numericalFeatures_.ShapeWidth*e.numericalFeatures_.ShapeHeight},evaluateCenterX:function(e){return i.DesignFeatureUtils.getFormaCenterX(e.forma_)},evaluateCenterY:function(e){return i.DesignFeatureUtils.getFormaCenterY(e.forma_)},evaluateRotCosine:function(e){return e.forma_.totalPlacement.transformValues.rotCosine},evaluateRotSine:function(e){return e.forma_.totalPlacement.transformValues.rotSine},evaluatePercentageDesignArea:function(e){var t=e.root_.finalFrame.area;return e.numericalFeatures_.Area/t},evaluatePercentageOutofBounds:function(e){var t,r,a=0;return(t=e.forma_.finalFrame)&&(r=e.root_.finalFrame.intersectionWith(t))&&(a=(t.area-r.area)/t.area),a},evaluateOverlappingGraphicCount:function(e){var t,r,a=0;return(t=e.forma_.finalFrame)&&(r=e.root_.finalFrame.intersectionWith(t))&&(a=(t.area-r.area)/t.area),a},evaluateShapeCount:function(e){return i.DesignFeatureUtils.getShapeCount(e.root_)},evaluateTextCount:function(e){return i.DesignFeatureUtils.getTextCount(e.root_)},evaluatePageWidth:function(e){return i.DesignFeatureUtils.getPageWidth(e.root_)},evaluatePageHeight:function(e){return i.DesignFeatureUtils.getPageHeight(e.root_)},evaluateBackgroundImageCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&e.isGridCell()})).length)},evaluateForegroundImageCount:function(e){return o.toDouble(e.root_.filterWithCallback((function(e){return null!=e.controller&&e.controller.kind==u.FrameController.KIND&&!e.isGridCell()})).length)}}}),a)},wc1n:function(e,t,r){var a,n,o=t,i=r("oAGj"),l=r("Bqrm"),u=r("c3Vl"),s=r("pnSN"),c=r("cbNz"),m=r("KsJe"),g=r("Yudi"),h=r("pFDI");o.FeatureExtractorProtocol=i.defineProtocol("FeatureExtractorProtocol",{features:"Dictionary<String>",numericalFeatures:"Dictionary<String>",categoricalFeatures:"Dictionary<String>"}),o.FeatureExtractor=(a=function(){this.numericalFeatures_={},this.categoricalFeatures_={},this.complexFeatures_={},this.allFeatures_={}},i.defineClass({name:"FeatureExtractor",ctor:a,statics:{_implements:function(e){return"FeatureExtractorProtocol"==e}},props:{setFeature:function(e,t,r){r==o.FeatureType.Categorical?this.categoricalFeatures_[e]=i.as(t,"String"):r==o.FeatureType.Numerical?this.numericalFeatures_[e]=i.as(t,"Double"):this.complexFeatures_[e]=t,this.allFeatures_[e]=t},getFeature:function(e){return this.allFeatures_[e]},features:{get:function(){return this.allFeatures_}},numericalFeatures:{get:function(){return this.numericalFeatures_}},categoricalFeatures:{get:function(){return this.categoricalFeatures_}},featureForKey:function(e){return null!=this.features[e]?this.features[e]:null},numericFeatureForKey:function(e){return null!=this.numericalFeatures[e]?this.numericalFeatures[e]:null},categoricalFeatureForKey:function(e){return null!=this.categoricalFeatures_[e]?this.categoricalFeatures_[e]:null}}}),a),o.FeatureExtractorFactory=(n=function(){},i.defineClass({name:"FeatureExtractorFactory",ctor:n,statics:{getFeatureExtractor:function(e,t,r){switch(void 0===r&&(r=[]),e){case 0:return new u.DesignStyleFeatureExtractor(t,i.clone(r));case 1:return new m.LockupStyleFeatureExtractor(t,i.clone(r));case 2:return new c.GridStyleFeatureExtractor(i.as(t,s.GroupForma),void 0,void 0,void 0,void 0,void 0,i.clone(r));case 3:return new l.DesignConstraintFeatureExtractor(t,i.clone(r));case 4:return new h.ShapeFeatureExtractor(t,i.clone(r));case 5:return new g.RetargetFeatureExtractor(t,i.clone(r))}}}}),n),o.FeatureExtractorType=i.defineEnum("FeatureExtractorType",{DesignStyle:0,LockupStyle:1,GridStyle:2,DesignConstraint:3,Shape:4,Retarget:5}),o.FeatureType=i.defineEnum("FeatureType",{Numerical:0,Categorical:1,Complex:2})}}]);
//# sourceMappingURL=vendors_npm_spark_cd7b838a-99d58d0e.js.map